"use strict";(self.webpackChunkwlx_docs=self.webpackChunkwlx_docs||[]).push([[90693],{28453:(e,n,t)=>{t.d(n,{R:()=>a,x:()=>i});var o=t(96540);const l={},s=o.createContext(l);function a(e){const n=o.useContext(s);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),o.createElement(s.Provider,{value:n},e.children)}},43704:(e,n,t)=>{t.d(n,{A:()=>o});const o=t.p+"assets/images/Screenshot 2025-02-09 at 18.04.45-6a1da580fd9aaf6fc8f6432f488d5dc6.png"},74898:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>r,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>i,toc:()=>c});var o=t(74848),l=t(28453);const s={sidebar_position:2},a=void 0,i={id:"frontend/Development/Plugins/Examples/Action Button in UI and Cell Evaluation",title:"Action Button in UI and Cell Evaluation",description:"A ready-to-go example is available in this repository. Clone it to /wljs-notebook/wljs_packages using:",source:"@site/docs/frontend/Development/Plugins/Examples/Action Button in UI and Cell Evaluation.md",sourceDirName:"frontend/Development/Plugins/Examples",slug:"/frontend/Development/Plugins/Examples/Action Button in UI and Cell Evaluation",permalink:"/frontend/Development/Plugins/Examples/Action Button in UI and Cell Evaluation",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1740049094e3,sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Javascript library functions",permalink:"/frontend/Development/Plugins/Examples/Javascript library functions"},next:{title:"New cell type and Kernel evaluation",permalink:"/frontend/Development/Plugins/Examples/New cell type and Kernel evaluation"}},r={},c=[{value:"Summary",id:"summary",level:3},{value:"Preparations",id:"preparations",level:2},{value:"Main Kernel Package",id:"main-kernel-package",level:2},{value:"UI Element",id:"ui-element",level:3},{value:"Creating the Button",id:"creating-the-button",level:3},{value:"Processing cells",id:"processing-cells",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.admonition,{type:"info",children:[(0,o.jsxs)(n.p,{children:["A ready-to-go example is available in ",(0,o.jsx)(n.a,{href:"https://github.com/JerryI/wljs-plugin-example-2",children:"this repository"}),". Clone it to ",(0,o.jsx)(n.code,{children:"<AppData>/wljs-notebook/wljs_packages"})," using:"]}),(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/JerryI/wljs-plugin-example-2\n"})}),(0,o.jsx)(n.p,{children:"Then restart WLJS Notebook."})]}),"\n",(0,o.jsxs)(n.p,{children:["In this short tutorial, we will discuss how to add a basic UI element to the WLJS Notebook interface and cover some fundamentals of cell evaluation. In general, we need to create a package for the ",(0,o.jsx)(n.em,{children:"main kernel"}),"."]}),"\n",(0,o.jsx)(n.h3,{id:"summary",children:"Summary"}),"\n",(0,o.jsx)(n.p,{children:"This tutorial will cover:"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Creating a package for the ",(0,o.jsx)(n.em,{children:"main kernel"})," that adds a new UI action button and a handler function to evaluate all cells in a notebook."]}),"\n",(0,o.jsx)(n.li,{children:"Writing a UI action button template using WLX."}),"\n",(0,o.jsx)(n.li,{children:"Adding a native top-menu button that duplicates the action of the UI button."}),"\n"]}),"\n",(0,o.jsx)(n.h2,{id:"preparations",children:"Preparations"}),"\n",(0,o.jsxs)(n.p,{children:["Use the ",(0,o.jsx)(n.a,{href:"https://github.com/JerryI/wljs-plugin-template",children:"wljs-plugin-template"})," to create a new repository, then clone it to the ",(0,o.jsx)(n.code,{children:"<AppData>/wljs-notebook/wljs_packages"})," folder. For example:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-bash",children:"git clone https://github.com/JerryI/wljs-plugin-example-2\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Next, edit the contents of ",(0,o.jsx)(n.code,{children:"package.json"}),":"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",metastring:'title="package.json"',children:'{\n    "name": "wljs-plugin-example-2",\n    "version": "0.0.1",\n    "description": "An example plugin for WLJS Notebook",\n    "wljs-meta": {\n        "frontend": ["src/Frontend.wl"],\n        "priority": 5000,\n        "category": "Notebook Extensions",\n        "menu": [\n            {\n                "label": "Example Button Evaluate",\n                "event": "example-eval-all",\n                "spawnWindow": false,\n                "type": "button"\n            }\n        ]\n    },\n    "repository": {\n        "type": "git",\n        "url": "https://github.com/JerryI/wljs-plugin-example-2"\n    },\n    "dependencies": {\n        "@rollup/plugin-commonjs": "^25.0.4",\n        "@rollup/plugin-json": "^6.0.0",\n        "@rollup/plugin-node-resolve": "^15.2.1",\n        "@rollup/plugin-terser": "^0.4.4",\n        "rollup": "^3.21.6"\n    }\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["This defines an action button placed in the top-bar menu. When clicked, it triggers the ",(0,o.jsx)(n.code,{children:"example-eval-all"})," event in the global event pool, which we will handle later."]}),"\n",(0,o.jsx)(n.h2,{id:"main-kernel-package",children:"Main Kernel Package"}),"\n",(0,o.jsx)(n.h3,{id:"ui-element",children:"UI Element"}),"\n",(0,o.jsxs)(n.p,{children:["To inject new UI elements, we use the ",(0,o.jsx)(n.code,{children:"CoffeeLiqueur`Notebook`AppExtensions`"})," interface:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-mathematica",metastring:'title="src/Frontend.wl"',children:'BeginPackage["CoffeeLiqueur`Extensions`EvalAllButton`", {\n    "JerryI`Misc`Events`",\n    "JerryI`Misc`Events`Promise`",\n    "JerryI`WLX`Importer`",\n    "JerryI`WLX`WebUI`"\n}]\n\nNeeds["CoffeeLiqueur`Notebook`AppExtensions`" -> "AppExtensions`"];\n\nBegin["`Private`"]\n\nrootFolder = $InputFileName // DirectoryName // ParentDirectory;\n\nbuttonTemplate = ImportComponent[FileNameJoin[{rootFolder, "templates", "Button.wlx"}]];\n\nAppExtensions`TemplateInjection["AppNotebookTopBar"] = buttonTemplate[##, "HandlerFunction" -> processRequest]&;\n\nEnd[]\nEndPackage[]\n'})}),"\n",(0,o.jsx)(n.p,{children:"The packages:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"JerryI`Misc`Events`\nJerryI`Misc`Events`Promise`\n"})}),"\n",(0,o.jsx)(n.p,{children:"are used for event handling. The new UI element is injected via:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-mathematica",children:'AppExtensions`TemplateInjection["AppNotebookTopBar"] = buttonTemplate[##, "HandlerFunction" -> processRequest]&;\n'})}),"\n",(0,o.jsx)(n.h3,{id:"creating-the-button",children:"Creating the Button"}),"\n",(0,o.jsx)(n.p,{children:"A more convenient way to create UI elements is through WLX. We include the necessary contexts:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{children:"JerryI`WLX`Importer`,\nJerryI`WLX`WebUI`\n"})}),"\n",(0,o.jsx)(n.p,{children:"Now, let's create our button:"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-jsx",metastring:'title="templates/Button.wlx"',children:'Component[OptionsPattern[]] := With[{\n    messager = OptionValue["Messanger"], \n    globalControls = OptionValue["Controls"], \n    appEvents = OptionValue["AppEvent"], \n    modals = OptionValue["Modals"],\n    UId = CreateUUID[],\n    listener = CreateUUID[],\n    processRequest = OptionValue["HandlerFunction"]\n},\n\n    EventHandler[listener, {\n        "Button" -> Function[Null,\n            processRequest[globalControls, modals, messager, Global`$Client (*`*)]\n        ]\n    }];\n\n    EventHandler[EventClone[globalControls], {\n        "example-eval-all" -> Function[Null, processRequest[globalControls, modals, messager, Global`$Client (*`*)]]\n    }];\n\n    {\n        <button title="Evaluate all" id="{UId}" class="text-red-400 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-md w-6 h-6">\n            <svg class="w-5 h-5" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg" fill="currentColor">\n                <path d="M2.78 2L2 2.41v12l.78.42 9-6V8l-9-6zM3 13.48V3.35l7.6 5.07L3 13.48z"/>\n                <path fill-rule="evenodd" clip-rule="evenodd" d="M6 14.683l8.78-5.853V8L6 2.147V3.35l7.6 5.07L6 13.48v1.203z"/>\n            </svg>\n        </button>,\n        <WebUIEventListener Type={"click"} Id={UId} Pattern={"Button"} Event={listener} /> \n    }\n]\n\nOptions[Component] = {"Controls"->"", "AppEvent"->"", "Modals"->"", "HandlerFunction" -> Print};\n\nComponent\n'})}),"\n",(0,o.jsx)(n.p,{children:"After restarting the app, you should see a new icon in the top bar and a new menu item."}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:t(43704).A+"",width:"1582",height:"606"})}),"\n",(0,o.jsx)(n.h3,{id:"processing-cells",children:"Processing cells"}),"\n",(0,o.jsxs)(n.p,{children:["As it was mentioned, we want to evaluate all cells, when a user clicks on an icon. Let us go back to ",(0,o.jsx)(n.code,{children:"Frontend.wl"})," and add more packages to work with cells and notebooks"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-mathematica",children:'Needs["CoffeeLiqueur`Notebook`Cells`" -> "cell`"];\nNeeds["CoffeeLiqueur`Notebook`" -> "nb`"];\n'})}),"\n",(0,o.jsxs)(n.p,{children:["Next define ",(0,o.jsx)(n.code,{children:"processRequest"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-mathematica",children:"processRequest[globalControls_String, modals_String, messager_String, client_] := With[{\n    notebookOnline = findNotebook[globalControls]\n},\n\n...\n"})}),"\n",(0,o.jsxs)(n.p,{children:["To find a notebook available in the current window one can ",(0,o.jsx)(n.em,{children:"echo-locate"})," it using a global controls event pool"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-mathematica",children:'findNotebook[messagesPort_] := EventFire[messagesPort, "NotebookQ", True] /. {{___, n_nb`NotebookObj, ___} :> n};\n'})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.strong,{children:"If at least one notebook component is attached to the global events network, it will respond to this pattern."})}),"\n",(0,o.jsx)(n.p,{children:"Then we can sort out input cells and synchronously one by another"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-mathematica",children:'processRequest[globalControls_String, modals_String, messager_String, client_] := With[{\n    notebookOnline = findNotebook[globalControls]\n},\n    If[!MatchQ[notebookOnline, _nb`NotebookObj], \n        EvetFire[messager, "Warning", "No active notebooks"];\n        Return[];\n    ];\n\n    Echo["Processing!"];\n\n    With[{\n        inputCells = Select[notebookOnline["Cells"], cell`InputCellQ]\n    },\n    \n        (* If you don\'t want to handle Kernel requests and prepare the rest -> use Notebooks public API *)\n        runNext[inputCells, Function[cell, EventFire[globalControls, "NotebookCellEvaluate", cell] ] ];\n    ]\n]\n\nrunNext[l_List, f_] := With[{rest = Drop[l, 1]}, \n    Then[f[l // First], Function[Null,\n        runNext[rest, f]\n    ] ]\n] /; Length[l] > 0\n\nrunNext[_List, f_] := Echo["Done!"];\n'})}),"\n",(0,o.jsx)(n.p,{children:"We took a shortcut here. To avoid complexity with requesting kernels, showing dialogs we evaluate cells indirectly using Notebook API interface by firing pattern"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-mathematica",children:'EventFire[globalControls, "NotebookCellEvaluate", cell] _Promise\n'})}),"\n",(0,o.jsxs)(n.p,{children:["as a result an attached notebook (if any) on the events network returns ",(0,o.jsx)(n.code,{children:"Promise"}),", which we can handle using ",(0,o.jsx)(n.code,{children:"Then"})," and propagate to other cell and etc. Global controls event network interconnects modules and temporary exposes end-points of different services."]}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsxs)(n.p,{children:["Full source code can be found in ",(0,o.jsx)(n.a,{href:"https://github.com/JerryI/wljs-plugin-example-2",children:"this repository"})]})})]})}function p(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}}}]);