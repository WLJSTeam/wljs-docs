"use strict";(self.webpackChunkwlx_docs=self.webpackChunkwlx_docs||[]).push([[26252],{10838:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>o,contentTitle:()=>r,default:()=>m,frontMatter:()=>s,metadata:()=>c,toc:()=>d});var i=a(74848),t=a(28453);const s={draft:!1},r=void 0,c={id:"frontend/Advanced/Dynamics/Raster animation",title:"Raster animation",description:"Raster graphics are not well optimized in the WLJS Notebook at the moment. Consider using them as sparingly as possible.",source:"@site/docs/frontend/Advanced/Dynamics/Raster animation.md",sourceDirName:"frontend/Advanced/Dynamics",slug:"/frontend/Advanced/Dynamics/Raster animation",permalink:"/frontend/Advanced/Dynamics/Raster animation",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1743582564e3,frontMatter:{draft:!1},sidebar:"tutorialSidebar",previous:{title:"Proxies",permalink:"/frontend/Advanced/Dynamics/Proxies"},next:{title:"Scoping",permalink:"/frontend/Advanced/Dynamics/Scoping"}},o={},d=[{value:"Implementation",id:"implementation",level:3},{value:"Alternative way",id:"alternative-way",level:4}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"Raster graphics are not well optimized in the WLJS Notebook at the moment. Consider using them as sparingly as possible."})}),"\n",(0,i.jsxs)(n.p,{children:["All raster graphics are rendered using the ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Image/",children:"Image"})," expression, which also supports updates via the ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Interpreter/Offload",children:"Offload"})," expression."]}),"\n",(0,i.jsxs)(n.p,{children:["Let us start with a practical example \u2014 ",(0,i.jsx)(n.strong,{children:"image distortion"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{src:a(34255).A+"",width:"2560",height:"1280"}),"\n",(0,i.jsx)(n.em,{children:"Yandex Open Source Jam 2024"})]}),"\n",(0,i.jsx)(n.p,{children:"Or this one:"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.img,{src:a(69035).A+"",width:"641",height:"482"}),"\n",(0,i.jsxs)(n.em,{children:[(0,i.jsx)(n.a,{href:"https://stackoverflow.com/questions/36174431/how-to-make-a-wave-warp-effect-in-shader",children:"Stack Overflow"})," OpenGL"]})]}),"\n",(0,i.jsx)(n.h3,{id:"implementation",children:"Implementation"}),"\n",(0,i.jsx)(n.p,{children:"First, let's take an example image. Drag and drop it into the editor:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:a(57202).A+"",width:"1530",height:"398"})}),"\n",(0,i.jsx)(n.p,{children:"Then extract the raw data from it as a sequence of bytes:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'img = ImageData[(* image *), "Byte"];\n'})}),"\n",(0,i.jsx)(n.p,{children:"Now we can apply a mapping function to it, which stretches and shrinks pixels periodically:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"shader = Compile[{{img, _Integer, 3}, {phase, _Real}}, Module[{iter},\n  With[{\n    ysize = Length[img],\n    xsize = Length[img[[1]]]\n  },\n    Table[\n      iter = 1.0;\n      Table[With[{\n        yr = y,\n        xr = If[# < 1, 1, If[# > xsize, xsize, #]] &@ Round[iter]\n      },\n\n        iter = iter + (1.0 + 0.7 Sin[6 Pi x / xsize + phase]);\n\n        img[[yr, xr]]\n        \n      ], {x, xsize}], {y, ysize}]\n  ]\n]];\n"})}),"\n",(0,i.jsxs)(n.p,{children:["Here, we use ",(0,i.jsx)(n.code,{children:"Compile"})," to speed up the process since only real arrays are involved. We do not apply any antialiasing filters; it works in the nearest neighbors approximation. Let's check the result using the original ",(0,i.jsx)(n.code,{children:"Byte"})," encoding:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'Image[NumericArray[shader[img, 0], "UnsignedInteger8"], "Byte"] \n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:a(65898).A+"",width:"711",height:"349"})}),"\n",(0,i.jsxs)(n.admonition,{type:"tip",children:[(0,i.jsxs)(n.p,{children:["Always provide a typed numeric array as the first argument to ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Image/",children:"Image"}),". By default, it assumes a ",(0,i.jsx)(n.code,{children:"Real"})," format for pixel data. Therefore, we explicitly specify the encoding by passing ",(0,i.jsx)(n.code,{children:"Byte"})," as the second argument."]}),(0,i.jsx)(n.p,{children:"The most efficient way is to use:"}),(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"UnsignedInteger8"})," : ",(0,i.jsx)(n.code,{children:"Byte"})]}),"\n"]})]}),"\n",(0,i.jsxs)(n.p,{children:["Since performance is great with raster graphics, we can rely on fixed time intervals while animating, or use a straightforward ",(0,i.jsx)(n.code,{children:"Do"})," loop:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 1"',children:'imageFrame = NumericArray[img, "UnsignedInteger8"];\nImage[imageFrame // Offload, "Byte"]\n'})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 2"',children:'Do[\n  imageFrame = NumericArray[shader[img, angle], "UnsignedInteger8"];\n, {angle, 0, 4Pi, 2Pi/30.0}]\n'})}),"\n",(0,i.jsx)(n.p,{children:"The resulting animation:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:a(14929).A+"",width:"482",height:"346"})}),"\n",(0,i.jsx)(n.h4,{id:"alternative-way",children:"Alternative way"}),"\n",(0,i.jsxs)(n.p,{children:["Using ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/AnimationFrameListener",children:"AnimationFrameListener"})," one can get rid of any timers and animate as fast as system allows"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 1"',children:'frameEvent = CreateUUID[];\nangle = 0.;\n\nEventHandler[frameEvent, Function[Null,\n\timageFrame = NumericArray[shader[img, angle], "UnsignedInteger8"];\n\tangle += 2Pi/30.0;\n]];\n\nEventFire[frameEvent, True];\n\nImage[imageFrame // Offload, "Byte", Epilog->{\n\tAnimationFrameListener[imageFrame // Offload, "Frame"->frameEvent]\n}]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["This way it is also suitable for ",(0,i.jsx)(n.a,{href:"/frontend/Exporting/Dynamic%20HTML",children:"Dynamic HTML"})]})]})}function m(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},14929:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/goood-ezgif.com-optimize-f9408ecd1d27eedc351e5015a7aee603.gif"},28453:(e,n,a)=>{a.d(n,{R:()=>r,x:()=>c});var i=a(96540);const t={},s=i.createContext(t);function r(e){const n=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),i.createElement(s.Provider,{value:n},e.children)}},34255:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/Pasted image 20240514150707-b0d1e01e65464a81901279a741e916b7.png"},57202:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/Screenshot 2024-06-16 at 11.17.10-3b523ea15a160307324ea20e8db34d3e.png"},65898:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/Screenshot 2024-05-14 at 15.18.05-7814fe04dc652fa5c9ddf85a3ed942ef.png"},69035:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/Pasted image 20240514150822-e6a140ba047f64db2649e38c40a24b40.png"}}]);