"use strict";(self.webpackChunkwljs_docs=self.webpackChunkwljs_docs||[]).push([[48],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>h});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},p="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),p=c(n),m=r,h=p["".concat(s,".").concat(m)]||p[m]||u[m]||o;return n?a.createElement(h,l(l({ref:t},d),{},{components:n})):a.createElement(h,l({ref:t},d))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,l=new Array(o);l[0]=m;var i={};for(var s in t)hasOwnProperty.call(t,s)&&(i[s]=t[s]);i.originalType=e,i[p]="string"==typeof e?e:r,l[1]=i;for(var c=2;c<o;c++)l[c]=n[c];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},6222:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>u,frontMatter:()=>o,metadata:()=>i,toc:()=>c});var a=n(7462),r=(n(7294),n(3905));const o={sidebar_position:1},l="Architecture of symbols",i={unversionedId:"interpreter/Advanced/architecture",id:"interpreter/Advanced/architecture",title:"Architecture of symbols",description:"Features",source:"@site/docs/interpreter/Advanced/architecture.md",sourceDirName:"interpreter/Advanced",slug:"/interpreter/Advanced/architecture",permalink:"/wljs-docs/docs/interpreter/Advanced/architecture",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"interpreterSidebar",previous:{title:"Advanced",permalink:"/wljs-docs/docs/category/advanced"},next:{title:"Containers",permalink:"/wljs-docs/docs/interpreter/Advanced/containers"}},s={},c=[{value:"Features",id:"features",level:2},{value:"Symbol definition",id:"symbol-definition",level:3},{value:"Contexts",id:"contexts",level:3},{value:"External  functions",id:"external--functions",level:3},{value:"Metadata",id:"metadata",level:3},{value:"Methods | Sub-symbols",id:"methods--sub-symbols",level:4},{value:"DOM",id:"dom",level:4},{value:"Global and local memory",id:"global-and-local-memory",level:4}],d={toc:c},p="wrapper";function u(e){let{components:t,...o}=e;return(0,r.kt)(p,(0,a.Z)({},d,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"architecture-of-symbols"},"Architecture of symbols"),(0,r.kt)("h2",{id:"features"},"Features"),(0,r.kt)("p",null,"Let us show the most essential parts"),(0,r.kt)("h3",{id:"symbol-definition"},"Symbol definition"),(0,r.kt)("p",null,"In general the rule is"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"context.Symbol = async (arguments, env) => {\n    //evaluating arguments\n    const a = await interpretate(arguments[0], env);\n    //body\n    some calculations\n    //may return or not\n    return result;\n}\n")),(0,r.kt)("h3",{id:"contexts"},"Contexts"),(0,r.kt)("p",null,"To prevent the mess of duplicated function names and etc, you can specify the context or let's say library of symbols using"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"var library = {};\ninterpretate.extendContext(library);\n\nlibrary.Symbol = async (args, env) => {/*...*/}\n")),(0,r.kt)("p",null,"The interpreter will check all available contexts and find the first match. However, you can prioritize the context providing the information in ",(0,r.kt)("inlineCode",{parentName:"p"},"env")," object"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"core.GrandSymbol = async (args, env) => {\n    const data = await interpretate(args, {...env, context: library});\n    //...\n}\n")),(0,r.kt)("p",null,"More about ",(0,r.kt)("inlineCode",{parentName:"p"},"env")," object is here ",(0,r.kt)("a",{parentName:"p",href:"#Meta%20Data"},"Meta Data"),"."),(0,r.kt)("p",null,"In the same manner, the separation between ",(0,r.kt)("inlineCode",{parentName:"p"},"Line[]")," used in ",(0,r.kt)("inlineCode",{parentName:"p"},"Graphics3D")," and in ",(0,r.kt)("inlineCode",{parentName:"p"},"Graphics")," functions was made."),(0,r.kt)("h3",{id:"external--functions"},"External  functions"),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"This feature is still in development")),(0,r.kt)("p",null,"If the called expression was not found in all available contexts, the interpreter will extend ",(0,r.kt)("inlineCode",{parentName:"p"},"core")," with a server-call, i.e. ",(0,r.kt)("strong",{parentName:"p"},"will ask kernel to evaluate the unknown symbol and return back the result"),"."),(0,r.kt)("p",null,"By the default, those special missing expressions becomes in the end virtual containers and can call ",(0,r.kt)("inlineCode",{parentName:"p"},"update")," method on other containerized functions."),(0,r.kt)("p",null,"See ",(0,r.kt)("a",{parentName:"p",href:"/wljs-docs/docs/frontend/Advanced/executables"},"executables")," and ",(0,r.kt)("a",{parentName:"p",href:"#Methods%20Sub%20symbols"},"Sub symbols")," for more information about methods and etc."),(0,r.kt)("h3",{id:"metadata"},"Metadata"),(0,r.kt)("p",null,"To share some data between functions, to use local and global memory of the executable objects, specifying methods of evaluation and DOM access the following object is provided"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"env = {\n    element: document.element, /* a Code Mirror widget */\n\n    context: core, /* default context */\n\n    /* subsymbol */\n    method: undefined | 'update' | 'destory',\n\n    /* global and local memory of front-end objects*/\n    local: {},\n    global: {call: uid},\n\n    numerical: false, /* keep symbolic or not */\n    hold: false /* keep exps in a List and JS Objects */\n    unsafe: false /* allows to ask Wolfram Kernel for undefined symbols */\n\n    novirtual: false /* prevents creatation of virtual containers (all functions inside are executed normally) */\n\n    /* anything you want to share */\n    root: ExecutableObject/* a reference to the FrontEndObject container */\n\n    ...\n    //anything else you want\n}\n")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"local")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"global")," cannot be deeply-copied, therefore they will be the same for all nested expressions if the expression is containerized (frontend object or virtual), then ",(0,r.kt)("inlineCode",{parentName:"p"},"local")," will be overridden."),(0,r.kt)("p",null,"Ones, which ave the most influence to the process of interpreting, are"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"context")," - prioritizes the context to fetch, the symbol to evaluate. See section ",(0,r.kt)("a",{parentName:"li",href:"#Contextes"},"Contexts")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"method")," - it is meant to specify a sub-symbol for the whole three of WL expression (or in practice so-called method of interpreting)")),(0,r.kt)("h4",{id:"methods--sub-symbols"},"Methods | Sub-symbols"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"undefined")," (leave empty)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"update")," - usually called when the sub-expression was updated"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"destroy")," - used only on the wolfram frontend, when the widget was removed")),(0,r.kt)("p",null,"The following sub-symbols can be defined as"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"core.MySymbol = (args, env) => {}\ncore.MySymbol.update = (args, env) => {}\ncore.MySymbol.destory = (args, env) => {}\n")),(0,r.kt)("p",null,"You can think about it if it was a class definition with a constructor and several methods."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"It is good to declare ",(0,r.kt)("inlineCode",{parentName:"p"},"update")," method for your function, even if you do not plan to use it explicitly, define ",(0,r.kt)("inlineCode",{parentName:"p"},"core.MySymbol.update = core.MySymbol")," ")),(0,r.kt)("p",null,"For the sake of performance, when something changes with the data inside the plot, there is no need to reevaluate the whole tree of WL expressions. Therefore, we can specify the method of reevaluation"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"//to create a plot\ncore.ListLinePlotly = (args, env) => {\n    ...\n    Plotly.newPlot(env.element, data)\n}\n\n//to update only the data\ncore.ListLinePlotly.update = (args, env) => {\n    ...\n    Plotly.restyle(env.element, newdata)\n}\n")),(0,r.kt)("p",null,"When a nested expression was changed, the nearest parent can be called using ",(0,r.kt)("inlineCode",{parentName:"p"},"update")," method like on a picture"),(0,r.kt)("p",null,(0,r.kt)("img",{src:n(515).Z,width:"914",height:"468"})),(0,r.kt)("p",null,"In principle, interpreter has no idea about what ",(0,r.kt)("inlineCode",{parentName:"p"},"update"),' and etc means, one can write any "method", which is basically just a sub-symbol.'),(0,r.kt)("p",null,"For ",(0,r.kt)("inlineCode",{parentName:"p"},"Graphics3D")," object is crucial to use ",(0,r.kt)("inlineCode",{parentName:"p"},"destroy")," method, when object has removed from the editor, since it is necessary to remove the ",(0,r.kt)("inlineCode",{parentName:"p"},"animation")," cycle"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"core.Graphics3D.destroy = (args, env) => {\n    cancelAnimationFrame(env.local.aid);\n    //to cancel the animation\n}\n")),(0,r.kt)("h4",{id:"dom"},"DOM"),(0,r.kt)("p",null,"When the WL expressing is called via ",(0,r.kt)("inlineCode",{parentName:"p"},"FrontEndVirtual")," on editor's side it creates ",(0,r.kt)("inlineCode",{parentName:"p"},"local")," memory and unique identifier, where one can attach DOM element using"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-mathematica"},'AttachDOM["dom-element-id"]\n')),(0,r.kt)("p",null,"which is accessible by ",(0,r.kt)("inlineCode",{parentName:"p"},"env.element")," field"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"core.Canvas = (args, env) => {\n    const canvas = document.createElement('canvas');\n    env.element.append(canvas);\n    //....\n}\n")),(0,r.kt)("h4",{id:"global-and-local-memory"},"Global and local memory"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"env.global")," is visible to all containers and its inner WL expressions, where ",(0,r.kt)("inlineCode",{parentName:"li"},"env.global.stack")," contains the call-tree"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"env.local")," is isolated memory related to individual ",(0,r.kt)("inlineCode",{parentName:"li"},"executable")," functions, i.e. real or virtual containers.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"core.MyFunction = (args, env) => {\n    env.local  = {} //pointer to the local memory of the instance\n    env.global = {} //pointer to the global memory of the call tree\n    env //sharable memory\n}\n")))}u.isMDXComponent=!0},515:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/data-binding-2.excalidraw-5867e5d17733a0e0e7dc03fc5115c6c7.svg"}}]);