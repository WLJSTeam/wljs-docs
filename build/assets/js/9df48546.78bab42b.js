"use strict";(self.webpackChunkwlx_docs=self.webpackChunkwlx_docs||[]).push([[36529],{1011:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/No Numeric Array-d536f089bbb96027dbb6f9e553d2ad28.gif"},3938:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/dynEx1.excalidraw-515f578e91df9a75e892122da5ef3f68.svg"},12847:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/Screenshot 2025-05-09 at 10.10.55-682be2fbe8ea92b0313b2541d0676b35.png"},28453:(e,n,i)=>{i.d(n,{R:()=>r,x:()=>o});var s=i(96540);const a={},t=s.createContext(a);function r(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:r(e.components),s.createElement(t.Provider,{value:n},e.children)}},44697:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>t,metadata:()=>o,toc:()=>d});var s=i(74848),a=i(28453);const t={draft:!1},r="Performance Tips",o={id:"frontend/Advanced/Dynamics/Performance tips",title:"Performance Tips",description:"Post processing on frontend",source:"@site/docs/frontend/Advanced/Dynamics/Performance tips.md",sourceDirName:"frontend/Advanced/Dynamics",slug:"/frontend/Advanced/Dynamics/Performance tips",permalink:"/frontend/Advanced/Dynamics/Performance tips",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1749492433e3,frontMatter:{draft:!1},sidebar:"tutorialSidebar",previous:{title:"Offloading calculations",permalink:"/frontend/Advanced/Dynamics/Offloading calculations"},next:{title:"Prototyping",permalink:"/frontend/Advanced/Dynamics/Prototyping"}},c={},d=[{value:"Post processing on frontend",id:"post-processing-on-frontend",level:2},{value:"Multiple symbols to 1 primitive",id:"multiple-symbols-to-1-primitive",level:2},{value:"Tables of data",id:"tables-of-data",level:2},{value:"Full Load on the Kernel \u2705",id:"full-load-on-the-kernel-",level:3},{value:"Math operations for free",id:"math-operations-for-free",level:4},{value:"Using the Frontend",id:"using-the-frontend",level:3},{value:"Naive Approach 1 \u274c",id:"naive-approach-1-",level:5},{value:"Naive Approach 2 \u274c",id:"naive-approach-2-",level:5},{value:"Optimized Version \u2705",id:"optimized-version-",level:5},{value:"A Possible Pitfall with <code>With</code>",id:"a-possible-pitfall-with-with",level:3},{value:"Numeric Arrays",id:"numeric-arrays",level:2}];function l(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...e.components},{Details:t}=n;return t||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"performance-tips",children:"Performance Tips"}),"\n",(0,s.jsx)(n.h2,{id:"post-processing-on-frontend",children:"Post processing on frontend"}),"\n",(0,s.jsxs)(n.p,{children:["For instance you are passing some symbol ",(0,s.jsx)(n.code,{children:"vec"})," to ",(0,s.jsx)(n.code,{children:"Graphics"})," primitive and would like to change the order of elements or rescale it."]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Good approach"})," \ud83d\udc4d\ud83c\udffc"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"vec = {1,1};\n\nGraphics[{\n\tArrow[{{0,0}, vec, 2 {vec[[1]], 0.8 vec[[2]]}} // Offload]\n}]\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(12847).A+"",width:"634",height:"396"})}),"\n",(0,s.jsxs)(n.p,{children:["This will work, but will be slightly inefficient when it comes to large arrays of data or multiple copies of ",(0,s.jsx)(n.code,{children:"Arrow"}),"."]}),"\n",(0,s.jsxs)(n.p,{children:["Try to minimize to a single instance of ",(0,s.jsx)(n.code,{children:"vec"})," :"]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"Best approach"})," \ud83d\udc4c"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"vec = {1,1};\n\nGraphics[{\n\tArrow[With[{x = vec}, {{0,0}, x, {2 x[[1]], 1.6 x[[2]]}}] // Offload]\n}]\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Then if you set ",(0,s.jsx)(n.code,{children:"vec = RandomReal[{0,1}, 2]"})," it will ",(0,s.jsx)(n.strong,{children:"only cause 1 revaluation"})," of ",(0,s.jsx)(n.code,{children:"vec"})," instance."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Think of an onion from the Shrek movie!"})}),"\n",(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:"Possible wrong solution"}),(0,s.jsx)(n.p,{children:"You might try to do the following \u274c"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"Graphics[{\n\tWith[{x = vec}, Arrow[{{0,0}, x, {2 x[[1]], 1.6 x[[2]]}}]] // Offload\n}]\n"})}),(0,s.jsxs)(n.p,{children:["It won't work, since the binding between ",(0,s.jsx)(n.code,{children:"vec"})," and ",(0,s.jsx)(n.code,{children:"Arrow"})," isn't possible. ",(0,s.jsx)(n.code,{children:"Arrow"})," simply does not see its outer expressions."]})]}),"\n",(0,s.jsxs)(n.admonition,{type:"note",children:[(0,s.jsx)(n.p,{children:"The syntax"}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"{2, 1.6} x }]] // Offload\n"})}),(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"is not yet supported by WLJS Interpreter"}),", but absolutely valid for Wolfram Language. Please do ",(0,s.jsxs)(n.strong,{children:["this instead if you place it inside ",(0,s.jsx)(n.code,{children:"Offload"})]})]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"{2 x[[1]], 1.6 x[[2]]} }]] // Offload\n"})})]}),"\n",(0,s.jsx)(n.h2,{id:"multiple-symbols-to-1-primitive",children:"Multiple symbols to 1 primitive"}),"\n",(0,s.jsx)(n.p,{children:"Sometimes you need to controls two parameters at the same time. Then one can write something like this"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"Graphics[{\n\tDisk[pos // Offload, radius // Offload]\n}]\n"})}),"\n",(0,s.jsxs)(n.p,{children:["It will still work, but it depends how you update ",(0,s.jsx)(n.code,{children:"pos"})," and ",(0,s.jsx)(n.code,{children:"radius"}),". If they are completely independent in terms on time it makes sense to couple them to ",(0,s.jsx)(n.code,{children:"Disk"})," equally."]}),"\n",(0,s.jsxs)(t,{children:[(0,s.jsx)("summary",{children:"Optimization"}),(0,s.jsxs)(n.p,{children:["However, if you always update ",(0,s.jsx)(n.code,{children:"pos"})," and ",(0,s.jsx)(n.code,{children:"radius"})," ",(0,s.jsx)(n.strong,{children:"at the same time"}),", you might rewrite it as follows \u2705"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:'Graphics[{\n\tDisk[pos // Offload, Offload[radius, "Static"->True]]\n}]\n'})}),(0,s.jsxs)(n.p,{children:["It might be misleading, but here setting a new value to ",(0,s.jsx)(n.code,{children:"radius"})," won't cause re-evaluation of ",(0,s.jsx)(n.code,{children:"Disk"}),". Then you can update two as"]}),(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"radius = newRadius; (* only sync *)\npos = newPos; (* sync + re-evalaution of Disk *)\n"})}),(0,s.jsxs)(n.p,{children:["Here order matters, if you flip it ",(0,s.jsx)(n.code,{children:"Disk"})," might still use ",(0,s.jsx)(n.code,{children:"radius"})," values from the previous update (1 step lagging behind ",(0,s.jsx)(n.code,{children:"pos"}),")."]})]}),"\n",(0,s.jsx)(n.h2,{id:"tables-of-data",children:"Tables of data"}),"\n",(0,s.jsxs)(n.p,{children:["You can explicitly choose what will be interpreted on the frontend or backend. There are a few possibilities for our function inside the ",(0,s.jsx)(n.code,{children:"Line"})," expression."]}),"\n",(0,s.jsx)(n.h3,{id:"full-load-on-the-kernel-",children:"Full Load on the Kernel \u2705"}),"\n",(0,s.jsx)(n.p,{children:"The simplest, universal and robust solution"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"EventHandler[InputRange[0,4,0.1], Function[data, \n\tlines = With[{y = data}, \n\t\tTable[{Cos[x], Sin[y x]}, {x,0,2Pi, 0.01}]\n\t]\n]];\n% // EventFire (* Just to initialize *)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["The last line manually fires an event to initialize the symbol ",(0,s.jsx)(n.code,{children:"lines"}),". Then, for the output, we can write:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"Graphics[{Cyan, Line[lines // Offload]}]\n"})}),"\n",(0,s.jsx)(n.p,{children:"This binding can be illustrated as shown in the image below:"}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(3938).A+"",width:"434",height:"173"})}),"\n",(0,s.jsx)(n.h4,{id:"math-operations-for-free",children:"Math operations for free"}),"\n",(0,s.jsx)(n.p,{children:"You can apply any basic operation on the data on the frontend almost for free"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"Graphics[{Cyan, Line[2 lines // Offload], Line[lines // Offload]}]\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Then you have two sets of lines, each binds to its own instance of ",(0,s.jsx)(n.code,{children:"lines"})," symbol. It won't cost extra in terms of bandwidth of the communication channel between frontend and backend."]}),"\n",(0,s.jsx)(n.h3,{id:"using-the-frontend",children:"Using the Frontend"}),"\n",(0,s.jsxs)(n.p,{children:["One can move the entire ",(0,s.jsx)(n.code,{children:"Table"})," computation to the browser's side (WLJS Interpreter). Let's discard our previous changes:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"EventHandler[InputRange[0,4,0.1], Function[data, \n\tv = data\n]];\n% // EventFire\n"})}),"\n",(0,s.jsx)(n.h5,{id:"naive-approach-1-",children:"Naive Approach 1 \u274c"}),"\n",(0,s.jsx)(n.p,{children:"A straightforward solution for output could be:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"Graphics[{Cyan, Line[\n\tTable[{Cos[x], Sin[Offload[v] x]}, {x,0,2Pi, 0.1}]\n]}]\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This would be ",(0,s.jsx)(n.strong,{children:"a terrible solution"})," \ud83d\udc4e\ud83c\udffc"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(87971).A+"",width:"806",height:"246"})}),"\n",(0,s.jsxs)(n.p,{children:["Each time the ",(0,s.jsx)(n.code,{children:"Table"})," iterator ",(0,s.jsx)(n.code,{children:"x"})," goes through the range of values, it creates a sublist of ",(0,s.jsx)(n.code,{children:"Sin"})," and ",(0,s.jsx)(n.code,{children:"Cos"})," functions that contain the dynamic variable ",(0,s.jsx)(n.code,{children:"v"}),". This results in multiple instances of ",(0,s.jsx)(n.code,{children:"v"}),"."]}),"\n",(0,s.jsxs)(n.admonition,{type:"danger",children:[(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"Line[Table[Expression[Offload[symbol]], {i, 10}]]\n"})}),(0,s.jsxs)(n.p,{children:["Creates ",(0,s.jsx)(n.code,{children:"10"})," instances of ",(0,s.jsx)(n.code,{children:"symbol"}),". The ",(0,s.jsx)(n.code,{children:"Line"})," function will be called ",(0,s.jsx)(n.strong,{children:"10"})," times on each update of ",(0,s.jsx)(n.code,{children:"symbol"}),"!"]})]}),"\n",(0,s.jsx)(n.admonition,{type:"danger",children:(0,s.jsxs)(n.p,{children:["Avoid placing dynamic symbols inside large ",(0,s.jsx)(n.code,{children:"Table"})," expressions. Minimize the number of copies created."]})}),"\n",(0,s.jsx)(n.h5,{id:"naive-approach-2-",children:"Naive Approach 2 \u274c"}),"\n",(0,s.jsx)(n.p,{children:"Let's try to improve it a bit:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"Graphics[{Cyan, Line[\n\tTable[{Cos[x], Sin[v x]}, {x,0,2Pi, 0.1}] // Offload\n]}]\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This is also ",(0,s.jsx)(n.strong,{children:"inefficient"})," \ud83d\udc4e\ud83c\udffc  The ",(0,s.jsx)(n.code,{children:"Table"})," function still runs on the ",(0,s.jsx)(n.strong,{children:"browser's side"})," and each time ",(0,s.jsx)(n.code,{children:"v"})," gets an update it re-evaluates the whole table"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(69528).A+"",width:"806",height:"360"})}),"\n",(0,s.jsx)(n.h5,{id:"optimized-version-",children:"Optimized Version \u2705"}),"\n",(0,s.jsxs)(n.p,{children:["One can reduce the number of instances to just one using ",(0,s.jsx)(n.code,{children:"With"}),", as shown in the example above:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"Graphics[{Cyan, Line[\n\tWith[{y = v}, \n\t\tTable[{Cos[x], Sin[y x]}, {x,0,2Pi, 0.01}]\n\t] // Offload\n  ]\n}]\n"})}),"\n",(0,s.jsxs)(n.p,{children:["This ",(0,s.jsx)(n.strong,{children:"saves a lot of resources"})," \ud83d\udc4d\ud83c\udffc"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(50865).A+"",width:"806",height:"388"})}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"Line[With[{y = symbol}, Table[AnyBasicExpression[y], {i, 10}]]]\n"})}),(0,s.jsxs)(n.p,{children:["Creates only 1 instance of ",(0,s.jsx)(n.code,{children:"symbol"}),". The ",(0,s.jsx)(n.code,{children:"Line"})," function will be called ",(0,s.jsx)(n.strong,{children:"once"})," per update of ",(0,s.jsx)(n.code,{children:"symbol"}),"."]})]}),"\n",(0,s.jsxs)(n.admonition,{type:"tip",children:[(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"Line[symbol//Offload], ... Line[symbol//Offload]\n"})}),(0,s.jsxs)(n.p,{children:["This is acceptable since each ",(0,s.jsx)(n.code,{children:"Line"})," is bound to its own ",(0,s.jsx)(n.code,{children:"symbol"})," instance. Therefore, on an update of ",(0,s.jsx)(n.code,{children:"symbol"}),", each ",(0,s.jsx)(n.code,{children:"Line"})," expression will be reevaluated once."]})]}),"\n",(0,s.jsxs)(n.h3,{id:"a-possible-pitfall-with-with",children:["A Possible Pitfall with ",(0,s.jsx)(n.code,{children:"With"})]}),"\n",(0,s.jsxs)(n.p,{children:["There might be a temptation to wrap the ",(0,s.jsx)(n.code,{children:"Line"})," expression inside ",(0,s.jsx)(n.code,{children:"With"}),", like this:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"Graphics[{Cyan, With[{y = v}, \n\tLine[\n\t\tTable[{Cos[x], Sin[y x]}, {x,0,2Pi, 0.01}]\n\t]\n] // Offload}]\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"This will not work at all"})," \ud83d\udc4e\ud83c\udffc because the binding will occur between ",(0,s.jsx)(n.code,{children:"Graphics"})," and ",(0,s.jsx)(n.code,{children:"v"})," objects."]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(91350).A+"",width:"773",height:"388"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Think of an onion from the Shrek movie!"})}),"\n",(0,s.jsx)(n.h2,{id:"numeric-arrays",children:"Numeric Arrays"}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.p,{children:["It is usually done automatically by Wolfram Language if the data has been generated using pure functions with ",(0,s.jsx)(n.code,{children:"Map"}),", ",(0,s.jsx)(n.code,{children:"RandomReal"}),", ",(0,s.jsx)(n.code,{children:"Table"})," and etc."]})}),"\n",(0,s.jsxs)(n.p,{children:["When transferring points as nested lists, it is better to wrap them in ",(0,s.jsx)(n.code,{children:"NumericArray"}),". This informs the WLJS Interpreter in the browser that only numbers or lists of numbers are expected, reducing the load during parsing."]}),"\n",(0,s.jsxs)(n.p,{children:["For example, using ",(0,s.jsx)(n.a,{href:"/frontend/Reference/Interpreter/Offload",children:"dynamic"})," symbols:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"(* Every update *)\nsymbol = someFunctionThatReturnsList\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"20 FPS"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(1011).A+"",width:"600",height:"376"})}),"\n",(0,s.jsxs)(n.p,{children:["By using ",(0,s.jsx)(n.code,{children:"NumericArray"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-mathematica",children:"(* Every update *)\nsymbol = NumericArray[someFunctionThatReturnsList]\n"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"~40 FPS"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{src:i(98609).A+"",width:"600",height:"376"})})]})}function h(e={}){const{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(l,{...e})}):l(e)}},50865:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/dynEx4.excalidraw-021e439e911cbe6b419ae7724cf8f9f7.svg"},69528:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/dynEx3.excalidraw-24bca3989528b40d91907ea5f9631431.svg"},87971:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/dynEx2.excalidraw-fed62bc73e874b4f01527b4053db2eb5.svg"},91350:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/dynEx5.excalidraw-bdd264bc0acfa8fcadd2a9a4eb3215c9.svg"},98609:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/NumericArray video-78168ba367ec3234e74be058af7ba4ea.gif"}}]);