"use strict";(self.webpackChunkwlx_docs=self.webpackChunkwlx_docs||[]).push([[59834],{4319:(e,n,s)=>{s.d(n,{A:()=>o});const o=s.p+"assets/images/Screenshot 2025-01-18 at 17.07.10-8be80d41b76497a0f75bad99dc731d64.png"},28453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>l});var o=s(96540);const i={},r=o.createContext(i);function t(e){const n=o.useContext(r);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),o.createElement(r.Provider,{value:n},e.children)}},40320:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>t,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>a});var o=s(74848),i=s(28453);const r={},t=void 0,l={id:"frontend/Development/API/Iframe",title:"Iframe",description:"WLJS Notebook (both desktop app and server) does support special embedding of a notebook window to iframe",source:"@site/docs/frontend/Development/API/Iframe.md",sourceDirName:"frontend/Development/API",slug:"/frontend/Development/API/Iframe",permalink:"/frontend/Development/API/Iframe",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1739462254e3,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Architecture",permalink:"/frontend/Development/Architecture"},next:{title:"REST",permalink:"/frontend/Development/API/REST"}},d={},a=[{value:"URL parameters (optional)",id:"url-parameters-optional",level:3},{value:"<code>root</code>",id:"root",level:4},{value:"Communication",id:"communication",level:2},{value:"Incoming messages",id:"incoming-messages",level:3},{value:"Hotkeys",id:"hotkeys",level:4},{value:"File dialogs",id:"file-dialogs",level:4},{value:"Open request",id:"open-request",level:4},{value:"Outgoing messages",id:"outgoing-messages",level:3},{value:"Promises",id:"promises",level:4},{value:"Commands",id:"commands",level:4}];function c(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(n.p,{children:["WLJS Notebook (both desktop app and server) does support special embedding of a notebook window to ",(0,o.jsx)(n.code,{children:"iframe"})]}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.img,{src:s(4319).A+"",width:"1274",height:"1148"})}),"\n",(0,o.jsx)(n.p,{children:(0,o.jsx)(n.em,{children:"App running inside Obsidian"})}),"\n",(0,o.jsxs)(n.p,{children:["In this regime your hotkeys are redirected to a parent window, top-bar, sidebar as well as control buttons ",(0,o.jsx)(n.strong,{children:"are not drawn"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-url",children:"/iframe/<PATH>\n"})}),"\n",(0,o.jsxs)(n.p,{children:["Use ",(0,o.jsx)(n.code,{children:"/iframe/"})," in the the URL to open any resource in this regime"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-html",children:'<iframe id="yourIframe" src="http://127.0.0.1:20560/iframe/<PATH>"></iframe>\n'})}),"\n",(0,o.jsxs)(n.p,{children:["where ",(0,o.jsx)(n.code,{children:"<PATH>"})," must be an absolute path on your machine to a given notebook, markdown file (see ",(0,o.jsx)(n.a,{href:"/frontend/Importing/Markdown",children:"Markdown"})," or regular ",(0,o.jsx)(n.code,{children:"wl"})," files) or any other supported input format encoded using ",(0,o.jsx)(n.code,{children:"encodeURIComponent()"})," or equivalent."]}),"\n",(0,o.jsx)(n.p,{children:"Ports and hosts can be configured at the startup"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-shell",children:"wolframscript -f Scripts/start.wls host 0.0.0.0 http 20560 ws 20561 ws2 20562 docs 20563\n"})}),"\n",(0,o.jsx)(n.h3,{id:"url-parameters-optional",children:"URL parameters (optional)"}),"\n",(0,o.jsx)(n.h4,{id:"root",children:(0,o.jsx)(n.code,{children:"root"})}),"\n",(0,o.jsx)(n.p,{children:'Provides a "root" folder to lookup files. Any provided path will be added to exposed directories of the web-server'}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-url",children:"/iframe/<PATH>/?root=<ROOT>\n"})}),"\n",(0,o.jsx)(n.admonition,{type:"tip",children:(0,o.jsx)(n.p,{children:"It comes handy, when the working directory is higher by the hierarchy than the notebook folder."})}),"\n",(0,o.jsx)(n.h2,{id:"communication",children:"Communication"}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsxs)(n.p,{children:["Iframe API effectively replaces the communication between Electron main process and WLJS Notebook used in desktop application (",(0,o.jsx)(n.code,{children:"electronAPI"}),")."]})}),"\n",(0,o.jsxs)(n.p,{children:["The communication from the parent window to ",(0,o.jsx)(n.code,{children:"iframe"})," is done using ",(0,o.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Web/API/Window/postMessage",children:(0,o.jsx)(n.code,{children:"postMessage"})})," API, which works even if your window is hosted on other domain."]}),"\n",(0,o.jsxs)(n.p,{children:["On WLJS Notebook side a global Javascript object ",(0,o.jsx)(n.code,{children:"iframeAPI"})," (similar to ",(0,o.jsx)(n.code,{children:"electronAPI"}),") is responsible for handling in-/out- events."]}),"\n",(0,o.jsx)(n.h3,{id:"incoming-messages",children:"Incoming messages"}),"\n",(0,o.jsxs)(n.p,{children:["Attach event listener to ",(0,o.jsx)(n.code,{children:"window"})," object in the parent window as usual"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"window.addEventListener('message', console.warn)\n"})}),"\n",(0,o.jsx)(n.p,{children:"All messages has the following form"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'{\n\t"type": <eventType>\n\t...\n}\n'})}),"\n",(0,o.jsx)(n.h4,{id:"hotkeys",children:"Hotkeys"}),"\n",(0,o.jsx)(n.p,{children:'Since it is cumbersome to capture keypresses inside iframe from the parent window, we redirect all "important" hotkey used in WLJS to the parent window using the following structure'}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'{\n\t"type": \'shortcut\'\n\t"data": <keyCombination>\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["where ",(0,o.jsx)(n.code,{children:"keyCombination"})," can be"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"save"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"abort"})}),"\n",(0,o.jsx)(n.li,{children:(0,o.jsx)(n.code,{children:"togglefocusedcell"})}),"\n"]}),"\n",(0,o.jsx)(n.h4,{id:"file-dialogs",children:"File dialogs"}),"\n",(0,o.jsx)(n.p,{children:"In some situations WLJS can request a file-dialog window to save a notebook. An incoming request has the following form"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'{\n\t"type": \'request\',\n\t"method": \'requestFileWindow\',\n\t"params": <params>,\n\t"promise": <promise>\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["where ",(0,o.jsx)(n.code,{children:"<params>"})," is an ",(0,o.jsx)(n.strong,{children:"array of strings"})," with file extensions to filter in a dialog window, ",(0,o.jsx)(n.code,{children:"<promise>"})," is uuid ",(0,o.jsx)(n.strong,{children:"used to resolve the request"}),"."]}),"\n",(0,o.jsx)(n.p,{children:"The reply from parent window to iframe should have the following form"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:'title="reply"',children:'{\n\t"type": "promise",\n\t"promise": <promise>,\n\t"data": <path>\n}\n'})}),"\n",(0,o.jsxs)(n.p,{children:["where ",(0,o.jsx)(n.code,{children:"<path>"})," is ",(0,o.jsx)(n.strong,{children:"url-encoded absolute path a notebook"})," or other object picked as a destination. To reject the request (a user cancelled dialog) send ",(0,o.jsx)(n.code,{children:"false"})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",metastring:'title="reply"',children:'{\n\t"type": "promise",\n\t"promise": <promise>,\n\t"data": false\n}\n'})}),"\n",(0,o.jsx)(n.h4,{id:"open-request",children:"Open request"}),"\n",(0,o.jsxs)(n.p,{children:["WLJS might request to open a new window with a provided url (for example after ",(0,o.jsx)(n.code,{children:"newnotebook"})," has been called)"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-json",children:'{\n\t"type": "open",\n\t"data": <uriEncodedPath>\n}\n'})}),"\n",(0,o.jsx)(n.h3,{id:"outgoing-messages",children:"Outgoing messages"}),"\n",(0,o.jsxs)(n.p,{children:["To send a command to WLJS Notebook or resolve a request use ",(0,o.jsx)(n.code,{children:"postMessage"})," method"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:'yourIframe.contentWindow.postMessage(message, "*")\n'})}),"\n",(0,o.jsxs)(n.p,{children:["where ",(0,o.jsx)(n.code,{children:"message"})," follows"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"{\n\t'type': <type>, \n\t...\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["The following ",(0,o.jsx)(n.code,{children:"<type>"})," of messages are supported"]}),"\n",(0,o.jsx)(n.h4,{id:"promises",children:"Promises"}),"\n",(0,o.jsx)(n.p,{children:"To resolve or reject the request a parent window should send a message in a form"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"{\n\t'type': 'promise',\n\t'promise': <promise>,\n\t'data': <data>\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["where ",(0,o.jsx)(n.code,{children:"<promise>"})," is uuid of the request and ",(0,o.jsx)(n.code,{children:"<data>"})," is payload."]}),"\n",(0,o.jsx)(n.h4,{id:"commands",children:"Commands"}),"\n",(0,o.jsx)(n.p,{children:"There are several commands you can send to WLJS, most of them originates from UI control buttons and hotkeys of the desktop application. You don't have to support all of them to get the working notebook interface"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"{\n\t'type': 'controls',\n\t'name': <name>\n\t...\n}\n"})}),"\n",(0,o.jsxs)(n.p,{children:["where ",(0,o.jsx)(n.code,{children:"<name>"})," is a command name. The following list covers most internal commands"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"save"})," fires save action in WLJS app"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"saveas"})," first save action with provided absolute path to a file in ",(0,o.jsx)(n.code,{children:"data"})," field, i.e."]}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-js",children:"{\n\t'type': 'controls',\n\t'name': 'saveas',\n\t'data': <urlEncodedPath>\n}\n"})}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"abort"})," fires abort signal to attached kernel and interrupts evaluation"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"changekernel"})," opens an internal dialog to choose kernel"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"unhideallcells"})," unhides all hidden cells"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"clearoutputs"})," cleans up all output cells (deletes)"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"togglecell"})," hides/reveals focused input cell"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"deletecell"})," deletes focused cell"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"evaluateinit"})," evaluates initialization cells"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"newnotebook"})," creates new notebook (see ",(0,o.jsx)(n.a,{href:"#Open%20request",children:"Open request"}),")"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"checkupdates"})," forces to check updates"]}),"\n"]}),"\n",(0,o.jsx)(n.admonition,{type:"note",children:(0,o.jsx)(n.p,{children:"Different extensions may also register their commands, this has to be checked separately."})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(c,{...e})}):c(e)}}}]);