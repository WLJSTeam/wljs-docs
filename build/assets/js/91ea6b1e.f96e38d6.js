"use strict";(self.webpackChunkwlx_docs=self.webpackChunkwlx_docs||[]).push([[83366],{84128:e=>{e.exports=JSON.parse('{"archive":{"blogPosts":[{"id":"/2025/01/08/earth","metadata":{"permalink":"/wljs-docs/blog/2025/01/08/earth","source":"@site/blog/2025-01-08-earth/index.mdx","title":"Modeling Earth","description":"using GeoData, surface plot, and a bunch of other beautiful stuff","date":"2025-01-08T00:00:00.000Z","tags":[{"label":"animation","permalink":"/wljs-docs/blog/tags/animation"},{"label":"geo","permalink":"/wljs-docs/blog/tags/geo"}],"readingTime":1.22,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["animation","geo"],"enableComments":true},"unlisted":false,"nextItem":{"title":"Automata-like shooter. A teaser","permalink":"/wljs-docs/blog/2025/01/07/nier"}},"content":"*using GeoData, surface plot, and a bunch of other beautiful stuff*\\n\\nHave you ever played `Outer Wilds` ? Planets there are so beautiful. That was the main motivation to rebuild one using real elevation data and a bunch of WL\'s magic \\n\\n![](./../EarthROt-ezgif.com-optimize.gif)\\n\\n\x3c!--truncate--\x3e\\n\\nimport { WLJSHTML, WLJSEditor, WLJSStore } from \\"@site/src/components/wljs-reactcells\\";\\n\\n\\n\\n<WLJSStore kernel={require(\'./attachments/kernel.txt\').default} json={require(\'./attachments/a3d056d8-5bf5-48ef-8ab5-9dd6ca7b3d69.txt\').default} notebook={require(\'./attachments/notebook-a3d.wln\').default}/>\\n\\n\\n\\n\\n## Spreading points on a sphere\\nA small task to do\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"a3d056d8-5bf5-48ef-8ab5-9dd6ca7b3d69\\"} id={\\"dbed2cc2-a6ab-4dc3-b3dc-cbd71a1cf00f\\"} type={\\"Input\\"} opts={{}} >{`Graphics3D%5B%7B%0A%20%20Sphere%5B%5D%2C%0A%20%20Red%2C%20PointSize%5B0.01%5D%2C%20SpherePoints%5B1000%5D%2F%2FPoint%0A%7D%5D%0A`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"a3d056d8-5bf5-48ef-8ab5-9dd6ca7b3d69\\"} id={\\"04a84fbc-24c2-4bb1-b575-451b0e04cd03\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%226133ae90-57e8-4be5-8ed4-54d14e466715%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKmxkaGyemWhrompqnWuiaJKWa6lqkppjompqkGJqkmpiZmRuaAgB9OhUh%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\n## Convert to Geo coordinates\\nFind latitude and langitude\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"a3d056d8-5bf5-48ef-8ab5-9dd6ca7b3d69\\"} id={\\"3c740dc6-11ae-4a35-9f92-8e0eb81d3d1e\\"} type={\\"Input\\"} opts={{}} >{`points%20%3D%20SpherePoints%5B5000%5D%3B%0AlatLon%20%3D%20%28%2AFB%5B%2A%29%28%28180%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%28Pi%29%29%28%2A%5DFB%2A%29%20%7B90Degree%20-%20ArcCos%5B%23%5B%5B3%5D%5D%5D%2C%20ArcTan%5B%23%5B%5B1%5D%5D%2C%20%23%5B%5B2%5D%5D%5D%7D%20%26%2F%40%20points%3B%0Aelevation%20%3D%20GeoElevationData%5BGeoPosition%5BlatLon%5D%5D%3B%0Aelevation%20%3D%20%28elevation%20%2B%20Min%5Belevation%5D%29%2FMax%5Belevation%5D%3B`}</WLJSEditor>\\n\\nIn the case if `Geo` did not work. Here is a dump\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"a3d056d8-5bf5-48ef-8ab5-9dd6ca7b3d69\\"} id={\\"30ed7825-e7b1-4ded-a6b6-d39fba872a8b\\"} type={\\"Input\\"} opts={{}} >{`%7Bpoints%2C%20latLon%2C%20elevation%7D%20%3D%20%28%2AVB%5B%2A%29%28Get%5BFileNameJoin%5B%7B%22.iconized%22%2C%20%22iconized-337e.wl%22%7D%5D%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeH5DwTM7Py6xKdcvMSXXKr8j0YOVmAADrbgrN%22%2A%29%28%2A%5DVB%2A%29%3B`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"a3d056d8-5bf5-48ef-8ab5-9dd6ca7b3d69\\"} id={\\"1b4247a1-cc44-4501-a3e0-9209df0ae33c\\"} type={\\"Input\\"} opts={{}} >{`rainbow%20%3D%20ColorData%5B%22DarkRainbow%22%5D%3B%0A%0AListSurfacePlot3D%5BMapThread%5B%28%231%20%280.8%20%2B%200.1%20%232%29%29%26%2C%20%7Bpoints%2C%20elevation%7D%5D%2C%20Mesh-%3ENone%2C%20MaxPlotPoints-%3E100%2C%20ColorFunction%20-%3E%20Function%5B%7Bx%2Cy%2Cz%7D%2C%20rainbow%5B1.5%282%20Norm%5B%7Bx%2Cy%2Cz%7D%5D-1%29%5D%5D%2C%20ColorFunctionScaling%20-%3E%20False%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"a3d056d8-5bf5-48ef-8ab5-9dd6ca7b3d69\\"} id={\\"02c5cf5d-7a4f-489e-8b05-ef95a7f9941b\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%22ef4101c8-35c1-415b-a881-83c0e3a8f8f1%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKp6aZGBoYJlvoGpsmG%2BqaGJom6SZaWBjqWhgnG6QaJ1qkWaQZAgB%2BRxVt%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nThat looks like Earth!\\n\\n## Generating clouds\\nOne can simply use Perlin noise and perform marching cubes\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"a3d056d8-5bf5-48ef-8ab5-9dd6ca7b3d69\\"} id={\\"719ae7b0-e161-4441-86d6-f1f040185bf5\\"} type={\\"Input\\"} opts={{}} >{`n%20%3D%20128%3B%0Ak2%20%3D%20Outer%5BPlus%2C%20%23%2C%20%23%5D%20%26%5BRotateRight%5BN%40Range%5B-n%2C%20n%20-%201%2C%202%5D%2Fn%2C%20n%2F2%5D%5E2%5D%3B%0A%0Aspectrum%20%3D%20With%5B%7Bd%20%3A%3D%20RandomReal%5BNormalDistribution%5B%5D%2C%20%7Bn%2C%20n%7D%5D%7D%2C%0A%20%20%20%281%2Fn%29%20%28d%20%2B%20I%20d%29%2F%280.002%20%2B%20k2%29%5D%3B%20%0Aspectrum%5B%5B1%2C%201%5D%5D%20%2A%3D%200%3B%0A%0Aim%5Bp_%5D%20%3A%3D%20Clip%5BRe%5BInverseFourier%5Bspectrum%20Exp%5BI%20p%5D%5D%5D%2C%20%7B0%2C%20%E2%88%9E%7D%5D%5E0.5%0A%0Ap0%20%3D%20p%20%3D%20Sqrt%5Bk2%5D%3B%0A%0AImage%5Bim%5Bp0%20%2B%3D%20p%5D%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"a3d056d8-5bf5-48ef-8ab5-9dd6ca7b3d69\\"} id={\\"15f7f79a-b712-4778-b301-049aa7c61621\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%22f77ace65-5c0e-4968-abdf-b65fdb70367f%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKp5mbJyanmpnqmiYbpOqaWJpZ6CYmpaTpJpmZpqUkmRsYm5mnAQCRdxZG%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nIt is hard to wrap on the sphere `RegionMesh` function from the standard library. Therefore we will go with an external library\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"a3d056d8-5bf5-48ef-8ab5-9dd6ca7b3d69\\"} id={\\"b3ff92e7-6437-49a7-83b2-e54788c9c86c\\"} type={\\"Input\\"} opts={{}} >{`PacletRepositories%5B%7B%0A%20%20Github%20-%3E%20%22https%3A%2F%2Fgithub.com%2FJerryI%2Fwl-marching-cubes%22%20-%3E%20%22main%22%0A%7D%5D%0A%0A%3C%3CJerryI%60MarchingCubes%60`}</WLJSEditor>\\n\\nNow generate vertices and map them to sphere\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"a3d056d8-5bf5-48ef-8ab5-9dd6ca7b3d69\\"} id={\\"d75e1dd7-938e-4010-8ac6-98b1d034a413\\"} type={\\"Input\\"} opts={{}} >{`With%5B%7Bplain%20%3D%20im%5Bp0%2B%3Dp%5D%7D%2C%20Table%5Bplain%20Exp%5B-%28%20i%29%5E2%2F200.%5D%2C%20%7Bi%2C%20-20%2C20%7D%5D%5D%3B%0A%0A%7Bvertices%2C%20normals%7D%20%3D%20CMarchingCubes%5B%25%2C%200.2%2C%20%22CalculateNormals%22%20-%3E%20False%5D%3B%0A%0Avertices%20%3D%20Map%5BFunction%5Bv%2C%0A%20%20%20%20With%5B%7B%5C%5BRho%5D%20%3D%2050.0%20%2B%200.25%20%28v%5B%5B3%5D%5D%20-%2010%29%2C%20%5C%5BPhi%5D%20%3D%202.0%20Pi%20v%5B%5B1%5D%5D%2F127.0%2C%20%5C%5BTheta%5D%20%3D%20%20Pi%2F2%20%2B%20Pi%20v%5B%5B2%5D%5D%2F127.0%7D%2C%0A%20%20%20%20%20%20%7B%5C%5BRho%5D%20Cos%5B%5C%5BPhi%5D%5D%20Cos%5B%5C%5BTheta%5D%5D%2C%20%5C%5BRho%5D%20Sin%5B%5C%5BPhi%5D%5D%20Cos%5B%5C%5BTheta%5D%5D%2C%20%5C%5BRho%5D%20Sin%5B%5C%5BTheta%5D%5D%7D%0A%20%20%20%20%5D%0A%20%20%5D%0A%2C%20vertices%5D%3B%0A%0A%7B%0A%20%20clouds%20%3D%20GraphicsComplex%5B0.017%20vertices%2C%20Polygon%5B1%2C%20Length%5Bvertices%5D%5D%5D%0A%7D%20%2F%2F%20Graphics3D%3B`}</WLJSEditor>\\n\\nWe shifted $\\\\theta$ angle for purpose, to avoid visibles artifacts on poles.\\n\\n## Combine\\nPlot together\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"a3d056d8-5bf5-48ef-8ab5-9dd6ca7b3d69\\"} id={\\"6ce1f97f-509f-462f-ac04-a72c7f1a8696\\"} type={\\"Input\\"} opts={{}} >{`rainbow%20%3D%20ColorData%5B%22DarkRainbow%22%5D%3B%0AlightPos%20%3D%20%7B-2.4909%2C%204.069%2C%203.024%7D%3B%0A%0ArotationMatrix%20%3D%20RotationMatrix%5B0.%2C%20%7B0%2C0%2C1%7D%5D%3B%0Aangle%20%3D%200.%3B%0A%0Aanimation%20%3D%20CreateUUID%5B%5D%3B%0AEventHandler%5Banimation%2C%20Function%5BNull%2C%0A%20%20lightPos%20%3D%20RotationMatrix%5B1%20Degree%2C%20%7B1%2C1%2C1%7D%5D.lightPos%3B%0A%20%20rotationMatrix%20%3D%20RotationMatrix%5Bangle%2C%20%7B0%2C0%2C1%7D%5D%3B%0A%20%20angle%20%2B%3D%200.5%20Degree%3B%0A%5D%5D%3B%0A%0AListSurfacePlot3D%5B%0A%20%20MapThread%5B%28%231%20%280.8%20%2B%200.1%20%232%29%29%26%2C%20%7Bpoints%2C%20elevation%7D%5D%2C%20%0A%20%20Mesh-%3ENone%2C%20MaxPlotPoints-%3E100%2C%20%0A%20%20ColorFunction%20-%3E%20Function%5B%7Bx%2Cy%2Cz%7D%2C%20rainbow%5B1.5%282%20Norm%5B%7Bx%2Cy%2Cz%7D%5D-1%29%5D%5D%2C%20%0A%20%20ColorFunctionScaling%20-%3E%20False%2C%20%0A%20%20Lighting-%3E%22Default%22%2C%0A%20%20PlotStyle-%3EDirective%5B%22Shadows%22-%3ETrue%2C%20%22CastShadow%22-%3ETrue%5D%2C%0A%0A%20%20Prolog%20-%3E%20%7B%0A%20%20%20%20Directive%5B%22Shadows%22-%3ETrue%2C%20%22CastShadow%22-%3ETrue%5D%2C%0A%20%20%20%20GeometricTransformation%5Bclouds%2C%20rotationMatrix%20%2F%2F%20Offload%5D%2C%0A%20%20%20%20HemisphereLight%5BLightBlue%2C%20Orange%20%2F%2F%20Darker%20%2F%2F%20Darker%5D%2C%0A%20%20%20%20SpotLight%5BOrange%2C%20lightPos%20%2F%2F%20Offload%5D%0A%20%20%7D%2C%0A%0A%20%20Epilog%20-%3E%20AnimationFrameListener%5BlightPos%20%2F%2F%20Offload%2C%20%22Event%22-%3Eanimation%5D%2C%0A%20%20Background-%3EBlack%0A%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"a3d056d8-5bf5-48ef-8ab5-9dd6ca7b3d69\\"} id={\\"702d6017-cbed-4666-b128-adbabfe8716c\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%22c8e48c06-39cf-41b3-b9e8-9d005bb356f5%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKJ1ukmlgkG5jpGlsmp%2BmaGCYZ6yZZplroWqYYGJgmJRmbmqWZAgCHGhWu%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nTo start animation\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"a3d056d8-5bf5-48ef-8ab5-9dd6ca7b3d69\\"} id={\\"94ca22ac-6bae-45bf-8d11-961defbf1114\\"} type={\\"Input\\"} opts={{}} >{`EventFire%5Banimation%2C%20True%5D%3B`}</WLJSEditor>"},{"id":"/2025/01/07/nier","metadata":{"permalink":"/wljs-docs/blog/2025/01/07/nier","source":"@site/blog/2025-01-07-nier.md","title":"Automata-like shooter. A teaser","description":"A game running in the notebook? Ha?! \ud83d\udc3a\ud83d\udc7e","date":"2025-01-07T00:00:00.000Z","tags":[{"label":"short","permalink":"/wljs-docs/blog/tags/short"}],"readingTime":0.235,"hasTruncateMarker":false,"authors":[],"frontMatter":{"title":"Automata-like shooter. A teaser","tags":["short"]},"unlisted":false,"prevItem":{"title":"Modeling Earth","permalink":"/wljs-docs/blog/2025/01/08/earth"},"nextItem":{"title":"Custom input element with 2 ways data-binding","permalink":"/wljs-docs/blog/2024/12/23/2ways"}},"content":"A game running in the notebook? Ha?! \ud83d\udc3a\ud83d\udc7e  \\n\\n![](./GameInWL-ezgif.com-video-to-gif-converter.gif)\\n  \\nI was playing recently too much of Nier:Automata and decided to recreate a hacking mode in WLJS Notebook & Wolfram Language\\n\\n> Sorry for not posting a source code, I will make a blog post later on it"},{"id":"/2024/12/23/2ways","metadata":{"permalink":"/wljs-docs/blog/2024/12/23/2ways","source":"@site/blog/2024-12-23-2ways.md","title":"Custom input element with 2 ways data-binding","description":"It is also possible to combine your custom input element with traditional dynamics. For instance you want to create multiple input fields, which are synchronised  with each other or using some equation.","date":"2024-12-23T00:00:00.000Z","tags":[{"label":"javascript","permalink":"/wljs-docs/blog/tags/javascript"},{"label":"wlx","permalink":"/wljs-docs/blog/tags/wlx"},{"label":"ui","permalink":"/wljs-docs/blog/tags/ui"}],"readingTime":1.55,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"title":"Custom input element with 2 ways data-binding","authors":"jerryi","enableComments":true,"tags":["javascript","wlx","ui"]},"unlisted":false,"prevItem":{"title":"Automata-like shooter. A teaser","permalink":"/wljs-docs/blog/2025/01/07/nier"},"nextItem":{"title":"Point charges plot","permalink":"/wljs-docs/blog/2024/12/16/charges"}},"content":"It is also possible to combine your custom input element with traditional dynamics. For instance you want to create multiple input fields, which are synchronised  with each other or using some equation. \\n\\n\x3c!--truncate--\x3e\\n\\nYou need a WLJS Function with `update` methods defined. One can generate those on-fly for each input element within a WLX script\\n\\n```jsx\\n.wlx\\n\\nCustomInput[sym_, OptionsPattern[]] := Module[{\\n  Label = OptionValue[\\"Label\\"],\\n  Ev = OptionValue[\\"Event\\"],\\n  Pattern = OptionValue[\\"Pattern\\"],\\n  Handler\\n},\\n\\n  With[{Template = \\n    <div class=\\"mt-2 flex\\">\\n      <div style=\\"width: 7rem\\" class=\\"flex shrink-0 items-center rounded-l-md bg-white px-3 text-base text-gray-500 outline outline-1 -outline-offset-1 outline-gray-300 sm:text-sm/6\\"><Label/></div>\\n      <input type=\\"number\\" step=\\"1\\" class=\\"-ml-px block w-full grow rounded-r-md bg-white px-3 py-1.5 text-base text-gray-900 outline outline-1 -outline-offset-1 outline-gray-300 placeholder:text-gray-400 focus:outline focus:outline-2 focus:-outline-offset-2 focus:outline-indigo-600 sm:text-sm/6\\" placeholder=\\"0.0\\"/>\\n    <script type=\\"module\\">\\n      core[\'<Handler/>\'] = async (args, env) => {\\n        const input = env.element.getElementsByTagName(\'input\')[0];\\n\\n\\n        const data = await interpretate(args[0], env);\\n        input.value = +data.toFixed(4);\\n        env.local.input = input;\\n\\n        input.addEventListener(\'change\', () => {\\n          \\n          console.warn(input.value);\\n          env.local.skip = true;\\n          server.kernel.emitt(\'<Ev/>\', input.value, \'<Pattern/>\');\\n        });        \\n      }\\n\\n      core[\'<Handler/>\'].update = async (args, env) => {\\n        if (env.local.skip) {\\n          env.local.skip = false;\\n          return;\\n        }\\n        \\n        console.log(\'Update\');\\n        env.local.input.value = +(await interpretate(args[0], env)).toFixed(4);\\n      }\\n\\n      core[\'<Handler/>\'].destroy = () => {\\n        delete core[\'<Handler/>\'];\\n      }\\n\\n      core[\'<Handler/>\'].virtual = true;\\n    <\/script>\\n  </div>\\n  },\\n    HTMLView[Template, Epilog->(Handler[sym])]\\n  ]\\n]\\n\\nOptions[CustomInput] = {\\"Label\\"->\\"\\", \\"Event\\"->\\"\\", \\"Pattern\\"->\\"Default\\"};\\n```\\n\\nwhat happens here:\\n\\n1. we define a template for our custom input field\\n2. we define a support script with a generated `Handler` function, which reads and updates this input field\\n3. we pack in into `HTMLView`, which calls our `Handler` on a provided argument after this component has been mounted\\n\\nLet\'s see it in action\\n\\n```mathematica @\\nvalues = {1,1};\\n\\nevent = CreateUUID[];\\n\\nEventHandler[event, {\\n  \\"x\\" -> Function[val,\\n    values = {val, (*SpB[*)Power[val(*|*),(*|*)2](*]SpB*)} // N // Re;\\n  ],\\n\\n  \\"x2\\" -> Function[val,\\n    values = {(*SqB[*)Sqrt[val](*]SqB*), val} // N // Re;\\n  ]\\n}];\\n\\n{\\n  CustomInput[values[[1]] // Offload, \\"Event\\"->event, \\"Pattern\\"->\\"x\\", \\"Label\\"->\\"x\\"],\\n  CustomInput[values[[2]] // Offload, \\"Event\\"->event, \\"Pattern\\"->\\"x2\\", \\"Label\\"->\\"x<sup>2</sup>\\"]\\n} // Column\\n```\\n\\n![](./fields-ezgif.com-video-to-gif-converter-553959e2d416c2aa4cc82261b90aa3f0%20(1).gif)"},{"id":"/2024/12/16/charges","metadata":{"permalink":"/wljs-docs/blog/2024/12/16/charges","source":"@site/blog/2024-12-16-charges.md","title":"Point charges plot","description":"Point charges plot using a brand-new Tube","date":"2024-12-16T00:00:00.000Z","tags":[{"label":"graphics","permalink":"/wljs-docs/blog/tags/graphics"},{"label":"short","permalink":"/wljs-docs/blog/tags/short"}],"readingTime":0.055,"hasTruncateMarker":false,"authors":[],"frontMatter":{"title":"Point charges plot","tags":["graphics","short"]},"unlisted":false,"prevItem":{"title":"Custom input element with 2 ways data-binding","permalink":"/wljs-docs/blog/2024/12/23/2ways"},"nextItem":{"title":"Attempts to make sort of a fast OOP structures","permalink":"/wljs-docs/blog/2024/12/04/proxy"}},"content":"Point charges plot using a brand-new `Tube`\\n\\n![](./5404632935589602523%20(1).jpg)\\n\\nSee more [here](https://jerryi.github.io/wljs-demo/pointcharge3D.html)"},{"id":"/2024/12/04/proxy","metadata":{"permalink":"/wljs-docs/blog/2024/12/04/proxy","source":"@site/blog/2024-12-04-proxy.md","title":"Attempts to make sort of a fast OOP structures","description":"Can you image Graphics\xa0to be that fast? \ud83c\udf0a No raster images was used","date":"2024-12-04T00:00:00.000Z","tags":[{"label":"short","permalink":"/wljs-docs/blog/tags/short"},{"label":"graphics","permalink":"/wljs-docs/blog/tags/graphics"}],"readingTime":0.175,"hasTruncateMarker":false,"authors":[],"frontMatter":{"title":"Attempts to make sort of a fast OOP structures","tags":["short","graphics"],"enableComments":false},"unlisted":false,"prevItem":{"title":"Point charges plot","permalink":"/wljs-docs/blog/2024/12/16/charges"},"nextItem":{"title":"Fraunhofer diffraction","permalink":"/wljs-docs/blog/2024/11/25/diffraction"}},"content":"Can you image `Graphics`\xa0to be that fast? \ud83c\udf0a No raster images was used\\n\\n![](./Proxy1-ezgif.com-speed.gif)\\n\\nEach block is\\n\\n```mathematica\\nTranslate[{Opacity[life], RGBColor[life, 0, 1-life], Rectangle[{-1,-1}, {1,1}]}, t]\\n```\\n\\nPlease see `FrontProxy` in the documentation for more information."},{"id":"/2024/11/25/diffraction","metadata":{"permalink":"/wljs-docs/blog/2024/11/25/diffraction","source":"@site/blog/2024-11-25-diffraction.md","title":"Fraunhofer diffraction","description":"Learning Fraunhofer diffraction with Wolfram Language and WLJS Notebook","date":"2024-11-25T00:00:00.000Z","tags":[{"label":"short","permalink":"/wljs-docs/blog/tags/short"},{"label":"physics","permalink":"/wljs-docs/blog/tags/physics"}],"readingTime":0.445,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"Fraunhofer diffraction","tags":["short","physics"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Attempts to make sort of a fast OOP structures","permalink":"/wljs-docs/blog/2024/12/04/proxy"},"nextItem":{"title":"Path-tracing example","permalink":"/wljs-docs/blog/2024/11/20/rtx-refine"}},"content":"Learning Fraunhofer diffraction with Wolfram Language and WLJS Notebook\\n\\n![](./diffraction1-ezgif.com-optimize.gif)\\n\\n\x3c!--truncate--\x3e\\n\\n```mathematica\\namplidute2D[data_] := Module[{d, fw, nRow, nCol},\\n  {nRow, nCol} = Dimensions[data];\\n  d = data;\\n  d = d*(-1)^Table[i + j, {i, nRow}, {j, nCol}];\\n  fw = Fourier[d, FourierParameters -> {1, 1}];\\n  \\n  Log[1 + Abs@fw]\\n]\\n\\n\\nLeakyModule[{\\n  buffer = ImageData[ConstantImage[0, {300,300}], \\"Real32\\"],\\n  shape = InputRaster[ImageSize->{300,300}, \\"AllowUpdateWhileDrawing\\"->True]\\n},\\n\\n  EventHandler[shape, Function[new, \\n    With[{array = ImageData[RemoveAlphaChannel[new, White] // Binarize // ColorNegate, \\"Real32\\"]},\\n      With[{amp = amplidute2D[array]},\\n        buffer = amp / Max[amp];\\n      ];\\n    ]\\n  ]];\\n  \\n  {\\n    shape,\\n    Image[buffer // Offload, \\"Real32\\"]\\n  } // Row\\n]\\n```"},{"id":"/2024/11/20/rtx-refine","metadata":{"permalink":"/wljs-docs/blog/2024/11/20/rtx-refine","source":"@site/blog/2024-11-20-rtx-refine.md","title":"Path-tracing example","description":"We refined our Graphics3D to support different material parameters","date":"2024-11-20T00:00:00.000Z","tags":[{"label":"graphics","permalink":"/wljs-docs/blog/tags/graphics"},{"label":"short","permalink":"/wljs-docs/blog/tags/short"}],"readingTime":0.19,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"title":"Path-tracing example","authors":"jerryi","tags":["graphics","short"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Fraunhofer diffraction","permalink":"/wljs-docs/blog/2024/11/25/diffraction"},"nextItem":{"title":"Introducing non indexed geometry","permalink":"/wljs-docs/blog/2024/11/08/non-indexed"}},"content":"We refined our `Graphics3D` to support different material parameters\\n\\n![](./5327762079077230103.jpg)\\n\\n\x3c!--truncate--\x3e\\n\\n```mathematica\\nGraphics3D[{\\n  Polygon[30 {{-1,-1,0}, {-1,1,0}, {1,1,0}, {1,-1,0}}],\\n  {Directive[\\"Metalness\\"->1, \\"Roughness\\"->0], Sphere[{-5,0,2},2]},\\n  {Directive[\\"Roughness\\"->0], Red, Sphere[{-5,5,2},2]},\\n  {Directive[\\"Roughness\\"->0, \\"Transmission\\"->1.0, \\"MaterialThickness\\"->0.2], Blue, Sphere[{3,-1,2},2]},\\n\\n  {Directive[\\"Emissive\\"->White], Polygon[ {{10,13,0},{10,13,30},{-20,13,30},{-20,13,0}}]}\\n}, Lighting->None, Background->Black, \\"Renderer\\"->\\"PathTracing\\", ImageSize->700]\\n```"},{"id":"/2024/11/08/non-indexed","metadata":{"permalink":"/wljs-docs/blog/2024/11/08/non-indexed","source":"@site/blog/2024-11-08-non-indexed.md","title":"Introducing non indexed geometry","description":"We extended Polygon to support non-indexed with GraphicsComplex","date":"2024-11-08T00:00:00.000Z","tags":[{"label":"graphics","permalink":"/wljs-docs/blog/tags/graphics"},{"label":"dev","permalink":"/wljs-docs/blog/tags/dev"}],"readingTime":0.13,"hasTruncateMarker":false,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"title":"Introducing non indexed geometry","tags":["graphics","dev"],"authors":"jerryi"},"unlisted":false,"prevItem":{"title":"Path-tracing example","permalink":"/wljs-docs/blog/2024/11/20/rtx-refine"},"nextItem":{"title":"RevealJS x WL logo code","permalink":"/wljs-docs/blog/2024/10/25/rtx-logo"}},"content":"We extended `Polygon` to support non-indexed with `GraphicsComplex`\\n\\n\\n![](./nonindeed2-ezgif.com-video-to-gif-converter.gif)\\n\\nThis technique is especially effective together with marching cubes\\n\\n![](./metaballs1-ezgif.com-video-to-gif-converter.gif)\\n\\n__See more in the documentation of `Polygon`__"},{"id":"/2024/10/25/rtx-logo","metadata":{"permalink":"/wljs-docs/blog/2024/10/25/rtx-logo","source":"@site/blog/2024-10-25-rtx-logo.md","title":"RevealJS x WL logo code","description":"A tandem of RevealJS and Wolfram Language made using Graphics3D and Path-tracing","date":"2024-10-25T00:00:00.000Z","tags":[{"label":"graphics","permalink":"/wljs-docs/blog/tags/graphics"},{"label":"short","permalink":"/wljs-docs/blog/tags/short"}],"readingTime":0.66,"hasTruncateMarker":true,"authors":[],"frontMatter":{"title":"RevealJS x WL logo code","tags":["graphics","short"]},"unlisted":false,"prevItem":{"title":"Introducing non indexed geometry","permalink":"/wljs-docs/blog/2024/11/08/non-indexed"},"nextItem":{"title":"Giant dweller worm","permalink":"/wljs-docs/blog/2024/10/24/worm"}},"content":"A tandem of RevealJS and Wolfram Language made using `Graphics3D` and Path-tracing\\n\\n![](./5249342723645891565.jpg)\\n\\n\x3c!--truncate--\x3e\\n\\n```mathematica\\nWith[{a = 30, b = 30}, {\\n  {\\n    {\\n      Graphics3D`Materials[\\"Glass\\"], \\n      Directive[\\n        \\"MaterialThickness\\" -> 0, \\n        \\"Transmission\\" -> 0.8, \\n        \\"Roughness\\" -> 0.5\\n      ], \\n      Orange, \\n      GeometricTransformation[\\n        Cuboid[{-1.1 a, -1.1 a, -b 0.03}, {1.1 a, 1.1 a, b 0.03}], \\n        RotationMatrix[-45 Degree, {0, 1, 0}]\\n      ]\\n    },\\n    {\\n      Graphics3D`Materials[\\"Iridescent\\"], \\n      Pink, \\n      With[{i = Interpolation[\\n        {\\n          {0, {-a, -a, b}}, \\n          {0.25, {-a, a, b}}, \\n          {0.5, {a, a, -b}}, \\n          {0.75, {a, -a, -b}}, \\n          {1.0, {-a, -a, b}}, \\n          {1.2, {-a, -a, b}}\\n        }, InterpolationOrder -> 1\\n      ]},\\n      Tube[Table[i[j], {j, 0, 1.2, 0.01}]]\\n      ]\\n    }\\n  },\\n  Red, \\n  Directive[\\"Emissive\\" -> Red], \\n  Translate[\\n    GeometricTransformation[\\n      PolyhedronData[\\"RhombicHexecontahedron\\", \\"Faces\\"] // N, \\n      IdentityMatrix[3] * 8\\n    ], \\n    {40, 0, 0}\\n  ]\\n}];\\n\\nGraphics3D[%, \\n  ViewProjection -> \\"Perspective\\", \\n  \\"Renderer\\" -> \\"PathTracing\\", \\n  ImageSize -> 800\\n]\\n```"},{"id":"/2024/10/24/worm","metadata":{"permalink":"/wljs-docs/blog/2024/10/24/worm","source":"@site/blog/2024-10-24-worm.md","title":"Giant dweller worm","description":"An adapted animation from Wolfram Community","date":"2024-10-24T00:00:00.000Z","tags":[{"label":"animation","permalink":"/wljs-docs/blog/tags/animation"},{"label":"short","permalink":"/wljs-docs/blog/tags/short"}],"readingTime":0.78,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"title":"Giant dweller worm","tags":["animation","short"],"authors":"jerryi","enableComments":true},"unlisted":false,"prevItem":{"title":"RevealJS x WL logo code","permalink":"/wljs-docs/blog/2024/10/25/rtx-logo"},"nextItem":{"title":"Speech to text using local WL neural network","permalink":"/wljs-docs/blog/2024/10/15/speech2text"}},"content":"An adapted animation from Wolfram Community\\n\\n![](./Dweller1-ezgif.com-optimize.gif)\\n\\n\x3c!--truncate--\x3e\\n\\n```mathematica\\nClearAll[a];\\n\\na = Compile[{{x, _Real}, {y, _Real}, {t, _Real}}, Module[{k, e, o, d, q, c, xOut, yOut},\\n\\n  k = x / 8 - 25;\\n\\n  e = y / 8 - 25;\\n\\n  o = Sqrt[k^2 + e^2] / 3;\\n\\n  d = 5 * Cos[o];\\n\\n  q = x / 2 + (k / ArcTan[9 * Cos[e]]) * Sin[4 * d - t];\\n\\n  c = d / 3 - t / 8;\\n\\n  xOut = q * Sin[c] + 200;\\n\\n  yOut = ((y / 4 + 5 * o^2 + q) / 2) * Cos[c] + 200;\\n\\n   \\n\\n  {xOut, yOut, 0.}\\n\\n], \\"CompilationTarget\\" -> \\"C\\",  \\"RuntimeOptions\\" -> \\"Speed\\"];\\n\\n\\n\\npoints[t_] := Flatten[Table[a[x,y,t],{y,100,299},{x,100,299}],1];\\n\\nt = 0;\\n\\nEventHandler[\\"frame\\", Function[Null,\\n\\n pts = points[t = t + 0.02];\\n\\n]];\\n\\n\\n\\npts = points[0];\\n\\n\\n\\nGraphics3D[{Black, PointSize[0.001], Opacity[46/255], pts//Offload//Point, AnimationFrameListener[pts // Offload, \\"Event\\"->\\"frame\\"]}, ImageSize->500]\\n```\\n\\nWe used here `Graphics3D` since it is faster, when it comes to many small objects."},{"id":"/2024/10/15/speech2text","metadata":{"permalink":"/wljs-docs/blog/2024/10/15/speech2text","source":"@site/blog/2024-10-15-speech2text.md","title":"Speech to text using local WL neural network","description":"Speech2Text using built-in WL\'s neural network","date":"2024-10-15T00:00:00.000Z","tags":[{"label":"AI","permalink":"/wljs-docs/blog/tags/ai"},{"label":"short","permalink":"/wljs-docs/blog/tags/short"},{"label":"javascript","permalink":"/wljs-docs/blog/tags/javascript"}],"readingTime":0.98,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"title":"Speech to text using local WL neural network","authors":"jerryi","tags":["AI","short","javascript"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Giant dweller worm","permalink":"/wljs-docs/blog/2024/10/24/worm"},"nextItem":{"title":"How to make simple counter animation for slides","permalink":"/wljs-docs/blog/2024/10/08/statcnt"}},"content":"Speech2Text using built-in WL\'s neural network\\n\\n\x3c!--truncate--\x3e\\n\\nMicrophone capture function\\n\\n```js\\n.js\\n\\nconst label = document.createElement(\'div\');\\nlabel.classList.add(\'rounded\', \'p-1\', \'text-small\');\\nlabel.innerText = \\"Not recording\\";\\nlabel.style.background = \'lightgray\';\\n\\ncore.GetVoice = async (args, env) => {\\nconst interval = await interpretate(args[0], env);\\nconst promise = new Deferred();\\n  \\nnavigator.mediaDevices.getUserMedia({ audio: true })\\n  .then(stream => {\\n    const mediaRecorder = new MediaRecorder(stream);\\n    let chunks = [];\\n\\n    mediaRecorder.ondataavailable = event => {\\n      chunks.push(event.data);\\n    };\\n\\n    mediaRecorder.onstop = () => {\\n      const audioBlob = new Blob(chunks, { \'type\' : \'audio/ogg; codecs=opus\' });\\n      const reader = new FileReader();\\n\\n      reader.onloadend = () => {\\n        label.style.background = \'lightgray\';\\n        label.innerText = \\"Finished\\";\\n        const base64data = reader.result.split(\',\')[1];\\n        promise.resolve(base64data);\\n      };\\n\\n      reader.readAsDataURL(audioBlob);\\n    };\\n\\n    mediaRecorder.start();\\n    label.innerText = \\"Recording...\\";\\n    label.style.background = \'green\';\\n\\n    setTimeout(() => {\\n      mediaRecorder.stop();\\n    }, interval);\\n  })\\n  .catch(error => {\\n    console.error(\'Error accessing microphone:\', error);\\n    label.innerText = \\"Error accessing microphone\\";\\n    label.style.background = \'red\';\\n  });\\n\\n\\n  return promise.promise;\\n};\\n\\nreturn label;\\n\\n```\\n\\nWidget\\n\\n```mathematica\\nModule[{text = \\" \\", win = CurrentWindow[], status = \\" \\"}, Panel[Column[{\\n  {EventHandler[InputButton[\\"Speak\\"], Function[Null,\\n    status = \\"Listerning...\\";\\n    Then[FrontFetchAsync[GetVoice[3000], \\"Window\\"->win], Function[str,\\n      status = \\"Processing...\\";\\n      text = StringJoin[text, \\"\\\\n\\", SpeechRecognize[ImportString[str, \\"Base64\\"], Method->\\"NeuralNetwork\\"]];\\n      status = \\" \\";\\n    ]]\\n  ]], TextView[status // Offload]} // Row,\\n\\n  HTMLView[text // Offload, \\"Style\\"->\\"width:500px\\"]\\n}], Style[\\"Click and speak\\", 10]]]\\n```"},{"id":"/2024/10/08/statcnt","metadata":{"permalink":"/wljs-docs/blog/2024/10/08/statcnt","source":"@site/blog/2024-10-08-statcnt.md","title":"How to make simple counter animation for slides","description":"How to make simple counter animation for slides","date":"2024-10-08T00:00:00.000Z","tags":[{"label":"short","permalink":"/wljs-docs/blog/tags/short"},{"label":"slides","permalink":"/wljs-docs/blog/tags/slides"}],"readingTime":0.655,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"title":"How to make simple counter animation for slides","authors":"jerryi","tags":["short","slides"]},"unlisted":false,"prevItem":{"title":"Speech to text using local WL neural network","permalink":"/wljs-docs/blog/2024/10/15/speech2text"},"nextItem":{"title":"Animated bar charts","permalink":"/wljs-docs/blog/2024/09/11/barcharts"}},"content":"How to make simple counter animation for slides  \\n\\n![](./dynamicstats-ezgif.com-video-to-gif-converter-13d823691347f3aaccfa0df001852a7e.gif)\\n\\n\x3c!--truncate--\x3e\\n  \\nMake a counter component in WLX\\n\\n```jsx\\n.wlx\\n\\nStat[Text_, OptionsPattern[]] := LeakyModule[{\\n  cnt = 0, \\n  task\\n}, With[{\\n  ev = CreateUUID[],\\n  HTMLCounter = HTMLView[cnt // Offload],\\n  max = OptionValue[\\"Count\\"]\\n},\\n  EventHandler[ev, {\\n    \\"Destroy\\" -> Function[Null,\\n      EventRemove[ev]; \\n      If[task[\\"TaskStatus\\"] === \\"Running\\", TaskRemove[task]];\\n      ClearAll[task];\\n    ],\\n\\n    \\"Left\\" -> Function[Null,\\n      cnt = 0;\\n    ],\\n\\n    \\"Slide\\" -> Function[Null,\\n      If[task[\\"TaskStatus\\"] === \\"Running\\", TaskRemove[task]];\\n      task = SetInterval[\\n        If[cnt < max, cnt = cnt + 1,\\n          TaskRemove[task];\\n        ];\\n      , 15];\\n    ]\\n  }];\\n\\n  <div class=\\"text-center text-gray-600 m-4 p-4 rounded bg-gray-100 flex flex-col\\">\\n    <HTMLCounter/>\\n    <span class=\\"text-md\\"><Text/></span>\\n    <SlideEventListener Id={ev}/>\\n  </div>\\n] ]\\n\\nOptions[Stat] = {\\"Count\\"->1};\\n\\n\\n```\\n\\nPlace it on slide\\n\\n```jsx\\n.slide\\n\\n# Dynamic stats\\nHere is our data\\n\\n<div class=\\"justify-center flex flex-row ml-auto mr-auto\\">\\n\\n<Stat Count={128}>Label 1</Stat>\\n<Stat Count={256}>Label 2</Stat>\\n\\n</div>\\n```"},{"id":"/2024/09/11/barcharts","metadata":{"permalink":"/wljs-docs/blog/2024/09/11/barcharts","source":"@site/blog/2024-09-11-barcharts.md","title":"Animated bar charts","description":"You\'ve likely seen videos featuring animated bar charts with a timeline, where the bars dynamically shift and overtake each other","date":"2024-09-11T00:00:00.000Z","tags":[{"label":"animation","permalink":"/wljs-docs/blog/tags/animation"},{"label":"short","permalink":"/wljs-docs/blog/tags/short"}],"readingTime":1.35,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"title":"Animated bar charts","authors":"jerryi","tags":["animation","short"],"enableComments":true},"unlisted":false,"prevItem":{"title":"How to make simple counter animation for slides","permalink":"/wljs-docs/blog/2024/10/08/statcnt"},"nextItem":{"title":"Trippy raster animation","permalink":"/wljs-docs/blog/2024/09/07/raster"}},"content":"You\'ve likely seen videos featuring animated bar charts with a timeline, where the bars dynamically shift and overtake each other\\n\\n![](./SimpleBarNaimted1-ezgif.com-video-to-gif-converter.gif)\\n\\n\x3c!--truncate--\x3e\\n\\n```mathematica\\nOptions[barTimelineAnimated] = {PlotLegends -> Automatic};\\n\\ngetMagnitude[e_Quantity] := QuantityMagnitude[e];\\ngetMagnitude[e_] := e;\\n\\ngetLevels = Function[{list}, \\n  SortBy[\\n    MapIndexed[Function[{value, index}, {value, index // First}], Ordering[list]], \\n    First\\n  ][[All, 2]]\\n];\\n\\nbarTimelineAnimated[l_List, OptionsPattern[]] := With[{\\n  timeline = MinimalBy[(#[\\"Times\\"] & /@ l), Length] // First,\\n  labels = If[OptionValue[PlotLegends] === Automatic, Range[Length[l]], OptionValue[PlotLegends]],\\n  interpolated = TimeSeries[#, MissingDataMethod -> Automatic] & /@ l\\n},\\n\\n  With[{\\n    first = getMagnitude[#[timeline // First]] & /@ interpolated\\n  },\\n\\n    Module[{\\n      levels = getLevels[first] / Length[first] // N,\\n      order = getLevels[first],\\n      rects,\\n      date = timeline // First // DateObject // TextString,\\n      recalc\\n    },\\n\\n      recalc[index_] := With[{values = getMagnitude[#[timeline[[index]]]] & /@ interpolated},\\n\\n        With[{newOrdering = getLevels[values]},\\n          If[order != newOrdering,\\n            order = newOrdering;\\n            levels = newOrdering / Length[first] // N;\\n          ];\\n        ];\\n\\n        date = timeline[[index]] // DateObject // TextString;\\n\\n        With[{min = Min[values], max = Max[values]},\\n          rects = ((values - min) / (max - min) + 0.02) / 1.02;\\n        ];\\n      ];\\n\\n      recalc[1];\\n\\n      Column[{\\n        With[{spacing = 0.8 / Length[levels]}, \\n          Graphics[{\\n            Text[date // Offload, {0.5, 0.}, {0, 0}],\\n            Directive[TransitionType -> \\"CubicInOut\\", TransitionDuration -> 500],\\n            Table[\\n              With[{i = i},\\n                Translate[{\\n                  ColorData[97][i] // Lighter,\\n                  {\\n                    Directive[TransitionType -> \\"Linear\\", TransitionDuration -> 20],\\n                    Rectangle[{0, 0}, {Offload[rects[[i]]], spacing}]\\n                  },\\n                  Black,\\n                  Text[Style[labels[[i]], FontSize -> 14], {-0.02, spacing / 3.0}, {1, 0}]\\n                }, {0, Offload[levels[[i]]]}]\\n              ], \\n              {i, 1, Length[rects]}\\n            ]\\n          }, PlotRange -> {{-0.4, 1}, {-0.1, 1 + spacing}}, ImagePadding -> None]\\n        ],\\n        \\n        EventHandler[InputRange[1, Length[timeline], 1, 1], recalc]\\n      }]\\n    ]\\n  ]\\n];\\n\\n(* test it! *)\\n\\ncountry = {\\"Germany\\", \\"UK\\", \\"Switzerland\\", \\"Russia\\", \\"China\\"};\\ngdp = CountryData[#, {\\"GDP\\", {1970, 2015}}] &/@ country;\\n\\nbarTimelineAnimated[gdp, PlotLegends->country]\\n```"},{"id":"/2024/09/07/raster","metadata":{"permalink":"/wljs-docs/blog/2024/09/07/raster","source":"@site/blog/2024-09-07-raster.md","title":"Trippy raster animation","description":"Another raster animation. Now without OpenCL, pure WL and Compile","date":"2024-09-07T00:00:00.000Z","tags":[{"label":"short","permalink":"/wljs-docs/blog/tags/short"},{"label":"animation","permalink":"/wljs-docs/blog/tags/animation"}],"readingTime":0.715,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["short","animation"],"title":"Trippy raster animation","enableComments":true},"unlisted":false,"prevItem":{"title":"Animated bar charts","permalink":"/wljs-docs/blog/2024/09/11/barcharts"},"nextItem":{"title":"Basics of Compute Shaders in WL 1","permalink":"/wljs-docs/blog/2024/09/1/basics-csh-1"}},"content":"Another raster animation. Now without OpenCL, pure WL and `Compile`\\n\\n![](./trippy1-ezgif.com-optimize.gif)\\n\\n\x3c!--truncate--\x3e\\n\\n```mathematica\\ngen = Compile[{{time, _Real}, {f1, _Real}, {f2, _Real}, {f3, _Real}},\\nTable[With[{fpos = {i,j}},\\n  With[{result = Module[{\\n      d0 = Norm[fpos], \\n      d1 = 1.0, \\n      d2 = 1.0, \\n      d3 = 1.0\\n    },\\n    \\n    d1 = Sin[d0 f1 + time]/6.;\\n    d2 = Sin[d0 f2 + time]/6.;\\n    d3 = Sin[d0 f3 + time]/6.;\\n    \\n    d1 = Abs[d1];\\n    d2 = Abs[d2];\\n    d3 = Abs[d3];\\n    \\n    d1 = 0.02 / (d1 + 0.01);\\n    d2 = 0.02 / (d2 + 0.01);\\n    d3 = 0.02 / (d3 + 0.01);\\n    \\n    {d1, d2, d3} 255.0\\n  ]},\\n    result\\n  ]\\n], {i, -0.5, 0.5, 1.0/500.0}, {j, -0.5, 0.5, 1.0/500.0}]\\n, CompilationTarget->\\"C\\", RuntimeOptions->\\"Speed\\"];\\n\\nbuffer = NumericArray[gen[0,5.0, 8.0, 16.0], \\"UnsignedInteger8\\", \\"ClipAndRound\\"];\\n\\nImage[buffer // Offload, \\"Byte\\"]\\n\\na = 0.0;\\nDo[\\n\\n  buffer = NumericArray[gen[a, Cos[a/5.0] 5.0, Sin[a/8.0] 8.0, Sin[a/16.0] 16.0], \\"UnsignedInteger8\\", \\"ClipAndRound\\"];\\n  a = a + 0.1;\\n  \\n, {k,300}];\\n```"},{"id":"/2024/09/1/basics-csh-1","metadata":{"permalink":"/wljs-docs/blog/2024/09/1/basics-csh-1","source":"@site/blog/2024-09-1-basics-csh-1/index.mdx","title":"Basics of Compute Shaders in WL 1","description":"A GPU is also a great tool for general-purpose computations. There are a few ways to couple it with Wolfram Language:","date":"2024-09-01T00:00:00.000Z","tags":[{"label":"graphics","permalink":"/wljs-docs/blog/tags/graphics"},{"label":"opencl","permalink":"/wljs-docs/blog/tags/opencl"},{"label":"GPU","permalink":"/wljs-docs/blog/tags/gpu"}],"readingTime":3.81,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","enableComments":true,"tags":["graphics","opencl","GPU"]},"unlisted":false,"prevItem":{"title":"Trippy raster animation","permalink":"/wljs-docs/blog/2024/09/07/raster"},"nextItem":{"title":"Covariant Matrices and Ellipses","permalink":"/wljs-docs/blog/2024/08/22/ellipce"}},"content":"A GPU is also a great tool for general-purpose computations. There are a few ways to couple it with Wolfram Language:\\n\\n- CUDALink\\n- OpenCLLink\\n- LibraryLink\\n\\nThe first option requires hardware from Nvidia, which is a massive drawback considering there are many other processors on the market capable of crunching numbers. The last option allows integrating any dynamic library written in C/Rust (probably there are other bindings as well) into our Kernel, but the amount of effort required to write a general-purpose GPU library and deal with cross-platform issues is quite cumbersome and defeats the whole purpose of using WL here.\\n\\nWe will go with the most cross-platform and hardware-agnostic solution: `OpenCL` \ud83d\ude85\\n\\n\x3c!--truncate--\x3e\\n\\nimport { WLJSHTML, WLJSEditor, WLJSStore } from \\"@site/src/components/wljs-reactcells\\";\\n\\n\\n\\n<WLJSStore kernel={require(\'./attachments/kernel.txt\').default} json={require(\'./attachments/00c394a0-debc-4934-86e5-d68ca867ca52.txt\').default} notebook={require(\'./attachments/notebook-00c.wln\').default}/>\\n\\n\\n\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"bd6478fa-a72d-4da8-8b7c-65ff4b7aea29\\"} type={\\"Input\\"} opts={{}} >{`Needs%5B%22OpenCLLink%60%22%5D%0AIf%5B%21OpenCLQ%5B%5D%2C%20Alert%5B%22Report%20the%20police%2C%20it%20doest%20not%20work%22%5D%20%2F%2F%20FrontSubmit%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"435c58eb-46b5-4204-ae69-670384f7bcc3\\"} type={\\"Output\\"} opts={{}} >{`True`}</WLJSEditor>\\n\\nWe assume you already know the OpenCL programming language and its execution model. There are plenty of resources available online.\\n\\n## Drawing on Canvas\\nThe most visual way of seeing the work of your tiny GPU kernels is to ask them to generate data and interpret it as an image. Let us define a simple kernel that fills an entire screen.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"03ca5c8d-7664-4664-8201-290f3ca19ae2\\"} type={\\"Input\\"} opts={{}} >{`test.cl%0A%0A__kernel%20void%20render%28%0A%20%20__global%20uchar4%2A%20output%2C%20%0A%20%20const%20int%20width%2C%20%0A%20%20const%20int%20height%0A%29%20%7B%0A%20%20%20%20unsigned%20int%20work_item_id%20%3D%20get_global_id%280%29%3B%0A%20%20%20%20%0A%20%20%20%20unsigned%20int%20x_coord%20%3D%20work_item_id%20%25%20width%3B%0A%20%20%20%20unsigned%20int%20y_coord%20%3D%20work_item_id%20%2F%20width%3B%0A%0A%20%20%20%20float3%20finalcolor%20%3D%20%28float3%29%280.0f%2C%200.5f%2C%200.2f%29%3B%0A%0A%20%20%20%20%2F%2Fclamp%20to%208bits%20for%20each%20channel%0A%20%20%20%20%0A%20%20%20%20uchar4%20rgba%3B%0A%20%20%20%20rgba.x%3D%28uchar%29%28finalcolor.x%2A255.0%29%3B%0A%20%20%20%20rgba.y%3D%28uchar%29%28finalcolor.y%2A255.0%29%3B%0A%20%20%20%20rgba.z%3D%28uchar%29%28finalcolor.z%2A255.0%29%3B%0A%20%20%20%20rgba.w%3D255%3B%0A%0A%20%20%20%20output%5Bwork_item_id%5D%20%3D%20rgba%3B%0A%7D`}</WLJSEditor>\\n\\n\\nA side note\\n\\n> If you run the cell above, it creates a file named `test.cl`\\n\\nWe added a minor optimization: the resulting color will be normalized to the range of the `UnsignedInteger8` typed array in Wolfram Language.\\n\\nNow let us compile it.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"603b2ec0-a289-4698-8e65-fdcf7b8752bb\\"} type={\\"Input\\"} opts={{}} >{`render%20%3D%20OpenCLFunctionLoad%5BFile%5B%22test.cl%22%5D%2C%20%0A%20%20%22render%22%2C%20%7B%7B%22UnsignedByte%5B4%5D%22%2C%20_%2C%20%22Output%22%7D%2C%20_Integer%2C%20_Integer%7D%2C%20256%2C%20%22ShellOutputFunction%22-%3EPrint%5D%3B`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"print\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"608bf505-330a-4066-bec7-80c6106f70e1\\"} type={\\"Output\\"} opts={{}} >{`%22%20%22`}</WLJSEditor>\\n\\nHere we specified the local group size to be `256`, but at this stage, it does not matter for us. Just make sure that it does not exceed your CL device limitations.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"8404302d-93b3-43db-8d58-2e1b0a1fdca4\\"} type={\\"Input\\"} opts={{}} >{`Cases%5BOpenCLInformation%5B%5D%2C%20Rule%5B%22Maximum%20Work%20Group%20Size%22%2C%20r_%5D%20%3A%3E%20r%2C%20Infinity%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"68f87835-3fef-465e-a98f-fb79c3f30ca2\\"} type={\\"Output\\"} opts={{}} >{`%7B256%7D`}</WLJSEditor>\\n\\nAllocate memory for our generated image. Let it be small for now, `128x128`.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"c479f9d1-965a-48a1-845f-c16f694c89f1\\"} type={\\"Input\\"} opts={{}} >{`image%20%3D%20OpenCLMemoryLoad%5BTable%5B%7B0%2C%200%2C%200%2C%200%7D%2C%20%7Bi%2C%20128%7D%2C%20%7Bj%2C%20128%7D%5D%2C%20%22UnsignedByte%5B4%5D%22%5D%3B`}</WLJSEditor>\\n\\n\\nA side note\\n\\n> Do not forget to unload this memory if you no longer need it.\\n\\nTo execute our OpenCL function, we also need to specify the grid size (aka how many kernels we need to run). Since in our case this is a bitmap image and we are running 1 kernel per pixel the number will `128^2` according the resolution we picked for an image\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"ef9b9c2d-8d09-4f58-9c39-a49386f3dde4\\"} type={\\"Input\\"} opts={{}} >{`render%5Bimage%2C%20128%2C%20128%2C%20128%20128%5D%3B%0Aimage%20%2F%2F%20OpenCLMemoryGet%3B%0ANumericArray%5B%25%2C%20%22UnsignedInteger8%22%5D%3B%0AImage%5B%25%2C%20%22Byte%22%2C%20Magnification-%3E3%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"783d9533-0768-465c-bf44-e02cdc10e14f\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%22fe0488c4-e676-4a8a-9e38-79950149d078%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKp6UamFhYJJvoppqZm%2BmaJFok6lqmGlvomltamhoYmlimGJhbAACA9RUH%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nIt is important to note that __you should always try to utilize__ `NumericArray` when working with raster graphics, since Wolfram\'s native `List` is quite slow for this task. The second important thing is to specify the format explicitly in `Image` as well. There is a 1:1 correspondence:\\n\\n<WLJSHTML>{`%3Cbr%20%2F%3E`}</WLJSHTML>\\n\\n| OpenCL             | NumericArray       | Image                |\\n|--------------------|--------------------|----------------------|\\n| `UnsignedByte`     | `UnsignedInteger8` | `Byte`               |\\n| `Float`            | `Real32`           | `Real`               |\\n\\nLet us try something more interesting.\\n\\nHere is a very primitive example of what is called Signed-Distance-Fields (SDF). We set the \\"geometry\\" using a parametric equation and calculate the color of every pixel based on the distance to vertices or any other control points of our defined geometry. For example, to draw a disk we need only the equation of a circle with two parameters:\\n\\n$$\\n\\\\text{color} = R^2 - |\\\\mathbf{r} - \\\\mathbf{r}_c|^2 \\n$$\\n\\nwhere $\\\\mathbf{r}_c$ is the coordinates of the center and $R$ is the radius. After that, we should clip the resulting color to the range of `0.0` and `1.0` to avoid any artifacts.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"7c27851c-db56-4e7c-8ed2-a7738667825e\\"} type={\\"Input\\"} opts={{}} >{`test.cl%0A%0Afloat%20clip%28float%20val%2C%20const%20float%20min%2C%20const%20float%20max%29%20%7B%0A%20%20if%20%28val%20%3E%20max%29%20return%20max%3B%0A%20%20if%20%28val%20%3C%20min%29%20return%20min%3B%0A%20%20return%20val%3B%0A%7D%0A%0A__kernel%20void%20render%28%0A%20%20__global%20uchar4%2A%20output%2C%20%0A%20%20const%20int%20width%2C%20%0A%20%20const%20int%20height%0A%29%20%7B%0A%20%20%20%20unsigned%20int%20work_item_id%20%3D%20get_global_id%280%29%3B%0A%20%20%20%20%0A%20%20%20%20unsigned%20int%20x_coord%20%3D%20work_item_id%20%25%20width%3B%0A%20%20%20%20unsigned%20int%20y_coord%20%3D%20work_item_id%20%2F%20width%3B%0A%0A%20%20%20%20%2F%2Fnormalize%20screen%20coordinates%0A%20%20%20%20float%20fx%20%3D%20%28float%29x_coord%20%2F%20%28float%29width%3B%20%0A%09float%20fy%20%3D%20%28float%29y_coord%20%2F%20%28float%29height%3B%0A%0A%20%20%20%20float3%20finalcolor%20%3D%20%28float3%29%28fy%20%2A%200.1f%2C%20fy%20%2A%200.3f%2C%200.3f%29%3B%20%2F%2F%20a%20nice%20background%0A%0A%20%20%20%20float%20dist2%20%3D%20%28fx%20-%200.5f%29%2A%28fx%20-%200.5f%29%20%2B%20%28fy%20-%200.5f%29%2A%28fy%20-%200.5f%29%3B%0A%20%20%20%20finalcolor.x%20%2B%3D%20clip%2810.0f%2A%280.4f%2A0.4f%20-%20dist2%29%2C%200.0f%2C%201.0f%29%3B%0A%0A%20%20%20%20%2F%2Fclamp%20to%208bits%20for%20each%20channel%0A%20%20%20%20%0A%20%20%20%20uchar4%20rgba%3B%0A%20%20%20%20rgba.x%3D%28uchar%29%28finalcolor.x%2A255.0%29%3B%0A%20%20%20%20rgba.y%3D%28uchar%29%28finalcolor.y%2A255.0%29%3B%0A%20%20%20%20rgba.z%3D%28uchar%29%28finalcolor.z%2A255.0%29%3B%0A%20%20%20%20rgba.w%3D255%3B%0A%0A%20%20%20%20output%5Bwork_item_id%5D%20%3D%20rgba%3B%0A%7D`}</WLJSEditor>\\n\\nReload\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"556b3b97-2eb3-4007-ab47-a302519f0b43\\"} type={\\"Input\\"} opts={{}} >{`render%20%3D%20OpenCLFunctionLoad%5BFile%5B%22test.cl%22%5D%2C%20%0A%20%20%22render%22%2C%20%7B%7B%22UnsignedByte%5B4%5D%22%2C%20_%2C%20%22Output%22%7D%2C%20_Integer%2C%20_Integer%7D%2C%20256%2C%20%22ShellOutputFunction%22-%3EPrint%5D%3B%0A%0Arender%5Bimage%2C%20128%2C%20128%2C%20128%20128%5D%3B%0Aimage%20%2F%2F%20OpenCLMemoryGet%3B%0ANumericArray%5B%25%2C%20%22UnsignedInteger8%22%5D%3B%0AImage%5B%25%2C%20%22Byte%22%2C%20Magnification-%3E3%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"print\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"2b97bad1-105e-47d9-a575-387532f75b90\\"} type={\\"Output\\"} opts={{}} >{`%22%20%22`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"6ad9f415-273e-468a-a1ab-e80adcfb56c7\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%22402e057f-1586-4e2d-8c5a-504dc17741f1%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKmxgYpRqYmqfpGppamOmapBql6FokmybqmhqYpCQbmpubGKYZAgB3XxUP%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nBecause our toy SDF function provides a squared distance, it creates a smooth transition on the edges before it starts to clip to 1.0.\\n\\n## Controls\\nWe can hook up some external controls to change the parameters of our disk. The simplest one will be the radius.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"ec921301-2fbf-4abb-9530-97be32896fa8\\"} type={\\"Input\\"} opts={{}} >{`test.cl%0A%0Afloat%20clip%28float%20val%2C%20const%20float%20min%2C%20const%20float%20max%29%20%7B%0A%20%20if%20%28val%20%3E%20max%29%20return%20max%3B%0A%20%20if%20%28val%20%3C%20min%29%20return%20min%3B%0A%20%20return%20val%3B%0A%7D%0A%0A__kernel%20void%20render%28%0A%20%20__global%20uchar4%2A%20output%2C%20%0A%20%20const%20int%20width%2C%20%0A%20%20const%20int%20height%2C%0A%20%20const%20float%20radius%20%2F%2F%3C----%20HERE%0A%29%20%7B%0A%20%20%20%20unsigned%20int%20work_item_id%20%3D%20get_global_id%280%29%3B%0A%20%20%20%20%0A%20%20%20%20unsigned%20int%20x_coord%20%3D%20work_item_id%20%25%20width%3B%0A%20%20%20%20unsigned%20int%20y_coord%20%3D%20work_item_id%20%2F%20width%3B%0A%0A%20%20%20%20%2F%2Fnormalize%20screen%20coordinates%0A%20%20%20%20float%20fx%20%3D%20%28float%29x_coord%20%2F%20%28float%29width%3B%20%0A%09float%20fy%20%3D%20%28float%29y_coord%20%2F%20%28float%29height%3B%0A%0A%20%20%20%20float3%20finalcolor%20%3D%20%28float3%29%28fy%20%2A%200.1f%2C%20fy%20%2A%200.3f%2C%200.3f%29%3B%20%2F%2F%20a%20nice%20background%0A%0A%20%20%20%20float%20dist2%20%3D%20%28fx%20-%200.5f%29%2A%28fx%20-%200.5f%29%20%2B%20%28fy%20-%200.5f%29%2A%28fy%20-%200.5f%29%3B%0A%20%20%20%20finalcolor.x%20%2B%3D%20clip%2810.0f%2A%28radius%2Aradius%20-%20dist2%29%2C%200.0f%2C%201.0f%29%3B%20%2F%2F%3C----%20HERE%0A%0A%20%20%20%20%2F%2Fclamp%20to%208bits%20for%20each%20channel%0A%20%20%20%20%0A%20%20%20%20uchar4%20rgba%3B%0A%20%20%20%20rgba.x%3D%28uchar%29%28finalcolor.x%2A255.0%29%3B%0A%20%20%20%20rgba.y%3D%28uchar%29%28finalcolor.y%2A255.0%29%3B%0A%20%20%20%20rgba.z%3D%28uchar%29%28finalcolor.z%2A255.0%29%3B%0A%20%20%20%20rgba.w%3D255%3B%0A%0A%20%20%20%20output%5Bwork_item_id%5D%20%3D%20rgba%3B%0A%7D`}</WLJSEditor>\\n\\nNow recompile it once.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"7b5f15dc-3c2d-49f1-800c-80a74e45c797\\"} type={\\"Input\\"} opts={{}} >{`render%20%3D%20OpenCLFunctionLoad%5BFile%5B%22test.cl%22%5D%2C%20%0A%20%20%22render%22%2C%20%7B%7B%22UnsignedByte%5B4%5D%22%2C%20_%2C%20%22Output%22%7D%2C%20_Integer%2C%20_Integer%2C%20%22Float%22%7D%2C%20256%2C%20%22ShellOutputFunction%22-%3EPrint%5D%3B`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"print\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"f229a7c3-a28d-4daa-b57c-58c104f595cf\\"} type={\\"Output\\"} opts={{}} >{`%22%20%22`}</WLJSEditor>\\n\\nTo render dynamically, we provide an intermediate symbol to which an `Image` listener will be assigned.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"5aa367d2-aefe-4372-930c-951d782cc9f0\\"} type={\\"Input\\"} opts={{}} >{`Module%5B%7Bbuffer%7D%2C%0A%20%20%7B%0A%20%20%20%20Image%5Bbuffer%20%2F%2F%20Offload%2C%20%22Byte%22%2C%20Magnification-%3E3%5D%2C%0A%0A%20%20%20%20EventHandler%5BInputRange%5B0.%2C%201.%2C%200.1%2C%20%22Label%22-%3E%22R%22%5D%2C%20Function%5Bradius%2C%0A%20%20%20%20%20%20render%5Bimage%2C%20128%2C%20128%2C%20radius%2C%20128%20128%5D%3B%0A%20%20%20%20%20%20buffer%20%3D%20NumericArray%5Bimage%20%2F%2F%20OpenCLMemoryGet%2C%20%22UnsignedInteger8%22%5D%3B%0A%20%20%20%20%5D%5D%20%2F%2F%20EventFire%20%28%2ABB%5B%2A%29%28%2A%20fire%20once%20to%20initialize%20buffer%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%7D%20%2F%2F%20Row%20%0A%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"00c394a0-debc-4934-86e5-d68ca867ca52\\"} id={\\"83d2fa9d-d9ca-4a59-a6bc-62d63b85a0d1\\"} type={\\"Output\\"} opts={{}} >{`%28%2AGB%5B%2A%29%7B%7B%28%2AVB%5B%2A%29%28FrontEndRef%5B%220b6d244d-9e67-4236-90f8-133aa756151a%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKGySZpRiZmKToWqaameuaGBmb6VoapFnoGhobJyaam5oZmhomAgB4zxTh%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28EventObject%5B%3C%7C%22Id%22%20-%3E%20%22e86d4b59-0c98-45ff-af58-e0d00db0df09%22%2C%20%22Initial%22%20-%3E%200.5%2C%20%22View%22%20-%3E%20%22d4225ab7-34a1-4615-8131-947dbbfc6796%22%7C%3E%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKp5gYGZkmJpnrGpskGuqamBma6loYGhvqWpqYpyQlpSWbmVuaAQB3ohUV%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7D%28%2A%5DGB%2A%29`}</WLJSEditor>\\n\\n\\nWhen you drag the slider, it reruns the OpenCL kernel and provides a new bitmap image to be displayed on the screen.\\n\\nIn the next part we will go deeper and try to take advantage of local groups, memory and do animations."},{"id":"/2024/08/22/ellipce","metadata":{"permalink":"/wljs-docs/blog/2024/08/22/ellipce","source":"@site/blog/2024-08-22-ellipce.md","title":"Covariant Matrices and Ellipses","description":"By simply computing the covariance matrix and finding its eigenvectors and -values, you can determine the principal axes and the corresponding lengths of the ellipse.","date":"2024-08-22T00:00:00.000Z","tags":[{"label":"numerics","permalink":"/wljs-docs/blog/tags/numerics"},{"label":"short","permalink":"/wljs-docs/blog/tags/short"}],"readingTime":2.2,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","draft":false,"tags":["numerics","short"]},"unlisted":false,"prevItem":{"title":"Basics of Compute Shaders in WL 1","permalink":"/wljs-docs/blog/2024/09/1/basics-csh-1"},"nextItem":{"title":"Real-time Fluid Simulation Part 3","permalink":"/wljs-docs/blog/2024/08/21/fluid-3"}},"content":"> By simply computing the covariance matrix and finding its eigenvectors and -values, you can determine the principal axes and the corresponding lengths of the ellipse.\\n\\n\x3c!--truncate--\x3e\\n\\nEllipses are common shapes characterized by their major and minor axes\\n\\n$$\\n\\\\frac{(x - h)^2}{a^2} + \\\\frac{(y - k)^2}{b^2} = 1\\n$$\\n\\nHere, $(h, k)$ is the center of the ellipse, and $a$ and $b$ represent the lengths of the semi-major and semi-minor axes, respectively. In multivariate statistics, ellipses frequently appear as confidence regions, where they represent the distribution and correlation between two or more variables.\\n\\nThe connection between ellipses and the covariance matrix arises from the fact that the covariance matrix encapsulates the variance and covariance of data in multiple dimensions. Specifically, the covariance matrix of a set of data points can be used to determine the orientation and lengths of the ellipse that best represents the spread of the data.\\n\\nMathematically, the covariance matrix $\\\\Sigma$ for a set of data points $(x_i, y_i)$ is:\\n\\n$$\\n\\\\Sigma = \\\\begin{pmatrix}\\n\\\\sigma_{xx} & \\\\sigma_{xy} \\\\\\\\\\n\\\\sigma_{xy} & \\\\sigma_{yy}\\n\\\\end{pmatrix}\\n$$\\n\\nwhere $\\\\sigma_{xx}$ and $\\\\sigma_{yy}$ are the variances along the $x$ and $y$ axes, and $\\\\sigma_{xy}$ is the covariance between $x$ and $y$. The eigenvalues and eigenvectors of this covariance matrix are key to understanding the shape and orientation of the ellipse:\\n\\n- The eigenvectors indicate the directions of the ellipse\'s axes.\\n- The eigenvalues correspond to the squared lengths of these axes.\\n\\nThis connection makes it surprisingly straightforward to estimate the semi-major and semi-minor axes $a$ and $b$ of an ellipse from sampled data. By simply computing the covariance matrix and finding its eigensystem, you can determine the principal axes and the corresponding lengths of the ellipse\\n\\n```mathematica @\\n(* Generate sample data points representing an ellipse *)\\n\\nsampleElipse[n_, r_, a_, b_, angle_] := \\n Flatten[(RandomReal[r] RotationMatrix[angle] . ((*GB[*){{a Cos[#]}, {b Sin[#]}}(*]GB*)))] & /@ \\n  RandomReal[{-Pi, Pi}, n];\\n\\ndata = sampleElipse[1000, {0.9, 1.0}, 1, 2, 45 Degree];\\n```\\n\\n```mathematica @\\n(* Process the data *)\\n\\ncentered = With[{m = Mean[data]}, (# - m) & /@ data];\\n\\n(* Compute the covariance matrix of the centered data *)\\ncovMatrix = Covariance[centered];\\n\\n(* Find the eigenvalues and eigenvectors of the covariance matrix *)\\n{eigenValues, mainAxes} = Eigensystem[covMatrix];\\n\\nListPlot[centered, \\n Epilog -> {Line[{{0, 0}, #}] & /@ (mainAxes (*SqB[*)Sqrt[2 eigenValues](*]SqB*))}, \\n AspectRatio -> 1]\\n```\\n\\nIn this code, `sampleElipse` generates random points distributed in the shape of an ellipse. The covariance matrix is computed from the centered data, and its eigensystem is then found. The eigenvectors provide the directions of the ellipse\'s axes, and the square roots of the eigenvalues give the lengths of these axes\\n\\n\\n<Wl>{`ListPlot[\\"1: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\\"//Uncompress, Epilog->{Line[{{0,0}, #}] &/@ {{-1.325800732155661,1.3545327015452},{-0.680211043651611,-0.665782596953846}}}, AspectRatio->1]`}</Wl>"},{"id":"/2024/08/21/fluid-3","metadata":{"permalink":"/wljs-docs/blog/2024/08/21/fluid-3","source":"@site/blog/2024-08-21-fluid-3/index.mdx","title":"Real-time Fluid Simulation Part 3","description":"Using Wolfram Language and WLJS","date":"2024-08-21T00:00:00.000Z","tags":[{"label":"graphics","permalink":"/wljs-docs/blog/tags/graphics"},{"label":"animation","permalink":"/wljs-docs/blog/tags/animation"}],"readingTime":4.16,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["graphics","animation"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Covariant Matrices and Ellipses","permalink":"/wljs-docs/blog/2024/08/22/ellipce"},"nextItem":{"title":"Real-time Fluid Simulation Part 2","permalink":"/wljs-docs/blog/2024/08/19/fluid-2"}},"content":"*Using Wolfram Language and WLJS*\\n\\nIn this notebook we will apply some optimizations to the code, expand the resolution and switch to immediate mode of graphics rendering. \\n\\n\x3c!--truncate--\x3e\\n\\nimport { WLJSHTML, WLJSEditor, WLJSStore } from \\"@site/src/components/wljs-reactcells\\";\\n\\n\\n\\n<WLJSStore json={require(\'./attachments/73fe49db-9a23-480c-b68c-e4e3334021f7.txt\').default} notebook={require(\'./attachments/notebook-73f.wln\').default}/>\\n\\n\\n\\n\\n## Measure and optimize \u23f1\ufe0f\\nLet us try to estimate the time we need to do our normal calculations on *divergence*, *advection* and *bilinear interpolation*\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"3778f713-f0ac-4279-af40-99061d14cf32\\"} type={\\"Input\\"} opts={{\\"Fade\\":true}} >{`ClearAll%5Badvect%5D%3B%20ClearAll%5BremoveDivergence%5D%3B%20ClearAll%5BbilinearInterpolation%5D%3B%0A%0Aadvect%5Bv_%2C%20u_%2C%20%CE%B4t_%3A0.1%5D%20%3A%3D%20With%5B%7Bmax%20%3D%20Length%5Bv%5D%7D%2C%20With%5B%7B%0A%20%20take%20%3D%20Function%5B%7Barray%2C%20x%2Cy%7D%2C%20If%5Bx%20%3E%3D%201%20%26%26%20x%20%3C%3D%20max%20%26%26%20y%20%3E%3D%201%20%26%26%20y%20%3C%3D%20max%2C%20array%5B%5Bx%2Cy%5D%5D%2C%20array%5B%5B1%2C1%5D%5D%200.%5D%5D%0A%7D%2C%0A%20%20Table%5B%20%0A%20%20%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20v1%20%3D%20%20%28%2AFB%5B%2A%29%28%28take%5Bv%2C%20i-1%2C%20j%5D%20%2B%20take%5Bv%2C%20i%2C%20j%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B1%2C0%7D%2C%0A%20%20%20%20%20%20v2%20%3D%20%20%28%2AFB%5B%2A%29%28%28take%5Bv%2C%20i%2C%20j%2B1%5D%20%2B%20take%5Bv%2C%20i%2C%20j%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C-1%7D%2C%0A%20%20%20%20%20%20v3%20%3D%20%20%28%2AFB%5B%2A%29%28%28take%5Bv%2C%20i%2B1%2C%20j%5D%20%2B%20take%5Bv%2C%20i%2C%20j%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B-1%2C0%7D%2C%0A%20%20%20%20%20%20v4%20%3D%20%20%28%2AFB%5B%2A%29%28%28take%5Bv%2C%20i%2C%20j-1%5D%20%2B%20take%5Bv%2C%20i%2C%20j%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C1%7D%2C%0A%20%20%20%20%20%20org%20%3D%20u%5B%5Bi%2Cj%5D%5D%0A%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20org%20%2B%20%28%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20v1%20%28%2ATB%5B%2A%29Piecewise%5B%7B%7B%28%2A%7C%2A%29take%5Bu%2C%20i-1%2C%20j%5D%28%2A%7C%2A%29%2C%28%2A%7C%2A%29v1%20%3E%200%28%2A%7C%2A%29%7D%2C%7B%28%2A%7C%2A%29org%28%2A%7C%2A%29%2C%28%2A%7C%2A%29True%28%2A%7C%2A%29%7D%7D%5D%28%2A%7C%2A%29%28%2A1%3AeJxTTMoPSmNkYGAo5gESAZmpyanlmcWpTvkVmUxAAQBzVQdd%2A%29%28%2A%5DTB%2A%29%20%2B%20v3%20%28%2ATB%5B%2A%29Piecewise%5B%7B%7B%28%2A%7C%2A%29take%5Bu%2C%20i%2B1%2C%20j%5D%28%2A%7C%2A%29%2C%28%2A%7C%2A%29v3%20%3E%200%28%2A%7C%2A%29%7D%2C%7B%28%2A%7C%2A%29org%28%2A%7C%2A%29%2C%28%2A%7C%2A%29True%28%2A%7C%2A%29%7D%7D%5D%28%2A%7C%2A%29%28%2A1%3AeJxTTMoPSmNkYGAo5gESAZmpyanlmcWpTvkVmUxAAQBzVQdd%2A%29%28%2A%5DTB%2A%29%20%20%2B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20v4%20%28%2ATB%5B%2A%29Piecewise%5B%7B%7B%28%2A%7C%2A%29take%5Bu%2C%20i%2C%20j-1%5D%28%2A%7C%2A%29%2C%28%2A%7C%2A%29v4%20%3E%200%28%2A%7C%2A%29%7D%2C%7B%28%2A%7C%2A%29org%28%2A%7C%2A%29%2C%28%2A%7C%2A%29True%28%2A%7C%2A%29%7D%7D%5D%28%2A%7C%2A%29%28%2A1%3AeJxTTMoPSmNkYGAo5gESAZmpyanlmcWpTvkVmUxAAQBzVQdd%2A%29%28%2A%5DTB%2A%29%20%2B%20v2%20%28%2ATB%5B%2A%29Piecewise%5B%7B%7B%28%2A%7C%2A%29take%5Bu%2C%20i%2C%20j%2B1%5D%28%2A%7C%2A%29%2C%28%2A%7C%2A%29v2%20%3E%200%28%2A%7C%2A%29%7D%2C%7B%28%2A%7C%2A%29org%28%2A%7C%2A%29%2C%28%2A%7C%2A%29True%28%2A%7C%2A%29%7D%7D%5D%28%2A%7C%2A%29%28%2A1%3AeJxTTMoPSmNkYGAo5gESAZmpyanlmcWpTvkVmUxAAQBzVQdd%2A%29%28%2A%5DTB%2A%29%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%20%CE%B4t%0A%20%20%20%20%5D%0A%20%20%20%20%0A%20%20%2C%20%7Bi%2C%20max%7D%2C%20%7Bj%2C%20max%7D%5D%20%2F%2F%20Chop%0A%20%5D%5D%0A%0A%20removeDivergence%5Bgrid_%5D%20%3A%3D%20With%5B%7B%0A%20%20%28%2ABB%5B%2A%29%28%2Asafety%20checks%2C%20which%20enforce%20closed%20boundaries%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20take%20%3D%20Function%5B%7Barray%2C%20x%2Cy%7D%2C%20If%5Bx%20%3E%3D%201%20%26%26%20x%20%3C%3D%20Length%5Bgrid%5D%20%26%26%20y%20%3E%3D%201%20%26%26%20y%20%3C%3D%20Length%5Bgrid%5D%2C%20array%5B%5Bx%2Cy%5D%5D%2C%20%7B0%2C0%7D%5D%5D%0A%7D%2C%0A%20%20MapIndexed%5BFunction%5B%7Bval%2C%20i%7D%2C%20%0A%20%20%20%20val%20%2B%20%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%288.0%29%29%28%2A%5DFB%2A%29%20%28%0A%20%20%20%20%20%20%28%28take%5Bgrid%2C%20i%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%29.%7B1%2C1%7D%29%7B1%2C1%7D%20%2B%0A%0A%20%20%20%20%20%20%28%28take%5Bgrid%2C%20i%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%29.%7B1%2C-1%7D%29%7B1%2C-1%7D%20%2B%0A%0A%20%20%20%20%20%20%28take%5Bgrid%2C%20i%5B%5B1%5D%5D-1%2C%20i%5B%5B2%5D%5D%5D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2B1%2C%20i%5B%5B2%5D%5D%5D%20-%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D-1%5D%20-%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%2B1%5D%29%7B2%2C-2%7D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%5D%20%28-4%29%0A%0A%20%20%20%20%29%0A%20%20%5D%2C%20grid%2C%20%7B2%7D%5D%0A%5D%0A%0AbilinearInterpolation%5Barray_%2C%20%7Bx0_%2C%20y0_%7D%5D%20%3A%3D%20Module%5B%0A%20%20%7Brows%2C%20cols%2C%20x%20%3D%20y0%2C%20y%20%3D%20x0%2C%20x1%2C%20x2%2C%20y1%2C%20y2%2C%20fQ11%2C%20fQ12%2C%20fQ21%2C%20fQ22%7D%2C%0A%20%20%0A%20%20%28%2A%20Get%20the%20dimensions%20of%20the%20array%20%2A%29%0A%20%20%7Brows%2C%20cols%7D%20%3D%20Take%5BDimensions%5Barray%5D%2C%202%5D%3B%0A%20%20%0A%20%20%28%2A%20Clip%20points%20to%20the%20boundaries%20%2A%29%0A%20%20x%20%3D%20Clip%5Bx%2C%20%7B1%2C%20cols%7D%5D%3B%0A%20%20y%20%3D%20Clip%5By%2C%20%7B1%2C%20rows%7D%5D%3B%0A%20%20%0A%20%20%28%2A%20Find%20the%20bounding%20indices%20%2A%29%0A%20%20x1%20%3D%20Floor%5Bx%5D%3B%20%0A%20%20x2%20%3D%20Ceiling%5Bx%5D%3B%0A%20%20y1%20%3D%20Floor%5By%5D%3B%20%0A%20%20y2%20%3D%20Ceiling%5By%5D%3B%0A%20%20%0A%20%20%28%2A%20Get%20the%20values%20at%20the%20four%20corners%20%2A%29%0A%20%20fQ11%20%3D%20array%5B%5By1%2C%20x1%5D%5D%3B%0A%20%20fQ12%20%3D%20array%5B%5By2%2C%20x1%5D%5D%3B%0A%20%20fQ21%20%3D%20array%5B%5By1%2C%20x2%5D%5D%3B%0A%20%20fQ22%20%3D%20array%5B%5By2%2C%20x2%5D%5D%3B%0A%20%20%0A%20%20%28%2A%20Perform%20bilinear%20interpolation%20%2A%29%0A%20%20If%5Bx2%20%3D%3D%20x1%2C%0A%20%20%20%20If%5By2%20%3D%3D%20y1%2C%0A%20%20%20%20%20%20fQ11%2C%0A%20%20%20%20%20%201%2F%282%20%28y2%20-%20y1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28y%20-%20y1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28y%20-%20y1%29%0A%20%20%20%20%20%20%29%0A%20%20%20%20%5D%2C%0A%20%20%20%20If%5By2%20%3D%3D%20y1%2C%0A%20%20%20%20%20%201%2F%282%20%28x2%20-%20x1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28x2%20-%20x%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28x%20-%20x1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28x2%20-%20x%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28x%20-%20x1%29%0A%20%20%20%20%20%20%29%2C%0A%20%20%20%20%20%201%2F%28%28x2%20-%20x1%29%20%28y2%20-%20y1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28x2%20-%20x%29%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28x%20-%20x1%29%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28x2%20-%20x%29%20%28y%20-%20y1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28x%20-%20x1%29%20%28y%20-%20y1%29%0A%20%20%20%20%20%20%29%0A%20%20%20%20%5D%0A%20%20%5D%0A%5D%0A%0AadvectParticles%5Bv_%2C%20pts_%2C%20%CE%B4t_%3A0.02%5D%20%3A%3D%20Map%5BFunction%5Bp%2C%20p%20%2B%20%CE%B4t%20%28bilinearInterpolation%5Bv%2C%20p%5D%29%5D%2C%20pts%5D`}</WLJSEditor>\\n\\nFor a single run we have\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"4aac5186-935d-4ad1-a8f6-18284ad46ac1\\"} type={\\"Input\\"} opts={{\\"Fade\\":true}} >{`runTest%5Btitle_%5D%20%3A%3D%20With%5B%7B%7D%2C%0A%20%20testGrid%20%3D%20Table%5B%7B0.%2C0.%7D%2C%20%7Bi%2C15%7D%2C%20%7Bj%2C15%7D%5D%3B%0A%20%20testParticles%20%3D%20Table%5BRandomReal%5B%7B1%2C15%7D%2C%202%5D%2C%20%7Bi%2C1000%7D%5D%3B%0A%0A%20%20timing%20%3D%20%7B0.%2C%200.%2C%200.%7D%3B%0A%0A%20%20timing%5B%5B1%5D%5D%20%3D%20-AbsoluteTime%5B%5D%3B%0A%20%20testGrid%20%3D%20advect%5BtestGrid%2C%20testGrid%2C%200.2%5D%3B%0A%20%20timing%5B%5B1%5D%5D%20%2B%3D%20AbsoluteTime%5B%5D%3B%0A%0A%20%20timing%5B%5B2%5D%5D%20%3D%20-AbsoluteTime%5B%5D%3B%0A%20%20testGrid%20%3D%20removeDivergence%5BtestGrid%5D%3B%0A%20%20timing%5B%5B2%5D%5D%20%2B%3D%20AbsoluteTime%5B%5D%3B%0A%0A%20%20timing%5B%5B3%5D%5D%20%3D%20-AbsoluteTime%5B%5D%3B%0A%20%20testParticles%20%3D%20advectParticles%5BtestGrid%2C%20testParticles%2C%200.2%5D%3B%0A%20%20timing%5B%5B3%5D%5D%20%2B%3D%20AbsoluteTime%5B%5D%3B%0A%0A%20%20%7B%0A%20%20%20%20Style%5Btitle%2C%20Italic%2C%2012%5D%2C%0A%0A%20%20%20%20Flatten%20%2F%40%20%7B%0A%20%20%20%20%20%20%7BStyle%5B%22time%2C%20s%22%2C%20Italic%5D%2C%20Round%5Btiming%2C%200.001%5D%7D%2C%0A%20%20%20%20%20%20%7BStyle%5B%22Max%20FPS%22%2C%20Italic%5D%2C%20Round%5B1%20%2F%20%28timing%20%2F%2F%20Total%29%2C%201%5D%7D%0A%20%20%20%20%7D%20%2F%2F%20TableView%20%0A%20%20%7D%20%2F%2F%20Column%0A%5D%3B%0A%0ArunTest%5B%22Uncompiled%22%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"fb3892d8-c313-401d-88d4-9156b13de3bf\\"} type={\\"Output\\"} opts={{}} >{`%28%2AGB%5B%2A%29%7B%7B%28%2ABB%5B%2A%29%28%22Uncompiled%22%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCRYg4ZGfkwJRxgkkgkuKMvPSnfIritmAPM%2BSxJzM5EweIBOiBKQhqDQnNZgNrhYsFlJUmgoAykcZ4w%3D%3D%22%2A%29%28%2A%5DBB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28FrontEndRef%5B%22bc61c228-82bc-43b5-a78b-b2829082984b%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKJyWbGSYbGVnoWhglJeuaGCeZ6iaaWyTpJhlZGFkaALGFSRIAgx0VRQ%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29`}</WLJSEditor>\\n\\n### Compile\\nMost probably for pure function JIT compiler should kick in, however, not all expressions are compilable in our case. We can make them by removing function declaration within the `Module` and replacing `Piecewise` with just a normal `If` statement.\\n\\nIt makes our code looks less readable ~~and removes all magic of WL~~, but the result worth it\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"5d76df8d-c1e8-4454-86a2-a735271062f8\\"} type={\\"Input\\"} opts={{\\"Fade\\":true}} >{`advect%20%3D%20Compile%5B%7B%7Bv%2C%20_Real%2C%203%7D%2C%20%7Bu%2C%20_Real%2C%203%7D%2C%20%7B%CE%B4t%2C%20_Real%2C%200%7D%7D%20%2C%20With%5B%7Bmax%20%3D%20Length%5Bv%5D%7D%2C%20With%5B%7B%0A%20%0A%7D%2C%0A%20%20Table%5B%20%0A%20%20%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20here%20we%20add%20a%20lot%20of%20manual%20check%20for%20boundary%20condition%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20v1%20%3D%20%28%2ABB%5B%2A%29%28%20%28%2AFB%5B%2A%29%28%28If%5Bi-1%20%3E%3D%201%2C%20v%5B%5Bi-1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeB5AILqnMSXXKr0hjgskHleakFnMBGU6JydnpRfmleSlpzDDlQe5Ozvk5%2BUVFDGDwwR6dwcAAAAHdFiw%3D%22%2A%29%28%2A%5DBB%2A%29.%7B1%2C0%7D%2C%0A%20%20%20%20%20%20v2%20%3D%20%20%28%2AFB%5B%2A%29%28%28If%5Bj%2B1%20%3C%3D%20max%2C%20v%5B%5Bi%2C%20j%2B1%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C-1%7D%2C%0A%20%20%20%20%20%20v3%20%3D%20%20%28%2AFB%5B%2A%29%28%28If%5Bi%2B1%20%3C%3D%20max%2C%20v%5B%5Bi%2B1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B-1%2C0%7D%2C%0A%20%20%20%20%20%20v4%20%3D%20%20%28%2AFB%5B%2A%29%28%28If%5Bj-1%20%3E%3D%201%2C%20v%5B%5Bi%2C%20j-1%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C1%7D%2C%0A%20%20%20%20%20%20org%20%3D%20u%5B%5Bi%2Cj%5D%5D%0A%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20org%20%2B%20%20%28%0A%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20here%20we%20add%20a%20lot%20of%20manual%20check%20for%20boundary%20condition%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20v1%20%28%2ABB%5B%2A%29%28If%5Bv1%20%3E0%2C%20If%5Bi-1%20%3E%3D%201%2C%20u%5B%5Bi-1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeB5AILqnMSXXKr0hjgskHleakFnMBGU6JydnpRfmleSlpzDDlQe5Ozvk5%2BUVFDGDwwR6dwcAAAAHdFiw%3D%22%2A%29%28%2A%5DBB%2A%29%20%20%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2B%20v3%20%28%2ABB%5B%2A%29%28If%5Bv3%3E0%2CIf%5Bi%2B1%20%3C%3D%20max%2C%20u%5B%5Bi%2B1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeB5AILqnMSXXKr0hjgskHleakFnMBGU6JydnpRfmleSlpzDDlQe5Ozvk5%2BUVFDGDwwR6dwcAAAAHdFiw%3D%22%2A%29%28%2A%5DBB%2A%29%2B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20v4%20If%5Bv4%20%3E0%2C%20If%5Bj-1%20%3E%3D%201%2C%20u%5B%5Bi%2C%20j-1%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%20%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2B%20v2%20If%5Bv2%3E0%2C%20If%5Bj%2B1%20%3C%3D%20max%2C%20u%5B%5Bi%2C%20j%2B1%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%20%CE%B4t%20%0A%20%20%20%20%5D%0A%20%20%20%20%0A%20%20%2C%20%7Bi%2C%20max%7D%2C%20%7Bj%2C%20max%7D%5D%20%2F%2F%20Chop%0A%20%5D%5D%5D%3B%0A%0AremoveDivergence%20%3D%20Compile%5B%7B%7Bgrid%2C%20_Real%2C%203%7D%7D%2C%20With%5B%7B%0A%20%20max%20%3D%20grid%20%2F%2F%20Length%0A%7D%2C%0A%20%20MapIndexed%5BFunction%5B%7Bval%2C%20i%7D%2C%20%0A%20%20%20%20val%20%2B%20%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%288.0%29%29%28%2A%5DFB%2A%29%20%28%0A%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20here%20we%20add%20a%20lot%20of%20manual%20check%20for%20boundary%20condition%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%20%20%20%20If%5Bi%5B%5B1%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%20-%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%2B%20If%5Bi%5B%5B1%5D%5D%20%2B%201%20%3E%3D1%20%26%26%20i%5B%5B1%5D%5D%20%2B%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%29.%7B1%2C1%7D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%7B1%2C1%7D%20%2B%0A%0A%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20here%20we%20add%20a%20lot%20of%20manual%20check%20for%20boundary%20condition%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%20%20%20%20If%5Bi%5B%5B1%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%20-%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%2B%20If%5Bi%5B%5B1%5D%5D%20%2B%201%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%20%2B%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%29.%7B1%2C-1%7D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%7B1%2C-1%7D%20%2B%0A%0A%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28If%5Bi%5B%5B1%5D%5D-1%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D-1%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D-1%2C%20i%5B%5B2%5D%5D%20%5D%5D%2C%20%7B0.%2C0.%7D%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeB5AILqnMSXXKr0hjgskHleakFnMBGU6JydnpRfmleSlpzDDlQe5Ozvk5%2BUVFDGDwwR6dwcAAAAHdFiw%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2B%20If%5Bi%5B%5B1%5D%5D%2B1%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%2B1%20%3C%3D%20max%2C%20grid%5B%5B%20i%5B%5B1%5D%5D%2B1%2C%20i%5B%5B2%5D%5D%20%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20-%20If%5Bi%5B%5B2%5D%5D-1%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D-1%20%3C%3D%20max%2C%20grid%5B%5B%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D-1%20%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20-%20If%5Bi%5B%5B2%5D%5D%2B1%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%2B1%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%2B1%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%7B2%2C-2%7D%20%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2B%20grid%5B%5B%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%20%5D%5D%20%28-4%29%0A%0A%20%20%20%20%29%0A%20%20%5D%2C%20grid%2C%20%7B2%7D%5D%0A%5D%5D%3B%0A%0AbilinearInterpolation%20%3D%20Compile%5B%7B%7Barray%2C%20_Real%2C%203%7D%2C%20%7Bv%2C%20_Real%2C%201%7D%7D%2C%20%0A%28%2ABB%5B%2A%29%28%2A%20no%20big%20changes%20here%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0AModule%5B%0A%20%20%7Brows%2C%20cols%2C%20x%20%3D%20v%5B%5B2%5D%5D%2C%20y%20%3D%20v%5B%5B1%5D%5D%2C%20x1%2C%20x2%2C%20y1%2C%20y2%2C%20fQ11%2C%20fQ12%2C%20fQ21%2C%20fQ22%7D%2C%0A%20%20%0A%20%20%28%2A%20Get%20the%20dimensions%20of%20the%20array%20%2A%29%0A%20%20%7Brows%2C%20cols%7D%20%3D%20%7BLength%5Barray%5D%2C%20Length%5Barray%5D%7D%3B%0A%20%20%0A%20%20%28%2A%20Clip%20points%20to%20the%20boundaries%20%2A%29%0A%20%20x%20%3D%20Clip%5Bx%2C%20%7B1%2C%20cols%7D%5D%3B%0A%20%20y%20%3D%20Clip%5By%2C%20%7B1%2C%20rows%7D%5D%3B%0A%20%20%0A%20%20%28%2A%20Find%20the%20bounding%20indices%20%2A%29%0A%20%20x1%20%3D%20Floor%5Bx%5D%3B%20%0A%20%20x2%20%3D%20Ceiling%5Bx%5D%3B%0A%20%20y1%20%3D%20Floor%5By%5D%3B%20%0A%20%20y2%20%3D%20Ceiling%5By%5D%3B%0A%20%20%0A%20%20%28%2A%20Get%20the%20values%20at%20the%20four%20corners%20%2A%29%0A%20%20fQ11%20%3D%20array%5B%5By1%2C%20x1%5D%5D%3B%0A%20%20fQ12%20%3D%20array%5B%5By2%2C%20x1%5D%5D%3B%0A%20%20fQ21%20%3D%20array%5B%5By1%2C%20x2%5D%5D%3B%0A%20%20fQ22%20%3D%20array%5B%5By2%2C%20x2%5D%5D%3B%0A%20%20%0A%20%20%28%2A%20Perform%20bilinear%20interpolation%20%2A%29%0A%20%20If%5Bx2%20%3D%3D%20x1%2C%0A%20%20%20%20If%5By2%20%3D%3D%20y1%2C%0A%20%20%20%20%20%20fQ11%2C%0A%20%20%20%20%20%201%2F%282%20%28y2%20-%20y1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28y%20-%20y1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28y%20-%20y1%29%0A%20%20%20%20%20%20%29%0A%20%20%20%20%5D%2C%0A%20%20%20%20If%5By2%20%3D%3D%20y1%2C%0A%20%20%20%20%20%201%2F%282%20%28x2%20-%20x1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28x2%20-%20x%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28x%20-%20x1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28x2%20-%20x%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28x%20-%20x1%29%0A%20%20%20%20%20%20%29%2C%0A%20%20%20%20%20%201%2F%28%28x2%20-%20x1%29%20%28y2%20-%20y1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28x2%20-%20x%29%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28x%20-%20x1%29%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28x2%20-%20x%29%20%28y%20-%20y1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28x%20-%20x1%29%20%28y%20-%20y1%29%0A%20%20%20%20%20%20%29%0A%20%20%20%20%5D%0A%20%20%5D%0A%5D%5D%3B%20%20%20%20`}</WLJSEditor>\\n\\nLet us test it again!\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"16b21fa2-abb0-4b08-915e-d00f25347ec6\\"} type={\\"Input\\"} opts={{}} >{`runTest%5B%22Compiled%22%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"ecbfb280-ec3c-4653-8c47-9f1b4fb63496\\"} type={\\"Output\\"} opts={{}} >{`%28%2AGB%5B%2A%29%7B%7B%28%2ABB%5B%2A%29%28%22Compiled%22%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCRYg4ZGfkwJRxgkkgkuKMvPSnfIritmAPM%2BSxJzM5EweIBOiBKQhqDQnNZgNrhYsFlJUmgoAykcZ4w%3D%3D%22%2A%29%28%2A%5DBB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28FrontEndRef%5B%22695430be-0583-497f-8116-2c88bdb6b06d%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKm1mamhgbJKXqGphaGOuaWJqn6VoYGprpGiVbWCSlJJklGZilAAByCRUe%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29`}</WLJSEditor>\\n\\n<WLJSHTML>{`%3Cspan%20style%3D%22color%3Ared%22%3E%3Cb%20%3Ex5%3C%2Fb%3E%20time%20faster%3C%2Fspan%3E`}</WLJSHTML>\\n\\nHowever, one should note, that this is still not a machine code, but rather byte-code of Wolfram Kernel internal command representation or something similar to that.\\n\\nOne can go futher and force WL to compile it to C and then link automatically. __This will probably require to have `gcc` or `clang` installed on your system__\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"9da84e82-862e-4190-9ad7-6d18bf5fc82b\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true,\\"Fade\\":true}} >{`advect%20%3D%20Compile%5B%7B%7Bv%2C%20_Real%2C%203%7D%2C%20%7Bu%2C%20_Real%2C%203%7D%2C%20%7B%CE%B4t%2C%20_Real%2C%200%7D%7D%20%2C%20With%5B%7Bmax%20%3D%20Length%5Bv%5D%7D%2C%20With%5B%7B%0A%20%0A%7D%2C%0A%20%20Table%5B%20%0A%20%20%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20v1%20%3D%20%20%28%2AFB%5B%2A%29%28%28If%5Bi-1%20%3E%3D%201%2C%20v%5B%5Bi-1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B1%2C0%7D%2C%0A%20%20%20%20%20%20v2%20%3D%20%20%28%2AFB%5B%2A%29%28%28If%5Bj%2B1%20%3C%3D%20max%2C%20v%5B%5Bi%2C%20j%2B1%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C-1%7D%2C%0A%20%20%20%20%20%20v3%20%3D%20%20%28%2AFB%5B%2A%29%28%28If%5Bi%2B1%20%3C%3D%20max%2C%20v%5B%5Bi%2B1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B-1%2C0%7D%2C%0A%20%20%20%20%20%20v4%20%3D%20%20%28%2AFB%5B%2A%29%28%28If%5Bj-1%20%3E%3D%201%2C%20v%5B%5Bi%2C%20j-1%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C1%7D%2C%0A%20%20%20%20%20%20org%20%3D%20u%5B%5Bi%2Cj%5D%5D%0A%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20org%20%2B%20%20%28%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20v1%20If%5Bv1%20%3E0%2C%20If%5Bi-1%20%3E%3D%201%2C%20u%5B%5Bi-1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%20%20%2B%20v3%20If%5Bv3%3E0%2CIf%5Bi%2B1%20%3C%3D%20max%2C%20u%5B%5Bi%2B1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%2B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20v4%20If%5Bv4%20%3E0%2C%20If%5Bj-1%20%3E%3D%201%2C%20u%5B%5Bi%2C%20j-1%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%20%2B%20v2%20If%5Bv2%3E0%2C%20If%5Bj%2B1%20%3C%3D%20max%2C%20u%5B%5Bi%2C%20j%2B1%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%20%CE%B4t%20%0A%20%20%20%20%5D%0A%20%20%20%20%0A%20%20%2C%20%7Bi%2C%20max%7D%2C%20%7Bj%2C%20max%7D%5D%20%2F%2F%20Chop%0A%20%5D%5D%20%2C%20CompilationOptions%20-%3E%20%7B%22InlineExternalDefinitions%22%20-%3E%20True%7D%2C%20%0A%20%20%20%20%22CompilationTarget%22%20-%3E%20%22C%22%2C%20%22RuntimeOptions%22%20-%3E%20%22Speed%22%5D%3B%0A%0AremoveDivergence%20%3D%20Compile%5B%7B%7Bgrid%2C%20_Real%2C%203%7D%7D%2C%20With%5B%7B%0A%20%20max%20%3D%20grid%20%2F%2F%20Length%0A%7D%2C%0A%20%20MapIndexed%5BFunction%5B%7Bval%2C%20i%7D%2C%20%0A%20%20%20%20val%20%2B%20%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%288.0%29%29%28%2A%5DFB%2A%29%20%28%0A%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%20%20If%5Bi%5B%5B1%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%20-%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%2B%20If%5Bi%5B%5B1%5D%5D%20%2B%201%20%3E%3D1%20%26%26%20i%5B%5B1%5D%5D%20%2B%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%29.%7B1%2C1%7D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%7B1%2C1%7D%20%2B%0A%0A%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%20%20If%5Bi%5B%5B1%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%20-%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%2B%20If%5Bi%5B%5B1%5D%5D%20%2B%201%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%20%2B%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%29.%7B1%2C-1%7D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%7B1%2C-1%7D%20%2B%0A%0A%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20If%5Bi%5B%5B1%5D%5D-1%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D-1%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D-1%2C%20i%5B%5B2%5D%5D%20%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2B%20If%5Bi%5B%5B1%5D%5D%2B1%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%2B1%20%3C%3D%20max%2C%20grid%5B%5B%20i%5B%5B1%5D%5D%2B1%2C%20i%5B%5B2%5D%5D%20%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20-%20If%5Bi%5B%5B2%5D%5D-1%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D-1%20%3C%3D%20max%2C%20grid%5B%5B%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D-1%20%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20-%20If%5Bi%5B%5B2%5D%5D%2B1%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%2B1%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%2B1%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%7B2%2C-2%7D%20%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2B%20grid%5B%5B%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%20%5D%5D%20%28-4%29%0A%0A%20%20%20%20%29%0A%20%20%5D%2C%20grid%2C%20%7B2%7D%5D%0A%5D%2C%20CompilationOptions%20-%3E%20%7B%22InlineExternalDefinitions%22%20-%3E%20True%7D%2C%20%0A%20%20%20%20%22CompilationTarget%22%20-%3E%20%22C%22%2C%20%20%20%22RuntimeOptions%22%20-%3E%20%22Speed%22%5D%3B%0A%0A%0AbilinearInterpolation%20%3D%20Compile%5B%7B%7Barray%2C%20_Real%2C%203%7D%2C%20%7Bv%2C%20_Real%2C%201%7D%7D%2C%20Module%5B%0A%20%20%7Brows%2C%20cols%2C%20x%20%3D%20v%5B%5B2%5D%5D%2C%20y%20%3D%20v%5B%5B1%5D%5D%2C%20x1%2C%20x2%2C%20y1%2C%20y2%2C%20fQ11%2C%20fQ12%2C%20fQ21%2C%20fQ22%7D%2C%0A%20%20%0A%20%20%28%2A%20Get%20the%20dimensions%20of%20the%20array%20%2A%29%0A%20%20%7Brows%2C%20cols%7D%20%3D%20%7BLength%5Barray%5D%2C%20Length%5Barray%5D%7D%3B%0A%20%20%0A%20%20%28%2A%20Clip%20points%20to%20the%20boundaries%20%2A%29%0A%20%20x%20%3D%20Clip%5Bx%2C%20%7B1%2C%20cols%7D%5D%3B%0A%20%20y%20%3D%20Clip%5By%2C%20%7B1%2C%20rows%7D%5D%3B%0A%20%20%0A%20%20%28%2A%20Find%20the%20bounding%20indices%20%2A%29%0A%20%20x1%20%3D%20Floor%5Bx%5D%3B%20%0A%20%20x2%20%3D%20Ceiling%5Bx%5D%3B%0A%20%20y1%20%3D%20Floor%5By%5D%3B%20%0A%20%20y2%20%3D%20Ceiling%5By%5D%3B%0A%20%20%0A%20%20%28%2A%20Get%20the%20values%20at%20the%20four%20corners%20%2A%29%0A%20%20fQ11%20%3D%20array%5B%5By1%2C%20x1%5D%5D%3B%0A%20%20fQ12%20%3D%20array%5B%5By2%2C%20x1%5D%5D%3B%0A%20%20fQ21%20%3D%20array%5B%5By1%2C%20x2%5D%5D%3B%0A%20%20fQ22%20%3D%20array%5B%5By2%2C%20x2%5D%5D%3B%0A%20%20%0A%20%20%28%2A%20Perform%20bilinear%20interpolation%20%2A%29%0A%20%20If%5Bx2%20%3D%3D%20x1%2C%0A%20%20%20%20If%5By2%20%3D%3D%20y1%2C%0A%20%20%20%20%20%20fQ11%2C%0A%20%20%20%20%20%201%2F%282%20%28y2%20-%20y1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28y%20-%20y1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28y%20-%20y1%29%0A%20%20%20%20%20%20%29%0A%20%20%20%20%5D%2C%0A%20%20%20%20If%5By2%20%3D%3D%20y1%2C%0A%20%20%20%20%20%201%2F%282%20%28x2%20-%20x1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28x2%20-%20x%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28x%20-%20x1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28x2%20-%20x%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28x%20-%20x1%29%0A%20%20%20%20%20%20%29%2C%0A%20%20%20%20%20%201%2F%28%28x2%20-%20x1%29%20%28y2%20-%20y1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28x2%20-%20x%29%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28x%20-%20x1%29%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28x2%20-%20x%29%20%28y%20-%20y1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28x%20-%20x1%29%20%28y%20-%20y1%29%0A%20%20%20%20%20%20%29%0A%20%20%20%20%5D%0A%20%20%5D%0A%5D%20%2C%20CompilationOptions%20-%3E%20%7B%22InlineExternalDefinitions%22%20-%3E%20True%7D%2C%20%0A%20%20%20%20%22CompilationTarget%22%20-%3E%20%22C%22%2C%22RuntimeOptions%22%20-%3E%20%22Speed%22%5D%3B%20%20`}</WLJSEditor>\\n\\nNow we have new results\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"4ae7a2ba-842d-4526-86a8-2961864ed5f1\\"} type={\\"Input\\"} opts={{}} >{`runTest%5B%22Compiled%20%2B%20C%22%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"7a260453-994b-4ba2-a652-a0b41ff83253\\"} type={\\"Output\\"} opts={{}} >{`%28%2AGB%5B%2A%29%7B%7B%28%2ABB%5B%2A%29%28%22Compiled%20%2B%20C%22%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCRYg4ZGfkwJRxgkkgkuKMvPSnfIritmAPM%2BSxJzM5EweIBOiBKQhqDQnNZgNrhYsFlJUmgoAykcZ4w%3D%3D%22%2A%29%28%2A%5DBB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28FrontEndRef%5B%2209dd1aaf-1abc-48e4-8407-2d04783abf9c%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG1impBgmJqbpGiYmJeuaWKSa6FqYGJjrGqUYmJhbGCcmpVkmAwCN5RX9%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29`}</WLJSEditor>\\n\\n<WLJSHTML>{`%3Cspan%20style%3D%22color%3Ared%22%3E%3Cb%20%3Ex6%3C%2Fb%3E%20time%20faster%3C%2Fspan%3E`}</WLJSHTML>\\n\\nWe gained a bit of speed; we will see more difference once the grid is expanded and more iterations are needed.\\n\\n## Immediate Graphics Mode\\nThis only means, that we will do all rendering of our primitives by ourself. The graphics API will only display the rendered frame we crafted on Wolfram Kernel. The last also meant we migh have to transfer much more data over WebSockets to frontend.\\n\\nLet me show you a simple example\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"6cf0317c-09c9-4e99-9515-ef4741b27d27\\"} type={\\"Input\\"} opts={{}} >{`Table%5BClip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B10%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%20%7Bx%2C-10%2C10%2C%200.5%7D%2C%20%7By%2C-10%2C10%2C%200.5%7D%5D%3B%0AImage%5B%25%2C%20Magnification%20-%3E%205%2C%20Antialiasing-%3EFalse%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"9e248deb-85e1-4a1a-8d61-65efe29b1d70\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%22a38a8802-948f-46d8-9f9a-33a0bf6828dd%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKJxpbJFpYGBjpWppYpOmamKVY6FqmWSbqGhsnGiSlmVkYWaSkAAB9LBWL%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nHere we used so-called SDF method for drawing graphics. We iterate over all posiitons of pixels in reactangle, produce brightness values and then send them to `Image`, which copies them into a texture on GPU.\\n\\nWe can use all 4 (RGBA) color channels to draw our picture\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"68edadf2-03e7-47c6-9ddb-fd75ee0ff1f7\\"} type={\\"Input\\"} opts={{}} >{`Table%5B%7B%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B10%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B5%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B3%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B1%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%0A%7D%2C%20%7Bx%2C-10%2C10%2C%200.5%7D%2C%20%7By%2C-10%2C10%2C%200.5%7D%5D%3B%0AImage%5B%25%2C%20Magnification%20-%3E%205%2C%20Antialiasing-%3EFalse%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"2a261f4b-bff3-4147-8281-d86eb9067f03\\"} type={\\"Input\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%2237dbfc31-9a78-43de-bb3d-a7828a5639f6%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG5unJKUlGxvqWiaaW%2BiaGKek6iYlGafoAnlGFommZsaWaWYAjRsV4g%3D%3D%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\n__For the best performance__ use `NumericArray`, since it packs all numberic data to a more compact form\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"a6040353-179c-4fa6-aca7-9374b3a26514\\"} type={\\"Input\\"} opts={{}} >{`Table%5B%7B%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B10%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B5%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B3%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B1%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%0A%7D%2C%20%7Bx%2C-10%2C10%2C%200.5%7D%2C%20%7By%2C-10%2C10%2C%200.5%7D%5D%3B%0AImage%5BNumericArray%5B%25%2C%20%22Real32%22%5D%2C%20Magnification%20-%3E%205%2C%20Antialiasing-%3EFalse%5D`}</WLJSEditor>\\n\\n---\\n\\n### Dynamic image\\nThere is a usual way on how to update our `Image` - using `Offload` technique as we did before\\n\\n><WLJSHTML>{`%3Cb%20%3ETIP%3C%2Fb%3E`}</WLJSHTML>\\nReal values takes more time to deserialize on frontend, we will use `UnsignedInteger8`\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"6f7e3a9c-fdea-4f80-b7af-9152dc302506\\"} type={\\"Input\\"} opts={{}} >{`serialize%5Barr_List%5D%20%3A%3D%20NumericArray%5Barr%2C%20%22UnsignedInteger8%22%2C%20%22ClipAndRound%22%5D%3B%0A%0Abuffer%20%3D%20Table%5B255.0%20%7B%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B10%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B5%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B3%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B1%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%0A%7D%2C%20%7Bx%2C-10%2C10%2C%200.5%7D%2C%20%7By%2C-10%2C10%2C%200.5%7D%5D%20%2F%2F%20serialize%3B%0A%0AImage%5Bbuffer%20%2F%2F%20Offload%2C%20%22Byte%22%2C%20Magnification%20-%3E%205%2C%20Antialiasing-%3EFalse%5D`}</WLJSEditor>\\n\\n![](./../eye-ezgif.com-optimize.gif)\\n\\nNow we can easily update our image by setting new values to `buffer`\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"f8c2fc4f-f0a6-43e5-a137-c474d6a6a98d\\"} type={\\"Input\\"} opts={{}} >{`t%20%3A%3D%20AbsoluteTime%5B%5D%3B%0A%0Atask%20%3D%20SetInterval%5B%0A%20%20buffer%20%3D%20Table%5B255.0%20%7B%0A%20%20%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5B%28x%20%2B%20Cos%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5B%28y%20-%20Sin%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B3%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5B%28x%20-%20Cos%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5B%28y%20-%20Sin%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B5%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5B%28x%20%2B%20Cos%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5B%28y%20%2B%20Sin%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B10%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5B%28x%20-%20Cos%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5B%28y%20%2B%20Sin%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B1%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%0A%20%20%7D%2C%20%7Bx%2C-10%2C10%2C%200.5%7D%2C%20%7By%2C-10%2C10%2C%200.5%7D%5D%20%2F%2F%20serialize%3B%0A%2C%20100%5D%3B%0A%0ASetTimeout%5BTaskRemove%5Btask%5D%2C%2010000%5D%3B`}</WLJSEditor>\\n\\nIf you made that far, **congratulations** \u2b50\ufe0f Now you have learned how to do the software rendering. \\n\\n> Please, never do *software rendering*. It is slow and basically is a waste of resources of your CPU, which was not designed for rendering graphics. Use it only for educational purposes, small images or complex calulations, which are not possible to do using GPU.\\n\\n## Virtual Ink\\nTo visualize velocity field, one can actually use another scalar field instead of 1000 probing balls. This scalar field is easy to imagine: ink \u270d\ud83c\udffc or dye or goo, which fell into a water and now is carried by the steams of fluid\\n\\n$$\\n\\\\frac{\\\\partial{u_{ink}}}{\\\\partial{t}} + (\\\\mathbf{v}\\\\cdot \\\\nabla) u_{ink} = 0\\n$$\\n\\nWe already know how to solve advection equation. Our function `advect` is used for modelling the momentum of fluid, which is a 2D vector field... Why not then to use __two kinds of ink__?\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"87b65963-4580-4c9f-a471-b67a3ac3ab47\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`ink%20%3D%20Table%5B%7B0.%2C0.%7D%2C%20%7Bi%2C50%7D%2C%20%7Bj%2C50%7D%5D%3B%0A%0A%28%2ABB%5B%2A%29%28%2A%20transform%20to%20%22byte%22%20format%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0Anink%20%3D%20NumericArray%5BMap%5B255.0%20%7B%23%5B%5B1%5D%5D%2C%200.%2C%20%23%5B%5B2%5D%5D%7D%20%26%2C%20ink%2C%20%7B2%7D%5D%2C%20%22UnsignedInteger8%22%2C%20%22ClipAndRound%22%5D%3B`}</WLJSEditor>\\n\\nThen we can directly visualize `nink` scalar field instead of drawing many many arrows and dots. In this way we will utilize fully our expensive software rendering.\\n\\n__TL;DR__ Final program\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"73fe49db-9a23-480c-b68c-e4e3334021f7\\"} id={\\"63d3faa1-b130-427a-b958-7f416cf688f1\\"} type={\\"Input\\"} opts={{}} >{`vgrid%20%3D%20Table%5B%7B0.%2C0.%7D%2C%20%7Bi%2C50%7D%2C%20%7Bj%2C50%7D%5D%3B%0A%0Aink%20%3D%200.%20ink%3B%0Anink%20%3D%20NumericArray%5BMap%5B255.0%20%7B%23%5B%5B1%5D%5D%2C%200.%2C%20%23%5B%5B2%5D%5D%7D%20%26%2C%20ink%2C%20%7B2%7D%5D%2C%20%22UnsignedInteger8%22%2C%20%22ClipAndRound%22%5D%3B%0A%0Adest%20%3D%20%7B0%2C0%7D%3B%0Acink%20%3D%20%7B1.0%2C0.2%7D%3B%0Avfps%20%3D%200%3B%0A%0AWith%5B%7B%0A%20%20win%20%3D%20CurrentWindow%5B%5D%2C%20%0A%20%20currentCell%20%3D%20ResultCell%5B%5D%0A%7D%2C%0A%0A%20%20EventHandler%5Bwin%2C%20%7B%22Closed%22%20-%3E%20Function%5BNull%2C%0A%20%20%20%20Delete%5BcurrentCell%5D%20%28%2ABB%5B%2A%29%28%2A%20remove%20output%20cell%20if%20a%20notebook%20has%20been%20closed%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20this%20will%20prevent%20the%20animation%20running%20uncontrollably%20on%20the%20next%20start%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%5D%7D%5D%3B%0A%0A%20%20Graphics%5B%7B%0A%0A%20%20%20%20%28%2ABB%5B%2A%29%28%2Aattach%20listeners%20to%20a%20user%27s%20mouse%20to%20manipulate%20the%20grid%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20EventHandler%5BGraphics%60Canvas%5B%5D%2C%20%7B%0A%20%20%20%20%20%20%22click%22%20-%3E%20Function%5BNull%2C%0A%20%20%20%20%20%20%20%20cink%20%3D%20cink%20%2F%2F%20Reverse%3B%0A%20%20%20%20%20%20%5D%2C%0A%0A%20%20%20%20%20%20%22mousemove%22%20-%3E%20Function%5Bpos%2C%20With%5B%7B%0A%20%20%20%20%20%20%20%20%20%20xy%20%3D%20%7B50.0%20-%20pos%5B%5B2%5D%5D%2C%20pos%5B%5B1%5D%5D%7D%0A%20%20%20%20%20%20%20%20%7D%2C%20%0A%20%20%20%20%20%20%20%20%20%20With%5B%7Bp%20%3D%20Round%5Bxy%5D%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20If%5Bp%5B%5B1%5D%5D%20%3C%3D%2050-1%20%26%26%20p%5B%5B1%5D%5D%20%3E%3D2%20%26%26%20p%5B%5B2%5D%5D%20%3C%3D50-1%20%26%26%20p%5B%5B2%5D%5D%20%3E%3D2%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20accelerate%20the%20fluid%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20vgrid%5B%5Bp%5B%5B1%5D%5D%2Cp%5B%5B2%5D%5D%5D%5D%20%3D%20Normalize%5B%28xy%20-%20dest%29%5D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20add%20some%20ink%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ink%5B%5Bp%5B%5B1%5D%5D%2Cp%5B%5B2%5D%5D%5D%5D%20%3D%20cink%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ink%5B%5Bp%5B%5B1%5D%5D%2B1%2Cp%5B%5B2%5D%5D%5D%5D%20%3D%20cink%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ink%5B%5Bp%5B%5B1%5D%5D-1%2Cp%5B%5B2%5D%5D%5D%5D%20%3D%20cink%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ink%5B%5Bp%5B%5B1%5D%5D%2Cp%5B%5B2%5D%5D%2B1%5D%5D%20%3D%20cink%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ink%5B%5Bp%5B%5B1%5D%5D%2Cp%5B%5B2%5D%5D%2B1%5D%5D%20%3D%20cink%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%5D%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20dest%20%3D%20xy%3B%0A%20%20%20%20%20%20%20%20%5D%20%5D%0A%20%20%20%20%7D%5D%2C%20%0A%0A%20%20%20%20%28%2ABB%5B%2A%29%28%2Async%20with%20browser%27s%20repaint%20cycle%20and%20update%20of%20fps%20label%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20AnimationFrameListener%5Bvfps%20%2F%2F%20Offload%2C%20%22Event%22-%3E%22vframe%22%5D%2C%20%0A%0A%20%20%20%20%28%2ABB%5B%2A%29%28%2Ainsert%20our%20Image%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20Inset%5B%0A%20%20%20%20%0A%20%20%20%20%20%20Image%5Bnink%20%2F%2F%20Offload%2C%20%22Byte%22%2C%20Magnification-%3E10%5D%0A%20%20%20%20%0A%20%20%20%20%2C%20%7B0%2C0%7D%2C%20%7B0%2C0%7D%2C%20%7B500%2C500%7D%2C%20%0A%20%20%20%20%0A%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20do%20not%20apply%20any%20transformation.%20keep%20the%20original%20size%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20ViewMatrix-%3ENone%0A%20%20%20%20%5D%2C%0A%20%20%20%20%0A%20%20%20%20Text%5Bvfps%20%2F%2F%20Offload%2C%20%7B0%2C0%7D%5D%0A%0A%20%20%20%20%0A%20%20%7D%2C%20%0A%20%20%20%20Controls-%3EFalse%2C%20%0A%20%20%20%20ImageSize-%3E500%2C%20%0A%20%20%20%20PlotRange-%3E%7B%7B0%2C50%7D%2C%20%7B0%2C50%7D%7D%2C%20%0A%20%20%20%20ImagePadding-%3ENone%0A%20%20%5D%0A%5D%0A%0A%28%2A%20subscribe%20to%20animation%20event%20%2A%29%0A%0Avtime%20%3D%20AbsoluteTime%5B%5D%3B%0A%0AEventHandler%5B%22vframe%22%2C%20Function%5BNull%2C%0A%20%20%0A%20%20vgrid%20%3D%20advect%5Bvgrid%2Cvgrid%2C%201.0%5D%3B%0A%20%20vgrid%20%3D%20removeDivergence%5Bvgrid%5D%3B%0A%20%20vgrid%20%3D%20removeDivergence%5Bvgrid%5D%3B%0A%0A%20%20ink%20%3D%20With%5B%7Ba%20%3D%20advect%5Bvgrid%2C%20ink%2C%201.0%5D%7D%2C%20advect%5Bvgrid%2C%20a%2C%201.0%5D%5D%3B%0A%20%20nink%20%3D%20NumericArray%5BMap%5B255.0%20%7B1.0%20-%20%23%5B%5B2%5D%5D%2C%201.0-%20%23%5B%5B1%5D%5D%2C%201.0%20-%20%23%5B%5B1%5D%5D%2C%201.0%7D%20%26%2C%20ink%2C%20%7B2%7D%5D%2C%20%22UnsignedInteger8%22%2C%20%22ClipAndRound%22%5D%3B%0A%20%20%0A%20%20vfps%20%3D%20%28%2AFB%5B%2A%29%28%28%28vfps%20%2B%201%20%2F%20%28AbsoluteTime%5B%5D%20-%20vtime%29%29%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29%20%2F%2F%20Round%3B%0A%20%20vtime%20%3D%20AbsoluteTime%5B%5D%3B%20%0A%5D%5D%3B`}</WLJSEditor>\\n\\nWe do here pretty much the same as before; however, there are no longer arrows but a single `Inset` with a raster dynamic image inside. This places the `Image` on top of our `Graphics` canvas. This overlay is helpful since we can still listen to mouse positions and display FPS at a low cost. The fluid goes in the same direction as the mouse\\n\\nimport testVideo from \'./attachments/fluid_raster.mov\';\\n\\n<video width={\\"100%\\"} controls>\\n  <source src={testVideo}/>\\n</video>\\n\\nI (Me - @JerryI) personally believe that we pushed the implementation to the limits of this toy model running on a CPU with an interpretive programming language. The next step definitely should be to utilize GPU compute shaders such as WebGPU, OpenCL, CUDA to calculate bigger fields and pipe the data directly to the canvas. However, this will be another story.\\n\\nThank you \u2764\ufe0f"},{"id":"/2024/08/19/fluid-2","metadata":{"permalink":"/wljs-docs/blog/2024/08/19/fluid-2","source":"@site/blog/2024-08-19-fluid-2/index.mdx","title":"Real-time Fluid Simulation Part 2","description":"Using Wolfram Language and WLJS libraries","date":"2024-08-19T00:00:00.000Z","tags":[{"label":"visualization","permalink":"/wljs-docs/blog/tags/visualization"},{"label":"dynamics","permalink":"/wljs-docs/blog/tags/dynamics"}],"readingTime":8.35,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["visualization","dynamics"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Real-time Fluid Simulation Part 3","permalink":"/wljs-docs/blog/2024/08/21/fluid-3"},"nextItem":{"title":"Real-time Fluid Simulation Part 1","permalink":"/wljs-docs/blog/2024/08/18/fluid-1"}},"content":"*Using Wolfram Language and WLJS libraries*\\n\\nIn this notebook, we will __continue__ to explore a simple technique for simulating 2D incompressible fluids for visual effects. This work is mostly based on Jos Stam. Stable Fluids SIGGRAPH 1999 as well as a tutorial by [Karl Sims](https://www.karlsims.com/fluid-flow.html)\\n\\n\x3c!--truncate--\x3e\\n\\nimport { WLJSHTML, WLJSEditor, WLJSStore } from \\"@site/src/components/wljs-reactcells\\";\\n\\n\\n<WLJSStore json={require(\'./attachments/5caf3e63-833d-41f0-b4be-6dd62b241fad.txt\').default} notebook={require(\'./attachments/notebook-5ca.wln\').default}/>\\n\\n---\\n\\n## Advection\\nFrom mathematica point of view it describes a general process of moving something on a scalar or vector field in the direction given by another vector field.\\n\\nFor simplicity\'s sake, we will first start with scalar fields.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"f30a2585-dca9-4c0a-817d-49b50222edad\\"} type={\\"Input\\"} opts={{}} >{`grid%20%3D%20Table%5B%7B0%2C0%7D%2C%20%7B5%7D%2C%20%7B5%7D%5D%3B%20grid%5B%5B3%2C3%5D%5D%20%3D%20%7B0%2C1%7D%3B%0Au%20%3D%20Table%5B1.%2C%20%7B5%7D%2C%20%7B5%7D%5D%3B%20%28%2ABB%5B%2A%29%28%2Aour%20scalar%20field%20we%20will%20move%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29`}</WLJSEditor>\\n\\nOne can think about `u` as if it were a mass of something, which will be carried by the stream `grid`.\\n\\n\\n### Naive approach\\n*Looking at the borders*\\n\\n\\n<WLJSHTML>{`%3Cdiv%20class%3D%22text-center%20w-full%22%3E%3Csvg%20version%3D%221.1%22%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20362.609375%20167.34765625%22%3E%0A%20%20%3C%21--%20svg-source%3Aexcalidraw%20--%3E%0A%20%20%0A%20%20%3Cdefs%3E%0A%20%20%20%20%3Cstyle%20class%3D%22style-fonts%22%3E%0A%20%20%20%20%20%20%40font-face%20%7B%0A%20%20%20%20%20%20%20%20font-family%3A%20%22Virgil%22%3B%0A%20%20%20%20%20%20%20%20src%3A%20url%28%22https%3A%2F%2Funpkg.com%2F%40excalidraw%2Fexcalidraw%40undefined%2Fdist%2Fexcalidraw-assets%2FVirgil.woff2%22%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%40font-face%20%7B%0A%20%20%20%20%20%20%20%20font-family%3A%20%22Cascadia%22%3B%0A%20%20%20%20%20%20%20%20src%3A%20url%28%22https%3A%2F%2Funpkg.com%2F%40excalidraw%2Fexcalidraw%40undefined%2Fdist%2Fexcalidraw-assets%2FCascadia.woff2%22%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%40font-face%20%7B%0A%20%20%20%20%20%20%20%20font-family%3A%20%22Assistant%22%3B%0A%20%20%20%20%20%20%20%20src%3A%20url%28%22https%3A%2F%2Funpkg.com%2F%40excalidraw%2Fexcalidraw%40undefined%2Fdist%2Fexcalidraw-assets%2FAssistant-Regular.woff2%22%29%3B%0A%20%20%20%20%20%20%7D%0A%20%20%20%20%3C%2Fstyle%3E%0A%20%20%20%20%0A%20%20%3C%2Fdefs%3E%0A%20%20%3Cg%20stroke-linecap%3D%22round%22%20transform%3D%22translate%28150.49307433001178%2078.12304707232147%29%20rotate%280%207.959858655597571%207.959858655597571%29%22%3E%3Cpath%20d%3D%22M7.66%20-0.1%20C9.22%20-0.26%2C%2011.43%200.76%2C%2012.82%201.83%20C14.22%202.9%2C%2015.72%204.7%2C%2016.03%206.34%20C16.33%207.97%2C%2015.56%2010.11%2C%2014.67%2011.63%20C13.78%2013.14%2C%2012.13%2014.81%2C%2010.7%2015.42%20C9.27%2016.04%2C%207.69%2015.85%2C%206.08%2015.3%20C4.47%2014.75%2C%201.97%2013.46%2C%201.02%2012.11%20C0.07%2010.76%2C%200.08%208.83%2C%200.39%207.2%20C0.7%205.58%2C%201.67%203.6%2C%202.89%202.34%20C4.1%201.07%2C%206.83%200.06%2C%207.68%20-0.37%20C8.53%20-0.81%2C%207.94%20-0.39%2C%207.98%20-0.27%20M7.31%20-0.22%20C8.77%20-0.34%2C%2010.46%201.06%2C%2011.95%202.18%20C13.44%203.29%2C%2015.6%205.02%2C%2016.25%206.46%20C16.9%207.9%2C%2016.78%209.26%2C%2015.84%2010.83%20C14.91%2012.4%2C%2012.34%2014.98%2C%2010.65%2015.89%20C8.97%2016.79%2C%207.24%2016.88%2C%205.73%2016.24%20C4.22%2015.59%2C%202.55%2013.57%2C%201.59%2012%20C0.64%2010.42%2C%20-0.01%208.33%2C%200.02%206.77%20C0.04%205.21%2C%200.56%203.79%2C%201.76%202.64%20C2.97%201.49%2C%206.29%200.2%2C%207.27%20-0.11%20C8.25%20-0.42%2C%207.58%200.6%2C%207.64%200.78%22%20stroke%3D%22none%22%20stroke-width%3D%220%22%20fill%3D%22%23ffc9c9%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M8.14%200.08%20C9.79%200.11%2C%2011.63%201.07%2C%2012.96%202.17%20C14.3%203.26%2C%2015.87%205.09%2C%2016.16%206.64%20C16.44%208.19%2C%2015.54%2010.03%2C%2014.67%2011.48%20C13.8%2012.93%2C%2012.5%2014.61%2C%2010.95%2015.33%20C9.39%2016.05%2C%206.95%2016.38%2C%205.35%2015.82%20C3.76%2015.27%2C%202.26%2013.56%2C%201.36%2011.98%20C0.45%2010.4%2C%20-0.31%208.03%2C%20-0.07%206.34%20C0.17%204.65%2C%201.41%202.93%2C%202.78%201.83%20C4.15%200.73%2C%207.07%20-0.05%2C%208.13%20-0.25%20C9.18%20-0.45%2C%209.02%200.48%2C%209.11%200.64%20M8.31%20-0.03%20C9.97%20-0.06%2C%2012.17%201.14%2C%2013.5%202.14%20C14.83%203.14%2C%2016.04%204.34%2C%2016.28%205.96%20C16.51%207.59%2C%2015.85%2010.34%2C%2014.89%2011.9%20C13.93%2013.46%2C%2012.16%2014.62%2C%2010.5%2015.32%20C8.84%2016.03%2C%206.43%2016.66%2C%204.92%2016.13%20C3.42%2015.6%2C%202.26%2013.82%2C%201.46%2012.14%20C0.66%2010.47%2C%20-0.13%207.78%2C%200.13%206.07%20C0.39%204.37%2C%201.79%202.9%2C%203.01%201.91%20C4.22%200.92%2C%206.64%200.5%2C%207.42%200.15%20C8.19%20-0.21%2C%207.67%20-0.42%2C%207.64%20-0.22%22%20stroke%3D%22%23e03131%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Cg%20stroke-linecap%3D%22round%22%20transform%3D%22translate%28165.97489797260033%2060.36721962944003%29%20rotate%280%2011.364946874028647%2011.364946874028632%29%22%3E%3Cpath%20d%3D%22M12.07%200.21%20C14.42%200.24%2C%2017.77%201.58%2C%2019.47%203.22%20C21.18%204.86%2C%2022.12%207.64%2C%2022.3%2010.06%20C22.47%2012.48%2C%2021.73%2015.75%2C%2020.53%2017.74%20C19.33%2019.72%2C%2017.43%2021.34%2C%2015.11%2022%20C12.79%2022.65%2C%208.88%2022.53%2C%206.62%2021.65%20C4.35%2020.77%2C%202.53%2018.84%2C%201.53%2016.72%20C0.53%2014.61%2C%200.15%2011.44%2C%200.63%208.97%20C1.1%206.49%2C%202.41%203.42%2C%204.38%201.87%20C6.35%200.31%2C%2010.96%20-0.04%2C%2012.43%20-0.37%20C13.89%20-0.69%2C%2013.2%20-0.36%2C%2013.19%20-0.08%20M11.06%200.67%20C13.49%200.71%2C%2017.48%201.92%2C%2019.52%203.34%20C21.57%204.75%2C%2023.19%206.7%2C%2023.34%209.15%20C23.5%2011.6%2C%2021.88%2015.75%2C%2020.47%2018.03%20C19.05%2020.3%2C%2017.04%2022.22%2C%2014.85%2022.79%20C12.67%2023.37%2C%209.61%2022.56%2C%207.35%2021.49%20C5.1%2020.42%2C%202.61%2018.37%2C%201.31%2016.36%20C0.02%2014.34%2C%20-0.9%2011.77%2C%20-0.42%209.42%20C0.07%207.08%2C%202.16%203.76%2C%204.22%202.29%20C6.29%200.82%2C%2010.69%200.92%2C%2011.97%200.61%20C13.25%200.29%2C%2011.82%200.26%2C%2011.88%200.38%22%20stroke%3D%22none%22%20stroke-width%3D%220%22%20fill%3D%22%23ffc9c9%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M8.69%200.57%20C10.95%20-0.1%2C%2014.73%200.3%2C%2016.9%201.28%20C19.06%202.26%2C%2020.73%204.23%2C%2021.67%206.45%20C22.6%208.67%2C%2023.19%2012.11%2C%2022.52%2014.58%20C21.86%2017.06%2C%2019.73%2019.95%2C%2017.69%2021.3%20C15.64%2022.66%2C%2012.74%2023.12%2C%2010.27%2022.72%20C7.79%2022.31%2C%204.57%2020.7%2C%202.84%2018.9%20C1.12%2017.1%2C%200.06%2014.37%2C%20-0.07%2011.93%20C-0.21%209.49%2C%200.45%206.13%2C%202.03%204.25%20C3.62%202.37%2C%208.16%201.32%2C%209.45%200.66%20C10.74%200.01%2C%209.78%200.19%2C%209.76%200.33%20M11.2%200.34%20C13.51%20-0.03%2C%2016.79%200.3%2C%2018.66%201.71%20C20.53%203.12%2C%2022%206.34%2C%2022.43%208.78%20C22.87%2011.23%2C%2022.43%2014.11%2C%2021.27%2016.39%20C20.11%2018.68%2C%2017.61%2021.48%2C%2015.47%2022.48%20C13.33%2023.48%2C%2010.71%2023.3%2C%208.44%2022.39%20C6.18%2021.48%2C%203.24%2019.08%2C%201.88%2017.02%20C0.52%2014.96%2C%200.09%2012.32%2C%200.29%2010.03%20C0.5%207.73%2C%201.41%204.96%2C%203.1%203.23%20C4.8%201.5%2C%209.31%200.04%2C%2010.47%20-0.37%20C11.64%20-0.77%2C%2010.09%200.52%2C%2010.09%200.8%22%20stroke%3D%22%23e03131%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Cg%20stroke-linecap%3D%22round%22%20transform%3D%22translate%28170.20674296303383%2088.179385067966%29%20rotate%280%204.885304075052915%204.885304075052915%29%22%3E%3Cpath%20d%3D%22M4.91%200.08%20C5.86%20-0.04%2C%206.89%200.39%2C%207.65%201.04%20C8.4%201.68%2C%209.13%202.95%2C%209.45%203.94%20C9.76%204.93%2C%2010.01%206.1%2C%209.53%207%20C9.05%207.9%2C%207.55%208.87%2C%206.56%209.32%20C5.58%209.77%2C%204.53%209.99%2C%203.6%209.71%20C2.66%209.43%2C%201.57%208.59%2C%200.96%207.64%20C0.34%206.68%2C%20-0.18%205.07%2C%20-0.09%203.96%20C0%202.85%2C%200.66%201.68%2C%201.48%200.97%20C2.3%200.26%2C%204.27%20-0.17%2C%204.83%20-0.3%20C5.39%20-0.43%2C%204.82%200.04%2C%204.83%200.17%20M5%200.29%20C6.15%200.04%2C%207.59%20-0.08%2C%208.31%200.57%20C9.02%201.23%2C%209.13%203.06%2C%209.28%204.22%20C9.43%205.38%2C%209.6%206.7%2C%209.21%207.52%20C8.83%208.33%2C%207.91%208.8%2C%206.95%209.1%20C5.99%209.4%2C%204.54%209.53%2C%203.44%209.32%20C2.34%209.1%2C%200.93%208.67%2C%200.35%207.82%20C-0.23%206.96%2C%20-0.28%205.22%2C%20-0.05%204.2%20C0.17%203.19%2C%200.91%202.4%2C%201.7%201.71%20C2.5%201.03%2C%204.16%200.35%2C%204.72%200.11%20C5.28%20-0.14%2C%205.01%200.18%2C%205.05%200.24%22%20stroke%3D%22none%22%20stroke-width%3D%220%22%20fill%3D%22%23ffc9c9%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M5.25%200.02%20C6.24%20-0.1%2C%207.23%200.22%2C%208.01%200.9%20C8.79%201.58%2C%209.73%202.95%2C%209.91%204.08%20C10.1%205.22%2C%209.7%206.79%2C%209.15%207.7%20C8.6%208.62%2C%207.67%209.3%2C%206.64%209.57%20C5.61%209.83%2C%203.98%209.69%2C%202.96%209.29%20C1.94%208.9%2C%201.04%208.13%2C%200.53%207.21%20C0.02%206.28%2C%20-0.34%204.71%2C%20-0.08%203.74%20C0.18%202.76%2C%201.17%201.98%2C%202.07%201.35%20C2.96%200.72%2C%204.79%200.15%2C%205.3%20-0.04%20C5.81%20-0.23%2C%205.2%200.09%2C%205.14%200.21%20M5.18%20-0.37%20C6.12%20-0.47%2C%207.28%200.42%2C%208.01%201.13%20C8.73%201.85%2C%209.38%202.84%2C%209.53%203.95%20C9.67%205.05%2C%209.33%206.81%2C%208.88%207.75%20C8.43%208.68%2C%207.76%209.34%2C%206.82%209.56%20C5.89%209.79%2C%204.26%209.48%2C%203.26%209.11%20C2.25%208.74%2C%201.4%208.18%2C%200.81%207.36%20C0.23%206.53%2C%20-0.37%205.24%2C%20-0.25%204.16%20C-0.13%203.09%2C%200.77%201.54%2C%201.55%200.91%20C2.33%200.27%2C%203.91%200.49%2C%204.42%200.37%20C4.93%200.25%2C%204.57%200.12%2C%204.63%200.2%22%20stroke%3D%22%23e03131%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Cg%20stroke-linecap%3D%22round%22%3E%3Cg%20transform%3D%22translate%28163.72685972175793%2073.47685972175782%29%20rotate%2889.99999999999994%2051.552734375%200%29%22%3E%3Cpath%20d%3D%22M0%200%20C17.18%200%2C%2085.92%200%2C%20103.11%200%20M0%200%20C17.18%200%2C%2085.92%200%2C%20103.11%200%22%20stroke%3D%22%231e1e1e%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fg%3E%3Cmask%3E%3C%2Fmask%3E%3Cg%20stroke-linecap%3D%22round%22%3E%3Cg%20transform%3D%22translate%28181.94726562500017%20-126.06227829773717%29%20rotate%2889.99999999999994%20-1.7053025658242404e-13%20170.662109375%29%22%3E%3Cpath%20d%3D%22M0%200%20C0%2056.89%2C%200%20284.44%2C%200%20341.32%20M0%200%20C0%2056.89%2C%200%20284.44%2C%200%20341.32%22%20stroke%3D%22%231e1e1e%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fg%3E%3Cmask%3E%3C%2Fmask%3E%3Cg%20stroke-linecap%3D%22round%22%3E%3Cg%20transform%3D%22translate%28180.32226562500017%20-63.8719554162075%29%20rotate%2889.99999999999994%20-1.7053025658242404e-13%20170.322265625%29%22%3E%3Cpath%20d%3D%22M0%200%20C0%2056.77%2C%200%20283.87%2C%200%20340.64%20M0%200%20C0%2056.77%2C%200%20283.87%2C%200%20340.64%22%20stroke%3D%22%231e1e1e%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fg%3E%3Cmask%3E%3C%2Fmask%3E%3Cg%20stroke-linecap%3D%22round%22%3E%3Cg%20transform%3D%22translate%2890.76107921688504%2074.21589335392412%29%20rotate%2889.99999999999994%2051.552734375%200%29%22%3E%3Cpath%20d%3D%22M0%200%20C17.18%200%2C%2085.92%200%2C%20103.11%200%20M0%200%20C17.18%200%2C%2085.92%200%2C%20103.11%200%22%20stroke%3D%22%231e1e1e%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fg%3E%3Cmask%3E%3C%2Fmask%3E%3Cg%20stroke-linecap%3D%22round%22%3E%3Cg%20transform%3D%22translate%28163.50131810993025%2076.39720583377255%29%20rotate%280%2021.245434695034874%200.5416314581137271%29%22%3E%3Cpath%20d%3D%22M0%200%20C7.08%200.18%2C%2035.41%200.9%2C%2042.49%201.08%20M0%200%20C7.08%200.18%2C%2035.41%200.9%2C%2042.49%201.08%22%20stroke%3D%22%232f9e44%22%20stroke-width%3D%224%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Cg%20transform%3D%22translate%28163.50131810993025%2076.39720583377255%29%20rotate%280%2021.245434695034874%200.5416314581137271%29%22%3E%3Cpath%20d%3D%22M42.49%201.08%20L28.74%207.07%20L29.06%20-5.6%20L42.49%201.08%22%20stroke%3D%22none%22%20stroke-width%3D%220%22%20fill%3D%22%232f9e44%22%20fill-rule%3D%22evenodd%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M42.49%201.08%20C39.24%202.5%2C%2035.98%203.92%2C%2028.74%207.07%20M42.49%201.08%20C39.01%202.6%2C%2035.52%204.12%2C%2028.74%207.07%20M28.74%207.07%20C28.84%203.11%2C%2028.94%20-0.85%2C%2029.06%20-5.6%20M28.74%207.07%20C28.83%203.6%2C%2028.92%200.13%2C%2029.06%20-5.6%20M29.06%20-5.6%20C32.99%20-3.65%2C%2036.92%20-1.69%2C%2042.49%201.08%20M29.06%20-5.6%20C33.73%20-3.28%2C%2038.39%20-0.96%2C%2042.49%201.08%20M42.49%201.08%20C42.49%201.08%2C%2042.49%201.08%2C%2042.49%201.08%20M42.49%201.08%20C42.49%201.08%2C%2042.49%201.08%2C%2042.49%201.08%22%20stroke%3D%22%232f9e44%22%20stroke-width%3D%224%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fg%3E%3Cmask%3E%3C%2Fmask%3E%3Cg%20stroke-linecap%3D%22round%22%20transform%3D%22translate%2886.13497691818259%2079.1703181154445%29%20rotate%280%207.959858655597571%207.959858655597571%29%22%3E%3Cpath%20d%3D%22M8.12%20-0.44%20C9.69%20-0.53%2C%2011.8%200.6%2C%2013.14%201.72%20C14.48%202.85%2C%2015.89%204.69%2C%2016.16%206.34%20C16.43%207.98%2C%2015.72%2010.05%2C%2014.73%2011.6%20C13.74%2013.15%2C%2011.82%2014.97%2C%2010.23%2015.66%20C8.65%2016.34%2C%206.75%2016.37%2C%205.23%2015.69%20C3.72%2015.01%2C%202.08%2013.06%2C%201.16%2011.56%20C0.23%2010.07%2C%20-0.53%208.26%2C%20-0.31%206.7%20C-0.08%205.14%2C%200.95%203.39%2C%202.49%202.22%20C4.02%201.05%2C%207.81%200.03%2C%208.91%20-0.33%20C10.01%20-0.68%2C%209.12%20-0.05%2C%209.09%200.09%20M5.91%200.67%20C7.46%200.21%2C%2010.24%20-0.38%2C%2011.85%200.36%20C13.47%201.1%2C%2015.01%203.43%2C%2015.61%205.12%20C16.21%206.82%2C%2015.93%208.86%2C%2015.47%2010.53%20C15%2012.19%2C%2014.12%2014.12%2C%2012.81%2015.11%20C11.49%2016.1%2C%209.39%2016.81%2C%207.55%2016.46%20C5.71%2016.11%2C%203.05%2014.38%2C%201.78%2013.03%20C0.51%2011.67%2C%20-0.04%209.86%2C%20-0.08%208.3%20C-0.12%206.74%2C%200.4%205.1%2C%201.56%203.64%20C2.71%202.18%2C%205.96%200.01%2C%206.83%20-0.45%20C7.71%20-0.9%2C%206.83%200.66%2C%206.81%200.9%22%20stroke%3D%22none%22%20stroke-width%3D%220%22%20fill%3D%22%23ffc9c9%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M8.24%20-0.14%20C9.87%20-0.05%2C%2012.05%201.18%2C%2013.37%202.34%20C14.69%203.5%2C%2016.01%205.17%2C%2016.17%206.81%20C16.33%208.45%2C%2015.24%2010.65%2C%2014.34%2012.17%20C13.45%2013.7%2C%2012.36%2015.42%2C%2010.8%2015.94%20C9.24%2016.47%2C%206.7%2016.02%2C%204.99%2015.35%20C3.28%2014.68%2C%201.26%2013.42%2C%200.55%2011.93%20C-0.17%2010.44%2C%200.29%208.1%2C%200.69%206.41%20C1.09%204.72%2C%201.59%202.84%2C%202.94%201.77%20C4.29%200.7%2C%207.74%200.29%2C%208.79%200%20C9.85%20-0.3%2C%209.32%20-0.13%2C%209.26%20-0.01%20M7.61%20-0.62%20C9.32%20-0.87%2C%2011.89%200.2%2C%2013.26%201.38%20C14.62%202.57%2C%2015.46%204.74%2C%2015.8%206.5%20C16.14%208.27%2C%2016.27%2010.4%2C%2015.29%2011.96%20C14.31%2013.53%2C%2011.7%2015.41%2C%209.94%2015.91%20C8.19%2016.4%2C%206.17%2015.63%2C%204.76%2014.95%20C3.35%2014.27%2C%202.24%2013.37%2C%201.48%2011.84%20C0.73%2010.32%2C%20-0.02%207.51%2C%200.22%205.82%20C0.47%204.13%2C%201.55%202.57%2C%202.96%201.7%20C4.38%200.84%2C%207.97%200.98%2C%208.71%200.63%20C9.45%200.29%2C%207.58%20-0.46%2C%207.39%20-0.38%22%20stroke%3D%22%23e03131%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Cg%20stroke-linecap%3D%22round%22%20transform%3D%22translate%28101.61680056077114%2061.41449067256306%29%20rotate%280%2011.364946874028647%2011.364946874028632%29%22%3E%3Cpath%20d%3D%22M13.84%200.27%20C16.19%200.73%2C%2019.04%202.64%2C%2020.54%204.57%20C22.05%206.5%2C%2022.98%209.38%2C%2022.87%2011.86%20C22.76%2014.34%2C%2021.54%2017.71%2C%2019.89%2019.43%20C18.25%2021.14%2C%2015.51%2021.89%2C%2013%2022.17%20C10.49%2022.45%2C%206.95%2022.3%2C%204.84%2021.11%20C2.74%2019.91%2C%201.04%2017.38%2C%200.37%2015.01%20C-0.31%2012.64%2C%20-0.18%209.14%2C%200.77%206.91%20C1.73%204.68%2C%203.83%202.76%2C%206.1%201.62%20C8.37%200.48%2C%2012.99%200.25%2C%2014.41%200.07%20C15.83%20-0.11%2C%2014.7%200.34%2C%2014.63%200.52%20M13.06%20-0.51%20C15.35%20-0.45%2C%2018.13%202.05%2C%2019.61%203.84%20C21.1%205.64%2C%2021.73%207.82%2C%2021.98%2010.28%20C22.23%2012.74%2C%2022.3%2016.53%2C%2021.09%2018.6%20C19.88%2020.67%2C%2017.26%2022.12%2C%2014.74%2022.71%20C12.21%2023.3%2C%208.17%2023.19%2C%205.95%2022.13%20C3.73%2021.07%2C%202.3%2018.62%2C%201.44%2016.35%20C0.57%2014.08%2C%200.07%2010.89%2C%200.74%208.51%20C1.41%206.12%2C%203.42%203.47%2C%205.46%202.03%20C7.49%200.59%2C%2011.65%200.09%2C%2012.95%20-0.13%20C14.26%20-0.35%2C%2013.38%200.4%2C%2013.3%200.73%22%20stroke%3D%22none%22%20stroke-width%3D%220%22%20fill%3D%22%23ffc9c9%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M9.66%200.47%20C11.81%20-0.18%2C%2014.67%20-0.1%2C%2016.76%201.16%20C18.86%202.41%2C%2021.38%205.58%2C%2022.24%208%20C23.1%2010.42%2C%2022.76%2013.48%2C%2021.94%2015.67%20C21.11%2017.86%2C%2019.46%2020.04%2C%2017.28%2021.14%20C15.1%2022.23%2C%2011.26%2022.61%2C%208.86%2022.23%20C6.46%2021.85%2C%204.34%2020.7%2C%202.88%2018.87%20C1.42%2017.04%2C%200.1%2013.74%2C%200.12%2011.23%20C0.14%208.72%2C%201.34%205.58%2C%203.01%203.8%20C4.68%202.02%2C%208.9%201.14%2C%2010.16%200.58%20C11.41%200.01%2C%2010.62%200.22%2C%2010.56%200.4%20M9.37%200.28%20C11.58%20-0.28%2C%2015.07%200.23%2C%2017.18%201.51%20C19.3%202.8%2C%2021.21%205.8%2C%2022.06%207.99%20C22.91%2010.17%2C%2023.16%2012.49%2C%2022.26%2014.6%20C21.37%2016.72%2C%2018.86%2019.44%2C%2016.69%2020.68%20C14.53%2021.91%2C%2011.51%2022.27%2C%209.28%2022.02%20C7.04%2021.77%2C%204.91%2020.99%2C%203.27%2019.18%20C1.64%2017.37%2C%20-0.33%2013.61%2C%20-0.55%2011.16%20C-0.76%208.71%2C%200.45%206.25%2C%201.97%204.46%20C3.5%202.67%2C%207.34%200.99%2C%208.6%200.41%20C9.86%20-0.17%2C%209.34%200.77%2C%209.53%200.99%22%20stroke%3D%22%23e03131%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Cg%20stroke-linecap%3D%22round%22%20transform%3D%22translate%28105.84864555120453%2089.22665611108903%29%20rotate%280%204.885304075052915%204.885304075052915%29%22%3E%3Cpath%20d%3D%22M4.96%20-0.28%20C5.98%20-0.3%2C%207.14%200.46%2C%207.95%201.15%20C8.76%201.84%2C%209.62%202.75%2C%209.82%203.85%20C10.03%204.96%2C%209.79%206.78%2C%209.17%207.77%20C8.55%208.76%2C%207.17%209.49%2C%206.11%209.77%20C5.05%2010.06%2C%203.69%209.87%2C%202.8%209.48%20C1.91%209.09%2C%201.21%208.33%2C%200.77%207.43%20C0.33%206.54%2C%20-0.01%205.16%2C%200.14%204.13%20C0.29%203.1%2C%200.81%201.94%2C%201.67%201.27%20C2.54%200.59%2C%204.72%200.3%2C%205.33%200.09%20C5.93%20-0.12%2C%205.37%200.02%2C%205.3%200.03%20M5.01%200.15%20C5.9%200.25%2C%207.16%201.08%2C%208.01%201.87%20C8.86%202.66%2C%2010.01%203.9%2C%2010.11%204.88%20C10.21%205.86%2C%209.25%207%2C%208.59%207.75%20C7.94%208.5%2C%207.21%209.08%2C%206.2%209.4%20C5.18%209.72%2C%203.55%2010.12%2C%202.52%209.67%20C1.48%209.22%2C%200.45%207.69%2C%200.01%206.72%20C-0.43%205.74%2C%20-0.47%204.8%2C%20-0.13%203.81%20C0.22%202.82%2C%201.24%201.38%2C%202.1%200.76%20C2.95%200.13%2C%204.48%200.19%2C%204.99%200.07%20C5.49%20-0.06%2C%205.06%20-0.12%2C%205.13%20-0.01%22%20stroke%3D%22none%22%20stroke-width%3D%220%22%20fill%3D%22%23ffc9c9%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M4.48%200.32%20C5.43%200.17%2C%207.08%200.28%2C%207.96%200.83%20C8.84%201.38%2C%209.6%202.49%2C%209.78%203.61%20C9.95%204.72%2C%209.52%206.58%2C%209%207.51%20C8.48%208.44%2C%207.57%208.85%2C%206.67%209.2%20C5.78%209.56%2C%204.65%209.91%2C%203.64%209.64%20C2.62%209.37%2C%201.2%208.51%2C%200.57%207.58%20C-0.05%206.64%2C%20-0.3%205.04%2C%20-0.11%204.01%20C0.09%202.99%2C%200.97%202.08%2C%201.75%201.44%20C2.53%200.81%2C%204.09%200.45%2C%204.58%200.2%20C5.07%20-0.06%2C%204.7%20-0.13%2C%204.71%20-0.09%20M5.26%20-0.34%20C6.25%20-0.25%2C%207.3%201.08%2C%208.08%201.83%20C8.86%202.57%2C%209.73%203.15%2C%209.93%204.14%20C10.13%205.13%2C%209.87%206.81%2C%209.31%207.77%20C8.74%208.72%2C%207.56%209.63%2C%206.54%209.86%20C5.53%2010.09%2C%204.29%209.58%2C%203.21%209.15%20C2.14%208.71%2C%200.62%208.19%2C%200.1%207.27%20C-0.42%206.35%2C%20-0.27%204.71%2C%200.09%203.62%20C0.45%202.53%2C%201.37%201.27%2C%202.24%200.74%20C3.11%200.22%2C%204.72%200.61%2C%205.3%200.49%20C5.87%200.37%2C%205.65%200.08%2C%205.69%200.03%22%20stroke%3D%22%23e03131%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Cg%20stroke-linecap%3D%22round%22%20transform%3D%22translate%28124.39765612237721%2090.82398804048364%29%20rotate%280%204.885304075052915%204.885304075052915%29%22%3E%3Cpath%20d%3D%22M5.02%200.14%20C6.05%200.08%2C%207.45%200.35%2C%208.2%201.01%20C8.94%201.67%2C%209.3%203.01%2C%209.48%204.11%20C9.67%205.2%2C%209.83%206.61%2C%209.29%207.56%20C8.76%208.52%2C%207.28%209.51%2C%206.28%209.84%20C5.27%2010.17%2C%204.25%209.97%2C%203.26%209.56%20C2.28%209.15%2C%200.97%208.35%2C%200.39%207.37%20C-0.19%206.39%2C%20-0.5%204.75%2C%20-0.21%203.67%20C0.08%202.59%2C%201.21%201.53%2C%202.14%200.89%20C3.06%200.26%2C%204.81%20-0.01%2C%205.35%20-0.14%20C5.89%20-0.28%2C%205.41%20-0.07%2C%205.39%200.08%20M4.81%200.18%20C5.77%200.12%2C%206.83%200.27%2C%207.71%200.89%20C8.58%201.5%2C%209.9%202.79%2C%2010.09%203.87%20C10.27%204.95%2C%209.36%206.48%2C%208.83%207.37%20C8.3%208.26%2C%207.8%208.83%2C%206.91%209.19%20C6.01%209.56%2C%204.47%209.89%2C%203.46%209.56%20C2.45%209.23%2C%201.4%208.05%2C%200.85%207.21%20C0.29%206.36%2C%20-0.08%205.43%2C%200.12%204.52%20C0.32%203.6%2C%201.22%202.43%2C%202.04%201.72%20C2.86%201%2C%204.54%200.55%2C%205.06%200.23%20C5.57%20-0.09%2C%205.22%20-0.24%2C%205.12%20-0.23%22%20stroke%3D%22%23e03131%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Cg%20stroke-linecap%3D%22round%22%20transform%3D%22translate%28224.5265845026703%2078.90040412884707%29%20rotate%280%207.959858655597571%207.959858655597571%29%22%3E%3Cpath%20d%3D%22M7.55%200.17%20C9.15%20-0.12%2C%2010.6%200.49%2C%2012.01%201.39%20C13.42%202.28%2C%2015.48%203.9%2C%2015.99%205.55%20C16.51%207.2%2C%2015.92%209.69%2C%2015.11%2011.29%20C14.3%2012.88%2C%2012.64%2014.38%2C%2011.13%2015.12%20C9.63%2015.87%2C%207.6%2016.19%2C%206.07%2015.76%20C4.55%2015.33%2C%203.01%2013.88%2C%201.98%2012.54%20C0.96%2011.2%2C%20-0.18%209.42%2C%20-0.08%207.73%20C0.02%206.04%2C%201.36%203.62%2C%202.59%202.4%20C3.83%201.19%2C%206.52%200.85%2C%207.33%200.44%20C8.14%200.03%2C%207.41%20-0.09%2C%207.45%20-0.07%20M8.71%200.38%20C10.35%200.63%2C%2013.36%201.66%2C%2014.45%202.89%20C15.53%204.13%2C%2015.18%206.19%2C%2015.23%207.79%20C15.27%209.39%2C%2015.75%2011.15%2C%2014.71%2012.48%20C13.67%2013.81%2C%2010.83%2015.39%2C%208.98%2015.76%20C7.12%2016.13%2C%204.97%2015.54%2C%203.58%2014.69%20C2.2%2013.84%2C%201.23%2012.29%2C%200.68%2010.66%20C0.13%209.03%2C%20-0.3%206.41%2C%200.27%204.9%20C0.83%203.38%2C%202.63%202.26%2C%204.07%201.58%20C5.51%200.89%2C%208.12%200.94%2C%208.91%200.79%20C9.71%200.63%2C%208.94%200.58%2C%208.86%200.64%22%20stroke%3D%22none%22%20stroke-width%3D%220%22%20fill%3D%22%23ffc9c9%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M8.07%20-0.15%20C9.62%20-0.26%2C%2011.67%201.07%2C%2012.95%202.13%20C14.23%203.19%2C%2015.33%204.62%2C%2015.75%206.2%20C16.17%207.77%2C%2016.19%209.99%2C%2015.46%2011.58%20C14.72%2013.17%2C%2012.93%2015.11%2C%2011.33%2015.76%20C9.73%2016.4%2C%207.49%2016.07%2C%205.85%2015.45%20C4.22%2014.83%2C%202.53%2013.49%2C%201.5%2012.03%20C0.48%2010.56%2C%20-0.47%208.3%2C%20-0.32%206.65%20C-0.16%205.01%2C%201.13%203.27%2C%202.44%202.16%20C3.75%201.04%2C%206.62%200.3%2C%207.54%20-0.04%20C8.46%20-0.38%2C%207.86%20-0.09%2C%207.94%200.11%20M8.02%200.74%20C9.77%200.52%2C%2011.75%201.06%2C%2012.94%202.06%20C14.13%203.07%2C%2014.79%205.27%2C%2015.17%206.79%20C15.55%208.31%2C%2016.01%209.7%2C%2015.22%2011.18%20C14.42%2012.65%2C%2011.92%2014.89%2C%2010.4%2015.64%20C8.87%2016.39%2C%207.56%2016.19%2C%206.06%2015.68%20C4.56%2015.18%2C%202.46%2014.18%2C%201.4%2012.62%20C0.33%2011.07%2C%20-0.59%208.19%2C%20-0.36%206.36%20C-0.12%204.52%2C%201.45%202.76%2C%202.82%201.6%20C4.19%200.45%2C%206.97%20-0.33%2C%207.88%20-0.58%20C8.79%20-0.82%2C%208.29%20-0.07%2C%208.27%200.13%22%20stroke%3D%22%23e03131%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Cg%20stroke-linecap%3D%22round%22%20transform%3D%22translate%28240.00840814525884%2061.144576685965575%29%20rotate%280%2011.364946874028647%2011.364946874028632%29%22%3E%3Cpath%20d%3D%22M11.72%200.07%20C14.03%200.02%2C%2017.81%201.27%2C%2019.61%202.96%20C21.41%204.66%2C%2022.38%207.78%2C%2022.53%2010.24%20C22.67%2012.69%2C%2021.8%2015.68%2C%2020.47%2017.69%20C19.15%2019.71%2C%2016.77%2021.68%2C%2014.56%2022.34%20C12.36%2023%2C%209.49%2022.59%2C%207.24%2021.65%20C4.99%2020.71%2C%202.17%2018.86%2C%201.08%2016.69%20C-0.01%2014.52%2C%200.1%2010.97%2C%200.7%208.62%20C1.31%206.27%2C%202.76%204.08%2C%204.71%202.61%20C6.65%201.14%2C%2011.01%200.23%2C%2012.35%20-0.21%20C13.7%20-0.64%2C%2012.74%20-0.27%2C%2012.77%200%20M10.18%200.3%20C12.41%20-0.24%2C%2014.53%200.51%2C%2016.61%201.67%20C18.7%202.84%2C%2021.89%204.98%2C%2022.69%207.29%20C23.49%209.6%2C%2022.49%2013.22%2C%2021.41%2015.52%20C20.34%2017.82%2C%2018.28%2019.97%2C%2016.25%2021.11%20C14.22%2022.24%2C%2011.57%2022.85%2C%209.24%2022.32%20C6.92%2021.8%2C%203.82%2019.75%2C%202.32%2017.95%20C0.82%2016.14%2C%200.19%2013.73%2C%200.24%2011.49%20C0.28%209.26%2C%201.06%206.36%2C%202.59%204.53%20C4.11%202.7%2C%208.31%201.17%2C%209.38%200.52%20C10.46%20-0.14%2C%208.91%200.54%2C%209.04%200.61%22%20stroke%3D%22none%22%20stroke-width%3D%220%22%20fill%3D%22%23ffc9c9%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M12.3%200.45%20C14.56%200.48%2C%2017.5%201.49%2C%2019.31%203.1%20C21.13%204.71%2C%2022.86%207.59%2C%2023.17%2010.1%20C23.48%2012.62%2C%2022.56%2016.16%2C%2021.17%2018.19%20C19.78%2020.21%2C%2017.18%2021.67%2C%2014.81%2022.24%20C12.45%2022.81%2C%209.33%2022.62%2C%206.98%2021.6%20C4.63%2020.58%2C%201.86%2018.27%2C%200.71%2016.12%20C-0.43%2013.96%2C%20-0.48%2011.02%2C%200.13%208.68%20C0.74%206.34%2C%202.27%203.52%2C%204.36%202.08%20C6.46%200.64%2C%2011.16%200.27%2C%2012.69%200.05%20C14.23%20-0.17%2C%2013.58%200.64%2C%2013.58%200.76%20M14.18%200.71%20C16.3%201.09%2C%2018.51%203.34%2C%2019.97%205.16%20C21.43%206.98%2C%2023.09%209.22%2C%2022.93%2011.62%20C22.77%2014.02%2C%2020.64%2017.68%2C%2019%2019.55%20C17.37%2021.41%2C%2015.43%2022.53%2C%2013.13%2022.81%20C10.83%2023.1%2C%207.4%2022.7%2C%205.21%2021.24%20C3.03%2019.77%2C%200.69%2016.5%2C%200.02%2014.02%20C-0.66%2011.53%2C%200.07%208.56%2C%201.17%206.32%20C2.26%204.08%2C%204.32%201.58%2C%206.57%200.58%20C8.82%20-0.42%2C%2013.43%200.33%2C%2014.68%200.3%20C15.94%200.27%2C%2014.29%200.3%2C%2014.11%200.39%22%20stroke%3D%22%23e03131%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Cg%20stroke-linecap%3D%22round%22%20transform%3D%22translate%28244.24025313569234%2088.9567421244916%29%20rotate%280%204.885304075052915%204.885304075052915%29%22%3E%3Cpath%20d%3D%22M5.35%20-0.12%20C6.37%20-0.13%2C%207.4%200.63%2C%208.09%201.36%20C8.78%202.09%2C%209.34%203.22%2C%209.5%204.25%20C9.65%205.28%2C%209.49%206.68%2C%209.02%207.55%20C8.54%208.41%2C%207.67%209.12%2C%206.66%209.46%20C5.65%209.8%2C%203.93%209.99%2C%202.96%209.6%20C1.98%209.21%2C%201.28%208.03%2C%200.81%207.12%20C0.34%206.2%2C%20-0.02%205.15%2C%200.16%204.11%20C0.34%203.06%2C%201.04%201.56%2C%201.91%200.85%20C2.78%200.13%2C%204.76%20-0.09%2C%205.37%20-0.18%20C5.98%20-0.28%2C%205.63%200.21%2C%205.57%200.28%20M4.74%200.01%20C5.74%20-0.06%2C%207.85%200.32%2C%208.62%201.04%20C9.4%201.76%2C%209.39%203.28%2C%209.39%204.34%20C9.38%205.41%2C%209.1%206.58%2C%208.59%207.43%20C8.08%208.28%2C%207.32%209.19%2C%206.35%209.45%20C5.39%209.72%2C%203.77%209.38%2C%202.82%209.03%20C1.87%208.68%2C%201.14%208.14%2C%200.66%207.34%20C0.19%206.53%2C%20-0.23%205.21%2C%20-0.04%204.19%20C0.15%203.17%2C%200.99%201.88%2C%201.79%201.21%20C2.59%200.54%2C%204.15%200.4%2C%204.75%200.19%20C5.35%20-0.03%2C%205.29%20-0.14%2C%205.39%20-0.09%22%20stroke%3D%22none%22%20stroke-width%3D%220%22%20fill%3D%22%23ffc9c9%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M4.63%20-0.09%20C5.67%20-0.27%2C%207.27%200.19%2C%208.15%200.88%20C9.04%201.57%2C%209.71%203.03%2C%209.93%204.06%20C10.16%205.08%2C%209.99%206.18%2C%209.5%207.06%20C9.01%207.93%2C%208.06%208.91%2C%207%209.31%20C5.95%209.71%2C%204.25%209.73%2C%203.19%209.45%20C2.13%209.18%2C%201.2%208.5%2C%200.63%207.64%20C0.06%206.77%2C%20-0.36%205.32%2C%20-0.22%204.26%20C-0.09%203.2%2C%200.59%201.95%2C%201.43%201.28%20C2.28%200.6%2C%204.28%200.47%2C%204.85%200.22%20C5.42%20-0.02%2C%204.81%20-0.29%2C%204.85%20-0.22%20M5.3%200.4%20C6.3%200.4%2C%208.06%200.59%2C%208.74%201.36%20C9.43%202.14%2C%209.35%203.92%2C%209.4%205.04%20C9.45%206.16%2C%209.61%207.26%2C%209.03%208.08%20C8.45%208.91%2C%207.04%209.86%2C%205.91%209.98%20C4.77%2010.1%2C%203.11%209.42%2C%202.2%208.8%20C1.29%208.19%2C%200.74%207.29%2C%200.44%206.31%20C0.15%205.32%2C%200.03%203.82%2C%200.42%202.88%20C0.81%201.94%2C%201.91%201.15%2C%202.79%200.66%20C3.68%200.17%2C%205.28%200.11%2C%205.73%20-0.04%20C6.19%20-0.19%2C%205.58%20-0.28%2C%205.52%20-0.24%22%20stroke%3D%22%23e03131%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Cg%20stroke-linecap%3D%22round%22%20transform%3D%22translate%28222.99720919507246%2089.65405267113067%29%20rotate%280%204.885304075052915%204.885304075052915%29%22%3E%3Cpath%20d%3D%22M4.67%20-0.17%20C5.76%20-0.26%2C%207.28%200.43%2C%208.08%201.09%20C8.88%201.74%2C%209.25%202.83%2C%209.46%203.77%20C9.68%204.71%2C%209.78%205.87%2C%209.34%206.74%20C8.9%207.62%2C%207.77%208.55%2C%206.82%209.03%20C5.87%209.51%2C%204.67%209.89%2C%203.65%209.64%20C2.64%209.38%2C%201.32%208.34%2C%200.73%207.51%20C0.14%206.68%2C%20-0.01%205.72%2C%200.12%204.65%20C0.26%203.59%2C%200.84%201.89%2C%201.54%201.13%20C2.25%200.37%2C%203.82%200.32%2C%204.37%200.11%20C4.92%20-0.11%2C%204.81%20-0.26%2C%204.84%20-0.18%20M4.19%200.33%20C5.11%200.2%2C%206.48%200.51%2C%207.46%201.06%20C8.44%201.61%2C%209.71%202.65%2C%2010.09%203.62%20C10.47%204.6%2C%2010.24%206.01%2C%209.72%206.91%20C9.2%207.81%2C%208%208.49%2C%206.97%209%20C5.95%209.51%2C%204.67%2010.13%2C%203.56%209.96%20C2.44%209.79%2C%200.96%208.89%2C%200.31%207.98%20C-0.34%207.07%2C%20-0.56%205.6%2C%20-0.34%204.5%20C-0.12%203.4%2C%200.77%202.07%2C%201.64%201.36%20C2.51%200.65%2C%204.43%200.52%2C%204.9%200.24%20C5.38%20-0.04%2C%204.54%20-0.31%2C%204.5%20-0.34%22%20stroke%3D%22none%22%20stroke-width%3D%220%22%20fill%3D%22%23ffc9c9%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M4.43%20-0.16%20C5.31%20-0.31%2C%206.27%200.39%2C%207.14%200.94%20C8.02%201.5%2C%209.36%202.16%2C%209.69%203.16%20C10.02%204.16%2C%209.57%205.99%2C%209.13%206.94%20C8.7%207.9%2C%207.97%208.45%2C%207.07%208.88%20C6.17%209.3%2C%204.71%209.65%2C%203.73%209.48%20C2.76%209.31%2C%201.8%208.62%2C%201.21%207.85%20C0.61%207.09%2C%200.09%205.93%2C%200.14%204.91%20C0.19%203.89%2C%200.88%202.55%2C%201.51%201.73%20C2.13%200.91%2C%203.37%200.24%2C%203.87%20-0.03%20C4.38%20-0.3%2C%204.51%20-0.02%2C%204.54%200.11%20M5.1%20-0.01%20C6.19%200.04%2C%207.79%200.81%2C%208.64%201.6%20C9.49%202.39%2C%2010.2%203.78%2C%2010.21%204.74%20C10.22%205.7%2C%209.38%206.55%2C%208.68%207.37%20C7.98%208.18%2C%206.92%209.24%2C%206%209.64%20C5.08%2010.04%2C%204.12%2010.19%2C%203.18%209.76%20C2.24%209.32%2C%200.86%208%2C%200.36%207.01%20C-0.14%206.02%2C%20-0.08%204.84%2C%200.18%203.83%20C0.44%202.81%2C%201.03%201.62%2C%201.93%200.91%20C2.83%200.21%2C%205.11%20-0.19%2C%205.59%20-0.4%20C6.06%20-0.62%2C%204.81%20-0.5%2C%204.79%20-0.37%22%20stroke%3D%22%23e03131%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3Cg%20stroke-linecap%3D%22round%22%3E%3Cg%20transform%3D%22translate%2824.880859374999943%2075.20703125%29%20rotate%2889.99999999999994%2051.552734375%200%29%22%3E%3Cpath%20d%3D%22M0%200%20C17.18%200%2C%2085.92%200%2C%20103.11%200%20M0%200%20C17.18%200%2C%2085.92%200%2C%20103.11%200%22%20stroke%3D%22%231e1e1e%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fg%3E%3Cmask%3E%3C%2Fmask%3E%3Cg%20stroke-linecap%3D%22round%22%3E%3Cg%20transform%3D%22translate%28226.29101562499994%2074.04296875%29%20rotate%2889.99999999999994%2051.552734375%200%29%22%3E%3Cpath%20d%3D%22M0%200%20C17.18%200%2C%2085.92%200%2C%20103.11%200%20M0%200%20C17.18%200%2C%2085.92%200%2C%20103.11%200%22%20stroke%3D%22%231e1e1e%22%20stroke-width%3D%222%22%20fill%3D%22none%22%3E%3C%2Fpath%3E%3C%2Fg%3E%3C%2Fg%3E%3Cmask%3E%3C%2Fmask%3E%3Cg%20transform%3D%22translate%28235.10546875%2012.6015625%29%20rotate%280%2014.419998168945312%2012.5%29%22%3E%3Ctext%20x%3D%220%22%20y%3D%220%22%20font-family%3D%22Virgil%2C%20Segoe%20UI%20Emoji%22%20font-size%3D%2220px%22%20fill%3D%22%231e1e1e%22%20text-anchor%3D%22start%22%20style%3D%22white-space%3A%20pre%3B%22%20direction%3D%22ltr%22%20dominant-baseline%3D%22text-before-edge%22%3Eq%2B1%3C%2Ftext%3E%3C%2Fg%3E%3Cg%20transform%3D%22translate%28172.9198455810547%2010%29%20rotate%280%205.459999084472656%2012.5%29%22%3E%3Ctext%20x%3D%220%22%20y%3D%220%22%20font-family%3D%22Virgil%2C%20Segoe%20UI%20Emoji%22%20font-size%3D%2220px%22%20fill%3D%22%231e1e1e%22%20text-anchor%3D%22start%22%20style%3D%22white-space%3A%20pre%3B%22%20direction%3D%22ltr%22%20dominant-baseline%3D%22text-before-edge%22%3Eq%3C%2Ftext%3E%3C%2Fg%3E%3Cg%20transform%3D%22translate%2894.01359558105469%2012.52734375%29%20rotate%280%2012.279991149902344%2012.5%29%22%3E%3Ctext%20x%3D%220%22%20y%3D%220%22%20font-family%3D%22Virgil%2C%20Segoe%20UI%20Emoji%22%20font-size%3D%2220px%22%20fill%3D%22%231e1e1e%22%20text-anchor%3D%22start%22%20style%3D%22white-space%3A%20pre%3B%22%20direction%3D%22ltr%22%20dominant-baseline%3D%22text-before-edge%22%3Eq-1%3C%2Ftext%3E%3C%2Fg%3E%3Cg%20transform%3D%22translate%28168.9609375%20109.04296875%29%20rotate%280%205.2299957275390625%2012.5%29%22%3E%3Ctext%20x%3D%220%22%20y%3D%220%22%20font-family%3D%22Virgil%2C%20Segoe%20UI%20Emoji%22%20font-size%3D%2220px%22%20fill%3D%22%232f9e44%22%20text-anchor%3D%22start%22%20style%3D%22white-space%3A%20pre%3B%22%20direction%3D%22ltr%22%20dominant-baseline%3D%22text-before-edge%22%3Ev%3C%2Ftext%3E%3C%2Fg%3E%3Cg%20transform%3D%22translate%28177.9765625%20116.24609375%29%20rotate%280%204.3679962158203125%2010%29%22%3E%3Ctext%20x%3D%220%22%20y%3D%220%22%20font-family%3D%22Virgil%2C%20Segoe%20UI%20Emoji%22%20font-size%3D%2216px%22%20fill%3D%22%232f9e44%22%20text-anchor%3D%22start%22%20style%3D%22white-space%3A%20pre%3B%22%20direction%3D%22ltr%22%20dominant-baseline%3D%22text-before-edge%22%3Eq%3C%2Ftext%3E%3C%2Fg%3E%3Cg%20transform%3D%22translate%28170.32421875%20130.92578125%29%20rotate%280%205.67999267578125%2012.5%29%22%3E%3Ctext%20x%3D%220%22%20y%3D%220%22%20font-family%3D%22Virgil%2C%20Segoe%20UI%20Emoji%22%20font-size%3D%2220px%22%20fill%3D%22%23e03131%22%20text-anchor%3D%22start%22%20style%3D%22white-space%3A%20pre%3B%22%20direction%3D%22ltr%22%20dominant-baseline%3D%22text-before-edge%22%3Eu%3C%2Ftext%3E%3C%2Fg%3E%3Cg%20transform%3D%22translate%28181.51171875%20137.34765625%29%20rotate%280%204.3679962158203125%2010%29%22%3E%3Ctext%20x%3D%220%22%20y%3D%220%22%20font-family%3D%22Virgil%2C%20Segoe%20UI%20Emoji%22%20font-size%3D%2216px%22%20fill%3D%22%23e03131%22%20text-anchor%3D%22start%22%20style%3D%22white-space%3A%20pre%3B%22%20direction%3D%22ltr%22%20dominant-baseline%3D%22text-before-edge%22%3Eq%3C%2Ftext%3E%3C%2Fg%3E%3C%2Fsvg%3E%3C%2Fdiv%3E`}</WLJSHTML>\\n\\n\\nOne can consider interpolating the velocity at borders and then move the mass between them. We can write it as follows:\\n\\n$$\\n\\\\frac{u_{q}^{t} - u_{q}^{t-1}}{\\\\delta t} = - \\\\frac{v_{q} + v_{q+1}}{2} \\\\frac{u_{q} + u_{q+1}}{2} + \\\\frac{v_{q} + v_{q-1}}{2} \\\\frac{u_{q}^{t-1} + u_{q-1}^{t-1}}{2}  \\n$$\\n\\n<WLJSHTML>{`%3Cspan%20style%3D%22color%3Ared%22%3EWarning%3A%20this%20is%20wrong%3C%2Fspan%3E`}</WLJSHTML>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"9a6b6264-a049-4748-a649-dc5144bb9270\\"} type={\\"Input\\"} opts={{\\"Fade\\":true}} >{`advect%5Bv_%2C%20u_%2C%20%CE%B4t_%3A0.1%5D%20%3A%3D%20With%5B%7Bmax%20%3D%20Length%5Bv%5D%7D%2C%20With%5B%7B%0A%20%20take%20%3D%20Function%5B%7Barray%2C%20x%2Cy%7D%2C%20If%5Bx%20%3E%3D%201%20%26%26%20x%20%3C%3D%20max%20%26%26%20y%20%3E%3D%201%20%26%26%20y%20%3C%3D%20max%2C%20array%5B%5Bx%2Cy%5D%5D%2C%20array%5B%5B1%2C1%5D%5D%200.%5D%5D%0A%7D%2C%0A%20%20Table%5B%20%0A%20%20%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20v2%20%3D%20%20%28%2AFB%5B%2A%29%28%28take%5Bv%2C%20i%2C%20j%2B1%5D%20%2B%20take%5Bv%2C%20i%2C%20j%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C-1%7D%2C%0A%20%20%20%20%20%20v4%20%3D%20%20%28%2AFB%5B%2A%29%28%28take%5Bv%2C%20i%2C%20j-1%5D%20%2B%20take%5Bv%2C%20i%2C%20j%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C1%7D%2C%0A%20%20%20%20%20%20org%20%3D%20u%5B%5Bi%2Cj%5D%5D%0A%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20org%20%2B%20%28%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20v4%20%20%28%2AFB%5B%2A%29%28%28take%5Bu%2C%20i%2C%20j-1%5D%20%2B%20org%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29%20%2B%20v2%20%20%28%2AFB%5B%2A%29%28%28take%5Bu%2C%20i%2C%20j%2B1%5D%20%2B%20org%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%20%CE%B4t%0A%20%20%20%20%5D%0A%20%20%20%20%0A%20%20%2C%20%7Bi%2C%20max%7D%2C%20%7Bj%2C%20max%7D%5D%20%2F%2F%20Chop%0A%20%5D%5D`}</WLJSEditor>\\n\\nNow if we test it on our `u` field\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"853b1af3-6052-4ee6-a20e-c2a950b49bd7\\"} type={\\"Input\\"} opts={{}} >{`arrow%20%3D%20Graphics%5BArrow%5B%7B%7B0%2C0%7D%2C%20%7B1%2C0%7D%7D%5D%2C%20ImagePadding-%3ENone%2C%20ImageSize-%3E30%5D%3B%0A%0ATable%5BMatrixPlot%5BNest%5Badvect%5Bgrid%2C%20%23%5D%26%2C%20u%2C%20n%5D%2C%20ImageSize-%3E150%5D%2C%20%7Bn%2C%20%7B0%2C%201%2C%20100%7D%7D%5D%3B%0ARiffle%5B%25%2C%20arrow%5D%20%2F%2F%20Row%20`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"3e30781a-26ec-4575-8cd4-fb06b06f4472\\"} type={\\"Output\\"} opts={{}} >{`%28%2AGB%5B%2A%29%7B%7B%28%2AVB%5B%2A%29%28FrontEndRef%5B%22e1451c50-456f-4076-9ed4-1aeca5bf0e88%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKpxqamBommxrompiapemaGJib6VqmppjoGiamJieaJqUZpFpYAAB7ihWk%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28Graphics%5BArrow%5B%7B%7B0%2C%200%7D%2C%20%7B1%2C%200%7D%7D%5D%2C%20ImagePadding%20-%3E%20None%2C%20ImageSize%20-%3E%2030%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KWnMIB4HkHAvSizIyEwuhsizAgnHoqL88jQmmHKfzOISVF4mkGYAE2jijJjiQaU5qcU8QIZnbmJ6akBiSkpmXjpYxi8%2FLxVNHSdMXXBmVWqmHJAHALiLJE4%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28FrontEndRef%5B%22b238a126-d81c-40fe-8c34-f1d04780de66%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKJxkZWyQaGpnpplgYJuuaGKSl6lokG5vophmmGJiYWxikpJqZAQCAdxVw%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28Graphics%5BArrow%5B%7B%7B0%2C%200%7D%2C%20%7B1%2C%200%7D%7D%5D%2C%20ImagePadding%20-%3E%20None%2C%20ImageSize%20-%3E%2030%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KWnMIB4HkHAvSizIyEwuhsizAgnHoqL88jQmmHKfzOISVF4mkGYAE2jijJjiQaU5qcU8QIZnbmJ6akBiSkpmXjpYxi8%2FLxVNHSdMXXBmVWqmHJAHALiLJE4%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28FrontEndRef%5B%229b540d0e-6b20-4b41-91d4-cb4acf1fb194%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKWyaZmhikGKTqmiUZGeiaJJkY6loappjoJieZJCanGaYlGVqaAACB3RXB%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29`}</WLJSEditor>\\n\\nAfter 100 iterations, the space in the middle becomes negative. In our code\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"705aac04-68f0-4322-8736-98dd77b5d1e0\\"} type={\\"Input\\"} opts={{}} >{`v4%20%20%28%2AFB%5B%2A%29%28%28take%5Bu%2C%20i%2C%20j-1%5D%20%2B%20org%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29%20%2B%20v2%20%20%28%2AFB%5B%2A%29%28%28take%5Bu%2C%20i%2C%20j%2B1%5D%20%2B%20org%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29`}</WLJSEditor>\\n\\nIf `org` (which stands for the current cell) equals `0`, it still does not mean that it cannot be reduced even more if we have a velocity vector to the nearest cell.\\n\\n### Donor-cell advection\\n\\nThe way to fix it is to use the *Donor-cell* method described well in Heidelberg University\'s [lecture](https://www.ita.uni-heidelberg.de/~dullemond/lectures/num_fluid_2009/Chapter_4.pdf) on numerical fluid dynamics. There we again consider velocities at borders, but based on the relative sign (outtake or intake) we decide which cell is going to be a donor.\\n\\n$$\\nv_{q+1/2} = \\\\frac{v_{q} + v_{q+1}}{2} \\\\\\\\\\nv_{q-1/2} = \\\\frac{v_{q} + v_{q-1}}{2}\\n$$\\n\\nUsing these notations one can write the __donor-cell__ method as follows:\\n\\n$$\\n\\\\frac{u_{q}^{t} - u_{q}^{t-1}}{\\\\delta t} = - v_{q+1/2}\\\\begin{cases}\\n   u_{q}^{t-1} ,& v_{q+1/2} > 0 \\\\\\\\\\n   u_{q+1}^{t-1} &\\n\\\\end{cases} + v_{q-1/2}\\\\begin{cases}\\n   u_{q-1}^{t-1} ,& v_{q-1/2} > 0 \\\\\\\\\\n   u_{q}^{t-1} &\\n\\\\end{cases}\\n$$\\n\\n<WLJSHTML>{`%3Cspan%20style%3D%22color%3Agreen%22%3EWarning%3A%20this%20is%20correct%3C%2Fspan%3E`}</WLJSHTML>\\n\\nAdding the projections from other sides, our final function will be\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"b7ae7fc2-5348-4d80-8294-98b564a72445\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true,\\"Fade\\":true}} >{`advect%5Bv_%2C%20u_%2C%20%CE%B4t_%3A0.1%5D%20%3A%3D%20With%5B%7Bmax%20%3D%20Length%5Bv%5D%7D%2C%20With%5B%7B%0A%20%20take%20%3D%20Function%5B%7Barray%2C%20x%2Cy%7D%2C%20If%5Bx%20%3E%3D%201%20%26%26%20x%20%3C%3D%20max%20%26%26%20y%20%3E%3D%201%20%26%26%20y%20%3C%3D%20max%2C%20array%5B%5Bx%2Cy%5D%5D%2C%20array%5B%5B1%2C1%5D%5D%200.%5D%5D%0A%7D%2C%0A%20%20Table%5B%20%0A%20%20%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20v1%20%3D%20%20%28%2AFB%5B%2A%29%28%28take%5Bv%2C%20i-1%2C%20j%5D%20%2B%20take%5Bv%2C%20i%2C%20j%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B1%2C0%7D%2C%0A%20%20%20%20%20%20v2%20%3D%20%20%28%2AFB%5B%2A%29%28%28take%5Bv%2C%20i%2C%20j%2B1%5D%20%2B%20take%5Bv%2C%20i%2C%20j%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C-1%7D%2C%0A%20%20%20%20%20%20v3%20%3D%20%20%28%2AFB%5B%2A%29%28%28take%5Bv%2C%20i%2B1%2C%20j%5D%20%2B%20take%5Bv%2C%20i%2C%20j%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B-1%2C0%7D%2C%0A%20%20%20%20%20%20v4%20%3D%20%20%28%2AFB%5B%2A%29%28%28take%5Bv%2C%20i%2C%20j-1%5D%20%2B%20take%5Bv%2C%20i%2C%20j%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C1%7D%2C%0A%20%20%20%20%20%20org%20%3D%20u%5B%5Bi%2Cj%5D%5D%0A%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20org%20%2B%20%28%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20v1%20%28%2ATB%5B%2A%29Piecewise%5B%7B%7B%28%2A%7C%2A%29take%5Bu%2C%20i-1%2C%20j%5D%28%2A%7C%2A%29%2C%28%2A%7C%2A%29v1%20%3E%200%28%2A%7C%2A%29%7D%2C%7B%28%2A%7C%2A%29org%28%2A%7C%2A%29%2C%28%2A%7C%2A%29True%28%2A%7C%2A%29%7D%7D%5D%28%2A%7C%2A%29%28%2A1%3AeJxTTMoPSmNkYGAo5gESAZmpyanlmcWpTvkVmUxAAQBzVQdd%2A%29%28%2A%5DTB%2A%29%20%2B%20v3%20%28%2ATB%5B%2A%29Piecewise%5B%7B%7B%28%2A%7C%2A%29take%5Bu%2C%20i%2B1%2C%20j%5D%28%2A%7C%2A%29%2C%28%2A%7C%2A%29v3%20%3E%200%28%2A%7C%2A%29%7D%2C%7B%28%2A%7C%2A%29org%28%2A%7C%2A%29%2C%28%2A%7C%2A%29True%28%2A%7C%2A%29%7D%7D%5D%28%2A%7C%2A%29%28%2A1%3AeJxTTMoPSmNkYGAo5gESAZmpyanlmcWpTvkVmUxAAQBzVQdd%2A%29%28%2A%5DTB%2A%29%20%20%2B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20v4%20%28%2ATB%5B%2A%29Piecewise%5B%7B%7B%28%2A%7C%2A%29take%5Bu%2C%20i%2C%20j-1%5D%28%2A%7C%2A%29%2C%28%2A%7C%2A%29v4%20%3E%200%28%2A%7C%2A%29%7D%2C%7B%28%2A%7C%2A%29org%28%2A%7C%2A%29%2C%28%2A%7C%2A%29True%28%2A%7C%2A%29%7D%7D%5D%28%2A%7C%2A%29%28%2A1%3AeJxTTMoPSmNkYGAo5gESAZmpyanlmcWpTvkVmUxAAQBzVQdd%2A%29%28%2A%5DTB%2A%29%20%2B%20v2%20%28%2ATB%5B%2A%29Piecewise%5B%7B%7B%28%2A%7C%2A%29take%5Bu%2C%20i%2C%20j%2B1%5D%28%2A%7C%2A%29%2C%28%2A%7C%2A%29v2%20%3E%200%28%2A%7C%2A%29%7D%2C%7B%28%2A%7C%2A%29org%28%2A%7C%2A%29%2C%28%2A%7C%2A%29True%28%2A%7C%2A%29%7D%7D%5D%28%2A%7C%2A%29%28%2A1%3AeJxTTMoPSmNkYGAo5gESAZmpyanlmcWpTvkVmUxAAQBzVQdd%2A%29%28%2A%5DTB%2A%29%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%20%CE%B4t%0A%20%20%20%20%5D%0A%20%20%20%20%0A%20%20%2C%20%7Bi%2C%20max%7D%2C%20%7Bj%2C%20max%7D%5D%20%2F%2F%20Chop%0A%20%5D%5D`}</WLJSEditor>\\n\\nNow if we run the same test, the result should be correct\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"4d103ec1-c5a1-401d-b6b6-fa90cf4cfbcf\\"} type={\\"Input\\"} opts={{}} >{`arrow%20%3D%20Graphics%5BArrow%5B%7B%7B0%2C0%7D%2C%20%7B1%2C0%7D%7D%5D%2C%20ImagePadding-%3ENone%2C%20ImageSize-%3E30%5D%3B%0A%0ATable%5BMatrixPlot%5BNest%5Badvect%5Bgrid%2C%20%23%5D%26%2C%20u%2C%20n%5D%2C%20ImageSize-%3E150%5D%2C%20%7Bn%2C%20%7B0%2C%201%2C%20100%7D%7D%5D%3B%0ARiffle%5B%25%2C%20arrow%5D%20%2F%2F%20Row%20`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"dfc29d73-9162-4a75-a34a-cd5f3ed89c21\\"} type={\\"Output\\"} opts={{}} >{`%28%2AGB%5B%2A%29%7B%7B%28%2AVB%5B%2A%29%28FrontEndRef%5B%22e8fdf197-1b9a-4d20-bb58-7d80a23f0253%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKp1qkpaQZWprrGiZZJuqapBgZ6CYlmVromqdYGCQaGacZGJkaAwCNkhWi%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28Graphics%5BArrow%5B%7B%7B0%2C%200%7D%2C%20%7B1%2C%200%7D%7D%5D%2C%20ImagePadding%20-%3E%20None%2C%20ImageSize%20-%3E%2030%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KWnMIB4HkHAvSizIyEwuhsizAgnHoqL88jQmmHKfzOISVF4mkGYAE2jijJjiQaU5qcU8QIZnbmJ6akBiSkpmXjpYxi8%2FLxVNHSdMXXBmVWqmHJAHALiLJE4%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28FrontEndRef%5B%22f41c04c8-2eef-469c-bf5d-4f8fe8dd9191%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKp5kYJhuYJFvoGqWmpumamFkm6yalmabomqRZpKVapKRYGloaAgCQbhZK%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28Graphics%5BArrow%5B%7B%7B0%2C%200%7D%2C%20%7B1%2C%200%7D%7D%5D%2C%20ImagePadding%20-%3E%20None%2C%20ImageSize%20-%3E%2030%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KWnMIB4HkHAvSizIyEwuhsizAgnHoqL88jQmmHKfzOISVF4mkGYAE2jijJjiQaU5qcU8QIZnbmJ6akBiSkpmXjpYxi8%2FLxVNHSdMXXBmVWqmHJAHALiLJE4%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28FrontEndRef%5B%22086251cd-1038-4ff8-989d-cbc828c24c25%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG1iYGZkaJqfoGhoYW%2BiapKVZ6FpaWKboJiclWxhZJBuZJBuZAgB5KRVP%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29`}</WLJSEditor>\\n\\nWe can check it numerically as well\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"b238e764-e482-46d8-ab01-3d18fc086995\\"} type={\\"Input\\"} opts={{}} >{`Nest%5Badvect%5Bgrid%2C%20%23%5D%26%2C%20u%2C%20100%5D%20%2F%2F%20Chop%20%2F%2F%20MatrixForm%20`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"ca607c0c-9569-4772-90c2-a134e2fc6722\\"} type={\\"Output\\"} opts={{}} >{`%28%28%2AGB%5B%2A%29%7B%7B1.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B1.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B1.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%290.005920529220334025%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%290.0370812093273552%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%292.9569982614523105%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B1.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B1.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%28%2A%7C%2A%29%2C%28%2A%7C%2A%291.%60%7D%7D%28%2A%5DGB%2A%29%29`}</WLJSEditor>\\n\\nor in a more creative way\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"bada543f-214a-494c-aeea-85340291005a\\"} type={\\"Input\\"} opts={{}} >{`Map%5BFunction%5Bcell%2C%20RGBColor%5BTanh%5Bcell%5D%2C%200%2C-Tanh%5Bcell%5D%5D%5D%2C%20Nest%5Badvect%5Bgrid%2C%20%23%5D%26%2C%20u%2C%20100%5D%2C%20%7B2%7D%5D%3B%0A%25%20%2F%2F%20MatrixForm`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"561cc248-f763-40b0-8125-215303d6d7c6\\"} type={\\"Output\\"} opts={{}} >{`%28%28%2AGB%5B%2A%29%7B%7B%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.005920460044525685%2C%200%2C%20-0.005920460044525685%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRedvOydwutQYV%2FEAAUwkf0AVBEZTA%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.037064222916834776%2C%200%2C%20-0.037064222916834776%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRc5i%2FZ%2FEvm1yL6IAQpgIvsBV8caPg%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.9946118170687553%2C%200%2C%20-0.9946118170687553%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRelXgjQvHP5vX0RAxTARPYDAG2TG8Q%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.7615941559557649%2C%200%2C%20-0.7615941559557649%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdN%2BSyy9VfcC%2FsiBiiAiewHAHfzHEw%3D%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29%29`}</WLJSEditor>\\n\\nNow we are ready to apply this knowledge to our fluid simulation. But how?\\n\\n#### Advection differential equation\\nI would like to draw your attention to the differential equation of advection\\n\\n$$\\n\\\\frac{\\\\partial u}{\\\\partial t} + (\\\\mathbf{v} \\\\cdot \\\\nabla) u = 0\\n$$\\n\\nIf one tries to descritize it on 1D grid\\n\\n$$\\nu^{t+1}_{q} - u^{t}_{q} + \\\\frac{\\\\delta t}{\\\\delta q} (f^{t}_{q + 1/2}  - f^{t}_{q - 1/2}) = 0~,\\n$$\\n\\nwhere $f_{q \\\\pm 1/2}$ we define flux at the interface of $q$ th cell. The exact form if a flux is given by the algorythm used. For above-mentioned __donor-cell__ we find\\n\\n$$\\nf_{q\\\\pm 1/2}^{t} = v_{q\\\\pm 1/2} \\\\begin{cases}\\n   u_{q}^{t} ,& v_{q\\\\pm 1/2} > 0 \\\\\\\\\\n   u_{q \\\\pm 1}^{t} &\\n\\\\end{cases}\\n$$\\n\\nAfter substituting it back, one finds, that it matches our previous equation we found for a problem of moving \\"mass\\" on a grid. ==We solved this exact differnetial advection equation while implementing `advect` function.==\\n\\n### Fluid Momentum\\nNewton\'s second law in the Navier-Stokes equation is defined by the following term.\\n\\n$$\\n\\\\frac{\\\\partial \\\\mathbf{v}}{\\\\partial t} + (\\\\mathbf{v} \\\\cdot \\\\nabla) \\\\mathbf{v} + ... = 0\\n$$\\n\\nDoes it remind you anything?.. The conservation of momentum of our fluid is actual __self advection__.\\n\\n> To simulate fluid momentum, the flow field can simply flow itself. Flow vectors are updated by reading interpolated values from upstream grid cells in the same way the tracer image is advected above. New vector values are pulled from the negative direction of flow.\\n\\nTo test it, one can construct the same sandbox used in *Part 1*, but change the update loop slightly.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"f5bc4328-ed14-48e3-a545-6cf0438b2dae\\"} type={\\"Input\\"} opts={{}} >{`vgrid%20%3D%20Table%5B%7B0.%2C0.%7D%2C%20%7Bi%2C15%7D%2C%20%7Bj%2C15%7D%5D%3B%0Avcolors%20%3D%20Table%5B1.0%2C%20%7BLength%5Bvgrid%5D%7D%2C%20%7BLength%5Bvgrid%5D%7D%5D%3B%0Avfps%20%3D%200%3B%0A`}</WLJSEditor>\\n\\nadd mouse handler\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"42ce8215-2ef7-4376-b2fd-0c5efe561c89\\"} type={\\"Input\\"} opts={{}} >{`mouseHandler%5Bbgrid_%2C%20win_%2C%20canvas_%5D%20%3D%20Module%5B%7B%0A%20%20arrow%20%3D%20False%2C%0A%20%20dest%20%3D%20%7B0%2C0%7D%2C%0A%20%20start%20%3D%20%7B0%2C0%7D%0A%7D%2C%20%7B%0A%20%20%20%20%20%20%22mouseup%22%20-%3E%20Function%5Bxy%2C%0A%20%20%20%20%20%20%20%20With%5B%7Bv%20%3D%20-Normalize%5Bstart%20-%20xy%5D%7D%2C%0A%20%20%20%20%20%20%20%20%20%20Do%5B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20With%5B%7Bp%20%3D%20Clip%5B%23%2C%20%7B1%2C15%7D%5D%20%26%2F%40%20Round%20%2F%40%20%28%28xy%20-%20start%29%20a%20%2B%20start%29%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20bgrid%5B%5Bp%5B%5B1%5D%5D%2Cp%5B%5B2%5D%5D%5D%5D%20%3D%20%7Bv%5B%5B1%5D%5D%2C%20v%5B%5B2%5D%5D%7D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%2C%20%7Ba%2C%200%2C%201%2C0.1%7D%5D%3B%20%28%2A%20a%20very%20stipid%20way%20of%20drawing%20lines%20%2A%29%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%5D%3B%0A%0A%20%20%20%20%20%20%20%20Delete%5Barrow%5D%3B%20%0A%20%20%20%20%20%20%20%20arrow%20%3D%20False%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%5D%2C%0A%0A%20%20%20%20%20%20%22mousemove%22%20-%3E%20Function%5Bxy%2C%0A%20%20%20%20%20%20%20%20dest%20%3D%20xy%3B%0A%20%20%20%20%20%20%5D%2C%0A%20%20%20%20%0A%20%20%20%20%20%20%22mousedown%22%20-%3E%20Function%5Bxy%2C%0A%20%20%20%20%20%20%20%20start%20%3D%20xy%3B%0A%20%20%20%20%20%20%20%20dest%20%3D%20xy%20%2B%20%7B1%2C1%7D%3B%20%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20If%5Barrow%20%3D%21%3D%20False%2C%20Delete%5Barrow%5D%5D%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20arrow%20%3D%20FrontSubmit%5B%7B%0A%20%20%20%20%20%20%20%20%20%20AbsoluteThickness%5B3%5D%2C%20Gray%2C%20%0A%20%20%20%20%20%20%20%20%20%20Arrow%5B%7Bxy%2C%20dest%20%2F%2F%20Offload%7D%5D%0A%20%20%20%20%20%20%20%20%7D%2C%20%0A%20%20%20%20%20%20%20%20%20%20canvas%2C%20%0A%20%20%20%20%20%20%20%20%20%20%22Window%22-%3Ewin%2C%20%0A%20%20%20%20%20%20%20%20%20%20%22Tracking%22-%3ETrue%20%0A%20%20%20%20%20%20%20%20%5D%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%5D%0A%20%20%7D%5D%3B%0A%0ASetAttributes%5BmouseHandler%2C%20HoldFirst%5D`}</WLJSEditor>\\n\\nSubscribe for events\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"8ce88c58-4077-41f8-b510-6b255e24b7f4\\"} type={\\"Input\\"} opts={{}} >{`vtime%20%3D%20AbsoluteTime%5B%5D%3B%0A%0AEventHandler%5B%22vframe%22%2C%20Function%5BNull%2C%0A%20%20vgrid%20%3D%20advect%5Bvgrid%2C%20vgrid%5D%20%2F%2F%20N%3B%20%0A%20%20vcolors%20%3D%20Map%5BFunction%5Bval%2C%20%28%2AFB%5B%2A%29%28%28%CF%80%20%2B%202.0%20ToPolarCoordinates%5Bval%5D%2F%2F%20Last%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%283.0%20%CF%80%29%29%28%2A%5DFB%2A%29%20%5D%2C%20vgrid%2C%20%7B2%7D%5D%3B%0A%20%20%0A%20%20vfps%20%3D%20%28%2AFB%5B%2A%29%28%28%28vfps%20%2B%201%20%2F%20%28AbsoluteTime%5B%5D%20-%20vtime%29%29%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29%20%2F%2F%20Round%3B%0A%20%20vtime%20%3D%20AbsoluteTime%5B%5D%3B%20%0A%5D%5D%3B`}</WLJSEditor>\\n\\nAssemble the widget\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"1fea2dd4-8fa5-4606-b6ed-4b23afe8279b\\"} type={\\"Input\\"} opts={{}} >{`With%5B%7B%0A%20%20win%20%3D%20CurrentWindow%5B%5D%2C%20%0A%20%20currentCell%20%3D%20ResultCell%5B%5D%2C%0A%20%20canvas%20%3D%20CreateUUID%5B%5D%0A%7D%2C%0A%0A%20%20EventHandler%5Bwin%2C%20%7B%22Closed%22%20-%3E%20Function%5BNull%2C%0A%20%20%20%20Delete%5BcurrentCell%5D%20%0A%20%20%5D%7D%5D%3B%0A%0A%20%20Graphics%5B%7B%0A%20%20%20%20Table%5BWith%5B%7Bi%3Di%2C%20j%3Dj%7D%2C%20%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20Offload%5B%7B%20%0A%20%20%20%20%20%20%20%20Hue%5Bvcolors%5B%5Bi%5D%5D%5B%5Bj%5D%5D%5D%2C%0A%20%20%20%20%20%20%20%20Arrow%5B%7B%7Bi%2Cj%7D%2C%20%7Bi%2Cj%7D%20%2B%20%20vgrid%5B%5Bi%5D%5D%5B%5Bj%5D%5D%7D%5D%0A%20%20%20%20%20%20%7D%5D%20%0A%20%20%20%20%0A%20%20%20%20%5D%2C%20%7Bi%2C15%7D%2C%20%7Bj%2C15%7D%5D%2C%0A%0A%20%20%20%0A%20%20%20%20EventHandler%5BGraphics%60Canvas%5B%5D%2C%20mouseHandler%5Bvgrid%2C%20win%2C%20MetaMarker%5Bcanvas%5D%5D%5D%2C%20%0A%0A%20%20%20%20AnimationFrameListener%5Bvfps%20%2F%2F%20Offload%2C%20%22Event%22-%3E%22vframe%22%5D%2C%20%0A%20%20%20%20%0A%20%20%20%20MetaMarker%5Bcanvas%5D%2C%20%0A%20%20%20%20Text%5Bvfps%20%2F%2F%20Offload%2C%20%7B0%2C0%7D%5D%0A%20%20%7D%2C%20%0A%20%20%20%20Controls-%3EFalse%2C%20%0A%20%20%20%20ImageSize-%3E500%2C%20%0A%20%20%20%20PlotRange-%3E%7B%7B-0.5%2C15.5%7D%2C%20%7B-0.5%2C15.5%7D%7D%2C%20%0A%20%20%20%20ImagePadding-%3ENone%2C%20%0A%20%20%20%20TransitionType-%3ENone%0A%20%20%5D%0A%5D`}</WLJSEditor>\\n\\nIn the end it should be similar to what is shown on the animation\\n\\n\\n![](attachments/momentum-ezgif.com-speed.webp)\\n\\n## Test particles\\nIn order to better visualize the fluid, we need something to be moved by our stream. The simplest solution is to spread hundreds of tracer particles. The velocity field can push them in the direction interpolated bilinearly from the grid.\\n\\n### Bilinear interpolation\\nThis is the most basic thing to implement. This probably is not the fastest version, but good enough for educational purposes.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"cd79795a-7b00-4737-9eb6-03ce468ce3fe\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true,\\"Fade\\":true}} >{`bilinearInterpolation%5Barray_%2C%20%7Bx0_%2C%20y0_%7D%5D%20%3A%3D%20Module%5B%0A%20%20%7Brows%2C%20cols%2C%20x%20%3D%20y0%2C%20y%20%3D%20x0%2C%20x1%2C%20x2%2C%20y1%2C%20y2%2C%20fQ11%2C%20fQ12%2C%20fQ21%2C%20fQ22%7D%2C%0A%20%20%0A%20%20%28%2A%20Get%20the%20dimensions%20of%20the%20array%20%2A%29%0A%20%20%7Brows%2C%20cols%7D%20%3D%20Take%5BDimensions%5Barray%5D%2C%202%5D%3B%0A%20%20%0A%20%20%28%2A%20Clip%20points%20to%20the%20boundaries%20%2A%29%0A%20%20x%20%3D%20Clip%5Bx%2C%20%7B1%2C%20cols%7D%5D%3B%0A%20%20y%20%3D%20Clip%5By%2C%20%7B1%2C%20rows%7D%5D%3B%0A%20%20%0A%20%20%28%2A%20Find%20the%20bounding%20indices%20%2A%29%0A%20%20x1%20%3D%20Floor%5Bx%5D%3B%20%0A%20%20x2%20%3D%20Ceiling%5Bx%5D%3B%0A%20%20y1%20%3D%20Floor%5By%5D%3B%20%0A%20%20y2%20%3D%20Ceiling%5By%5D%3B%0A%20%20%0A%20%20%28%2A%20Get%20the%20values%20at%20the%20four%20corners%20%2A%29%0A%20%20fQ11%20%3D%20array%5B%5By1%2C%20x1%5D%5D%3B%0A%20%20fQ12%20%3D%20array%5B%5By2%2C%20x1%5D%5D%3B%0A%20%20fQ21%20%3D%20array%5B%5By1%2C%20x2%5D%5D%3B%0A%20%20fQ22%20%3D%20array%5B%5By2%2C%20x2%5D%5D%3B%0A%20%20%0A%20%20%28%2A%20Perform%20bilinear%20interpolation%20%2A%29%0A%20%20If%5Bx2%20%3D%3D%20x1%2C%0A%20%20%20%20If%5By2%20%3D%3D%20y1%2C%0A%20%20%20%20%20%20fQ11%2C%0A%20%20%20%20%20%201%2F%282%20%28y2%20-%20y1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28y%20-%20y1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28y%20-%20y1%29%0A%20%20%20%20%20%20%29%0A%20%20%20%20%5D%2C%0A%20%20%20%20If%5By2%20%3D%3D%20y1%2C%0A%20%20%20%20%20%201%2F%282%20%28x2%20-%20x1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28x2%20-%20x%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28x%20-%20x1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28x2%20-%20x%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28x%20-%20x1%29%0A%20%20%20%20%20%20%29%2C%0A%20%20%20%20%20%201%2F%28%28x2%20-%20x1%29%20%28y2%20-%20y1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28x2%20-%20x%29%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28x%20-%20x1%29%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28x2%20-%20x%29%20%28y%20-%20y1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28x%20-%20x1%29%20%28y%20-%20y1%29%0A%20%20%20%20%20%20%29%0A%20%20%20%20%5D%0A%20%20%5D%0A%5D`}</WLJSEditor>\\n\\nOne can check if it works correctly by scaling up some raster images\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"e5035e3b-0e46-4a38-becf-47d581c9bfd7\\"} type={\\"Input\\"} opts={{}} >{`bmp%20%3D%20Table%5B%7B%28%2ASpB%5B%2A%29Power%5BCos%5By%5D%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%28%2ASpB%5B%2A%29Power%5BSin%5Bx%5D%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%200.5%7D%20%2F%2F%20N%2C%20%7Bx%2C%200%2C%20Pi%2C%20Pi%2F5%7D%2C%20%7By%2C%200%2C%20Pi%2C%20Pi%2F5%7D%5D%3B%0Aibmp%20%3D%20Table%5BbilinearInterpolation%5Bbmp%2C%20%7Bx%2Cy%7D%5D%2C%20%20%7Bx%2C%201%2C%206%20-%200.1%2C%200.0165%202%7D%2C%20%7By%2C%201%2C%206%20-%200.1%2C%200.0165%202%7D%5D%3B%0A%0A%7B%0A%20%20Image%5BImageResize%5BImage%5Bbmp%2C%20%22Real32%22%5D%2C%20Scaled%5B25%5D%2C%20Resampling-%3E%22Nearest%22%5D%2C%20Magnification-%3E2%5D%2C%20%0A%20%20Image%5Bibmp%2C%20%22Real32%22%2C%20Magnification-%3E2%5D%0A%7D%20%2F%2F%20Row%20`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"382912b8-ecef-4381-a47d-ae6a836bb223\\"} type={\\"Output\\"} opts={{}} >{`%28%2AGB%5B%2A%29%7B%7B%28%2AVB%5B%2A%29%28FrontEndRef%5B%22a2a331ed-cc9c-4b80-9377-d58dd2533045%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKJxolGhsbpqboJidbJuuaJFkY6Foam5vrpphapKQYmRobG5iYAgCKcRVw%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28FrontEndRef%5B%22c2d79718-ca37-454d-8357-b2c9a1224b84%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKJxulmFuaG1roJicam%2BuamJqk6FoYm5rrJhklWyYaGhmZJFmYAAB9KBUa%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29`}</WLJSEditor>\\n\\nOn the right, there is our interpolated array, while on the left, the original one\\n\\n### Uniform distribution\\nThere is another short problem to solve: how to distribute particles evenly over a defined region. However, there is a solution out of the box in the Wolfram Language standard library.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"0046f1c0-1a6e-47cf-83e0-ec7ed85e08fa\\"} type={\\"Input\\"} opts={{}} >{`RandomPointConfiguration%5B%0A%20%20%20%20%20%20HardcorePointProcess%5B10000%2C%200.4%2C%202%5D%2C%0A%20%20%20%20%20%20Rectangle%5B%7B1%2C1%7D%2C%20%7B5%2C5%7D%5D%0A%2C%20Method%20-%3E%20%7B%22LengthOfRun%22%20-%3E%2010000000%7D%5D%5B%22Points%22%5D%20%2F%2F%20Point%20%2F%2F%20Graphics%20`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"0d78c370-1e1a-4292-a10d-cadb58446f16\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%221b5a0b27-3686-4aa2-a7a8-ce20c1a34c56%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKGyaZJhokGZnrGptZmOmaJCYa6SaaJ1roJqcaGSQbJhqbJJuaAQCBHhWL%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nThe last thing is to implement a function, which updates all probe particles\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"d78c897a-3693-4790-a328-f846ff49ba42\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`advectParticles%5Bv_%2C%20pts_%2C%20%CE%B4t_%3A0.02%5D%20%3A%3D%20Map%5BFunction%5Bp%2C%20p%20%2B%20%CE%B4t%20%28bilinearInterpolation%5Bv%2C%20p%5D%29%5D%2C%20pts%5D`}</WLJSEditor>\\n\\n## Complete Real-Time fluid simulation\\nWrapping everything up together with the divergence solver from the previous part, we can finally assemble the model\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"1b7c985e-3f91-4ec9-8c4a-9b59f7dd221c\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true,\\"Fade\\":true}} >{`removeDivergence%5Bgrid_%5D%20%3A%3D%20With%5B%7B%0A%20%20%28%2ABB%5B%2A%29%28%2Asafety%20checks%2C%20which%20enforce%20closed%20boundaries%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20take%20%3D%20Function%5B%7Barray%2C%20x%2Cy%7D%2C%20If%5Bx%20%3E%3D%201%20%26%26%20x%20%3C%3D%20Length%5Bgrid%5D%20%26%26%20y%20%3E%3D%201%20%26%26%20y%20%3C%3D%20Length%5Bgrid%5D%2C%20array%5B%5Bx%2Cy%5D%5D%2C%20%7B0%2C0%7D%5D%5D%0A%7D%2C%0A%20%20MapIndexed%5BFunction%5B%7Bval%2C%20i%7D%2C%20%0A%20%20%20%20val%20%2B%20%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%288.0%29%29%28%2A%5DFB%2A%29%20%28%0A%20%20%20%20%20%20%28%28take%5Bgrid%2C%20i%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%29.%7B1%2C1%7D%29%7B1%2C1%7D%20%2B%0A%0A%20%20%20%20%20%20%28%28take%5Bgrid%2C%20i%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%29.%7B1%2C-1%7D%29%7B1%2C-1%7D%20%2B%0A%0A%20%20%20%20%20%20%28take%5Bgrid%2C%20i%5B%5B1%5D%5D-1%2C%20i%5B%5B2%5D%5D%5D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2B1%2C%20i%5B%5B2%5D%5D%5D%20-%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D-1%5D%20-%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%2B1%5D%29%7B2%2C-2%7D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%5D%20%28-4%29%0A%0A%20%20%20%20%29%0A%20%20%5D%2C%20grid%2C%20%7B2%7D%5D%0A%5D`}</WLJSEditor>\\n\\n---\\n**TL;DR**\\nHere is the final code\\n\\n<WLJSHTML>{`%3Cspan%20id%3D%22tldr%22%20style%3D%22color%3A%20blue%22%3E%3Cb%20%3EEvaluate%20the%20cell%20below%3C%2Fb%3E%20in%20the%20notebook.%20Use%20your%20mouse%20to%20draw%20velocity%20vectors.%3C%2Fspan%3E`}</WLJSHTML>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"5caf3e63-833d-41f0-b4be-6dd62b241fad\\"} id={\\"078e51b7-428a-421e-96de-b82dd3c3ff07\\"} type={\\"Input\\"} opts={{}} >{`fgrid%20%3D%20Table%5B%7B0.%2C0.%7D%2C%20%7Bi%2C15%7D%2C%20%7Bj%2C15%7D%5D%3B%0Afcolors%20%3D%20Table%5B1.0%2C%20%7BLength%5Bfgrid%5D%7D%2C%20%7BLength%5Bfgrid%5D%7D%5D%3B%0Affps%20%3D%200%3B%0A%0Aparticles%20%3D%20RandomPointConfiguration%5B%0A%20%20%20%20%20%20HardcorePointProcess%5B10000%0A%20%20%20%20%20%20%2C%200.4%2C%202%5D%2C%0A%20%20%20%20%20%20Rectangle%5B%7B1%2B4%2C1%2B4%7D%2C%20%7B15-4%2C15-4%7D%5D%2C%20Method%20-%3E%20%7B%22LengthOfRun%22%20-%3E%2010000000%7D%5D%5B%22Points%22%5D%3B%0A%0A%0Aftime%20%3D%20AbsoluteTime%5B%5D%3B%0A%0Afpipeline%20%3D%20Composition%5BremoveDivergence%2C%20removeDivergence%2C%20advect%5B%23%2C%23%2C%200.2%5D%26%5D%3B%0A%0AEventHandler%5B%22fframe%22%2C%20Function%5BNull%2C%0A%0A%20%20fgrid%20%3D%20fpipeline%5Bfgrid%5D%3B%0A%20%20%0A%20%20fcolors%20%3D%20Map%5BFunction%5Bval%2C%20%28%2AFB%5B%2A%29%28%28%CF%80%20%2B%202.0%20ToPolarCoordinates%5Bval%5D%2F%2F%20Last%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%283.0%20%CF%80%29%29%28%2A%5DFB%2A%29%20%5D%2C%20fgrid%2C%20%7B2%7D%5D%3B%0A%20%20%0A%20%20particles%20%3D%20With%5B%7Bp%20%3D%20advectParticles%5Bfgrid%2C%20particles%2C%200.3%5D%7D%2C%0A%20%20%20%20advectParticles%5Bfgrid%2C%20p%2C%200.3%5D%0A%20%20%5D%3B%0A%0A%20%20ffps%20%3D%20%28%2AFB%5B%2A%29%28%28%28ffps%20%2B%201%20%2F%20%28AbsoluteTime%5B%5D%20-%20ftime%29%29%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29%20%2F%2F%20Round%3B%0A%20%20ftime%20%3D%20AbsoluteTime%5B%5D%3B%20%0A%5D%5D%3B%0A%0AWith%5B%7B%0A%20%20win%20%3D%20CurrentWindow%5B%5D%2C%20%0A%20%20currentCell%20%3D%20ResultCell%5B%5D%2C%0A%20%20canvas%20%3D%20CreateUUID%5B%5D%0A%7D%2C%0A%0A%20%20EventHandler%5Bwin%2C%20%7B%22Closed%22%20-%3E%20Function%5BNull%2C%0A%20%20%20%20Delete%5BcurrentCell%5D%20%0A%20%20%5D%7D%5D%3B%0A%0A%20%20Graphics%5B%7BArrowheads%5BMedium%2F2%5D%2C%0A%20%20%20%20Table%5BWith%5B%7Bi%3Di%2C%20j%3Dj%7D%2C%20%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20Offload%5B%7B%20%0A%20%20%20%20%20%20%20%20Hue%5Bfcolors%5B%5Bi%5D%5D%5B%5Bj%5D%5D%5D%2C%0A%20%20%20%20%20%20%20%20Arrow%5B%7B%7Bi%2Cj%7D%2C%20%7Bi%2Cj%7D%20%2B%20%20fgrid%5B%5Bi%5D%5D%5B%5Bj%5D%5D%7D%5D%0A%20%20%20%20%20%20%7D%5D%20%0A%20%20%20%20%0A%20%20%20%20%5D%2C%20%7Bi%2C15%7D%2C%20%7Bj%2C15%7D%5D%2C%0A%0A%20%20%20%20%0A%20%20%20%20EventHandler%5BGraphics%60Canvas%5B%5D%2C%20mouseHandler%5Bfgrid%2C%20win%2C%20MetaMarker%5Bcanvas%5D%5D%5D%2C%20%0A%0A%20%20%20%20%0A%20%20%20%20AnimationFrameListener%5Bffps%20%2F%2F%20Offload%2C%20%22Event%22-%3E%22fframe%22%5D%2C%20%0A%20%20%20%20%0A%20%20%20%20MetaMarker%5Bcanvas%5D%2C%20%0A%20%20%20%20PointSize%5B0.02%5D%2C%20Point%5Bparticles%2F%2FOffload%5D%2C%0A%20%20%20%20Text%5Bffps%20%2F%2F%20Offload%2C%20%7B0%2C0%7D%5D%0A%20%20%7D%2C%20%0A%20%20%20%20Controls-%3EFalse%2C%20%0A%20%20%20%20ImageSize-%3E500%2C%20%0A%20%20%20%20PlotRange-%3E%7B%7B-0.5%2C15.5%7D%2C%20%7B-0.5%2C15.5%7D%7D%2C%20%0A%20%20%20%20ImagePadding-%3ENone%2C%20%0A%20%20%20%20TransitionDuration-%3E35%20%0A%20%20%5D%0A%5D`}</WLJSEditor>\\n\\n*Use your mouse to draw velocity vectors*\\n\\nimport testVideo from \'./attachments/fluidSim.mov\';\\n\\n<video width={\\"100%\\"} controls>\\n  <source src={testVideo}/>\\n</video>\\n\\nThere is still a lot that can be improved further. Especially advection and the code for removing divergence can be optimized and compiled as well.\\n\\n## Optimizations\\nSince all our main functions used in the animation loop are dealing only with numerics, one can apply `Compile` to them. With some minor changes made (which unfortunately make the code a bit ugly, because not all functions are compilable) we have\\n\\n```mathematica\\nadvect = Compile[{{v, _Real, 3}, {u, _Real, 3}, {\u03b4t, _Real, 0}} , With[{max = Length[v]}, With[{\\n \\n},\\n  Table[ \\n  \\n    With[{\\n      v1 =  (*FB[*)((If[i-1 >= 1, v[[i-1, j]], {0.,0.}] + v[[i, j]])(*,*)/(*,*)(2.0))(*]FB*).{1,0},\\n      v2 =  (*FB[*)((If[j+1 <= max, v[[i, j+1]], {0.,0.}] + v[[i, j]])(*,*)/(*,*)(2.0))(*]FB*).{0,-1},\\n      v3 =  (*FB[*)((If[i+1 <= max, v[[i+1, j]], {0.,0.}] + v[[i, j]])(*,*)/(*,*)(2.0))(*]FB*).{-1,0},\\n      v4 =  (*FB[*)((If[j-1 >= 1, v[[i, j-1]], {0.,0.}] + v[[i, j]])(*,*)/(*,*)(2.0))(*]FB*).{0,1},\\n      org = u[[i,j]]\\n    },\\n\\n      org +  (\\n      \\n        v1 If[v1 >0, If[i-1 >= 1, u[[i-1, j]], {0.,0.} ], org]  + v3 If[v3>0,If[i+1 <= max, u[[i+1, j]], {0.,0.} ], org]+\\n        \\n        v4 If[v4 >0, If[j-1 >= 1, u[[i, j-1]], {0.,0.} ], org] + v2 If[v2>0, If[j+1 <= max, u[[i, j+1]], {0.,0.} ], org]\\n        \\n      ) \u03b4t \\n    ]\\n    \\n  , {i, max}, {j, max}] // Chop\\n ]] ];\\n```\\n\\n```mathematica\\nremoveDivergence = Compile[{{grid, _Real, 3}}, With[{\\n  max = grid // Length\\n},\\n  MapIndexed[Function[{val, i}, \\n    val + (*FB[*)((1)(*,*)/(*,*)(8.0))(*]FB*) (\\n      (\\n        (\\n          If[i[[1]] - 1 >= 1 && i[[1]] - 1 <= max && i[[2]] - 1 >= 1 && i[[2]] - 1 <= max, grid[[i[[1]] - 1, i[[2]] - 1]], {0.,0.}] \\n          \\n          + If[i[[1]] + 1 >=1 && i[[1]] + 1 <= max && i[[2]] + 1 >= 1 && i[[2]] + 1 <= max, grid[[i[[1]] + 1, i[[2]] + 1]], {0.,0.}]\\n        \\n        ).{1,1}\\n        \\n      ){1,1} +\\n\\n      (\\n        (\\n          If[i[[1]] - 1 >= 1 && i[[1]] - 1 <= max && i[[2]] + 1 >= 1 && i[[2]] + 1 <= max, grid[[i[[1]] - 1, i[[2]] + 1]], {0.,0.}]\\n          \\n          + If[i[[1]] + 1 >= 1 && i[[1]] + 1 <= max && i[[2]] - 1 >= 1 && i[[2]] - 1 <= max, grid[[i[[1]] + 1, i[[2]] - 1]], {0.,0.}]\\n          \\n        ).{1,-1}\\n        \\n      ){1,-1} +\\n\\n      (\\n        If[i[[1]]-1 >= 1 && i[[1]]-1 <= max, grid[[i[[1]]-1, i[[2]] ]], {0.,0.}]\\n        \\n        + If[i[[1]]+1 >= 1 && i[[1]]+1 <= max, grid[[ i[[1]]+1, i[[2]] ]], {0.,0.}]\\n        \\n        - If[i[[2]]-1 >= 1 && i[[2]]-1 <= max, grid[[ i[[1]], i[[2]]-1 ]], {0.,0.}]\\n        \\n        - If[i[[2]]+1 >= 1 && i[[2]]+1 <= max, grid[[i[[1]], i[[2]]+1]], {0.,0.}]\\n        \\n      ){2,-2} \\n        \\n        + grid[[ i[[1]], i[[2]] ]] (-4)\\n\\n    )\\n  ], grid, {2}]\\n] ];\\n```\\n\\nand\\n\\n```mathematica\\nbilinearInterpolation = Compile[{{array, _Real, 3}, {v, _Real, 1}}, Module[\\n  {rows, cols, x = v[[2]], y = v[[1]], x1, x2, y1, y2, fQ11, fQ12, fQ21, fQ22},\\n  \\n  (* Get the dimensions of the array *)\\n  {rows, cols} = {Length[array], Length[array]};\\n  \\n  (* Clip points to the boundaries *)\\n  x = Clip[x, {1, cols}];\\n  y = Clip[y, {1, rows}];\\n  \\n  (* Find the bounding indices *)\\n  x1 = Floor[x]; \\n  x2 = Ceiling[x];\\n  y1 = Floor[y]; \\n  y2 = Ceiling[y];\\n  \\n  (* Get the values at the four corners *)\\n  fQ11 = array[[y1, x1]];\\n  fQ12 = array[[y2, x1]];\\n  fQ21 = array[[y1, x2]];\\n  fQ22 = array[[y2, x2]];\\n  \\n  (* Perform bilinear interpolation *)\\n  If[x2 == x1,\\n    If[y2 == y1,\\n      fQ11,\\n      1/(2 (y2 - y1)) * (\\n        fQ11 (y2 - y) +\\n        fQ21 (y2 - y) +\\n        fQ12 (y - y1) +\\n        fQ22 (y - y1)\\n      )\\n    ],\\n    If[y2 == y1,\\n      1/(2 (x2 - x1)) * (\\n        fQ11 (x2 - x) +\\n        fQ21 (x - x1) +\\n        fQ12 (x2 - x) +\\n        fQ22 (x - x1)\\n      ),\\n      1/((x2 - x1) (y2 - y1)) * (\\n        fQ11 (x2 - x) (y2 - y) +\\n        fQ21 (x - x1) (y2 - y) +\\n        fQ12 (x2 - x) (y - y1) +\\n        fQ22 (x - x1) (y - y1)\\n      )\\n    ]\\n  ]\\n] ];\\n```\\n\\nAfter that the main bottleneck is still the way how we draw and update SVG graphics (as well as WebSocket connection latency). However, these changes improves average FPS from `17-24` up to `30-35` on my Mac Air M1."},{"id":"/2024/08/18/fluid-1","metadata":{"permalink":"/wljs-docs/blog/2024/08/18/fluid-1","source":"@site/blog/2024-08-18-fluid-1/index.mdx","title":"Real-time Fluid Simulation Part 1","description":"Using Wolfram Language and WLJS libraries","date":"2024-08-18T00:00:00.000Z","tags":[{"label":"dynamics","permalink":"/wljs-docs/blog/tags/dynamics"},{"label":"visualization","permalink":"/wljs-docs/blog/tags/visualization"}],"readingTime":6.315,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","enableComments":true,"tags":["dynamics","visualization"]},"unlisted":false,"prevItem":{"title":"Real-time Fluid Simulation Part 2","permalink":"/wljs-docs/blog/2024/08/19/fluid-2"},"nextItem":{"title":"1D FDTD Method","permalink":"/wljs-docs/blog/2024/07/12/maxwell"}},"content":"*Using Wolfram Language and WLJS libraries*\\n\\nIn this notebook, we will explore a simple technique for simulating 2D incompressible fluids for visual effects. This work is mostly based on Jos Stam. Stable Fluids SIGGRAPH 1999 as well as a tutorial by [Karl Sims](https://www.karlsims.com/fluid-flow.html)\\n\\n\x3c!--truncate--\x3e\\n\\nimport { WLJSHTML, WLJSEditor, WLJSStore } from \\"@site/src/components/wljs-reactcells\\";\\n\\n\\n\\n<WLJSStore json={require(\'./attachments/36a310dd-d5f8-40a8-b29a-535bca60d052.txt\').default} notebook={require(\'./attachments/notebook-36a.wln\').default}/>\\n\\n\\n\\n## Working with a Grid\\n\\nHere we will use the Euler method to represent a fluid, i.e., by storing velocity as a vector field discretized to a uniform grid.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"74a3a573-87d2-4324-a102-0d6df63439f5\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`grid%20%3D%20Table%5BCross%5B%7Bi%2Cj%2C0%7D%2C%20%7B0%2C0%2C1%7D%5D%5B%5B%3B%3B2%5D%5D%2C%20%7Bi%2C%205%7D%2C%20%7Bj%2C%205%7D%5D%3B%0A%25%20%2F%2F%20MatrixForm%20`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"7df65f24-80c7-401a-bf50-62ecc4935496\\"} type={\\"Output\\"} opts={{}} >{`%28%28%2AGB%5B%2A%29%7B%7B%28%28%2AGB%5B%2A%29%7B%7B1%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-1%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B2%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-1%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B3%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-1%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B4%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-1%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B5%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-1%7D%7D%28%2A%5DGB%2A%29%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%28%2AGB%5B%2A%29%7B%7B1%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-2%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B2%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-2%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B3%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-2%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B4%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-2%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B5%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-2%7D%7D%28%2A%5DGB%2A%29%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%28%2AGB%5B%2A%29%7B%7B1%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-3%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B2%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-3%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B3%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-3%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B4%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-3%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B5%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-3%7D%7D%28%2A%5DGB%2A%29%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%28%2AGB%5B%2A%29%7B%7B1%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-4%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B2%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-4%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B3%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-4%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B4%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-4%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B5%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-4%7D%7D%28%2A%5DGB%2A%29%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%28%2AGB%5B%2A%29%7B%7B1%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-5%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B2%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-5%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B3%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-5%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B4%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-5%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B5%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B-5%7D%7D%28%2A%5DGB%2A%29%29%7D%7D%28%2A%5DGB%2A%29%29`}</WLJSEditor>\\n\\nThen one can easily visualize it as a vector field:\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"57756056-7501-4d9e-8547-d6213e8d7732\\"} type={\\"Input\\"} opts={{}} >{`grid%20%2F%2F%20ListVectorPlot`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"22f5cba7-8553-4e89-84bc-6f72a9ea4887\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%227fa3d105-973d-43df-aa2e-88d286b02c82%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKm6clGqcYGpjqWpobp%2BiaGKek6SYmGqXqWlikGFmYJRkYJVsYAQCGjBWk%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nFor the best performance, we will use `Map` or `MapIndexed` with a pure function inside. Then Wolfram Kernel is able to use JIT compilation. For example:\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"8c3fa2b1-6b3e-4b1f-b192-63ab80b191bb\\"} type={\\"Input\\"} opts={{}} >{`Map%5BFunction%5Bvector%2C%20%28%28%2AGB%5B%2A%29%7B%7B0%28%2A%7C%2A%29%2C%28%2A%7C%2A%29-1%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B1%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%7D%7D%28%2A%5DGB%2A%29%29%20.%20vector%5D%2C%20grid%2C%20%7B2%7D%5D%0AListVectorPlot%5B%25%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"1a963ff2-bd9d-4e47-abb9-0944393b760c\\"} type={\\"Output\\"} opts={{}} >{`%7B%7B%7B1%2C1%7D%2C%7B1%2C2%7D%2C%7B1%2C3%7D%2C%7B1%2C4%7D%2C%7B1%2C5%7D%7D%2C%7B%7B2%2C1%7D%2C%7B2%2C2%7D%2C%7B2%2C3%7D%2C%7B2%2C4%7D%2C%7B2%2C5%7D%7D%2C%7B%7B3%2C1%7D%2C%7B3%2C2%7D%2C%7B3%2C3%7D%2C%7B3%2C4%7D%2C%7B3%2C5%7D%7D%2C%7B%7B4%2C1%7D%2C%7B4%2C2%7D%2C%7B4%2C3%7D%2C%7B4%2C4%7D%2C%7B4%2C5%7D%7D%2C%7B%7B5%2C1%7D%2C%7B5%2C2%7D%2C%7B5%2C3%7D%2C%7B5%2C4%7D%2C%7B5%2C5%7D%7D%7D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"da1b74b7-1f22-41d7-8fda-91060b8e9e2c\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%229d29d953-9bbb-46aa-805e-391ff5054311%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKW6YYWaZYmhrrWiYlJemamCUm6loYmKbqGlsapqWZGpiaGBsaAgCEmxVJ%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\n### Custom Syntax Sugar\\n\\nAnother possibility to visualize using pure syntax sugar would be to define our own output form for a single velocity vector.\\n\\nThe most efficient way is to define a decorator function in Javascript. Let it be a small arrow pointing to a desired direction.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"80d9ba13-b899-4f19-ae99-0ad772f0796e\\"} type={\\"Input\\"} opts={{\\"Fade\\":true}} >{`.js%0Acore.ArrowGuide%20%3D%20async%20%28args%2C%20env%29%20%3D%3E%20%7B%0A%20%20const%20dir%20%3D%20await%20interpretate%28args%5B0%5D%2C%20env%29%3B%0A%20%20const%20mag%20%3D%20dir.map%28%28el%29%3D%3Eel%2Ael%29.reduce%28%28c%2Ca%29%20%3D%3E%20c%2Ba%29%3B%0A%0A%20%20const%20angle%20%3D%20Math.round%28180%20%2A%20Math.atan2%28dir%5B0%5D%2C%20dir%5B1%5D%29%20%2F%20Math.PI%29%3B%0A%20%20%0A%20%20console.log%28angle%29%3B%0A%20%20env.element.style.transform%20%3D%20%60rotate%28%24%7Bangle%7Ddeg%29%60%3B%0A%20%20%0A%20%20if%20%28mag%20%3C%200.01%29%20%7B%20%2F%2Fdo%20not%20display%20if%20it%20is%20too%20small%0A%20%20%20%20env.element.style.opacity%20%3D%200.5%3B%0A%20%20%20%20env.element.innerHTML%20%3D%20%22.%22%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20env.element.innerHTML%20%3D%20%22%26uarr%3B%22%3B%0A%20%20%7D%0A%7D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"js\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"096909ea-cc93-470d-b07f-f7e9d6b37ae5\\"} type={\\"Output\\"} opts={{}} >{`%0Acore.ArrowGuide%20%3D%20async%20%28args%2C%20env%29%20%3D%3E%20%7B%0A%20%20const%20dir%20%3D%20await%20interpretate%28args%5B0%5D%2C%20env%29%3B%0A%20%20const%20mag%20%3D%20dir.map%28%28el%29%3D%3Eel%2Ael%29.reduce%28%28c%2Ca%29%20%3D%3E%20c%2Ba%29%3B%0A%0A%20%20const%20angle%20%3D%20Math.round%28180%20%2A%20Math.atan2%28dir%5B0%5D%2C%20dir%5B1%5D%29%20%2F%20Math.PI%29%3B%0A%20%20%0A%20%20console.log%28angle%29%3B%0A%20%20env.element.style.transform%20%3D%20%60rotate%28%24%7Bangle%7Ddeg%29%60%3B%0A%20%20%0A%20%20if%20%28mag%20%3C%200.01%29%20%7B%20%2F%2Fdo%20not%20display%20if%20it%20is%20too%20small%0A%20%20%20%20env.element.style.opacity%20%3D%200.5%3B%0A%20%20%20%20env.element.innerHTML%20%3D%20%22.%22%3B%0A%20%20%7D%20else%20%7B%0A%20%20%20%20env.element.innerHTML%20%3D%20%22%26uarr%3B%22%3B%0A%20%20%7D%0A%7D`}</WLJSEditor>\\n\\nNow we define a standard form `ArrowGuide`, which will use the defined Javascript function to display itself inside a cell.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"59ea3062-81d1-473d-bde4-14cde7a0f505\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`ArrowGuide%20%2F%3A%20MakeBoxes%5Ba_ArrowGuide%2C%20StandardForm%5D%20%3A%3D%20%0A%20%20ViewBox%5Ba%2F%2FFirst%2C%20a%5D`}</WLJSEditor>\\n\\nThe first argument will be an actual expression used as input; `First` will break our wrapper and substitute an original vector.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"c4478553-1bf2-4c62-84a6-76645f3b7636\\"} type={\\"Input\\"} opts={{}} >{`ArrowGuide%5B%7B1%2C1%7D%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"1c68dc44-b6ee-460c-a102-f534482fd926\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28%7B1%2C%201%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBKkAEwCJmgvW%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nNow one can do some cool tricks like this one:\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"e91e36d0-3637-4fed-9cbd-89f5b557d0e2\\"} type={\\"Input\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28%7B1%2C%201%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBKkAEwCJmgvW%22%2A%29%28%2A%5DVB%2A%29%20.%20%28%2AVB%5B%2A%29%28%7B1%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBKnIBGIGAImWC9U%3D%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"0afb84e7-d747-475e-be77-ba2f0cbfaf8d\\"} type={\\"Output\\"} opts={{}} >{`1`}</WLJSEditor>\\n\\nNow we can basically apply this decoration wrapper to our matrix using multidimensional `Map` function and then again output it as a matrix\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"9044ba17-5f74-43f4-8cd3-bc96fab48bbe\\"} type={\\"Input\\"} opts={{}} >{`Map%5BArrowGuide%2C%20grid%2C%20%7B2%7D%5D%20%2F%2F%20MatrixForm%20`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"f7433e0d-4054-4bfc-b7d1-bea9bf882c81\\"} type={\\"Output\\"} opts={{}} >{`%28%28%2AGB%5B%2A%29%7B%7B%28%2AVB%5B%2A%29%28%7B1%2C%20-1%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBKnI%2FA8EAJOMD9E%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B2%2C%20-1%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBPEy%2FwMBAJOVD9I%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B3%2C%20-1%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JZAYyMv8DAQCTng%2FT%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B4%2C%20-1%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBDEy%2FwMBAJOnD9Q%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B5%2C%20-1%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JZAUyMv8DAQCTsA%2FV%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B1%2C%20-2%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBKnI%2FPf%2F%2F38Ak4gP0A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B2%2C%20-2%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBPEy%2F%2F3%2F%2Fx8Ak5EP0Q%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B3%2C%20-2%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JZAYyMv%2F9%2F%2F8fAJOaD9I%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B4%2C%20-2%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBDEy%2F%2F3%2F%2Fx8Ak6MP0w%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B5%2C%20-2%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JZAUyMv%2F9%2F%2F8fAJOsD9Q%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B1%2C%20-3%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBKnI%2FPv%2F%2F38Ak4QPzw%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B2%2C%20-3%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBPEy%2F%2F7%2F%2Fx8Ak40P0A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B3%2C%20-3%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JZAYyMv%2F%2B%2F%2F8fAJOWD9E%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B4%2C%20-3%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBDEy%2F%2F7%2F%2Fx8Ak58P0g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B5%2C%20-3%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JZAUyMv%2F%2B%2F%2F8fAJOoD9M%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B1%2C%20-4%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBKnI%2FPP%2F%2F38Ak4APzg%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B2%2C%20-4%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBPEy%2F%2Fz%2F%2Fx8Ak4kPzw%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B3%2C%20-4%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JZAYyMv%2F8%2F%2F8fAJOSD9A%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B4%2C%20-4%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBDEy%2F%2Fz%2F%2Fx8Ak5sP0Q%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B5%2C%20-4%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JZAUyMv%2F8%2F%2F8fAJOkD9I%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B1%2C%20-5%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBKnI%2FP3%2F%2F38Ak3wPzQ%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B2%2C%20-5%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBPEyf%2F%2F%2F%2Fx8Ak4UPzg%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B3%2C%20-5%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JZAYyMn%2F%2F%2F%2F8fAJOOD88%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B4%2C%20-5%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBDEyf%2F%2F%2F%2Fx8Ak5cP0A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B5%2C%20-5%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JZAUyMn%2F%2F%2F%2F8fAJOgD9E%3D%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29%29`}</WLJSEditor>\\n\\nLet\'s define a helper function\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"a0d0d26e-ccc3-49aa-8370-8595ac2b585b\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`showAsMatrix%5Bl_%5D%20%3A%3D%20Map%5BArrowGuide%2C%20l%2C%20%7B2%7D%5D%20%2F%2F%20MatrixForm%20`}</WLJSEditor>\\n\\n## Divergence\\n__Conservation of mass__ for incompressible fluid dictates\\n\\n$$\\ndiv ~\\\\mathbf{v} = 0\\n$$\\n\\nwhere $\\\\mathbf{v}$ is velocity vector field we played with earlier - `grid`.\\n\\n\\n\\n### Example\\n\\nLet us start with a simples example\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"ee7cc809-22c8-4a24-93e0-f8863aa9a58b\\"} type={\\"Input\\"} opts={{}} >{`grid%20%3D%20Table%5B%7B0%2C0%7D%2C%20%7Bi%2C5%7D%2C%20%7Bj%2C5%7D%5D%3B%0Agrid%20%2F%2F%20showAsMatrix`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"3f25d4fb-b61c-4860-8cf9-0c186e93041b\\"} type={\\"Output\\"} opts={{}} >{`%28%28%2AGB%5B%2A%29%7B%7B%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29%29`}</WLJSEditor>\\n\\nAnd put a single vector in the middle\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"e0f50781-ab65-467e-986d-1ea1ea2b1e60\\"} type={\\"Input\\"} opts={{}} >{`grid%20%3D%20%28%28%2AGB%5B%2A%29%7B%7B%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%201%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMmSBlAImRC9U%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29%29%3B`}</WLJSEditor>\\n\\nTo visualize the divergence, one can use `DensityPlot`\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"d2858fc8-5802-4f49-9cd5-526d7c204439\\"} type={\\"Input\\"} opts={{}} >{`%7BintX%2C%20intY%7D%20%3D%20%7B%0A%20%20%20%20ListInterpolation%5Bgrid%5B%5BAll%2CAll%2C1%5D%5D%5D%2C%0A%20%20%20%20ListInterpolation%5Bgrid%5B%5BAll%2CAll%2C2%5D%5D%5D%0A%7D%3B%20%28%2ABB%5B%2A%29%28%2Ainterpolate%20data%20for%20the%20convenience%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%0ACoolColor%5B%20z_%20%5D%20%3A%3D%20RGBColor%5Bz%2C%200.5%2C%201%20-%20z%5D%3B%0A%0A%28%2ABB%5B%2A%29%28%2Afind%20divergence%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0ADiv%5B%7BintX%5Bx%2Cy%5D%2C%20intY%5Bx%2Cy%5D%7D%2C%20%7Bx%2Cy%7D%5D%3B%20%0AContourPlot%5B%25%2C%20%7Bx%2C1%2C5%7D%2C%20%7By%2C1%2C5%7D%2C%20ColorFunction-%3ECoolColor%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"431e957f-5467-48d4-8ec6-0864d75e5d01\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%2215f4029b-3d6d-46e2-8893-95deb4f9c83e%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG5qmmRgYWSbpGqeYpeiamKUa6VpYWBrrWpqmpCaZpFkmWxinAgB8URWN%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nFrom a physical point of view, it means that there is a *source node* at the bottom and a *drain* at the top, which should not be a feature of a closed system with incompressible fluid.\\n\\n### Removing the Divergence\\nOne can try to solve this problem iteratively by taking a field with non-zero divergency and apply artificial tranformation on it to make it satisfy the equation.\\n\\nThere is a [clever algorithm](https://www.karlsims.com/fluid-flow.html) for removing the divergence of an arbitrary 2D vector field, which acts like a cellular automaton \\n\\n$$\\n\\\\begin{align*}\\nv^\\\\prime_{(x=0,y=0)} &= v_{(0,0)} + \\\\frac{1}{8} \\\\Big\\\\{ \\\\\\\\ \\n&\\\\Big((v_{(-1,-1)} + v_{(1,1)})\\\\cdot \\\\begin{bmatrix}\\n   1  \\\\\\\\\\n   1\\n\\\\end{bmatrix} \\\\Big) \\\\begin{bmatrix}\\n   1  \\\\\\\\\\n   1\\n\\\\end{bmatrix} \\\\Big\\\\} + \\\\\\\\\\n\\n&\\\\Big((v_{(-1,1)} + v_{(1,-1)})\\\\cdot \\\\begin{bmatrix}\\n   1  \\\\\\\\\\n   -1\\n\\\\end{bmatrix} \\\\Big) \\\\begin{bmatrix}\\n   1  \\\\\\\\\\n   -1\\n\\\\end{bmatrix} \\\\Big\\\\} + \\\\\\\\\\n\\n\\\\begin{bmatrix}\\n   2 &  0\\\\\\\\\\n   0 & -2\\n\\\\end{bmatrix} &\\\\cdot (v_{(-1,0)} + v_{(1,0)} - v_{(0,-1)} - v_{(0,1)}) + \\\\\\\\\\n\\n& (-4) v_{(0,0)} \\\\Big\\\\},\\n\\n\\\\end{align*}\\n$$\\n\\nwhere $v^{\\\\prime}_{(0,0)}$ is a new velocity vector at coordinates $(x,y)$ and others $v_{(i,j)}$ are ones from the previous state at $(x + i, y + j)$.\\n\\n\\n> This is done by adding flow away from high pressure converging areas, and toward low pressure diverging areas. \\n\\n\\nHere is our implementation\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"a67839f1-1fe1-457e-a784-7f2234461627\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`removeDivergence%5Bgrid_%5D%20%3A%3D%20With%5B%7B%0A%20%20%28%2ABB%5B%2A%29%28%2Asafety%20checks%2C%20which%20enforce%20closed%20boundaries%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20take%20%3D%20Function%5B%7Barray%2C%20x%2Cy%7D%2C%20If%5Bx%20%3E%3D%201%20%26%26%20x%20%3C%3D%20Length%5Bgrid%5D%20%26%26%20y%20%3E%3D%201%20%26%26%20y%20%3C%3D%20Length%5Bgrid%5D%2C%20array%5B%5Bx%2Cy%5D%5D%2C%20%7B0%2C0%7D%5D%5D%0A%7D%2C%0A%20%20MapIndexed%5BFunction%5B%7Bval%2C%20i%7D%2C%20%0A%20%20%20%20val%20%2B%20%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%288.0%29%29%28%2A%5DFB%2A%29%20%28%0A%20%20%20%20%20%20%28%28take%5Bgrid%2C%20i%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%29.%7B1%2C1%7D%29%7B1%2C1%7D%20%2B%0A%0A%20%20%20%20%20%20%28%28take%5Bgrid%2C%20i%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%29.%7B1%2C-1%7D%29%7B1%2C-1%7D%20%2B%0A%0A%20%20%20%20%20%20%28take%5Bgrid%2C%20i%5B%5B1%5D%5D-1%2C%20i%5B%5B2%5D%5D%5D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2B1%2C%20i%5B%5B2%5D%5D%5D%20-%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D-1%5D%20-%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%2B1%5D%29%7B2%2C-2%7D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%5D%20%28-4%29%0A%0A%20%20%20%20%29%0A%20%20%5D%2C%20grid%2C%20%7B2%7D%5D%0A%5D`}</WLJSEditor>\\n\\nLet us test it.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"5ef74ab6-6f2d-48d1-a7f3-0b90cd3c8088\\"} type={\\"Input\\"} opts={{}} >{`Table%5BNest%5BremoveDivergence%2C%20grid%2C%20i%5D%20%2F%2F%20showAsMatrix%2C%20%7Bi%2C%200%2C2%7D%5D%20%2F%2F%20Row%20`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"24dfce5d-2dc0-4d56-ba39-7e6a4fb41906\\"} type={\\"Output\\"} opts={{}} >{`%28%2AGB%5B%2A%29%7B%7B%28%28%2AGB%5B%2A%29%7B%7B%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%201%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMmSBlAImRC9U%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0%2C%200%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC7JBNIMYAIAiY0L1A%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.125%2C%200.125%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYgCDA%2FZwBgDz8Q3k%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%20-0.25%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKOPCfgDp2w11%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B-0.125%2C%200.125%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYgCDA%2FthDHsA%2BPEOZA%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.25%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKOOCPQDpWwz1%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.5%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKOOBPQDpew0F%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.25%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKOOCPQDpWwz1%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B-0.125%2C%200.125%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYgCDA%2FthDHsA%2BPEOZA%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%20-0.25%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKOPCfgDp2w11%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.125%2C%200.125%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYgCDA%2FZwBgDz8Q3k%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACOAMA53wL5g%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%28%2AGB%5B%2A%29%7B%7B%28%2AVB%5B%2A%29%28%7B0.03125%2C%200.03125%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYgCDBfZwBgDyUQ2k%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%20-0.0625%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKGPDfgDpmw1V%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.0625%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKGODPQDpGwzV%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%20-0.0625%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKGPDfgDpmw1V%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B-0.03125%2C%200.03125%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYgCDBfthDHsA91EOJA%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0.%2C%200.0625%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKGODPQDpGwzV%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.125%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYgCDA%2FZQBgMDAPIyDOU%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%20-0.125%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKOPAfgDpuw1l%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B-0.125%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYgCDA%2FuhDAYGAPcyDWU%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.0625%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKGODPQDpGwzV%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0.%2C%200.0625%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKGODPQDpGwzV%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.125%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKOOAPQDpOwzl%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.625%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKOOJPQDpgw0J%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.125%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKOOAPQDpOwzl%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.0625%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKGODPQDpGwzV%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B0.%2C%200.0625%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKGODPQDpGwzV%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B-0.125%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYgCDA%2FuhDAYGAPcyDWU%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%20-0.125%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKOPAfgDpuw1l%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.125%2C%200.%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYgCDA%2FZQBgMDAPIyDOU%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.0625%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKGODPQDpGwzV%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28%7B-0.03125%2C%200.03125%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYgCDBfthDHsA91EOJA%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%20-0.0625%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKGPDfgDpmw1V%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%200.0625%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKGODPQDpGwzV%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.%2C%20-0.0625%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYoACKGPDfgDpmw1V%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28%7B0.03125%2C%200.03125%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeF5BwLCrKL3cvzUxJTWOCqfDJLC4pYgCDBfZwBgDyUQ2k%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7D%28%2A%5DGB%2A%29`}</WLJSEditor>\\n\\nAs you can see, if we have a stream of fluid from *A* to *B*, there must be some other streams made from *B* to *A*. The applied procedure produces the missing one spread over the whole grid if `removeDivergence` is applied multiple times.\\n\\nWe can check it directly by calculating the divergence.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"6247d1de-940c-4a5c-8c06-e91a51ea94ed\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`CoolColor%5B%20z_%20%5D%20%3A%3D%20RGBColor%5Bz%2C%200.5%2C%201%20-%20z%5D%3B%0A%0AplotDiv%5Bgrid_%5D%20%3A%3D%20Module%5B%7BintX%2C%20intY%2C%20x%2C%20y%7D%2C%0A%0A%20%20%7BintX%2C%20intY%7D%20%3D%20%7B%0A%20%20%20%20%20%20ListInterpolation%5Bgrid%5B%5BAll%2CAll%2C1%5D%5D%5D%2C%0A%20%20%20%20%20%20ListInterpolation%5Bgrid%5B%5BAll%2CAll%2C2%5D%5D%5D%0A%20%20%7D%3B%20%28%2ABB%5B%2A%29%28%2Ainterpolate%20data%20for%20the%20convenience%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%0A%20%20With%5B%7Bdiv%20%3D%20Div%5B%7BintX%5Bx%2Cy%5D%2C%20intY%5Bx%2Cy%5D%7D%2C%20%7Bx%2Cy%7D%5D%7D%2C%0A%20%20%20%20ContourPlot%5B%0A%20%20%20%20%20%20div%2C%20%7Bx%2C1%2C5%7D%2C%20%7By%2C1%2C5%7D%2C%20%0A%20%20%20%20%20%20ColorFunctionScaling%20-%3E%20False%2C%20%28%2ABB%5B%2A%29%28%2Amake%20sure%20to%20have%20the%20same%20scale%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20ColorFunction%20-%3E%20ColorData%5B%7B%22ThermometerColors%22%2C%20%7B-1%2C%201%7D%7D%5D%0A%20%20%20%20%5D%0A%20%20%5D%0A%5D%0A`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"58dd0876-f1d9-4c80-b84b-f2eca343ef62\\"} type={\\"Input\\"} opts={{}} >{`%7B%0A%20%20%7BStyle%5B%22Original%22%2C%2014%5D%2C%20plotDiv%5Bgrid%5D%7D%2C%20%0A%20%20%7BStyle%5B%228%20iterations%22%2C%2014%5D%2C%20plotDiv%5BNest%5BremoveDivergence%2C%20grid%2C%208%5D%5D%7D%0A%7D%20%2F%2F%20Transpose%20%2F%2F%20Grid%20`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"b91d8db9-983a-4416-8868-f5ba4373ec56\\"} type={\\"Output\\"} opts={{}} >{`%28%2AGB%5B%2A%29%7B%7B%28%2ABB%5B%2A%29%28%22Original%22%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCRYg4ZGfkwLhcQKJ4JKizLx0p%2FyKTD4gD6IdpCqoNCc1mA2uACwWUlSaCgCn0xcV%22%2A%29%28%2A%5DBB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2ABB%5B%2A%29%28%228%20iterations%22%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCRYg4ZGfkwLhcQKJ4JKizLx0p%2FyKTD4gD6IdpCqoNCc1mA2uACwWUlSaCgCn0xcV%22%2A%29%28%2A%5DBB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28FrontEndRef%5B%2262b4aa00-b857-4b7d-8530-a563afd164ec%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKmxklmSQmGhjoJlmYmuuaJJmn6FqYGhvoJpqaGSempRiamaQmAwB%2FdRWX%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28FrontEndRef%5B%22b99a3f97-955e-4d38-b5cb-4ec0903c77e3%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKJ1laJhqnWZrrWpqapuqapBhb6CaZJifpmqQmG1gaGCebm6caAwCG1hW5%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29`}</WLJSEditor>\\n\\nApart from obvious artifacts caused by interpolation on a small grid, this algorithm definitely works. However, it is still far from modeling a fluid.\\n\\n### Interactive Example\\nWe can try to solve this in real-time and see how it reacts live. However, the current approach to visualizing will be quite slow when it comes to dynamics.\\n\\nIf we just try to reevaluate `ListVectorPlot` directly, it will be horribly slow. In general, there is no need to reevaluate the whole expression for graphics. The grid is the same, but vectors differ. We can go either fully `raster` using `Image` or use SVG graphics. The latter is the easiest way. Let us start from the ground up.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"94f9755f-043a-4720-b399-feb5cb3f1aa0\\"} type={\\"Input\\"} opts={{}} >{`grid%20%3D%20grid%20%2F%2F%20removeDivergence%3B%0A%0AGraphics%5B%7B%0A%20%20Table%5B%0A%20%20%20%20Arrow%5B%7B%0A%20%20%20%20%20%20%7Bi%2Cj%7D%2C%20%0A%20%20%20%20%20%20%7Bi%2Cj%7D%20%2B%201.5%20grid%5B%5Bi%5D%5D%5B%5Bj%5D%5D%0A%20%20%20%20%7D%5D%2C%20%7Bi%2C%205%7D%2C%20%7Bj%2C%205%7D%5D%0A%7D%2C%20PlotRange-%3E%7B%7B0%2C6%7D%2C%20%7B0%2C6%7D%7D%2C%20ImagePadding-%3ENone%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"480fe257-f9b6-4a66-83e4-4badae70a6c7\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%2246f8ea9d-0f01-4681-82d9-35d40f2fba91%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKm5ilWaQmWqboGqQZGOqamFkY6loYpVjqGpummBikGaUlJVoaAgCBGxV6%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nWhat about a color you ask. One can calculate `Hue` based on the polar angle of our vector\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"9159daef-55b8-451a-969e-b287e8fe3de9\\"} type={\\"Input\\"} opts={{}} >{`Graphics%5B%7B%0A%20%20Table%5B%7B%0A%20%20%20%20Hue%5B%28%2AFB%5B%2A%29%28%28%CF%80%20%2B%202%20ToPolarCoordinates%5Bgrid%5B%5Bi%5D%5D%5B%5Bj%5D%5D%5D%2F%2F%20Last%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%283%20%CF%80%29%29%28%2A%5DFB%2A%29%5D%2C%0A%20%20%20%20Arrow%5B%7B%0A%20%20%20%20%20%20%7Bi%2Cj%7D%2C%20%0A%20%20%20%20%20%20%7Bi%2Cj%7D%20%2B%201.5%20grid%5B%5Bi%5D%5D%5B%5Bj%5D%5D%0A%20%20%20%20%7D%5D%0A%20%20%7D%2C%20%7Bi%2C%205%7D%2C%20%7Bj%2C%205%7D%5D%0A%7D%2C%20PlotRange-%3E%7B%7B0%2C6%7D%2C%20%7B0%2C6%7D%7D%2C%20ImagePadding-%3ENone%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"4a7933eb-e29e-49e3-8a8d-d9a9bc6cc3df\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%225e1eca05-6839-466c-9b1d-9ac89c5ca036%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKm6YapiYnGpjqmlkYW%2BqamJkl61omGaboWiYmW1gmmwKljM0AhKkVrA%3D%3D%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nNow we basically recreated `VectorPlot` function in our primitive way. The next step will be to implement dynamic updates.\\n\\n### Dynamic Evaluation\\nThe key feature to fast dynamic evaluation is to minimize the amount of data transferred between the Kernel and frontend as well as the number of things updated.\\n\\nWe need to couple the `Arrow` primitive to a specific element of our array `grid`. To do this, one can use the `Offload` wrapper, which acts similarly to `Hold`\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"446f7d67-bb2e-49ab-aa0e-33a388ce5b95\\"} type={\\"Input\\"} opts={{}} >{`grid%20%3D%20Table%5B%7B0.%2C0.%7D%2C%20%7Bi%2C5%7D%2C%20%7Bj%2C5%7D%5D%3B%0Agrid%5B%5B3%2C3%5D%5D%20%3D%20%7B0%2C1.0%7D%3B%20%28%2ABB%5B%2A%29%28%2A%20initial%20divergence%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%0AGraphics%5B%7B%0A%20%20Table%5BWith%5B%7Bi%3Di%2C%20j%3Dj%7D%2C%20%28%2ABB%5B%2A%29%28%2A%20to%20substitute%20numbers%2C%20not%20symbols%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20Arrow%5B%7B%0A%20%20%20%20%20%20%7Bi%2Cj%7D%2C%20%0A%20%20%20%20%20%20%7Bi%2Cj%7D%20%2B%201.5%20grid%5B%5Bi%5D%5D%5B%5Bj%5D%5D%0A%20%20%20%20%7D%20%2F%2F%20Offload%20%5D%5D%2C%20%7Bi%2C%205%7D%2C%20%7Bj%2C%205%7D%5D%0A%7D%2C%20PlotRange-%3E%7B%7B0.5%2C5.5%7D%2C%20%7B0.5%2C5.5%7D%7D%2C%20ImagePadding-%3ENone%5D`}</WLJSEditor>\\n\\nNow __try to evaluate the next cell__ multiple times.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"487a6513-25cf-4a41-999f-d8ab268d8125\\"} type={\\"Input\\"} opts={{}} >{`grid%20%3D%20grid%20%2F%2F%20removeDivergence%3B`}</WLJSEditor>\\n\\nLet us increase the resolution and automate the process using `AnimationFrameListener`. In general, one can also add dynamic color to our arrows as well.\\n\\n---\\n**TL;DR**\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"36a310dd-d5f8-40a8-b29a-535bca60d052\\"} id={\\"4d83b66d-cbd5-487f-a5f0-76cfd8f8a112\\"} type={\\"Input\\"} opts={{}} >{`bgrid%20%3D%20Table%5B%7B0.%2C0.%7D%2C%20%7Bi%2C15%7D%2C%20%7Bj%2C15%7D%5D%3B%0Abcolors%20%3D%20Table%5B1.0%2C%20%7BLength%5Bbgrid%5D%7D%2C%20%7BLength%5Bbgrid%5D%7D%5D%3B%0Abfps%20%3D%200%3B%0A%0AmouseHandler%5Bbgrid_%2C%20win_%2C%20canvas_%5D%20%3D%20Module%5B%7B%0A%20%20arrow%20%3D%20False%2C%0A%20%20dest%20%3D%20%7B0%2C0%7D%2C%0A%20%20start%20%3D%20%7B0%2C0%7D%0A%7D%2C%20%7B%0A%20%20%20%20%20%20%22mouseup%22%20-%3E%20Function%5Bxy%2C%0A%20%20%20%20%20%20%20%20With%5B%7Bv%20%3D%20-Normalize%5Bstart%20-%20xy%5D%7D%2C%0A%20%20%20%20%20%20%20%20%20%20Do%5B%20%0A%20%20%20%20%20%20%20%20%20%20%20%20With%5B%7Bp%20%3D%20Clip%5B%23%2C%20%7B1%2C15%7D%5D%20%26%2F%40%20Round%20%2F%40%20%28%28xy%20-%20start%29%20a%20%2B%20start%29%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20bgrid%5B%5Bp%5B%5B1%5D%5D%2Cp%5B%5B2%5D%5D%5D%5D%20%3D%20%7Bv%5B%5B1%5D%5D%2C%20v%5B%5B2%5D%5D%7D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%2C%20%7Ba%2C%200%2C%201%2C0.1%7D%5D%3B%20%28%2A%20a%20very%20stipid%20way%20of%20drawing%20lines%20%2A%29%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%5D%3B%0A%0A%20%20%20%20%20%20%20%20Delete%5Barrow%5D%3B%20%0A%20%20%20%20%20%20%20%20arrow%20%3D%20False%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%5D%2C%0A%0A%20%20%20%20%20%20%22mousemove%22%20-%3E%20Function%5Bxy%2C%0A%20%20%20%20%20%20%20%20dest%20%3D%20xy%3B%0A%20%20%20%20%20%20%5D%2C%0A%20%20%20%20%0A%20%20%20%20%20%20%22mousedown%22%20-%3E%20Function%5Bxy%2C%0A%20%20%20%20%20%20%20%20start%20%3D%20xy%3B%0A%20%20%20%20%20%20%20%20dest%20%3D%20xy%20%2B%20%7B1%2C1%7D%3B%20%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20If%5Barrow%20%3D%21%3D%20False%2C%20Delete%5Barrow%5D%5D%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20arrow%20%3D%20FrontSubmit%5B%7B%0A%20%20%20%20%20%20%20%20%20%20AbsoluteThickness%5B3%5D%2C%20Gray%2C%20%0A%20%20%20%20%20%20%20%20%20%20Arrow%5B%7Bxy%2C%20dest%20%2F%2F%20Offload%7D%5D%0A%20%20%20%20%20%20%20%20%7D%2C%20%0A%20%20%20%20%20%20%20%20%20%20canvas%2C%20%0A%20%20%20%20%20%20%20%20%20%20%22Window%22-%3Ewin%2C%20%0A%20%20%20%20%20%20%20%20%20%20%22Tracking%22-%3ETrue%20%0A%20%20%20%20%20%20%20%20%5D%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%5D%0A%20%20%7D%5D%3B%0A%0ASetAttributes%5BmouseHandler%2C%20HoldFirst%5D%0A%0A%28%2ABB%5B%2A%29%28%2Adefine%20handler%20for%20the%20animation%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0Abtime%20%3D%20AbsoluteTime%5B%5D%3B%0A%0AEventHandler%5B%22bframe%22%2C%20Function%5BNull%2C%0A%20%20bgrid%20%3D%20removeDivergence%5Bbgrid%5D%20%2F%2F%20N%3B%0A%20%20bcolors%20%3D%20Map%5BFunction%5Bval%2C%20%28%2AFB%5B%2A%29%28%28%CF%80%20%2B%202.0%20ToPolarCoordinates%5Bval%5D%2F%2F%20Last%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%283.0%20%CF%80%29%29%28%2A%5DFB%2A%29%20%5D%2C%20bgrid%2C%20%7B2%7D%5D%3B%0A%20%20%0A%20%20bfps%20%3D%20%28%2AFB%5B%2A%29%28%28%28bfps%20%2B%201%20%2F%20%28AbsoluteTime%5B%5D%20-%20btime%29%29%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29%20%2F%2F%20Round%3B%0A%20%20btime%20%3D%20AbsoluteTime%5B%5D%3B%20%0A%5D%5D%3B%0A%0A%0AWith%5B%7B%0A%20%20win%20%3D%20CurrentWindow%5B%5D%2C%20%28%2ABB%5B%2A%29%28%2A%20save%20the%20current%20window%20to%20append%20graphics%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20currentCell%20%3D%20ResultCell%5B%5D%2C%0A%20%20canvasId%20%3D%20CreateUUID%5B%5D%0A%7D%2C%0A%0A%20%20EventHandler%5Bwin%2C%20%7B%22Closed%22%20-%3E%20Function%5BNull%2C%0A%20%20%20%20Delete%5BcurrentCell%5D%20%28%2ABB%5B%2A%29%28%2A%20remove%20output%20cell%20if%20a%20notebook%20has%20been%20closed%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20this%20will%20prevent%20the%20animation%20running%20uncontrollably%20on%20the%20next%20start%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%5D%7D%5D%3B%0A%0A%20%20Graphics%5B%7B%0A%20%20%20%20Table%5BWith%5B%7Bi%3Di%2C%20j%3Dj%7D%2C%20%0A%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20now%20we%20have%20dynamic%20Hue%20and%20dynamic%20Arrow%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20Offload%5B%7B%20%0A%20%20%20%20%20%20%20%20Hue%5Bbcolors%5B%5Bi%5D%5D%5B%5Bj%5D%5D%5D%2C%0A%20%20%20%20%20%20%20%20Arrow%5B%7B%7Bi%2Cj%7D%2C%20%7Bi%2Cj%7D%20%2B%20%20bgrid%5B%5Bi%5D%5D%5B%5Bj%5D%5D%7D%5D%0A%20%20%20%20%20%20%7D%5D%20%0A%20%20%20%20%0A%20%20%20%20%5D%2C%20%7Bi%2C15%7D%2C%20%7Bj%2C15%7D%5D%2C%0A%0A%20%20%20%20EventHandler%5BGraphics%60Canvas%5B%5D%2C%20mouseHandler%5Bbgrid%2C%20win%2C%20MetaMarker%5BcanvasId%5D%5D%5D%2C%20%0A%0A%20%20%20%20%28%2ABB%5B%2A%29%28%2Async%20with%20browser%27s%20repaint%20cycle%20and%20update%20of%20fps%20label%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20AnimationFrameListener%5Bbfps%20%2F%2F%20Offload%2C%20%22Event%22-%3E%22bframe%22%5D%2C%20%0A%20%20%20%20%28%2ABB%5B%2A%29%28%2Amark%20this%20instance%20of%20Graphics%20with%20uid%20to%20append%20new%20elements%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20MetaMarker%5BcanvasId%5D%2C%20%0A%20%20%20%20Text%5Bbfps%20%2F%2F%20Offload%2C%20%7B0%2C0%7D%5D%0A%20%20%7D%2C%20%0A%20%20%20%20Controls-%3EFalse%2C%20%0A%20%20%20%20ImageSize-%3E500%2C%20%0A%20%20%20%20PlotRange-%3E%7B%7B-0.5%2C15.5%7D%2C%20%7B-0.5%2C15.5%7D%7D%2C%20%0A%20%20%20%20ImagePadding-%3ENone%2C%20%0A%20%20%20%20TransitionType-%3ENone%0A%20%20%5D%0A%5D%0A`}</WLJSEditor>\\n\\nThe code can be divided into two parts: *visualization using Graphics and Arrow* and *calculation loop*.\\n\\nAs we discussed before, we draw each point from a grid individually with a pair of `Hue` and `Arrow`. At the same place, we attach listeners to the `Graphics` canvas to capture mouse clicks and movements to modify the velocity field.\\n\\nAnimation is done using `AnimationFrameListener` coupled to `fpsLabel`, which works as a trigger to a new frame. It serves two goals:\\n1. Sync animation with the browser\'s repaint cycle.\\n2. Do not start a new frame until the data is ready, which is indicated by `fpsLabel`. It can also be `grid`, but since `fpsLabel` is the last symbol to be updated before a new frame, we have chosen it to be a trigger.\\n\\nThen, before a new frame, it fires an event object with `\\"bframe\\"` uid, which is captured later by `EventHandler`. In the animation loop, it removes divergence, recalculates colors, and then also updates the FPS counter just for the statistics.\\n\\nAn expected result is shown on a GIF below \\n\\n\\nimport testVideo from \'./attachments/testVideo.mov\';\\n\\n<video width={\\"100%\\"} controls>\\n  <source src={testVideo}/>\\n</video>\\n\\nIt is quite far from an actual fluid simulation. We should also consider the momentum of it.\\n\\n__See you in Part 2__ \ud83e\udd84"},{"id":"/2024/07/12/maxwell","metadata":{"permalink":"/wljs-docs/blog/2024/07/12/maxwell","source":"@site/blog/2024-07-12-maxwell/index.mdx","title":"1D FDTD Method","description":"Solving Maxwell\'s equation for 1D case with two interfaces.","date":"2024-07-12T00:00:00.000Z","tags":[{"label":"numerics","permalink":"/wljs-docs/blog/tags/numerics"}],"readingTime":0.6,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["numerics"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Real-time Fluid Simulation Part 1","permalink":"/wljs-docs/blog/2024/08/18/fluid-1"},"nextItem":{"title":"Mesh region with Rick Astley","permalink":"/wljs-docs/blog/2024/07/10/rick"}},"content":"Solving Maxwell\'s equation for 1D case with two interfaces.\\nBased on the work of __John B. Schneider__ *\\"Understanding the Finite-Difference Time-Domain Method\\"* 2023 we will try to solve 1D Maxwell\'s equation for electro-magnetic wave propagating through a non-dispersive plate\\n\\n\x3c!--truncate--\x3e\\n\\nimport { WLJSHTML, WLJSEditor, WLJSStore } from \\"@site/src/components/wljs-reactcells\\";\\n\\n\\n\\n<WLJSStore kernel={require(\'./attachments/kernel.txt\').default} json={require(\'./attachments/d7fef5b9-b8f4-480b-adb2-e8b9ea3c262c.txt\').default} notebook={require(\'./attachments/notebook-d7f.wln\').default}/>\\n\\n\\n\\n\\nDefine constants\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"d7fef5b9-b8f4-480b-adb2-e8b9ea3c262c\\"} id={\\"49e93c53-112c-44c1-a227-cf443648f664\\"} type={\\"Input\\"} opts={{}} >{`%CE%B6%20%3D%20377.0%3B%20%28%2ABB%5B%2A%29%28%2AOhm%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0Asize%20%3D%20400%3B%0A%0Aez%20%3D%20ConstantArray%5B0.%2C%20%7Bsize%7D%5D%3B%0Ahy%20%3D%20ConstantArray%5B0.%2C%20%7Bsize%7D%5D%3B%0A%0Ac%CE%BC%20%3D%20ConstantArray%5B%CE%B6%2C%20%20%20%7Bsize%7D%5D%3B%0Ac%CF%B5%20%3D%20ConstantArray%5B1.%2C%20%20%7Bsize%7D%5D%3B%0A%0A%28%2ABB%5B%2A%29%28%2ADefine%20a%20second%20medium%20with%20losses%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%0Ac%CF%B5%5B%5B200%3B%3B220%5D%5D%20%3D%20%28%2AFB%5B%2A%29%28%28%281%20-%200.001%29%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%28%281%20%2B%200.001%29%29%29%28%2A%5DFB%2A%29%3B%0Ac%CE%BC%5B%5B200%3B%3B220%5D%5D%20%3D%20%28%2AFB%5B%2A%29%28%28%CE%B6%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%289.0%29%29%28%2A%5DFB%2A%29%20%2F%20%281%20%2B%200.001%29%3B%0A%0Agenerator%20%3D%20With%5B%7Bie%20%3D%20size%7D%2C%20Compile%5B%7B%7Bsteps%2C%20_Integer%7D%7D%2C%0A%20%20%20%20Module%5B%0A%20%20%20%20%20%7Bez%20%3D%20ez%2C%20hy%20%3D%20hy%7D%2C%0A%20%20%20%20%20Do%5B%0A%0A%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2ACalculate%20magnetic%20field%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%20%20Do%5B%0A%20%20%20%20%20%20%20%20%20%20%20hy%5B%5Bj%5D%5D%20%2B%3D%20%28%2AFB%5B%2A%29%28%28%28ez%5B%5Bj%20%2B%201%5D%5D%20-%20ez%5B%5Bj%5D%5D%29%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%28%CE%B6%29%29%28%2A%5DFB%2A%29%3B%0A%20%20%20%20%20%20%20%20%2C%20%7Bj%2C%201%2C%20ie-1%7D%5D%3B%0A%0A%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2ABoundary%20conditions%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%20%20hy%5B%5Bie%5D%5D%20%3D%20hy%5B%5Bie-1%5D%5D%3B%0A%20%20%20%20%20%20%20%20ez%5B%5Bie%5D%5D%20%3D%20ez%5B%5Bie-1%5D%5D%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2APulse%20generator%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%20%20hy%5B%5B49%5D%5D%20-%3D%20Exp%5B-%20%28%2AFB%5B%2A%29%28%28%28%2ASpB%5B%2A%29Power%5B%28n%20-%2030.%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%28100.%29%29%28%2A%5DFB%2A%29%5D%20%2F%20%CE%B6%3B%0A%0A%20%20%20%20%20%20%20%20ez%5B%5B1%5D%5D%20%3D%20ez%5B%5B2%5D%5D%3B%0A%0A%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2ACalculate%20electric%20field%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%20%20Do%5B%0A%20%20%20%20%20%20%20%20%20%20ez%5B%5Bj%5D%5D%20%3D%20c%CF%B5%5B%5Bj%5D%5D%20ez%5B%5Bj%5D%5D%20%2B%20c%CE%BC%5B%5Bj%5D%5D%20%28hy%5B%5Bj%5D%5D%20-%20hy%5B%5Bj%20-%201%5D%5D%29%0A%20%20%20%20%20%20%20%20%2C%20%7Bj%2C%202%2C%20ie%20-%201%7D%5D%3B%0A%0A%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2APulse%20generator%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%20%20ez%5B%5B50%5D%5D%20%2B%3D%20Exp%5B-%20%28%2AFB%5B%2A%29%28%28%28%2ASpB%5B%2A%29Power%5B%28n%20%2B%200.5%20-%20%28-0.5%29%20-%2030.%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%28100.0%29%29%28%2A%5DFB%2A%29%5D%3B%0A%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%2C%20%7Bn%2C%20steps%7D%5D%3B%20ez%5D%2C%0A%20%20%20%20CompilationOptions%20-%3E%20%7B%22InlineExternalDefinitions%22%20-%3E%20True%7D%2C%20%0A%20%20%20%20%22CompilationTarget%22%20-%3E%20%22C%22%2C%20%22RuntimeOptions%22%20-%3E%20%22Speed%22%5D%5D%3B`}</WLJSEditor>\\n\\nPlot as a function of x-coordinate\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"d7fef5b9-b8f4-480b-adb2-e8b9ea3c262c\\"} id={\\"c774fe84-a1d1-4d31-b37b-34f427646bbc\\"} type={\\"Input\\"} opts={{}} >{`electricField%20%3D%20%7BRange%5B400%5D%2C%20generator%5B3%5D%7D%20%2F%2F%20Transpose%3B%0AGraphics%5B%0A%20%20Line%5BelectricField%20%2F%2F%20Offload%5D%2C%20%0A%20%20PlotRange-%3E%7B%7B0%2C400%7D%2C%20%7B-1%2C1%7D%7D%2C%20%0A%20%20TransitionDuration-%3E5%0A%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"d7fef5b9-b8f4-480b-adb2-e8b9ea3c262c\\"} id={\\"99af2ed7-d26e-4f25-b16b-6cbe0645dba5\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%22c163d4ea-9002-4a25-a9f0-9e37f0a858d1%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKJxuaGaeYpCbqWhoYGOmaJBqZ6iZaphnoWqYam6cZJFqYWqQYAgCBDhVu%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\n*Try to drag this slider \ud83d\ude09*\\n\\nManipulate the time\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"d7fef5b9-b8f4-480b-adb2-e8b9ea3c262c\\"} id={\\"08b2d590-111b-4eb2-81be-2f8bd8f5d291\\"} type={\\"Input\\"} opts={{}} >{`EventHandler%5BInputRange%5B1%2C800%2C20%2C1%5D%2C%20Function%5Bval%2C%20%0A%20%20electricField%20%3D%20%7BRange%5B400%5D%2C%20generator%5Bval%5D%7D%20%2F%2F%20Transpose%3B%0A%5D%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"d7fef5b9-b8f4-480b-adb2-e8b9ea3c262c\\"} id={\\"3d3a9ff1-7e3b-4210-8d37-2895cee0a3fc\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28EventObject%5B%3C%7C%22Id%22%20-%3E%20%2297462fa3-8bc0-472a-919b-54cc650eacf1%22%2C%20%22Initial%22%20-%3E%201%2C%20%22View%22%20-%3E%20%22f294fa8d-e0cd-416c-9be1-baffe32749b6%22%7C%3E%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKpxlZmqQlWqTophokp%2BiaGJol61ompRrqJiWmpaUaG5mbWCaZAQCVOxZr%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nCongratulations! \ud83e\udd42 Now you know how to solve 1D Maxwell\'s equation with an arbitary boundary conditions!"},{"id":"/2024/07/10/rick","metadata":{"permalink":"/wljs-docs/blog/2024/07/10/rick","source":"@site/blog/2024-07-10-rick/index.mdx","title":"Mesh region with Rick Astley","description":"A example of creating and using boundary mesh for solving equations on them.","date":"2024-07-10T00:00:00.000Z","tags":[{"label":"numerics","permalink":"/wljs-docs/blog/tags/numerics"}],"readingTime":0.495,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["numerics"],"enableComments":true},"unlisted":false,"prevItem":{"title":"1D FDTD Method","permalink":"/wljs-docs/blog/2024/07/12/maxwell"},"nextItem":{"title":"Realtime Finite Elements Method","permalink":"/wljs-docs/blog/2024/06/20/fem"}},"content":"A example of creating and using boundary mesh for solving equations on them.\\n\\n\\n\x3c!--truncate--\x3e\\n\\nimport { WLJSHTML, WLJSEditor, WLJSStore } from \\"@site/src/components/wljs-reactcells\\";\\n\\n\\n\\n<WLJSStore json={require(\'./attachments/98460e8c-38ee-4b26-aa89-ab41cb1930fb.txt\').default} notebook={require(\'./attachments/notebook-984.wln\').default}/>\\n\\n\\n\\n\\nSmile!\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"98460e8c-38ee-4b26-aa89-ab41cb1930fb\\"} id={\\"65c549da-2029-4aa9-8b6a-24ff9d382f98\\"} type={\\"Input\\"} opts={{}} >{`img%20%3D%20%28%2AVB%5B%2A%29%28FrontEndRef%5B%22438babff-4e1b-415b-ba6b-edeb3d6f288f%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKmxhbJCUmpaXpmqQaJumaGJom6SYlmiXppqakJhmnmKUZWVikAQCXhRbB%22%2A%29%28%2A%5DVB%2A%29%3B`}</WLJSEditor>\\n\\nApply a filter\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"98460e8c-38ee-4b26-aa89-ab41cb1930fb\\"} id={\\"99e0cd41-7a4b-4f4e-a8a9-e6c8de22d0a6\\"} type={\\"Input\\"} opts={{}} >{`MeanShiftFilter%5Bimg%2C%205%2C%201%5D%20%2F%2F%20Binarize%20%2F%2F%20ColorNegate`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"98460e8c-38ee-4b26-aa89-ab41cb1930fb\\"} id={\\"fee61e9b-ff0b-4e74-b084-ef36c3adfdd6\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%2215a0967d-a941-4e65-a420-fb082f4c1fcb%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG5omGliamafoJlqaGOqapJqZ6iaaGBnopiUZWBilmSQbpiUnAQB6nhWZ%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nCreate a mesh region\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"98460e8c-38ee-4b26-aa89-ab41cb1930fb\\"} id={\\"324fa874-1cf3-4a78-bea4-079e59d10626\\"} type={\\"Input\\"} opts={{}} >{`%CE%BE%20%3D%20ImageMesh%5B%25%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"98460e8c-38ee-4b26-aa89-ab41cb1930fb\\"} id={\\"c8ba7a2d-bd5c-426a-add1-55c40c1745df\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28temporal%24303081%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKm6aam6dZGiXrmhunWuqamFsm61pYGKfqGqUkpRklG1okJxonAgCDyBXq%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nCompute eigenfunctiions of the wave equation\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"98460e8c-38ee-4b26-aa89-ab41cb1930fb\\"} id={\\"3e8908be-55a4-4d53-96a3-54b813064069\\"} type={\\"Input\\"} opts={{}} >{`%7Bvals%2C%20funs%7D%20%3D%20NDEigensystem%5B%0A%20%20%20%7B-Laplacian%5Bu%5Bx%2C%20y%5D%2C%20%7Bx%2C%20y%7D%5D%2C%20%0A%20%20%20%20DirichletCondition%5Bu%5Bx%2C%20y%5D%20%3D%3D%200%2C%20True%5D%7D%2C%20%0A%20%20%20u%5Bx%2C%20y%5D%2C%20Element%5B%7Bx%2C%20y%7D%2C%20%CE%BE%5D%2C%206%5D%3B`}</WLJSEditor>\\n\\nPlot different time slots\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"98460e8c-38ee-4b26-aa89-ab41cb1930fb\\"} id={\\"b7371e1e-931c-4dc6-9bbf-a36993519b68\\"} type={\\"Input\\"} opts={{}} >{`Grid%40%0A%20Partition%5B%0A%20%20Table%5BContourPlot%5Bfuns%5B%5Bi%5D%5D%2C%20Element%5B%7Bx%2C%20y%7D%2C%20%CE%BE%5D%2C%20%0A%20%20%20%20PlotRange%20-%3E%20All%2C%20ImageSize-%3E300%2C%20PerformanceGoal-%3E%22Speed%22%2C%20PlotLabel%20-%3E%20vals%5B%5Bi%5D%5D%2C%20%0A%20%20%20%20PlotTheme%20-%3E%20%22Minimal%22%5D%2C%20%7Bi%2C%20Length%5Bvals%5D%7D%5D%2C%203%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"98460e8c-38ee-4b26-aa89-ab41cb1930fb\\"} id={\\"f1e80932-479d-4dde-b762-738e9beac5f3\\"} type={\\"Output\\"} opts={{}} >{`%28%2AGB%5B%2A%29%7B%7B%28%2AVB%5B%2A%29%28FrontEndRef%5B%22d8c846b4-e03d-4933-af0d-5c0c607865b9%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKp1gkW5iYJZnophoYp%2BiaWBob6yamGaTomiYbJJsZmFuYmSZZAgCE%2FxV6%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28FrontEndRef%5B%22522b14a5-a144-4f98-93d4-ef618e74613d%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKmxoZJRmaJJrqJhqamOiapFla6Foap5jopqaZGVqkmpuYGRqnAAB4SBUa%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28FrontEndRef%5B%22ad1adb3d-e6aa-408e-9045-805e8be7e425%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKJ6YYJqYkGafoppolJuqaGFik6loamJjqWhiYplokpZqnmhiZAgCVWBX%2F%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28FrontEndRef%5B%221f6981c5-081b-49a0-b3ab-6412a3e17980%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG6aZWVoYJpvqGlgYJumaWCYa6CYZJybpmpkYGiUapxqaW1oYAAB6pxUK%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28FrontEndRef%5B%2298ffe6b3-a454-41e8-a875-98af8e9c6475%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKW1qkpaWaJRnrJpqYmuiaGKZa6CZamJvqWlokplmkWiabmZibAgCH8xWc%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28FrontEndRef%5B%22af9fc913-cfc6-4f29-a194-c65a20e7b129%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKJ6ZZpiVbGhrrJqclm%2BmapBlZ6iYaWproJpuZJhoZpJonGRpZAgCRcRXa%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29`}</WLJSEditor>"},{"id":"/2024/06/20/fem","metadata":{"permalink":"/wljs-docs/blog/2024/06/20/fem","source":"@site/blog/2024-06-20-fem/index.mdx","title":"Realtime Finite Elements Method","description":"Here we will solve simple 2D wave-equation and visualize it in realtime using polygons","date":"2024-06-20T00:00:00.000Z","tags":[{"label":"visualization","permalink":"/wljs-docs/blog/tags/visualization"},{"label":"animation","permalink":"/wljs-docs/blog/tags/animation"}],"readingTime":1.085,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["visualization","animation"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Mesh region with Rick Astley","permalink":"/wljs-docs/blog/2024/07/10/rick"},"nextItem":{"title":"\\"Atom\\" animation","permalink":"/wljs-docs/blog/2024/05/26/atom"}},"content":"Here we will solve simple 2D wave-equation and visualize it in realtime using polygons\\n\\n\x3c!--truncate--\x3e\\n\\nimport { WLJSHTML, WLJSEditor, WLJSStore } from \\"@site/src/components/wljs-reactcells\\";\\n\\n\\n\\n<WLJSStore kernel={require(\'./attachments/kernel.txt\').default} json={require(\'./attachments/2c9ff17a-19f8-4afa-9af7-523cc11e2a29.txt\').default} notebook={require(\'./attachments/notebook-2c9.wln\').default}/>\\n\\n\\n\\n\\n## Initialize mesh\\n50x50 equally distributed points on 2D plane\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"2c9ff17a-19f8-4afa-9af7-523cc11e2a29\\"} id={\\"1cf13737-8d0f-44fd-acb8-c60521344aff\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`field0%20%3D%20Table%5B0.%2C%20%7Bi%2C50%7D%2C%20%7Bj%2C50%7D%5D%3B%0Afield1%20%3D%20field0%3B%0Afield2%20%3D%20field0%3B%0A%0A%28%2A%20initial%20perturbation%20%2A%29%0Afield2%5B%5B25%2C25%5D%5D%20%3D%200.01%3B%0A%0Alattice%20%3D%20Table%5B%7Bi%2Cj%7D%2C%20%7Bi%2C%2050%7D%2C%20%7Bj%2C50%7D%5D%3B%0Amesh%20%3D%20Flatten%5Blattice%2C%201%5D%3B%0A%0AmakeVertices%20%3D%20Compile%5B%7B%7Bf%2C%20_Real%2C%202%7D%2C%20%7Bpairs%2C%20_Integer%2C%202%7D%2C%20%7Bscale%2C%20_Real%7D%7D%2C%0A%20%20Join%5B%23%2C%20%7Bscale%20f%5B%5B%23%5B%5B1%5D%5D%2C%20%23%5B%5B2%5D%5D%5D%5D%7D%5D%20%26%2F%40%20pairs%0A%5D%3B%0A%0Avertices%20%3D%20NumericArray%5BmakeVertices%5Bfield0%2C%20mesh%2C%20300%5D%5D%3B`}</WLJSEditor>\\n\\n## Triangulation\\nThis is necessary for plotting the data using 3D polygons. That we keep indexes of all polygons the same, but will update vertices\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"2c9ff17a-19f8-4afa-9af7-523cc11e2a29\\"} id={\\"12f685c3-e6ec-42c6-a1f3-6e2bca69cda0\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`Needs%5B%22ComputationalGeometry%60%22%5D%3B%0Atriangles2%5Bpoints_%5D%20%3A%3D%20Module%5B%7Btr%2C%20triples%7D%2C%0A%20%20tr%20%3D%20DelaunayTriangulation%5Bpoints%5D%3B%0A%20%20triples%20%3D%20Flatten%5BFunction%5B%7Bv%2C%20list%7D%2C%0A%20%20%20%20%20%20Switch%5BLength%5Blist%5D%2C%0A%20%20%20%20%20%20%20%20%28%2A%20account%20for%20nodes%20with%20connectivity%202%20or%20less%20%2A%29%0A%20%20%20%20%20%20%20%201%2C%20%7B%7D%2C%0A%20%20%20%20%20%20%20%202%2C%20%7BFlatten%5B%7Bv%2C%20list%7D%5D%7D%2C%20%0A%20%20%20%20%20%20%20%20_%2C%20%7Bv%2C%20%23%23%7D%20%26%20%40%40%40%20Partition%5Blist%2C%202%2C%201%2C%20%7B1%2C%201%7D%5D%0A%20%20%20%20%20%20%5D%0A%20%20%20%20%5D%20%40%40%40%20tr%2C%201%5D%3B%0A%20%20Cases%5BGatherBy%5Btriples%2C%20Sort%5D%2C%20a_%20%2F%3B%20Length%5Ba%5D%20%3D%3D%203%20%3A%3E%20a%5B%5B1%5D%5D%5D%5D%0A%0Atriangles%20%3D%20triangles2%5Bmesh%5D%3B`}</WLJSEditor>\\n\\nLet us check the result\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"2c9ff17a-19f8-4afa-9af7-523cc11e2a29\\"} id={\\"dd1cd9cf-4a18-400f-8a01-aad683ccb11a\\"} type={\\"Input\\"} opts={{}} >{`ListPlot%5Bmesh%2C%20PlotStyle-%3E%7BRed%2C%20PointSize%5B0.01%5D%7D%2C%20Prolog-%3E%7BLine%5Bmesh%5B%5B%23%5D%5D%5D%20%26%2F%40%20triangles%7D%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"2c9ff17a-19f8-4afa-9af7-523cc11e2a29\\"} id={\\"0317f700-a6fa-4087-9f37-debe5c02764d\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%2251f56b92-40e0-47fb-8b1a-9df9b700dd1d%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKmxqmmZolWRrpmhikGuiamKcl6VokGSbqWqakWSaZGxikpBimAACAORXR%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\n## Define our equation\\nThis is discretization of a wave-equation in a form\\n\\n$$\\n\\\\partial^2_{t,t} f - \\\\alpha^2 \\\\nabla^2 f = 0\\n$$\\n\\nwe follows [the following](https://beltoforion.de/en/recreational_mathematics/2d-wave-equation.php) tutorial and rewrite it in a form\\n\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"2c9ff17a-19f8-4afa-9af7-523cc11e2a29\\"} id={\\"a3d98e7a-8144-48ea-a729-f8c9fd8ab9ff\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`update%20%3D%20Compile%5B%7B%7Bi%2C%20_Integer%7D%2C%20%7Bj%2C%20_Integer%7D%2C%20%7Bf%2C%20_Real%2C%202%7D%2C%20%7Bp%2C%20_Real%2C%202%7D%7D%2C%20%0A%20%200.001%20%28If%5Bi-1%20%3E%200%2C%20f%5B%5Bi-1%2C%20j%5D%5D%2C%200%5D%20%2B%20If%5Bi%2B1%20%3C%2051%2C%20f%5B%5Bi%2B1%2C%20j%5D%5D%2C%200%5D%20%2B%20If%5Bj%2B1%3C51%2C%20f%5B%5Bi%2C%20j%2B1%5D%5D%2C%200%5D%20%2B%20If%5Bj-1%20%3E%200%2C%20f%5B%5Bi%2C%20j-1%5D%5D%2C%200%5D%20-%204%20f%5B%5Bi%2Cj%5D%5D%29%0A%2B%202%20f%5B%5Bi%2Cj%5D%5D%20-%20p%5B%5Bi%2Cj%5D%5D%0A%5D%3B`}</WLJSEditor>\\n\\nUpdate function calculated a new value at vertex $\\\\{i,j\\\\}$. \\n\\n## Realtime modelling\\nFor displaying we use simple `Polygon` and `GraphicsComplex`\\n\\n<WLJSHTML>{`%3Cspan%20style%3D%22color%3Ared%22%3ERun%20the%20cell%20below%20after%3C%2Fspan%3E`}</WLJSHTML> __evaluation of the initialization cells__\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"2c9ff17a-19f8-4afa-9af7-523cc11e2a29\\"} id={\\"0beef6ce-d1c8-4b8c-90ce-575dc77fc3bc\\"} type={\\"Input\\"} opts={{}} >{`Graphics3D%5B%7BShadows%5BTrue%5D%2C%20SpotLight%5BBlue%2C%20%7B2.4463%2C%2060.1604%2C%209.3104%7D%2C%201.5%2C%203000%5D%2C%20SpotLight%5BRed%2C%20%7B48.1378%2C%2047.8679%2C%2012.4545%7D%2C%201.5%2C%203000%5D%2C%20%0A%20%20Roughness%5B0%5D%2C%0A%20%20GraphicsComplex%5Bvertices%20%2F%2F%20Offload%2C%20Polygon%5Btriangles%5D%5D%2C%0A%20%20AnimationFrameListener%5Bvertices%20%2F%2F%20Offload%2C%20%22Event%22%20-%3E%20%22frame%20calc%22%5D%0A%7D%2C%20ImageSize-%3E500%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"2c9ff17a-19f8-4afa-9af7-523cc11e2a29\\"} id={\\"de5db1b4-3bcd-4500-bb8b-7aa6777f26cd\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%2293deb6c9-ae46-42de-b1aa-0dd3fdbb85eb%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKWxqnpCaZJVvqJqaamOmaGKWk6iYZJibqGqSkGKelJCVZmKYmAQCW7Bbt%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\n*try to pan and zoom it ! \ud83d\ude09*\\n\\nNow we wrap our calculations into a animation cycle\\n\\n__Evaluate this if animation did not start__\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"2c9ff17a-19f8-4afa-9af7-523cc11e2a29\\"} id={\\"92f538ed-02ba-4fc5-9457-211c0a040962\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`%28%2ABB%5B%2A%29%28%2Areset%20again%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0Afield0%20%3D%20Table%5B0.%2C%20%7Bi%2C50%7D%2C%20%7Bj%2C50%7D%5D%3B%0Afield1%20%3D%20field0%3B%0Afield2%20%3D%20field0%3B%0A%0A%28%2A%20initial%20perturbation%20%2A%29%0Afield2%5B%5B25%2C25%5D%5D%20%3D%200.01%3B%0A%0AEventHandler%5B%22frame%20calc%22%2C%20Function%5BNull%2C%20%0A%0A%20%20With%5B%7Bi%20%3D%20%23%5B%5B1%5D%5D%2C%20j%20%3D%20%23%5B%5B2%5D%5D%7D%2C%20%0A%20%20%20%20field0%5B%5Bi%2Cj%5D%5D%20%3D%20update%5Bi%2Cj%2C%20field1%2C%20field2%5D%3B%0A%20%20%5D%26%2F%40%20RandomSample%5Bmesh%5D%3B%0A%20%20%0A%20%20field2%20%3D%20field1%3B%0A%20%20field1%20%3D%20field0%3B%0A%20%20%0A%20%20vertices%20%3D%20NumericArray%5BmakeVertices%5Bfield0%2C%20mesh%2C%20300%5D%5D%3B%0A%0A%5D%5D%3B%0A%0A%28%2ABB%5B%2A%29%28%2Akickstarter%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0AEventFire%5B%22frame%20calc%22%2C%20True%5D%3B`}</WLJSEditor>\\n\\nTo stop it\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"2c9ff17a-19f8-4afa-9af7-523cc11e2a29\\"} id={\\"d86b0847-d000-4f20-82ed-c749571a6a86\\"} type={\\"Input\\"} opts={{}} >{`EventRemove%5B%22frame%20calc%22%5D%20`}</WLJSEditor>"},{"id":"/2024/05/26/atom","metadata":{"permalink":"/wljs-docs/blog/2024/05/26/atom","source":"@site/blog/2024-05-26-atom.md","title":"\\"Atom\\" animation","description":"Here is a short code snippet for atom (artistic-vision) animation","date":"2024-05-26T00:00:00.000Z","tags":[{"label":"animation","permalink":"/wljs-docs/blog/tags/animation"},{"label":"short","permalink":"/wljs-docs/blog/tags/short"}],"readingTime":0.7,"hasTruncateMarker":true,"authors":[{"name":"Kirill Belov","title":"Maintainer","url":"https://github.com/KirillBelovTest","imageURL":"https://avatars.githubusercontent.com/u/16749283?v=4","key":"kirillbelovtest"}],"frontMatter":{"authors":"kirillbelovtest","tags":["animation","short"],"title":"\\"Atom\\" animation","enableComments":true},"unlisted":false,"prevItem":{"title":"Realtime Finite Elements Method","permalink":"/wljs-docs/blog/2024/06/20/fem"},"nextItem":{"title":"THz Time-domain modelling","permalink":"/wljs-docs/blog/2024/05/20/thz-model"}},"content":"Here is a short code snippet for atom (artistic-vision) animation\\n\\n![](./______Clipchamp_4-ezgif.com-optimize.gif)\\n\\n\x3c!--truncate--\x3e\\n\\n```mathematica\\npath1 = Table[{5 * Sin[t], 5 * Cos[t], 0}, {t, 0.0, 8*Pi, Pi/360.0}]; \\nlight1 = path1[[1]]; \\n\\npath2 = RotationTransform[2Pi/3, {1, 0, 0}] /@ path1; \\nlight2 = path2[[1]]; \\n\\npath3 = RotationTransform[4Pi/3, {1, 0, 1}] /@ path1; \\nlight3 = path3[[1]];\\n```\\n\\n```mathematica\\nGraphics3D[{  \\n  {  \\n    MeshMaterial[MeshPhysicalMaterial[]],   \\n    Roughness[0.1],   \\n    Sphere[]  \\n  },   \\n  {  \\n    PointLight[Cyan, Offload @ light1],   \\n    PointLight[Magenta, Offload @ light2],   \\n    PointLight[Orange, Offload @ light3]  \\n  },   \\n  {  \\n    Emissive[Cyan, 5], Sphere[Offload @ light1, 0.1],   \\n    Emissive[Magenta, 5], Sphere[Offload @ light2, 0.1],   \\n    Emissive[Orange, 5], Sphere[Offload @ light3, 0.1]  \\n  },   \\n  {  \\n    LightBlue, Line[path1],   \\n    LightRed, Line[path2],   \\n    LightGreen, Line[path3]  \\n  }  \\n},   \\n  ImageSize -> 1200,   \\n  PlotRange -> {{-10, 10}, {-10, 10}, {-10, 10}},   \\n  Lighting -> None  \\n]\\n```\\n\\n```mathematica\\nt := Mod[Round[AbsoluteTime[] * 100] + 1, Length[path1]]\\n\\nSetInterval[\\n  light1 = path1[[t]]; \\n  light2 = path2[[t]]; \\n  light3 = path3[[t]]; \\n, 10]\\n```"},{"id":"/2024/05/20/thz-model","metadata":{"permalink":"/wljs-docs/blog/2024/05/20/thz-model","source":"@site/blog/2024-05-20-thz-model/index.mdx","title":"THz Time-domain modelling","description":"Using a single Lorentz-Oscillator model we model the responce of a materials with a variable thickneses","date":"2024-05-20T00:00:00.000Z","tags":[{"label":"numerics","permalink":"/wljs-docs/blog/tags/numerics"}],"readingTime":0.63,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["numerics"],"enableComments":true},"unlisted":false,"prevItem":{"title":"\\"Atom\\" animation","permalink":"/wljs-docs/blog/2024/05/26/atom"},"nextItem":{"title":"Triangulation and basics of dynamic polygons","permalink":"/wljs-docs/blog/2024/05/15/triangulation-polygons"}},"content":"Using a single Lorentz-Oscillator model we model the responce of a materials with a variable thickneses\\n\\n\x3c!--truncate--\x3e\\n\\nimport { WLJSHTML, WLJSEditor, WLJSStore } from \\"@site/src/components/wljs-reactcells\\";\\n\\n\\n\\n<WLJSStore kernel={require(\'./attachments/kernel.txt\').default} json={require(\'./attachments/03244e35-6412-4d23-a923-4235220462cb.txt\').default} notebook={require(\'./attachments/notebook-032.wln\').default}/>\\n\\n\\n\\n\\nEvaluate __initialization cells first__\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"03244e35-6412-4d23-a923-4235220462cb\\"} id={\\"5dca819e-a8e3-4a31-84c1-0fce3272e540\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`f%5B%CF%89_%2C%20eps_%2C%20%CF%890_%2C%20%CF%89p_%2C%20%CE%B3_%5D%20%3A%3D%20eps%20%2B%20%28%2AFB%5B%2A%29%28%28%28%2ASpB%5B%2A%29Power%5B%CF%89p%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%28%28%2ASpB%5B%2A%29Power%5B%CF%890%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20-%20%28%2ASpB%5B%2A%29Power%5B%CF%89%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20I%20%CE%B3%20%CF%89%29%29%28%2A%5DFB%2A%29`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"03244e35-6412-4d23-a923-4235220462cb\\"} id={\\"7e95fcef-ff3a-4ed3-aa30-90fc05a47e8f\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`n%5B%CF%89_%2C%20params__%5D%20%3A%3D%20%28%2ASqB%5B%2A%29Sqrt%5Bf%5B%CF%89%2C%20params%5D%5D%28%2A%5DSqB%2A%29%0A%0Ae%5B%CF%89_%2C%20L_%2C%20params__%5D%20%3A%3D%20Exp%5B-%20%28%2AFB%5B%2A%29%28%28I%202%CF%80%20%28%2ASpB%5B%2A%29Power%5B10%28%2A%7C%2A%29%2C%28%2A%7C%2A%2912%5D%28%2A%5DSpB%2A%29%20%CF%89%20n%5B%CF%89%2C%20params%5D%20L%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%28c%20cm2THz%29%29%28%2A%5DFB%2A%29%20%5D%20%2F.%7Bc%20-%3E%203.0%20%28%2ASpB%5B%2A%29Power%5B10%28%2A%7C%2A%29%2C%28%2A%7C%2A%2910%5D%28%2A%5DSpB%2A%29%2C%20cm2THz%20-%3E%2033.4%7D`}</WLJSEditor>\\n\\nMaterial parameters ($n$ and $\\\\kappa$)\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"03244e35-6412-4d23-a923-4235220462cb\\"} id={\\"cf31dc3f-0a48-43ee-b697-946baa13d6b7\\"} type={\\"Input\\"} opts={{}} >{`Plot%5Bn%5Bx%2C%209.8%2C%2028.66%2C%2015%2C%201.5%5D%20%2F%2F%20ReIm%20%2F%2F%20Evaluate%2C%20%7Bx%2C28.66%20-%2020%2C%2028.66%20%2B%2020%7D%2C%20%0A%20%20FrameLabel-%3E%7B%22wavenumber%20%28cm%5E%7B-1%7D%29%22%7D%2C%20Frame-%3ETrue%0A%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"03244e35-6412-4d23-a923-4235220462cb\\"} id={\\"36f0ecd2-d959-476a-a689-a8b886a77f22\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%22061e0ba5-ee09-492d-88fe-801fe1ab75b8%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG5gZphokJZrqpqYaWOqaWBql6FpYpKXqWhgYpqUaJiaZmyZZAACFChXW%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nA responce of a material to a short pulse ($\\\\delta$ - function)\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"03244e35-6412-4d23-a923-4235220462cb\\"} id={\\"261d2bf5-4bbf-4ed4-86ad-cc0819f20a16\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`tds%5Bparams__%5D%20%3A%3D%20%28Join%5B%23%2C%20Reverse%5B%23%5D%5D%20%26%40%20Table%5Be%5B%CF%89%2C%20params%5D%2C%20%7B%CF%89%2C%200%2C100%2C0.1%7D%5D%29%20%2F%2F%20Fourier`}</WLJSEditor>\\n\\nMake it interactive\\n\\n*evaluate this after initialization cells*\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"03244e35-6412-4d23-a923-4235220462cb\\"} id={\\"54124b3d-f643-4a3a-8b5e-dad9a244d567\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":false}} >{`udata%20%3D%20%7B%7B0%2C0%7D%2C%20%7B500%2C0%7D%7D%3B%0AGraphics%5B%7B%0A%20%20ColorData%5B97%5D%5B1%5D%2C%0A%20%20Line%5Budata%20%2F%2F%20Offload%5D%2C%20Black%2C%0A%20%20Text%5Bthick%20%2F%2F%20Offload%2C%20%7B300%2C%202.5%7D%5D%0A%20%20%7D%2C%0A%20%20%0A%20%20PlotRange-%3E%7B%7B0%2C400%7D%2C%20%7B-3%2C3%7D%7D%2C%20%0A%20%20%0A%20%20TransitionDuration-%3E30%2C%20%0A%20%20TransitionType-%3E%22Linear%22%2C%20%0A%20%20Axes-%3ETrue%2C%20Frame-%3ETrue%2C%20FrameLabel-%3E%7B%22time%2C%20ps%22%2C%20%22Electric%20field%2C%20nA%22%7D%0A%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"03244e35-6412-4d23-a923-4235220462cb\\"} id={\\"af34275b-5eff-42ac-843e-059e6fbfcc2a\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%22e3983d02-81d7-4cd3-b061-3146e34e2e98%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKpxpbWhinGBjpWhimmOuaJKcY6yYZmBnqGhuamKUam6QapVpaAAB6jRUX%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nTry __to drag this slider__\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"03244e35-6412-4d23-a923-4235220462cb\\"} id={\\"6b75276e-f17c-452b-a1e6-37ee5df97535\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true,\\"Hidden\\":false}} >{`EventHandler%5BInputRange%5B0.001%2C%200.1%2C%200.002%2C%20%22Label%22-%3E%22Thickness%22%5D%2C%20Function%5Bthickness%2C%20%0A%20%20udata%20%3D%20%7BRange%5BLength%5B%23%5D%5D%2C%20%23%7D%20%26%40%20%28Drop%5B%23%2C%20-Length%5B%23%5D%2F2%2F%2FCeiling%5D%20%26%40%20tds%5Bthickness%2C%209.8%2C%2028.%2C%2015.%2C%200.05%5D%20%2F%2F%20Re%29%20%2F%2F%20Transpose%3B%0A%20%20thick%20%3D%20ToString%5Bthickness%5D%3C%3E%22%20mm%22%3B%0A%5D%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"03244e35-6412-4d23-a923-4235220462cb\\"} id={\\"c4efb21c-d92f-4177-9d12-9f345a233efb\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28EventObject%5B%3C%7C%22Id%22%20-%3E%20%2267d72df1-7cee-4ad7-afb2-e6ddb517acf2%22%2C%20%22Initial%22%20-%3E%200.05%2C%20%22View%22%20-%3E%20%224ed9c3e4-cfe4-4227-b9b1-9cbaf7910793%22%7C%3E%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKm6SmWCYbp5roJqcBCRMjI3PdJMskQ13L5KTENHNLQwNzS2MAkHoV4A%3D%3D%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>"},{"id":"/2024/05/15/triangulation-polygons","metadata":{"permalink":"/wljs-docs/blog/2024/05/15/triangulation-polygons","source":"@site/blog/2024-05-15-triangulation-polygons/index.mdx","title":"Triangulation and basics of dynamic polygons","description":"It is quite tricky to make an efficient function for plotting dynamic 3D surfaces, which change with time using a high-level code such as Wolfram Language.","date":"2024-05-15T00:00:00.000Z","tags":[{"label":"visualization","permalink":"/wljs-docs/blog/tags/visualization"},{"label":"graphics","permalink":"/wljs-docs/blog/tags/graphics"},{"label":"animation","permalink":"/wljs-docs/blog/tags/animation"}],"readingTime":1.76,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["visualization","graphics","animation"],"enableComments":true},"unlisted":false,"prevItem":{"title":"THz Time-domain modelling","permalink":"/wljs-docs/blog/2024/05/20/thz-model"},"nextItem":{"title":"Converting JSON crystal data to Graphics using AI Assistant","permalink":"/wljs-docs/blog/2024/05/13/json-llm"}},"content":"It is quite tricky to make an efficient function for plotting dynamic 3D surfaces, which change with time using a high-level code such as Wolfram Language.\\n\\n\x3c!--truncate--\x3e\\n\\nHowever, graphics library provides a low-level access to a GPU, that operates with vertices and triangles. The last one is our way to go\\n\\nimport { WLJSHTML, WLJSEditor, WLJSStore } from \\"@site/src/components/wljs-reactcells\\";\\n\\n\\n\\n<WLJSStore json={require(\'./attachments/371da99a-1b43-4af5-8c39-cd604e67fc13.txt\').default} notebook={require(\'./attachments/notebook-371.wln\').default}/>\\n\\n\\n\\n\\n---\\n\\n### TLDR\\n\\nDownload this notebook to see the result\\n\\n---\\n\\n## How to draw fast\\nThere is a special structure for that\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"371da99a-1b43-4af5-8c39-cd604e67fc13\\"} id={\\"a28794d1-0790-4b49-a6fa-02aa7c4d1d50\\"} type={\\"Input\\"} opts={{}} >{`GraphicsComplex%5Bvertices_%2C%20primitives_%2C%20%22VertexColors%22-%3Ecolors_%5D`}</WLJSEditor>\\n\\nwhere `vertices` will be send directly to the GPU and can be efficiently updates as well. The only drawback is that the number of points has to be the same\\n\\nTherfore we need to define the working mesh and triangulate it\\n\\n## Random point distribution\\nPutting random numbers on 2D plane is not an optimal way, we need something more sophisticated\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"371da99a-1b43-4af5-8c39-cd604e67fc13\\"} id={\\"746290af-28a7-4f8d-8474-b534928cbb9f\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`proc%20%3D%20HardcorePointProcess%5B50%2C%200.9%2C%202%5D%3B%0Areg%20%3D%20Rectangle%5B%7B-10%2C%20-10%7D%2C%20%7B10%2C%2010%7D%5D%3B%0Asamples%20%3D%20RandomPointConfiguration%5Bproc%2C%20reg%5D%5B%22Points%22%5D%3B%0AListPlot%5Bsamples%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"371da99a-1b43-4af5-8c39-cd604e67fc13\\"} id={\\"62d9ecf8-3529-4c0a-9588-7bbd354207a7\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%22694ad5f2-7a1b-47b9-9e11-ce34dd596715%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKm1maJKaYphnpmicaJumamCdZ6lqmGhrqJqcam6SkmFqamRuaAgCFPRWB%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nhere is models a set of hard-core particles, which has a certain potential that keeps them apart.\\n\\n## Triangulation\\nWe will use __Delaunay method__ for that with [some post-processing](https://mathematica.stackexchange.com/questions/277/how-to-get-actual-triangles-from-delaunaytriangulation)\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"371da99a-1b43-4af5-8c39-cd604e67fc13\\"} id={\\"b647e772-6b25-4734-8080-17a56da04503\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`Needs%5B%22ComputationalGeometry%60%22%5D%3B%0Atriangles2%5Bpoints_%5D%20%3A%3D%20Module%5B%7Btr%2C%20triples%7D%2C%0A%20%20tr%20%3D%20DelaunayTriangulation%5Bpoints%5D%3B%0A%20%20triples%20%3D%20Flatten%5BFunction%5B%7Bv%2C%20list%7D%2C%0A%20%20%20%20%20%20Switch%5BLength%5Blist%5D%2C%0A%20%20%20%20%20%20%20%20%28%2A%20account%20for%20nodes%20with%20connectivity%202%20or%20less%20%2A%29%0A%20%20%20%20%20%20%20%201%2C%20%7B%7D%2C%0A%20%20%20%20%20%20%20%202%2C%20%7BFlatten%5B%7Bv%2C%20list%7D%5D%7D%2C%20%0A%20%20%20%20%20%20%20%20_%2C%20%7Bv%2C%20%23%23%7D%20%26%20%40%40%40%20Partition%5Blist%2C%202%2C%201%2C%20%7B1%2C%201%7D%5D%0A%20%20%20%20%20%20%5D%0A%20%20%20%20%5D%20%40%40%40%20tr%2C%201%5D%3B%0A%20%20Cases%5BGatherBy%5Btriples%2C%20Sort%5D%2C%20a_%20%2F%3B%20Length%5Ba%5D%20%3D%3D%203%20%3A%3E%20a%5B%5B1%5D%5D%5D%5D`}</WLJSEditor>\\n\\nnow apply it to our data\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"371da99a-1b43-4af5-8c39-cd604e67fc13\\"} id={\\"d313eaaf-8fef-47fa-b7c5-9d460072ca76\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`triangles%20%3D%20triangles2%5Bsamples%5D%3B%0AListPlot%5Bsamples%2C%20Prolog-%3E%7BEdgeForm%5BBlack%5D%2C%20Yellow%2C%20Opacity%5B0.5%5D%2C%20GraphicsComplex%5Bsamples%2C%20Polygon%5Btriangles%5D%5D%7D%2C%20PlotStyle-%3E%7BRed%2C%20PointSize%5B0.03%5D%7D%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"371da99a-1b43-4af5-8c39-cd604e67fc13\\"} id={\\"00d1f178-4d88-4a78-9808-2c2066cef86a\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%224def7292-250f-4955-9beb-482692c0d671%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKm6SkppkbWRrpGpkapOmaWJqa6lompSbpmlgYmVkaJRukmJkbAgB%2BuRUk%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nFor the demonstration purpose we kept the number of point very low. However, it can be increased drastically. \\n\\n## Sampling our function in 3D\\nLet us have an example function - a Gaussian distribution. We can sample it using our mesh and then plot it using polygons\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"371da99a-1b43-4af5-8c39-cd604e67fc13\\"} id={\\"a51106cc-7ec2-4b2b-a765-c08c9fdda4f4\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`%28%2A%20sample%20function%20%2A%29%0Af%5Bp_%2C%20%7Bx_%2Cy_%2Cz_%7D%5D%20%3A%3D%20z%20Exp%5B-%28%2AFB%5B%2A%29%28%28%28%2ASpB%5B%2A%29Power%5BNorm%5Bp%20-%20%7Bx%2Cy%7D%5D%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.%29%29%28%2A%5DFB%2A%29%5D%0A%0Aprobe%20%3D%20%7B%23%5B%5B1%5D%5D%2C%20%23%5B%5B2%5D%5D%2C%20f%5B%23%2C%20%7B10%2C%200%2C%200%7D%5D%7D%20%26%2F%40%20samples%20%2F%2F%20Chop%3B%0Acolors%20%3D%20With%5B%7Bmm%20%3D%20MinMax%5Bprobe%5B%5BAll%2C3%5D%5D%5D%7D%2C%0A%20%20%20%20%20%20%28Blend%5B%7B%7Bmm%5B%5B1%5D%5D%2C%20Blue%7D%2C%20%7Bmm%5B%5B2%5D%5D%2C%20Red%7D%7D%2C%20%23%5B%5B3%5D%5D%5D%20%29%26%2F%40%20probe%20%2F.%20%7BRGBColor%20-%3E%20List%7D%20%2F%2F%20Chop%5D%3B`}</WLJSEditor>\\n\\nMake a static plot\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"371da99a-1b43-4af5-8c39-cd604e67fc13\\"} id={\\"92b3e674-f302-4625-b377-bfd1d07f3bef\\"} type={\\"Input\\"} opts={{}} >{`Graphics3D%5B%7B%0A%20%20GraphicsComplex%5Bprobe%2C%20%7BPolygon%5Btriangles%5D%7D%2C%20%22VertexColors%22-%3Ecolors%5D%0A%7D%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"371da99a-1b43-4af5-8c39-cd604e67fc13\\"} id={\\"ffbe3431-fd0d-4613-9b8c-7a38317d579a\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%2218250678-2582-4554-b34a-6986be55867e%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG1oYmRqYmVvoGplaGOmamJqa6CYZmyTqmllamCWlmppamJmnAgBlMhRt%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\n## Dynamic plot\\nNow we need only to add `Offload` wrappers in order to make our data alive as well as some elements of control to manipulate the data\\n\\n**evaluate initialization cells, before running this one**\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"371da99a-1b43-4af5-8c39-cd604e67fc13\\"} id={\\"1c6ff7e6-12f6-4c2a-8a35-a2b11a6d59cc\\"} type={\\"Input\\"} opts={{}} >{`Graphics3D%5B%7B%0A%20%20GraphicsComplex%5Bprobe%20%2F%2F%20Offload%2C%20%7BPolygon%5Btriangles%5D%7D%2C%20%22VertexColors%22-%3EOffload%5Bcolors%2C%20%22Static%22-%3ETrue%5D%5D%2C%0A%0A%20%20EventHandler%5BSphere%5B%7B0%2C0%2C0%7D%2C%200.1%5D%2C%20%7B%22transform%22-%3EFunction%5Bdata%2C%20With%5B%7Bpos%20%3D%20data%5B%22position%22%5D%7D%2C%0A%20%20%20%20probe%20%3D%20%7B%23%5B%5B1%5D%5D%2C%20%23%5B%5B2%5D%5D%2C%20f%5B%23%2C%20pos%5D%7D%20%26%2F%40%20samples%20%2F%2F%20Chop%3B%0A%20%20%20%20colors%20%3D%20With%5B%7Bmm%20%3D%20MinMax%5Bprobe%5B%5BAll%2C3%5D%5D%5D%7D%2C%0A%20%20%20%20%20%20%28Blend%5B%7B%7Bmm%5B%5B1%5D%5D%2C%20Blue%7D%2C%20%7Bmm%5B%5B2%5D%5D%2C%20Red%7D%7D%2C%20%23%5B%5B3%5D%5D%5D%20%29%26%2F%40%20probe%20%2F.%20%7BRGBColor%20-%3E%20List%7D%20%2F%2F%20Chop%5D%3B%0A%20%20%5D%5D%7D%5D%0A%7D%5D`}</WLJSEditor>\\n\\n![](./../gif1_v-ezgif.com-video-to-gif-converter.gif)\\n\\n\\nOr variation with a light-source\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"371da99a-1b43-4af5-8c39-cd604e67fc13\\"} id={\\"ea0ad5fb-0530-43a8-95a1-1ee9fe8fbbc8\\"} type={\\"Input\\"} opts={{}} >{`light%20%3D%20%7B0%2C0%2C0%7D%3B%0AGraphics3D%5B%7B%0A%20%20GraphicsComplex%5Bprobe%20%2F%2F%20Offload%2C%20%7BPolygon%5Btriangles%5D%7D%5D%2C%0A%20%20PointLight%5BRed%2C%20light%20%2F%2F%20Offload%5D%2C%0A%0A%20%20EventHandler%5BSphere%5B%7B0%2C0%2C0%7D%2C%200.1%5D%2C%20%7B%22transform%22-%3EFunction%5Bdata%2C%20With%5B%7Bpos%20%3D%20data%5B%22position%22%5D%7D%2C%0A%20%20%20%20probe%20%3D%20%7B%23%5B%5B1%5D%5D%2C%20%23%5B%5B2%5D%5D%2C%20f%5B%23%2C%20pos%5D%7D%20%26%2F%40%20samples%20%2F%2F%20Chop%3B%0A%20%20%20%20light%20%3D%20pos%3B%0A%20%20%5D%5D%7D%5D%0A%7D%5D`}</WLJSEditor>\\n\\n![](./../gif2-ezgif.com-crop.gif)"},{"id":"/2024/05/13/json-llm","metadata":{"permalink":"/wljs-docs/blog/2024/05/13/json-llm","source":"@site/blog/2024-05-13-json-llm.md","title":"Converting JSON crystal data to Graphics using AI Assistant","description":"Working in condensed matter physics, I (JerryI) often need to represent crystal structures based on their CIF, JSON, or other formats. Sometimes, it is quite tricky to parse these data files since you also need to determine the given symmetry operation when constructing a unit cell. Here, we will do it using AI Copilot \ud83e\udd16","date":"2024-05-13T00:00:00.000Z","tags":[{"label":"AI","permalink":"/wljs-docs/blog/tags/ai"}],"readingTime":3.23,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["AI"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Triangulation and basics of dynamic polygons","permalink":"/wljs-docs/blog/2024/05/15/triangulation-polygons"},"nextItem":{"title":"Bad Apple, but it\u2019s Wolfram Language Plot","permalink":"/wljs-docs/blog/2024/05/01/badapple"}},"content":"Working in condensed matter physics, I (JerryI) often need to represent crystal structures based on their CIF, JSON, or other formats. Sometimes, it is quite tricky to parse these data files since you also need to determine the given symmetry operation when constructing a unit cell. Here, we will do it using AI Copilot \ud83e\udd16\\n\\n\x3c!--truncate--\x3e\\n\\n## Uranium\\nWhen I was measuring the spectrum of $U O_2$ at the Nijmegen High-Magnetic-Field Lab during the morning shift, I had to make a short summary report and needed a nice plot of a unit cell.\\n\\nGPT models can actually work with JSON data or Associations quite well. The first step is to get a CIF or JSON file on the crystal structure. This can be done using the [Materials Project database](https://next-gen.materialsproject.org/materials/mp-1597). In the summary section, one can export a single JSON file and then import it into our notebook.\\n\\n---\\n\\n```mathematica\\nImport[\\"UO2.json\\", \\"RawJSON\\"]\\n```\\n\\n```mathematica\\n<|\\"@module\\"->\\"pymatgen.core.structure\\",\\"@class\\"->\\"Structure\\",\\"charge\\"->0,\\"lattice\\"-><|\\"matrix\\"->{{5.45401004`,0.`,3.339617969001764`*^-16},{8.770717076887777`*^-16,5.45401004`,3.339617969001764`*^-16},{0.`,0.`,5.45401004`}},\\"pbc\\"->{True,True,True},\\"a\\"->5.45401004`,\\"b\\"->5.45401004`,\\"c\\"->5.45401004`,\\"alpha\\"->90.`,\\"beta\\"->90.`,\\"gamma\\"->90.`,\\"volume\\"->162.23621261866322`|>,\\"properties\\"-><||>,\\"sites\\"->{<|\\"species\\"->{<|\\"element\\"->\\"U\\",\\"oxidation_state\\"->4,\\"spin\\"->Null,\\"occu\\"->1|>},\\"abc\\"->{0.5`,0.`,0.`},\\"xyz\\"->{2.72700502`,0.`,1.669808984500882`*^-16},\\"properties\\"-><||>,\\"label\\"->\\"U4+\\"|>,<|\\"species\\"->{<|\\"element\\"->\\"U\\",\\"oxidation_state\\"->4,\\"spin\\"->Null,\\"occu\\"->1|>},\\"abc\\"->{0.5`,0.5`,0.5`},\\"xyz\\"->{2.7270050200000004`,2.72700502`,2.7270050200000004`},\\"properties\\"-><||>,\\"label\\"->\\"U4+\\"|>,<|\\"species\\"->{<|\\"element\\"->\\"U\\",\\"oxidation_state\\"->4,\\"spin\\"->Null,\\"occu\\"->1|>},\\"abc\\"->{0.`,0.`,0.5`},\\"xyz\\"->{0.`,0.`,2.72700502`},\\"properties\\"-><||>,\\"label\\"->\\"U4+\\"|>,<|\\"species\\"->{<|\\"element\\"->\\"U\\",\\"oxidation_state\\"->4,\\"spin\\"->Null,\\"occu\\"->1|>},\\"abc\\"->{0.`,0.5`,0.`},\\"xyz\\"->{4.3853585384438886`*^-16,2.72700502`,1.669808984500882`*^-16},\\"properties\\"-><||>,\\"label\\"->\\"U4+\\"|>,<|\\"species\\"->{<|\\"element\\"->\\"O\\",\\"oxidation_state\\"->-2,\\"spin\\"->Null,\\"occu\\"->1|>},\\"abc\\"->{0.25`,0.75`,0.75`},\\"xyz\\"->{1.3635025100000007`,4.09050753`,4.09050753`},\\"properties\\"-><||>,\\"label\\"->\\"O2-\\"|>,<|\\"species\\"->{<|\\"element\\"->\\"O\\",\\"oxidation_state\\"->-2,\\"spin\\"->Null,\\"occu\\"->1|>},\\"abc\\"->{0.25`,0.25`,0.75`},\\"xyz\\"->{1.3635025100000002`,1.36350251`,4.09050753`},\\"properties\\"-><||>,\\"label\\"->\\"O2-\\"|>,<|\\"species\\"->{<|\\"element\\"->\\"O\\",\\"oxidation_state\\"->-2,\\"spin\\"->Null,\\"occu\\"->1|>},\\"abc\\"->{0.25`,0.25`,0.25`},\\"xyz\\"->{1.3635025100000002`,1.36350251`,1.3635025100000002`},\\"properties\\"-><||>,\\"label\\"->\\"O2-\\"|>,<|\\"species\\"->{<|\\"element\\"->\\"O\\",\\"oxidation_state\\"->-2,\\"spin\\"->Null,\\"occu\\"->1|>},\\"abc\\"->{0.25`,0.75`,0.25`},\\"xyz\\"->{1.3635025100000007`,4.09050753`,1.3635025100000004`},\\"properties\\"-><||>,\\"label\\"->\\"O2-\\"|>,<|\\"species\\"->{<|\\"element\\"->\\"O\\",\\"oxidation_state\\"->-2,\\"spin\\"->Null,\\"occu\\"->1|>},\\"abc\\"->{0.75`,0.75`,0.25`},\\"xyz\\"->{4.090507530000001`,4.09050753`,1.3635025100000004`},\\"properties\\"-><||>,\\"label\\"->\\"O2-\\"|>,<|\\"species\\"->{<|\\"element\\"->\\"O\\",\\"oxidation_state\\"->-2,\\"spin\\"->Null,\\"occu\\"->1|>},\\"abc\\"->{0.75`,0.25`,0.25`},\\"xyz\\"->{4.09050753`,1.36350251`,1.3635025100000004`},\\"properties\\"-><||>,\\"label\\"->\\"O2-\\"|>,<|\\"species\\"->{<|\\"element\\"->\\"O\\",\\"oxidation_state\\"->-2,\\"spin\\"->Null,\\"occu\\"->1|>},\\"abc\\"->{0.75`,0.25`,0.75`},\\"xyz\\"->{4.09050753`,1.36350251`,4.09050753`},\\"properties\\"-><||>,\\"label\\"->\\"O2-\\"|>,<|\\"species\\"->{<|\\"element\\"->\\"O\\",\\"oxidation_state\\"->-2,\\"spin\\"->Null,\\"occu\\"->1|>},\\"abc\\"->{0.75`,0.75`,0.75`},\\"xyz\\"->{4.090507530000001`,4.09050753`,4.090507530000001`},\\"properties\\"-><||>,\\"label\\"->\\"O2-\\"|>}|>\\n```\\n\\nIt looks quite ugly. Let\'s ask our AI assistant to convert it to a 3D plot using following prompt\\n\\n> Ctrl/Cmd + P\\n\\nand type\\n\\n> read crystal data in focused cell and draw a unit cell using 3D graphics and representing ions as spheres with different colors\\n\\nThe generated cell is following (using `GPT-4o` model Jun 2024)\\n\\n```mathematica\\nModule[{a = 5.45401004, unitCell, filledUnitCell},\\n  unitCell = {\\n    {Yellow, Sphere[{2.72700502, 0., 0.}, 0.5]},\\n    {Yellow, Sphere[{2.72700502, 2.72700502, 2.72700502}, 0.5]},\\n    {Yellow, Sphere[{0., 0., 2.72700502}, 0.5]},\\n    {Yellow, Sphere[{0., 2.72700502, 0.}, 0.5]},\\n    {Red, Sphere[{1.36350251, 4.09050753, 4.09050753}, 0.3]},\\n    {Red, Sphere[{1.36350251, 1.36350251, 4.09050753}, 0.3]},\\n    {Red, Sphere[{1.36350251, 1.36350251, 1.36350251}, 0.3]},\\n    {Red, Sphere[{4.09050753, 1.36350251, 4.09050753}, 0.3]},\\n    {Red, Sphere[{4.09050753, 4.09050753, 4.09050753}, 0.3]}\\n  };\\n\\n  filledUnitCell = Flatten[Table[\\n    Translate[unitCell, {i, j, k} a],\\n    {i, 0, 1}, {j, 0, 1}, {k, 0, 1}\\n  ], 3];\\n\\n  Graphics3D[{filledUnitCell}]\\n]\\n```\\n\\nOne can also ask it to add borders\\n\\n> edit your cell and add borders of the unit cell using black lines\\n\\n```mathematica\\nModule[{a = 5.45401004, unitCell, filledUnitCell, borders},\\n  unitCell = {\\n    {Yellow, Sphere[{2.72700502, 0., 0.}, 0.5]},\\n    {Yellow, Sphere[{2.72700502, 2.72700502, 2.72700502}, 0.5]},\\n    {Yellow, Sphere[{0., 0., 2.72700502}, 0.5]},\\n    {Yellow, Sphere[{0., 2.72700502, 0.}, 0.5]},\\n    {Red, Sphere[{1.36350251, 4.09050753, 4.09050753}, 0.3]},\\n    {Red, Sphere[{1.36350251, 1.36350251, 4.09050753}, 0.3]},\\n    {Red, Sphere[{1.36350251, 1.36350251, 1.36350251}, 0.3]},\\n    {Red, Sphere[{4.09050753, 1.36350251, 4.09050753}, 0.3]},\\n    {Red, Sphere[{4.09050753, 4.09050753, 4.09050753}, 0.3]}\\n  };\\n\\n  filledUnitCell = Flatten[Table[\\n    Translate[unitCell, {i, j, k} a],\\n    {i, 0, 1}, {j, 0, 1}, {k, 0, 1}\\n  ], 3];\\n\\n  borders = {\\n    Line[{{0, 0, 0}, {a, 0, 0}}],\\n    Line[{{0, 0, 0}, {0, a, 0}}],\\n    Line[{{0, 0, 0}, {0, 0, a}}],\\n    Line[{{a, a, 0}, {0, a, 0}}],\\n    Line[{{a, a, 0}, {a, 0, 0}}],\\n    Line[{{a, 0, a}, {a, 0, 0}}],\\n    Line[{{a, 0, a}, {0, 0, a}}],\\n    Line[{{0, a, a}, {0, 0, a}}],\\n    Line[{{0, a, a}, {0, a, 0}}],\\n    Line[{{a, a, a}, {0, a, a}}],\\n    Line[{{a, a, a}, {a, 0, a}}],\\n    Line[{{a, a, a}, {a, a, 0}}]\\n  };\\n\\n  Graphics3D[{filledUnitCell, Black, borders}]\\n]\\n```\\n\\n<Wl>{`\\nModule[{a = 5.45401004, unitCell, filledUnitCell, borders},\\n  unitCell = {\\n    {Yellow, Sphere[{2.72700502, 0., 0.}, 0.5]},\\n    {Yellow, Sphere[{2.72700502, 2.72700502, 2.72700502}, 0.5]},\\n    {Yellow, Sphere[{0., 0., 2.72700502}, 0.5]},\\n    {Yellow, Sphere[{0., 2.72700502, 0.}, 0.5]},\\n    {Red, Sphere[{1.36350251, 4.09050753, 4.09050753}, 0.3]},\\n    {Red, Sphere[{1.36350251, 1.36350251, 4.09050753}, 0.3]},\\n    {Red, Sphere[{1.36350251, 1.36350251, 1.36350251}, 0.3]},\\n    {Red, Sphere[{4.09050753, 1.36350251, 4.09050753}, 0.3]},\\n    {Red, Sphere[{4.09050753, 4.09050753, 4.09050753}, 0.3]}\\n  };\\n\\n  filledUnitCell = Flatten[Table[\\n    Translate[unitCell, {i, j, k} a],\\n    {i, 0, 1}, {j, 0, 1}, {k, 0, 1}\\n  ], 3];\\n\\n  borders = {\\n    Line[{{0, 0, 0}, {a, 0, 0}}],\\n    Line[{{0, 0, 0}, {0, a, 0}}],\\n    Line[{{0, 0, 0}, {0, 0, a}}],\\n    Line[{{a, a, 0}, {0, a, 0}}],\\n    Line[{{a, a, 0}, {a, 0, 0}}],\\n    Line[{{a, 0, a}, {a, 0, 0}}],\\n    Line[{{a, 0, a}, {0, 0, a}}],\\n    Line[{{0, a, a}, {0, 0, a}}],\\n    Line[{{0, a, a}, {0, a, 0}}],\\n    Line[{{a, a, a}, {0, a, a}}],\\n    Line[{{a, a, a}, {a, 0, a}}],\\n    Line[{{a, a, a}, {a, a, 0}}]\\n  };\\n\\n  Graphics3D[{filledUnitCell, Black, borders}]\\n]\\n`}</Wl>\\n\\nThis is amazing how modern LLM can read and parse any kind of data and convert them to the desired formats \ud83e\udd84"},{"id":"/2024/05/01/badapple","metadata":{"permalink":"/wljs-docs/blog/2024/05/01/badapple","source":"@site/blog/2024-05-01-badapple/index.md","title":"Bad Apple, but it\u2019s Wolfram Language Plot","description":"Bad \ud83c\udf4e animation by Anira group originally based on ZUN)\'s work for bullet shoot \'em up game Touhou Project_ is remarkable cultural internet phenomenon often used for testing and demonstrating the features of some old hardware, algorithms, graphics systems  or other esoteric medium. And in general as an of art object -  Bad Apple shadow animation is just eye-catching and amazingly crafted piece \u2728. Not even mentioning hot pumping 16-bit flavoured tune and a beautiful voice of Nomico (\u306e\u307f\u3053).","date":"2024-05-01T00:00:00.000Z","tags":[],"readingTime":9.66,"hasTruncateMarker":true,"authors":[],"frontMatter":{},"unlisted":false,"prevItem":{"title":"Converting JSON crystal data to Graphics using AI Assistant","permalink":"/wljs-docs/blog/2024/05/13/json-llm"},"nextItem":{"title":"Dynamic color and opacity implementation","permalink":"/wljs-docs/blog/2024/04/24/dynamic-env"}},"content":"[Bad \ud83c\udf4e](https://www.youtube.com/watch?v=FtutLA63Cp8) animation by Anira group originally based on [ZUN](https://en.wikipedia.org/wiki/ZUN_(video_game_developer))\'s work for bullet shoot \'em up game _Touhou Project_ is remarkable cultural internet phenomenon often used for testing and demonstrating the features of some old hardware, algorithms, graphics systems  or other esoteric medium. And in general as an of art object -  Bad Apple *shadow animation* is just eye-catching and amazingly crafted piece \u2728. Not even mentioning hot pumping 16-bit flavoured tune and a beautiful voice of Nomico (\u306e\u307f\u3053).\\n\\nI (me @JerryI) have seen it many times popping up still in 2024, even as a [Fluid Simulation](https://www.youtube.com/watch?v=2Ni13dnAbSA) and have been questioning myself why not anyone to try to implement it lively using some scientific software like Jupyter or Matlab or Wolfram Language and a standard plot function? It could fun\\n\x3c!--truncate--\x3e\\n<details>\\n<summary>Spoiler</summary>\\n\\n<iframe width=\\"100%\\" height=\\"315\\" src=\\"https://www.youtube.com/embed/QOuVV9nTras?si=vKT4GGCdY94ZHDOm\\" title=\\"YouTube video player\\" frameborder=\\"0\\" allow=\\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\\" referrerpolicy=\\"strict-origin-when-cross-origin\\" allowfullscreen></iframe>\\n\\n\\n</details>\\n\\nToday we will learn how to render this animation in real-time using WLJS Notebook and a single `Line` function.\\n\\n> Open WLJS Notebook and create a new notebook \ud83d\udcd2\\n## One line to tell a story\\nWhat is the most basic thing people try to do, when open Mathematica or WLJS Notebook for the first time? I believe it must be `Plot`\\n\\n```mathematica\\nPlot[BesselJ[0, z], {z,0,10}]\\n```\\n\\n<Wl>{`Plot[BesselJ[0, z], {z,0,10}]`}</Wl>\\n\\nThe idea would be to transform each frame of a video to a single line path. Similar to a *one line art*. The approach is not new and [was published](https://www.wolfram.com/mathematica/new-in-10/enhanced-graphs-and-networks/continuous-line-drawing.html) by Wolfram Research as a fun example in Mathematica 10. \\n\\n### Handling video frames\\nFirstly, obtain a video file of Bad Apple animation somehow and __directly drop it to any input cell.__ It will upload a file and will provide a reference to it. Modify the tail of expression to explicitly tell Wolfram Kernel to extract video frames\\n\\n```mathematica @\\nvideo = Import[FileNameJoin[{\\"attachments\\", \\"Touhou - Bad Apple.mp4\\"}], (*BB[*)({\\"ImageList\\", All})(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRAeB5AILqnMSXXKr0hjgskHleakFnMBGU6JydnpRfmleSlpzDDlQe5Ozvk5+UVFDGDwwR6dwcAAAAHdFiw=\\"*)(*]BB*)];\\n```\\n\\nLet us try our methods on 500th frame\\n\\n```mathematica\\nvideo[[500]] // Thumbnail\\n```\\n\\n![](./../Screenshot%202024-06-01%20at%2020.55.29.png)\\nYou can __directly copy and paste this image from the output cell__ to a new input cell and wrap some function over it (like on a video at the end of the post). Since in this story I am limited to my markdown editor, for the demonstration purposes I will use a dedicated variable\\n\\n```mathematica\\nimg = video[[500]] // Thumbnail;\\n```\\n\\nIt comes handy here that Bad Apple relies on *shadow* animation style, so we can easily convert any image to a grid of `1` and `0`\\n\\n```mathematica\\nimg = img // ImageAdjust // Binarize\\n```\\n\\n![](./../Screenshot%202024-06-01%20at%2021.00.13.png)\\nImagine if all dark parts will be filled with one long line path zig-zagging over it. This is somewhat easy to do if we know the positions of all dark pixels\\n\\n```mathematica\\npos = PixelValuePositions[img, 0]\\n```\\n\\n![](./../Screenshot%202024-06-01%20at%2021.03.19.png)\\n\\nGreat. Thanks to a giant standard library of Wolfram Language, there is a complete solution for optimizing the path to cover all dark pixels\\n\\n```mathematica\\n{length, path} = FindShortestTour[pos];\\n```\\n\\nHere we do not need `length`, but only actual `path` which contains indexes of points from `pos` connected in order to form the shortest route though all dark pixels. Let\'s see how it looks\\n\\n```mathematica\\nListLinePlot[pos[[path]]]\\n```\\n\\n![](./../path-test-1.svg)\\n\\nIt feels a bit too dense for my taste, let\'s average it a bit\\n\\n```mathematica\\nListLinePlot[MovingAverage[pos[[path]], 5]]\\n```\\n\\n![](./../test-path-4.svg)\\n\\nThis already feels more interesting and has a vibe of *one line art*. \\n\\n### Batch processing\\nNow we need to apply this set of steps to every frame. One can organize it like this\\n\\n```mathematica\\ntrace[frame_] :=\\n    Module[{img, pos, path},\\n        img = ImageAdjust[frame // Thumbnail // Binarize];\\n        pos = PixelValuePositions[img, 0]//N; (* get numerical *)\\n        path = FindShortestTour[pos][[2]];\\n        MovingAverage[pos[[path]], 5]\\n    ]\\n```\\n\\nAnd to track progress, we can also add a bar\\n\\n```mathematica title=\\"optional\\"\\nprogressBar[max_Real | max_Integer] := LeakyModule[{\\n\\tprogress = 0.,\\n\\tbar,\\n\\tincrement,\\n\\ttimer = AbsoluteTime[]\\n},\\n\\tbar = CellPrint[ToString[\\n\\t\\tGraphics[{\\n\\t\\t\\tLightBlue, Rectangle[{-1,-1}, {1,1}],\\n\\t\\t\\tGreen, Rectangle[{-1,-1}, {Offload[2 progress - 1], 1}]\\n\\t\\t}, ImagePadding->None, Controls->False, ImageSize->{400, 30}]\\n\\t, StandardForm], \\"After\\"->EvaluationCell[]];\\n\\n\\t(* throttling *)\\n\\tincrement[value_Real | value_Integer] := If[AbsoluteTime[] - timer > 0.1,\\n\\t\\ttimer = AbsoluteTime[];\\n\\t\\tprogress = value / max // N;\\n\\t\\tIf[progress >= 0.99, \\n\\t\\t\\tClearAll[increment];\\n\\t\\t\\tDelete[bar];\\n\\t\\t];\\n\\t];\\n\\n\\tincrement\\n]\\n```\\n\\nI would not recommend to apply it right on all frames from the video, since an algorithm is extremely easy to implement, but it comes with performance costs. \\n\\nWe can test it on the 100 frames (skipping black frames from the beginning)\\n\\n```mathematica\\nbar = progressBar[100];\\nframes = MapIndexed[Function[{frame, index},\\n  bar[index // First];\\n  trace[frame]\\n], Take[Drop[video,200], 100]];\\n```\\n*It will take a while... Try lower resolution resizing each frame with `ImageResize` function*\\n\\nOn my Mac Air M1 a single frame took `~3` seconds to complete. In the end I left my laptop for next 5 hours and went for a walk in the forest to process an entire Bad Apple video, but you don\'t have to \ud83d\ude09 the final result is at the end of this post.\\n\\nAn algorithm can definitely be improved in many ways, but for demonstration purposes I will leave it as it is for now. This is __the most naive approach__ to one line stylised images.\\n\\n## Animation\\nHow to animate this sequence of lines __right in the notebook__? We do not want to cheat and use rasterized images. In Wolfram Mathematica, one can apply a simple `animate` function, however, dynamics in WLJS Notebook built differently: only low-level graphics primitives support dynamic evaluation, i.e.\\n\\n```mathematica title=\\"cell 1\\"\\ncurrentFrame = frames // First;\\nGraphics[Line[currentFrame // Offload], TransitionType->None]\\n```\\n*it is important to disable any tween-ing function by `TransitionType->None`, otherwise it will try to interpolate between frames, which is not good for our style *\\n\\nNow if we change `currentFrame` symbol, __a line will be redrawn using new data automatically__. For example one can assign it to a slider\\n\\n```mathematica title=\\"cell 2\\"\\nEventHandler[InputRange[1, Length[frames], 1, 1], Function[index,\\n\\tcurrentFrame = frames[[index]];\\n]]\\n```\\n\\n![](./../test-gif-demo-ezgif.com-optimize.gif)\\n\\nHow to make it animated automatically? There are several ways\\n\\n### Using timers\\nThe first thing coming to head is just to set a timer instead of a slider\\n\\n```mathematica\\nindex = 1;\\ntask = SetInterval[\\n\\tcurrentFrame = frames[[index]];\\n\\tindex++;\\n\\tIf[index > Length[frames], TaskRemove[task]];\\n, 1000/30.0];\\n```\\n\\nIt is suitable for most tasks, however for faster rates it might not keep up with the rest of the system. It also is not synchronized with a window refresh rate defined by a video engine.\\n\\n### Using browser\'s repaint cycle\\nThis is almost 1:1 copy of Javascript\'s `requestAnimationFrame` method. We need to assign an event handler and a special function, that will fire an event to update the frame\\n\\n```mathematica title=\\"cell 1\\"\\ncurrentFrame = frames // First;\\n\\nindex = 1;\\nEventHandler[\\"frame\\", Function[Null,\\n\\tcurrentFrame = frames[[index]];\\n\\tindex++;\\n\\tIf[index > Length[frames], index = 1];\\t\\n]];\\n\\nGraphics[{\\n\\tLine[currentFrame // Offload],\\n\\tAnimationFrameListener[currentFrame // Offload, \\"Event\\"->\\"frame\\"]\\n}, TransitionType->None]\\n```\\n\\nHere `AnimationFrameListener` checks if `currentFrame` is changing, and then requests an animation from a browser. On the next repaint cycle it will fire `frame` event, which updates `currentFrame` and the cycle repeats.\\n\\nAs a drawback, we cannot really control the speed, since it goes as fast as our system can go peaking at the refresh rate of a browser (60 - 120 FPS depending on the system).\\n\\n#### How to slow down the animation\\nWe can skip frames to roughly match the frame-rate of a video. For this we need to check the passed time between `frame` event calls and skip the call if needed\\n\\n```mathematica\\ncurrentFrame = frames // First;\\ntime = AbsoluteTime[];\\n\\nindex = 1;\\ndummy = 1;\\nEventHandler[\\"frame\\", Function[Null,\\n\\tIf[AbsoluteTime[] - time > 1/40.0, (* 40FPS lol *)\\n\\t\\tcurrentFrame = frames[[index]];\\n\\t\\tindex++;\\n\\t\\tIf[index > Length[frames], index = 1];\\n\\t\\ttime = \\tAbsoluteTime[];\\n\\t,\\n\\t\\tdummy = 1; (* just to kick a listener *)\\n\\t]\\n]];\\n\\nGraphics[{\\n\\tLine[currentFrame // Offload],\\n\\tAnimationFrameListener[currentFrame // Offload, \\"Event\\"->\\"frame\\"],\\n\\tAnimationFrameListener[dummy // Offload, \\"Event\\"->\\"frame\\"]\\n}, TransitionType->None]\\n```\\n\\n### Optimizations\\nTo improve the performance, we can apply several tricks\\n#### NumericArray\\nWolfram is a symbolic programming language, therefore even an array of numbers can become a higher-order specie. To explicitly tell a interpreter that there is no other things inside expect real or integer numbers (and will not be) we can wrap each frame into \\n\\n```mathematica\\nframes = NumericArray /@ frames;\\n```\\n\\nIt will also speed up the frontend.\\n\\n#### Skip points\\nSince there is anyway a moving average filter applied, we do not need all points\\n\\n```mathematica\\nframes = frames[[All, ;; ;; 2]]; (* take every 2nd *)\\n```\\n\\n## Final video\\nHere is the final result recorded in real-time (except the intro part)\\n\\n<iframe width=\\"100%\\" height=\\"315\\" src=\\"https://www.youtube.com/embed/QOuVV9nTras?si=vKT4GGCdY94ZHDOm\\" title=\\"YouTube video player\\" frameborder=\\"0\\" allow=\\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share\\" referrerpolicy=\\"strict-origin-when-cross-origin\\" allowfullscreen></iframe>\\n\\n## Bonus\\n### Iconic Mathematica\'s colors and axes\\nThis is 97\'s set in `ColorData`, which gives this typical blue-ish color of any Wolfram Language plot. We can add it to our `Graphics` symbol as well as typical x- and y-axis\\n\\n```mathematica\\nGraphics[{\\n\\tColorData[97][1],\\n\\tLine[currentFrame // Offload],\\n\\t...\\n}, Axes->True, TransitionType->None]\\n```\\n\\n![](./../true-plot.svg)\\n\\n### Audio\\nAn audio can be extracted from a video file directly and played in the notebook\\n\\n```mathematica\\naudio = VideoExtractTracks[\\n\\tImport[FileNameJoin[{\\"attachments\\", \\"Touhou - Bad Apple.mp4\\"}]]\\n, {\\"Audio\\", 1}]\\n```\\n\\n![](./../Screenshot%202024-06-01%20at%2022.22.27.png)\\n\\nA completely different story is how to synchronize it with our animation. We need a stream player and manually feed audio chunks to it.\\n\\nThere is a low-level primitive `PCMPlayer`, which can be used for this purpose. So let us create an audio buffer first and assign it to a player\\n\\n```mathematica title=\\"cell\\"\\naudioBuffer = {};\\nPCMPlayer[audioBuffer // Offload, \\"SignedInteger16\\", SampleRate->44100]\\n```\\n\\nNow we need to provide PCM encoded data to it by chunks. Then we have to figure out how it is distributed over our frames\\n\\n```mathematica\\naudioData = AudioData[audio, \\"SignedInteger16\\"] // First;\\nchunks = NumericArray /@ Partition[audioData, Round[Length[audioData]/Length[video]] + 1000];\\n```\\n\\nHere we added extra `1000` samples to slightly overlap the portions to account the time needed for sending them and processing (just in case). You may increase it you hear some crackling noise. \\n\\nThen we drop first 100, since we skipped them in frames\\n\\n```mathematica\\nchunks = Drop[chunks, 100];\\n```\\n\\nand modify our animation function accordingly. For the simplicity we will go with [Using timer](#Using%20timer)\\n\\n```mathematica\\nindex = 1;\\ntask = SetInterval[\\n\\tcurrentFrame = frames[[index]];\\n\\taudioBuffer = chunks[[index]];\\n\\tindex++;\\n\\tIf[index > Length[frames], TaskRemove[task]];\\n, 1000/30.0];\\n```\\n\\n__Full code__ for the animation with sound is available below\\n\\n```mathematica title=\\"processing\\"\\nvideo = Import[FileNameJoin[{\\"attachments\\", \\"Touhou - Bad Apple.mp4\\"}], {\\"ImageList\\", All}]; \\n\\naudio = VideoExtractTracks[Import[FileNameJoin[{\\"attachments\\", \\"Touhou - Bad Apple.mp4\\"}]], {\\"Audio\\", 1}];\\n\\ntrace[frame_] :=\\n    Module[{img, pos, path},\\n        img = ImageAdjust[frame // Thumbnail // Binarize];\\n        pos = PixelValuePositions[img, 0]//N;\\n        path = FindShortestTour[pos][[2]];\\n        MovingAverage[pos[[path]], 5]\\n    ];\\n\\n(* optional *)\\nprogressBar[max_Real | max_Integer] := LeakyModule[{\\n\\tprogress = 0.,\\n\\tbar,\\n\\tincrement,\\n\\ttimer = AbsoluteTime[]\\n},\\n\\tbar = CellPrint[ToString[\\n\\t\\tGraphics[{\\n\\t\\t\\tLightBlue, Rectangle[{-1,-1}, {1,1}],\\n\\t\\t\\tGreen, Rectangle[{-1,-1}, {Offload[2 progress - 1], 1}]\\n\\t\\t}, ImagePadding->None, Controls->False, ImageSize->{400, 30}]\\n\\t, StandardForm], \\"After\\"->EvaluationCell[]];\\n\\n\\t(* throttling *)\\n\\tincrement[value_Real | value_Integer] := If[AbsoluteTime[] - timer > 0.1,\\n\\t\\ttimer = AbsoluteTime[];\\n\\t\\tprogress = value / max // N;\\n\\t\\tIf[progress >= 0.99, \\n\\t\\t\\tClearAll[increment];\\n\\t\\t\\tDelete[bar];\\n\\t\\t];\\n\\t];\\n\\n\\tincrement\\n];\\n\\nbar = progressBar[100];\\nframes = MapIndexed[Function[{frame, index},\\n  bar[index // First];\\n  trace[frame]\\n], Take[Drop[video,100], 100]];\\n\\nframes = NumericArray /@ frames;\\n\\naudioData = AudioData[audio, \\"SignedInteger16\\"] // First;\\nchunks = NumericArray /@ Partition[audioData, Round[Length[audioData]/Length[video]] + 1000];\\nchunks = Drop[chunks, 100];\\n```\\n\\n```mathematica title=\\"animating\\"\\naudioBuffer = {};\\ncurrentFrame = frames // First;\\nPCMPlayer[audioBuffer // Offload, \\"SignedInteger16\\", SampleRate->44100]\\n\\nGraphics[{\\n\\tRGBColor[0.368417, 0.506779, 0.709798],\\n\\tLine[currentFrame // Offload]\\n}, TransitionType->None, Axes->True]\\n```\\n\\n```mathematica title=\\"animating\\"\\nindex = 1;\\ntask = SetInterval[\\n\\tcurrentFrame = frames[[index]];\\n\\taudioBuffer = chunks[[index]];\\n\\tindex++;\\n\\tIf[index > Length[frames], TaskRemove[task]];\\n, 1000/30.0];\\n```\\n\\nSee you next time \ud83e\ude84\\n\\nCheers,\\nKirill"},{"id":"/2024/04/24/dynamic-env","metadata":{"permalink":"/wljs-docs/blog/2024/04/24/dynamic-env","source":"@site/blog/2024-04-24-dynamic-env/index.md","title":"Dynamic color and opacity implementation","description":"This is going to be our first dev-log post here \ud83e\udd84","date":"2024-04-24T00:00:00.000Z","tags":[{"label":"dev","permalink":"/wljs-docs/blog/tags/dev"},{"label":"graphics","permalink":"/wljs-docs/blog/tags/graphics"}],"readingTime":5.405,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"title":"Dynamic color and opacity implementation","tags":["dev","graphics"],"authors":"jerryi"},"unlisted":false,"prevItem":{"title":"Bad Apple, but it\u2019s Wolfram Language Plot","permalink":"/wljs-docs/blog/2024/05/01/badapple"},"nextItem":{"title":"Dynamic gauge","permalink":"/wljs-docs/blog/2024/04/22/gauge"}},"content":"![](./../2024-04-24-dynamic-env/opacitydouble-ezgif.com-optimize.gif)\\n\\nThis is going to be our first dev-log post here \ud83e\udd84\\n\\n\x3c!--truncate--\x3e\\n## State and stateless\\nLet me give you an example\\n\\n```mathematica\\n{RGBColor[1,0,0], Disk[{0,0}, 1]}\\n```\\n\\nWhat you do see here? \\n\\n<Wl>{`Graphics[{RGBColor[1,0,0], Disk[{0,0}, 1]}]`}</Wl>\\n\\nA __stateless__ `RGBColor` symbol modifies the local scope of a `List` substituting a new color value read later by `Disk`. Is the last one is also stateless? No\\n\\nThe beauty and simplicity of dynamics implemented in WLJS Interpreter \\n\\n```mathematica\\n{RGBColor[1,0,0], Disk[{0,0}, Offload[radius]]}\\n```\\n\\nis that each instance of a `Disk` has its own state - DOM element, a couple of properties such as position, radius, color, opacity and etc. It is important to note, that `radius` here is also an instance with its own state, determined by a symbol `radius` defined on Wolfram Kernel. Two nested instances can see each other form a couple. When a child changes, a parent is reevaluated with a new data\\n\\n```mathematica\\nradius = 1.0;\\nGraphics[{RGBColor[1,0,0], Disk[{0,0}, Offload[radius]]}]\\n\\nEventHandler[InputRange[0,1,0.1], Function[value, radius = value]]\\n```\\n\\n__What about color?..__\\n\\n### Virtual containers\\nThe name is a bit weird, however, the idea is that if an interpreter sees an attribute of a symbol\\n\\n```js\\ng2d.Disk = async (args, env) => {\\n//... normal evaluation\\n}\\n\\ng2d.Disk.update = async () => {\\n//... when child mutates\\n}\\n\\n// highlight-next-line\\ng2d.Disk.virtual = true \\n```\\n\\nIt alters the interpretation and creates a sort of container for this symbol to be evaluated inside it. This container has a local memory, identity and can see other such containers.\\n\\nWe can do in the same way and add this attribute to `RGBColor`\\n\\n```js\\ng2d.RGBColor.virtual = true\\n```\\n\\nThen the construction \\n\\n```mathematica\\n{RGBColor[color // Offload], Disk[{0,0}, 1]}\\n```\\n\\nWill work for sure. However, now we coupled the following symbols\\n\\n1. `RGBColor`\\n\\t1. `color`\\n\\nHow to bind `Disk` to `RGBColor` instance, which cannot be directly seen?\\n\\n### New update methods and coupling schemes\\nWhat we can do is to provide sort of a reference to `env` variable to a list of potentially coupled objects, i.e.\\n\\n```js\\ng2d.RGBColor = async () => {\\n\\t//... create references list\\n\\tconst refs = [];\\n\\tenv.exposed.colorRefs = refs;\\n}\\n\\ng2d.RGBColor.update = async () => {\\n\\t//... execute one by one using new data\\n\\tenv.exposed.colorRefs.forEach((instance) => {\\n\\t\\tinstance.execute({method: \'updateColor\', color: newColor});\\n\\t})\\n}\\n\\ng2d.RGBColor.virtual = true;\\n```\\n\\nThis scheme will update all connected instances. To connect we need to add a couple of line to `Disk` and other primitives\\n\\n```js\\ng2d.Disk = async () => {\\n\\t//...\\n\\t// highlight-start\\n\\tif (env.colorRefs) {\\n\\t\\t//append this instance to a list of references\\n\\t\\tenv.colorRefs.push(env.root);\\n\\t}\\n\\t// highlight-end\\n}\\n\\ng2d.Disk.update = async () => {}\\n\\t//... regular update method\\n\\t//for nested expressions\\n}\\n\\n// highlight-start\\ng2d.Disk.updateColor = (args, env) => {\\n\\t//new method just for updating color!\\n\\tenv.local.object.attr(\'fill\', env.color);\\n}\\n// highlight-end\\n```\\n\\nHere we also defined a additional method for updating just a color of a primitive. The same can be done for `Opacity` as well.\\n\\nOf course by turning `RGBColor` from stateless function into a sort of object comes with a additional overhead for an interpreter and memory. However later on we will check it on our performance tests.\\n\\n## Examples\\nThis opens up more possibilities for dynamics. In principle, this was the last thing, which was missing for a long time for a complete dynamic evaluating in WLJS Notebook.\\n\\nLet us see it on a simple example\\n\\n```mathematica\\ncolor = {1,0,0};\\nGraphics[{RGBColor[color // Offload], Disk[{0,0}, 1]}]\\n\\nEventHandler[InputJoystick[], Function[xy,\\n\\tcolor = Normalize[{xy[[1]], xy[[2]], 0.5}] // Abs;\\n]]\\n```\\n\\n![](./../2024-04-24-dynamic-env/color-ezgif.com-optimize.gif)\\n\\nOr using `Opacity` and blending between two `Disk`s\\n\\n```mathematica\\nopacity = 0.5;\\nGraphics[{Opacity[Offload[opacity]], Red, Disk[{0,0}, 1], Blue, Opacity[Offload[1.0 - opacity]], Disk[{0,0}, 1]}]\\n\\nEventHandler[InputRange[0,1,0.1], Function[value,\\n\\topacity = value;\\n]]\\n```\\n\\n![](./../2024-04-24-dynamic-env/opacity-ezgif.com-video-to-gif-converter.gif)\\n\\nOr even cooler - combining it with a traditional dynamics as well\\n\\n```mathematica\\nopacity = 0.5;\\nGraphics[{Opacity[Offload[opacity]], Red, Disk[{0,0}, Offload[1-opacity]], Blue, Opacity[Offload[1.0 - opacity]], Disk[{0,0}, Offload[opacity]]}, ImagePadding->None]\\n\\nEventHandler[InputRange[0,1,0.1], Function[value,\\n\\topacity = value;\\n]]\\n```\\n\\n![](./../2024-04-24-dynamic-env/opacitydouble-ezgif.com-optimize.gif)\\n\\n## Benchmarking\\nI have created a complete suite of tests to check the performance of the system as a whole and by certain sections, i.e.\\n\\n- Wolfram Kernel\\n- WLJS Interpreter\\n- HTTP and WebSockets\\n- 2D/3D dynamic graphics\\n- Stress test with many dynamic objects\\n\\nIt provides stats in the end as well as comparison to others results (if you shared)\\n\\n![](./../2024-04-24-dynamic-env/Statsj.svg)\\n*more is better, all bars a normalized*\\n\\nYou can download this notebook by the link down below\\n[__Benchmark__](./Archive.zip)\\n\\nAccording to multiple tests __this new feature does not actually impacts the performance that much__\\n\\n<Wl>{`Graphics[{{{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-155.}],Text[\\"2.3.7mod-again\\",{41.1213619850795429039,-155}],Null,(*VB[*)(RGBColor[0.368417, 0.506779, 0.709798])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcVTJv0VGXKdfsiw2kvp3eYP7AvOt4yw3vVtmf2AKMBH1E=\\"*)(*]VB*),Text[\\"Balls3D\\",{0,-153.5}],Rectangle[{0,-155.},{40.1213619850795429039,-154.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-291.}],Text[\\"2.3.7mod-again\\",{28.5596828143449073232,-291}],Null,(*VB[*)(RGBColor[0.880722, 0.611041, 0.142051])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRf5HIl+fl/vjX3Rv+oPt5b2PrYv2jxrnfouvUP2ALwBIFo=\\"*)(*]VB*),Text[\\"Boids\\",{0,-289.5}],Rectangle[{0,-291.},{27.5596828143449073232,-290}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-427}],Text[\\"2.3.7mod-again\\",{31.8636091611720548194,-427}],Null,(*VB[*)(RGBColor[0.560181, 0.691569, 0.194885])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxPIvawvD2oX1R6dq9/qGKz+yLJCfsvff34wl7AJc8HzE=\\"*)(*]VB*),Text[\\"Bubbles\\",{0,-425.5}],Rectangle[{0,-427.},{30.8636091611720548194,-426.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-563.}],Text[\\"2.3.7mod-again\\",{34.44481608018015,-563.}],Null,(*VB[*)(RGBColor[0.922526, 0.385626, 0.209179])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRdd2frNLrT1rX3RHf35ayTW3bAv0nBnXJRw7JQ9AKbfHmU=\\"*)(*]VB*),Text[\\"Javascript\\",{0,-561.5}],Rectangle[{0,-563.},{33.44481608018015,-562.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-699.}],Text[\\"2.3.7mod-again\\",{29.08988764044944,-699.}],Null,(*VB[*)(RGBColor[0.528488, 0.470624, 0.701351])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRctbepaFf/ygX3Rxzm6Clvk7tkXZXYxLC8vfGYPAKOQHmA=\\"*)(*]VB*),Text[\\"Kernel\\",{0,-697.5}],Rectangle[{0,-699.},{28.08988764044944,-698.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-835.}],Text[\\"2.3.7mod-again\\",{18.78573148316312,-835.}],Null,(*VB[*)(RGBColor[0.772079, 0.431554, 0.102387])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcFbb3Lcn/LC/uiOf6yq6fMu21f9EGy8wKH2S57AKMVHmg=\\"*)(*]VB*),Text[\\"Sockets\\",{0,-833.5}],Rectangle[{0,-835.},{17.78573148316312,-834.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-971.}],Text[\\"2.3.7mod-again\\",{28.4780824131753398995,-971.}],Null,(*VB[*)(RGBColor[0.363898, 0.618501, 0.782349])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRdNlna9JuV13b5oXdLH2YdOPbYvWnBX8SgD50t7AJbnHk8=\\"*)(*]VB*),Text[\\"Wave3D\\",{0,-969.5}],Rectangle[{0,-971.},{27.4780824131753398995,-970.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-1107.}],Text[\\"2.3.7mod-again\\",{25.281667388014572,-1107.}],Null,(*VB[*)(RGBColor[1, 0.75, 0])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEHeyjjBYzBwAAAGBIUhA==\\"*)(*]VB*),Text[\\"WLJS Interpreter\\",{0,-1105.5}],Rectangle[{0,-1107.},{24.281667388014572,-1106.}]}},{{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-173.5}],Text[\\"2.3.7mod-again\\",{39.0516683701718147991,-173.5}],Null,(*VB[*)(RGBColor[0.368417, 0.506779, 0.709798])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcVTJv0VGXKdfsiw2kvp3eYP7AvOt4yw3vVtmf2AKMBH1E=\\"*)(*]VB*),Null,Rectangle[{0,-173.5},{38.0516683701718147991,-172.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-309.5}],Text[\\"2.3.7mod-again\\",{20.2016399027377077984,-309.5}],Null,(*VB[*)(RGBColor[0.880722, 0.611041, 0.142051])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRf5HIl+fl/vjX3Rv+oPt5b2PrYv2jxrnfouvUP2ALwBIFo=\\"*)(*]VB*),Null,Rectangle[{0,-309.5},{19.2016399027377077984,-308.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-445.5}],Text[\\"2.3.7mod-again\\",{32.5379750106166660923,-445.5}],Null,(*VB[*)(RGBColor[0.560181, 0.691569, 0.194885])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxPIvawvD2oX1R6dq9/qGKz+yLJCfsvff34wl7AJc8HzE=\\"*)(*]VB*),Null,Rectangle[{0,-445.5},{31.5379750106166660923,-444.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-581.5}],Text[\\"2.3.7mod-again\\",{34.55704703356123,-581.5}],Null,(*VB[*)(RGBColor[0.922526, 0.385626, 0.209179])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRdd2frNLrT1rX3RHf35ayTW3bAv0nBnXJRw7JQ9AKbfHmU=\\"*)(*]VB*),Null,Rectangle[{0,-581.5},{33.55704703356123,-580.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-717.5}],Text[\\"2.3.7mod-again\\",{29.296547821165817,-717.5}],Null,(*VB[*)(RGBColor[0.528488, 0.470624, 0.701351])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRctbepaFf/ygX3Rxzm6Clvk7tkXZXYxLC8vfGYPAKOQHmA=\\"*)(*]VB*),Null,Rectangle[{0,-717.5},{28.296547821165817,-716.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-853.5}],Text[\\"2.3.7mod-again\\",{27.909625299046187,-853.5}],Null,(*VB[*)(RGBColor[0.772079, 0.431554, 0.102387])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcFbb3Lcn/LC/uiOf6yq6fMu21f9EGy8wKH2S57AKMVHmg=\\"*)(*]VB*),Null,Rectangle[{0,-853.5},{26.909625299046187,-852.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-989.5}],Text[\\"2.3.7mod-again\\",{29.33503251720164082,-989.5}],Null,(*VB[*)(RGBColor[0.363898, 0.618501, 0.782349])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRdNlna9JuV13b5oXdLH2YdOPbYvWnBX8SgD50t7AJbnHk8=\\"*)(*]VB*),Null,Rectangle[{0,-989.5},{28.33503251720164082,-988.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-1125.5}],Text[\\"2.3.7mod-again\\",{25.281667388014572,-1125.5}],Null,(*VB[*)(RGBColor[1, 0.75, 0])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEHeyjjBYzBwAAAGBIUhA==\\"*)(*]VB*),Null,Rectangle[{0,-1125.5},{24.281667388014572,-1124.5}]}},{{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-192.}],Text[\\"2.3.7mod-again\\",{40.8303240615595453281,-192.}],Null,(*VB[*)(RGBColor[0.368417, 0.506779, 0.709798])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcVTJv0VGXKdfsiw2kvp3eYP7AvOt4yw3vVtmf2AKMBH1E=\\"*)(*]VB*),Null,Rectangle[{0,-192.},{39.8303240615595453281,-191.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-328.}],Text[\\"2.3.7mod-again\\",{22.6915543344424267071,-328.}],Null,(*VB[*)(RGBColor[0.880722, 0.611041, 0.142051])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRf5HIl+fl/vjX3Rv+oPt5b2PrYv2jxrnfouvUP2ALwBIFo=\\"*)(*]VB*),Null,Rectangle[{0,-328.},{21.6915543344424267071,-327.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-464.}],Text[\\"2.3.7mod-again\\",{36.6945921190032067295,-464.}],Null,(*VB[*)(RGBColor[0.560181, 0.691569, 0.194885])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxPIvawvD2oX1R6dq9/qGKz+yLJCfsvff34wl7AJc8HzE=\\"*)(*]VB*),Null,Rectangle[{0,-464.},{35.6945921190032067295,-463.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-600.}],Text[\\"2.3.7mod-again\\",{31.487804922371094,-600.}],Null,(*VB[*)(RGBColor[0.922526, 0.385626, 0.209179])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRdd2frNLrT1rX3RHf35ayTW3bAv0nBnXJRw7JQ9AKbfHmU=\\"*)(*]VB*),Null,Rectangle[{0,-600.},{30.487804922371094,-599.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-736.}],Text[\\"2.3.7mod-again\\",{29.176951253874332,-736.}],Null,(*VB[*)(RGBColor[0.528488, 0.470624, 0.701351])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRctbepaFf/ygX3Rxzm6Clvk7tkXZXYxLC8vfGYPAKOQHmA=\\"*)(*]VB*),Null,Rectangle[{0,-736.},{28.176951253874332,-735.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-872.}],Text[\\"2.3.7mod-again\\",{27.461659958660547,-872.}],Null,(*VB[*)(RGBColor[0.772079, 0.431554, 0.102387])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcFbb3Lcn/LC/uiOf6yq6fMu21f9EGy8wKH2S57AKMVHmg=\\"*)(*]VB*),Null,Rectangle[{0,-872.},{26.461659958660547,-871.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-1008.}],Text[\\"2.3.7mod-again\\",{29.9574995752287149394,-1008.}],Null,(*VB[*)(RGBColor[0.363898, 0.618501, 0.782349])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRdNlna9JuV13b5oXdLH2YdOPbYvWnBX8SgD50t7AJbnHk8=\\"*)(*]VB*),Null,Rectangle[{0,-1008.},{28.9574995752287149394,-1007.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-1144.}],Text[\\"2.3.7mod-again\\",{29.901734170430736,-1144.}],Null,(*VB[*)(RGBColor[1, 0.75, 0])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEHeyjjBYzBwAAAGBIUhA==\\"*)(*]VB*),Null,Rectangle[{0,-1144.},{28.901734170430736,-1143.}]}},{{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-210.5}],Text[\\"2.3.7dynamic-env-mod\\",{43.1351729166549604647,-210.5}],Null,(*VB[*)(RGBColor[0.368417, 0.506779, 0.709798])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcVTJv0VGXKdfsiw2kvp3eYP7AvOt4yw3vVtmf2AKMBH1E=\\"*)(*]VB*),Null,Rectangle[{0,-210.5},{42.1351729166549604647,-209.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-346.5}],Text[\\"2.3.7dynamic-env-mod\\",{22.1917276116719819325,-346.5}],Null,(*VB[*)(RGBColor[0.880722, 0.611041, 0.142051])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRf5HIl+fl/vjX3Rv+oPt5b2PrYv2jxrnfouvUP2ALwBIFo=\\"*)(*]VB*),Null,Rectangle[{0,-346.5},{21.1917276116719819325,-345.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-482.5}],Text[\\"2.3.7dynamic-env-mod\\",{27.7761126705069847621,-482.5}],Null,(*VB[*)(RGBColor[0.560181, 0.691569, 0.194885])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxPIvawvD2oX1R6dq9/qGKz+yLJCfsvff34wl7AJc8HzE=\\"*)(*]VB*),Null,Rectangle[{0,-482.5},{26.7761126705069847621,-481.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-618.5}],Text[\\"2.3.7dynamic-env-mod\\",{33.467532517797814,-618.5}],Null,(*VB[*)(RGBColor[0.922526, 0.385626, 0.209179])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRdd2frNLrT1rX3RHf35ayTW3bAv0nBnXJRw7JQ9AKbfHmU=\\"*)(*]VB*),Null,Rectangle[{0,-618.5},{32.467532517797814,-617.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-754.5}],Text[\\"2.3.7dynamic-env-mod\\",{29.050490883590463,-754.5}],Null,(*VB[*)(RGBColor[0.528488, 0.470624, 0.701351])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRctbepaFf/ygX3Rxzm6Clvk7tkXZXYxLC8vfGYPAKOQHmA=\\"*)(*]VB*),Null,Rectangle[{0,-754.5},{28.050490883590463,-753.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-890.5}],Text[\\"2.3.7dynamic-env-mod\\",{28.25081921680832,-890.5}],Null,(*VB[*)(RGBColor[0.772079, 0.431554, 0.102387])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcFbb3Lcn/LC/uiOf6yq6fMu21f9EGy8wKH2S57AKMVHmg=\\"*)(*]VB*),Null,Rectangle[{0,-890.5},{27.25081921680832,-889.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-1026.5}],Text[\\"2.3.7dynamic-env-mod\\",{29.7583125861421421656,-1026.5}],Null,(*VB[*)(RGBColor[0.363898, 0.618501, 0.782349])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRdNlna9JuV13b5oXdLH2YdOPbYvWnBX8SgD50t7AJbnHk8=\\"*)(*]VB*),Null,Rectangle[{0,-1026.5},{28.7583125861421421656,-1025.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-1162.5}],Text[\\"2.3.7dynamic-env-mod\\",{23.409800394327608,-1162.5}],Null,(*VB[*)(RGBColor[1, 0.75, 0])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEHeyjjBYzBwAAAGBIUhA==\\"*)(*]VB*),Null,Rectangle[{0,-1162.5},{22.409800394327608,-1161.5}]}},{{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-229.}],Text[\\"2.3.7dynamic-env-mod\\",{40.3746446292874211543,-229.}],Null,(*VB[*)(RGBColor[0.368417, 0.506779, 0.709798])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcVTJv0VGXKdfsiw2kvp3eYP7AvOt4yw3vVtmf2AKMBH1E=\\"*)(*]VB*),Null,Rectangle[{0,-229.},{39.3746446292874211543,-228.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-365.}],Text[\\"2.3.7dynamic-env-mod\\",{18.9850479820475683134,-365.}],Null,(*VB[*)(RGBColor[0.880722, 0.611041, 0.142051])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRf5HIl+fl/vjX3Rv+oPt5b2PrYv2jxrnfouvUP2ALwBIFo=\\"*)(*]VB*),Null,Rectangle[{0,-365.},{17.9850479820475683134,-364.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-501.}],Text[\\"2.3.7dynamic-env-mod\\",{33.2238266423878200206,-501.}],Null,(*VB[*)(RGBColor[0.560181, 0.691569, 0.194885])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxPIvawvD2oX1R6dq9/qGKz+yLJCfsvff34wl7AJc8HzE=\\"*)(*]VB*),Null,Rectangle[{0,-501.},{32.2238266423878200206,-500.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-637.}],Text[\\"2.3.7dynamic-env-mod\\",{29.409090870606505,-637.}],Null,(*VB[*)(RGBColor[0.922526, 0.385626, 0.209179])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRdd2frNLrT1rX3RHf35ayTW3bAv0nBnXJRw7JQ9AKbfHmU=\\"*)(*]VB*),Null,Rectangle[{0,-637.},{28.409090870606505,-636.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-773.}],Text[\\"2.3.7dynamic-env-mod\\",{29.473804100227788,-773.}],Null,(*VB[*)(RGBColor[0.528488, 0.470624, 0.701351])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRctbepaFf/ygX3Rxzm6Clvk7tkXZXYxLC8vfGYPAKOQHmA=\\"*)(*]VB*),Null,Rectangle[{0,-773.},{28.473804100227788,-772.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-909.}],Text[\\"2.3.7dynamic-env-mod\\",{18.839009449807445,-909.}],Null,(*VB[*)(RGBColor[0.772079, 0.431554, 0.102387])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcFbb3Lcn/LC/uiOf6yq6fMu21f9EGy8wKH2S57AKMVHmg=\\"*)(*]VB*),Null,Rectangle[{0,-909.},{17.839009449807445,-908.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-1045.}],Text[\\"2.3.7dynamic-env-mod\\",{29.5135816411600968948,-1045.}],Null,(*VB[*)(RGBColor[0.363898, 0.618501, 0.782349])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRdNlna9JuV13b5oXdLH2YdOPbYvWnBX8SgD50t7AJbnHk8=\\"*)(*]VB*),Null,Rectangle[{0,-1045.},{28.5135816411600968948,-1044.}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-1181.}],Text[\\"2.3.7dynamic-env-mod\\",{24.174971031286216,-1181.}],Null,(*VB[*)(RGBColor[1, 0.75, 0])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEHeyjjBYzBwAAAGBIUhA==\\"*)(*]VB*),Null,Rectangle[{0,-1181.},{23.174971031286216,-1180.}]}},{{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-247.5}],Text[\\"2.3.7dynamic-env-mod\\",{40.6475793794916107524,-247.5}],{(*VB[*)(RGBColor[1, 0, 0])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEHeyiDgQHOAAALpBNd\\"*)(*]VB*),Arrow[{{60.6475793794916107524,-247.5},{54.6475793794916107524,-247.5}}]},(*VB[*)(RGBColor[0.368417, 0.506779, 0.709798])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcVTJv0VGXKdfsiw2kvp3eYP7AvOt4yw3vVtmf2AKMBH1E=\\"*)(*]VB*),Null,Rectangle[{0,-247.5},{39.6475793794916107524,-246.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-383.5}],Text[\\"2.3.7dynamic-env-mod\\",{22.3797035026747845987,-383.5}],{(*VB[*)(RGBColor[1, 0, 0])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEHeyiDgQHOAAALpBNd\\"*)(*]VB*),Arrow[{{42.3797035026747845987,-383.5},{36.3797035026747845987,-383.5}}]},(*VB[*)(RGBColor[0.880722, 0.611041, 0.142051])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRf5HIl+fl/vjX3Rv+oPt5b2PrYv2jxrnfouvUP2ALwBIFo=\\"*)(*]VB*),Null,Rectangle[{0,-383.5},{21.3797035026747845987,-382.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-519.5}],Text[\\"2.3.7dynamic-env-mod\\",{35.2746198401460182772,-519.5}],{(*VB[*)(RGBColor[1, 0, 0])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEHeyiDgQHOAAALpBNd\\"*)(*]VB*),Arrow[{{55.2746198401460182772,-519.5},{49.2746198401460182772,-519.5}}]},(*VB[*)(RGBColor[0.560181, 0.691569, 0.194885])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxPIvawvD2oX1R6dq9/qGKz+yLJCfsvff34wl7AJc8HzE=\\"*)(*]VB*),Null,Rectangle[{0,-519.5},{34.2746198401460182772,-518.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-655.5}],Text[\\"2.3.7dynamic-env-mod\\",{29.735632223282234,-655.5}],{(*VB[*)(RGBColor[1, 0, 0])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEHeyiDgQHOAAALpBNd\\"*)(*]VB*),Arrow[{{49.73563222328224,-655.5},{43.73563222328224,-655.5}}]},(*VB[*)(RGBColor[0.922526, 0.385626, 0.209179])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRdd2frNLrT1rX3RHf35ayTW3bAv0nBnXJRw7JQ9AKbfHmU=\\"*)(*]VB*),Null,Rectangle[{0,-655.5},{28.735632223282234,-654.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-791.5}],Text[\\"2.3.7dynamic-env-mod\\",{29.425241614553727,-791.5}],{(*VB[*)(RGBColor[1, 0, 0])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEHeyiDgQHOAAALpBNd\\"*)(*]VB*),Arrow[{{49.42524161455373,-791.5},{43.42524161455373,-791.5}}]},(*VB[*)(RGBColor[0.528488, 0.470624, 0.701351])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRctbepaFf/ygX3Rxzm6Clvk7tkXZXYxLC8vfGYPAKOQHmA=\\"*)(*]VB*),Null,Rectangle[{0,-791.5},{28.425241614553727,-790.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-927.5}],Text[\\"2.3.7dynamic-env-mod\\",{18.90666034611764,-927.5}],{(*VB[*)(RGBColor[1, 0, 0])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEHeyiDgQHOAAALpBNd\\"*)(*]VB*),Arrow[{{38.90666034611764,-927.5},{32.90666034611764,-927.5}}]},(*VB[*)(RGBColor[0.772079, 0.431554, 0.102387])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcFbb3Lcn/LC/uiOf6yq6fMu21f9EGy8wKH2S57AKMVHmg=\\"*)(*]VB*),Null,Rectangle[{0,-927.5},{17.90666034611764,-926.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-1063.5}],Text[\\"2.3.7dynamic-env-mod\\",{29.8111487223813499838,-1063.5}],{(*VB[*)(RGBColor[1, 0, 0])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEHeyiDgQHOAAALpBNd\\"*)(*]VB*),Arrow[{{49.8111487223813499838,-1063.5},{43.8111487223813499838,-1063.5}}]},(*VB[*)(RGBColor[0.363898, 0.618501, 0.782349])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRdNlna9JuV13b5oXdLH2YdOPbYvWnBX8SgD50t7AJbnHk8=\\"*)(*]VB*),Null,Rectangle[{0,-1063.5},{28.8111487223813499838,-1062.5}]},{Text[\\"Mac OS X ARM (64-bit)\\",{-15.5,-1199.5}],Text[\\"2.3.7dynamic-env-mod\\",{23.609088732252804,-1199.5}],{(*VB[*)(RGBColor[1, 0, 0])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEHeyiDgQHOAAALpBNd\\"*)(*]VB*),Arrow[{{43.6090887322528,-1199.5},{37.6090887322528,-1199.5}}]},(*VB[*)(RGBColor[1, 0.75, 0])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEHeyjjBYzBwAAAGBIUhA==\\"*)(*]VB*),Null,Rectangle[{0,-1199.5},{22.609088732252804,-1198.5}]}}},ImagePadding->20,Controls->False,ImageSize->{600,600}]`}</Wl>\\n\\nThe most impact I expected from a test called *Bubbles*, which involves a lot of creation and destruction of many graphics objects. However, it seems very weak.\\n\\nSee you next time \u2728\\n*Kirill*"},{"id":"/2024/04/22/gauge","metadata":{"permalink":"/wljs-docs/blog/2024/04/22/gauge","source":"@site/blog/2024-04-22-gauge.md","title":"Dynamic gauge","description":"Today we will implement a simple gauge using Javascript and HTML and then integrate it to Wolfram Language.","date":"2024-04-22T00:00:00.000Z","tags":[{"label":"javascript","permalink":"/wljs-docs/blog/tags/javascript"}],"readingTime":2.59,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["javascript"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Dynamic color and opacity implementation","permalink":"/wljs-docs/blog/2024/04/24/dynamic-env"},"nextItem":{"title":"Procedural spider animation","permalink":"/wljs-docs/blog/spider"}},"content":"Today we will implement a simple gauge using Javascript and HTML and then integrate it to Wolfram Language.\\n\\n![](./Screenshot%202024-05-25%20at%2009.26.26.png)\\n\\n\x3c!--truncate--\x3e\\n\\n## Javascript\\nUsing AI assistant, one can directly ask\\n\\n> write a gauge in Javascript\\n\\nWith some minor modifications we end up with the following code\\n\\n```js\\n.js\\n\\ncore.gauge = async (args, env) => {\\n  \\n  // Create a gauge meter element\\n  const gauge = document.createElement(\'div\');\\n  gauge.style.width = \'100px\'; // half the original width\\n  gauge.style.height = \'50px\'; // half the original height\\n  gauge.style.border = \'1px solid #000\';\\n  gauge.style.borderRadius = \'50px 50px 0 0\'; // adjusted for smaller size\\n  gauge.style.position = \'relative\';\\n  gauge.style.background = \'linear-gradient(to right, red 0%, yellow 50%, green 100%)\';\\n\\n  // Create a needle for the gauge\\n  const needle = document.createElement(\'div\');\\n  needle.style.width = \'2px\';\\n  needle.style.height = \'40px\'; // made the needle longer for better visibility\\n  needle.style.background = \'#000\';\\n  needle.style.position = \'absolute\';\\n  needle.style.bottom = \'0\';\\n  needle.style.left = \'50%\';\\n  needle.style.transformOrigin = \'bottom\';\\n\\n  // Function to set the needle position based on input value\\n  function setNeedlePosition(value) {\\n    // Ensure value is between 0 and 1\\n    value = Math.max(0, Math.min(1, value));\\n    // Convert value to angle\\n    const angle = value * 180 - 90; // -90 to 90 degrees\\n    needle.style.transform = `rotate(${angle}deg)`;\\n  }\\n\\n  // Set initial needle position\\n  const pos = await interpretate(args[0], env);\\n  setNeedlePosition(pos); // Middle position\\n  \\n\\n  gauge.appendChild(needle);\\n\\n  env.element.appendChild(gauge);\\n  env.local.update = setNeedlePosition;\\n}\\n\\ncore.gauge.update = async (args, env) => {\\n  const val = await interpretate(args[0], env);\\n  env.local.update(val);\\n}\\n\\ncore.gauge.destroy = () => {\\n  console.log(\'Nothing to do\');\\n}\\n\\ncore.gause.virtual = true\\n```\\n\\nIt already includes all dynamic methods such as `update` and `destroy` used to update the meter, once the data has been changed.\\n\\nTo test is we can write\\n\\n```mathematica\\ngauge[0.3] // CreateFrontEndObject\\n```\\n\\n## Dynamics\\nWe have already implemented `update` method, then we can directly hook it up to a slider\\n\\n```mathematica\\ngvalue = 0.1;\\nEventHandler[InputRange[0, 1, 0.1, 0.1], (gvalue = #) &]\\n\\ngauge[gvalue // Offload] // CreateFrontEndObject\\n```\\n\\n![](./gauge4-ezgif.com-video-to-gif-converter.gif)\\n\\n## Cleaning up\\nWe don\'t have to create FrontEndObject manually each time, it is can be done using `StandardForm` and `MakeBoxes`. There is a few way on how to implement it.\\n\\n### The simplest way\\nOne can force Wolfram Kernel to execute output expression on WLJS Interpreter via\\n\\n```mathematica title=\\"change 1\\"\\ngauge /: MakeBoxes[g_gauge, StandardForm] := With[{\\n  o = CreateFrontEndObject[g]\\n},\\n  MakeBoxes[o, StandardForm]\\n]\\n```\\n\\nthen we can freely do now\\n\\n```mathematica title=\\"change 2\\"\\ngvalue = 0.1;\\nEventHandler[InputRange[0, 1, 0.1, 0.1], (gvalue = #) &]\\n\\ngauge[gvalue // Offload]\\n```\\n\\n:::warning\\nThis makes expression not copyable from notebook to notebook, what you will see under the symbol is something like this\\n\\n```mathematica\\n(*VB[*)(FrontEndRef[\\"35fa850e-5bfd-48ab-84b2-dc815f5f2666\\"])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG5umJVqYGqTqmialpeiaWCQm6VqYJBnppiRbGJqmmaYZmZmZAQCMcRXe\\"*)(*]VB*)\\n```\\n\\nSee [Treating as a decoration](#Treating%20as%20a%20decoration) on how to fix this\\n:::\\n\\n### Treating as a decoration\\nWe can preserve the original symbol by just decorating it using `ViewBox`\\n\\n```mathematica title=\\"change 1\\"\\ngauge /: MakeBoxes[g_gauge, StandardForm] := With[{\\n\\n},\\n  ViewBox[g, g]\\n]\\n```\\n\\n\\nNow it is the same as it was before\\n\\n```mathematica title=\\"change 2\\"\\ngvalue = 0.1;\\nEventHandler[InputRange[0, 1, 0.1, 0.1], (gvalue = #) &]\\n\\ngauge[gvalue // Offload]\\n```\\n\\nBut if you try to copy it, you will see\\n\\n```mathematica\\n(*VB[*)(gauge[Offload[gvalue]])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRAeP5BwK8rPK3HNSwnLLCopTcyBSLACifTE0vRUCJcdSPinpeXkJ6YUs4GkyhJzSlMBOCoUGw==\\"*)(*]VB*)\\n```\\n\\n*The original expression is preserved!*"},{"id":"spider","metadata":{"permalink":"/wljs-docs/blog/spider","source":"@site/blog/2024-04-19-spider/index.md","title":"Procedural spider animation","description":"I have been always amazed by a fascinating procedural animation using in some games like Rain World. The key feature there is that you define sort of a target points for a model and a clever algorithm figures out the way how each bone or \\"leg\\" will move to achieve the goal. This is a common problem of kinematics. Let\'s start with the simplest approach","date":"2024-04-19T00:00:00.000Z","tags":[{"label":"animation","permalink":"/wljs-docs/blog/tags/animation"}],"readingTime":4.55,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["animation"],"enableComments":true,"slug":"spider"},"unlisted":false,"prevItem":{"title":"Dynamic gauge","permalink":"/wljs-docs/blog/2024/04/22/gauge"},"nextItem":{"title":"Image tracing and animation","permalink":"/wljs-docs/blog/image-trace"}},"content":"![](./../spider-ezgif.com-crop.gif)\\n\\nI have been always amazed by a fascinating procedural animation using in some games like *Rain World*. The key feature there is that you define sort of a target points for a model and a clever algorithm figures out the way how each bone or \\"leg\\" will move to achieve the goal. This is a common problem of kinematics. Let\'s start with the simplest approach\\n\\n\x3c!--truncate--\x3e\\n## Cycloid\\nIf we roll a ball over a plane surface with attached marker at the side it will produce a well-known curve\\n\\n```mathematica\\nParametricPlot[{x - Sin[x], 1 - Cos[x]}, {x,0,6Pi}]\\n```\\n\\n<Wl>{`ParametricPlot[{x - Sin[x], 1 - Cos[x]}, {x,0,6Pi}]`}</Wl>\\n\\nImagine it it were legs, which would follow multiple cycloids with a little offset. But firstly, we should get rid of a plane ground and turn it into something more interesting\\n\\n```mathematica @\\nland[x_] := 5.0 + (*FB[*)((Sin[x])(*,*)/(*,*)(10.0))(*]FB*) + Cos[(*FB[*)((x)(*,*)/(*,*)(10.0))(*]FB*)] x + (*FB[*)(((*SpB[*)Power[x(*|*),(*|*)2](*]SpB*))(*,*)/(*,*)(100.0))(*]FB*)\\n\\nParametricPlot[{x, land[x]}, {x,-20,80}]\\n```\\n\\n<Wl>{`ParametricPlot[{x, 5.0 + (*FB[*)((Sin[x])(*,*)/(*,*)(10.0))(*]FB*) + Cos[(*FB[*)((x)(*,*)/(*,*)(10.0))(*]FB*)] x + (*FB[*)(((*SpB[*)Power[x(*|*),(*|*)2](*]SpB*))(*,*)/(*,*)(100.0))(*]FB*)}, {x,-20,80}]`}</Wl>\\n\\nTo project cycloid onto `land` curve, we could not find anything better, that to offset `y` axis\\n\\n```mathematica @\\nParametricPlot[\\n  With[{b = land[x]}, {\\n    {x, b},\\n    {(*FB[*)(((4x - Sin[4x]))(*,*)/(*,*)(4))(*]FB*), b + 1 - Cos[4x]}\\n  }\\n] // Evaluate, {x,-20,80}]\\n```\\n\\n<Wl>{`ListLinePlot[Table[With[{b = 5.0 + ((Sin[x])/(10.0)) + Cos[((x)/(10.0))] x + ((Power[x,2])/(100.0))}, {{x, b},{(((4x - Sin[4x]))/(4)), b + 1 - Cos[4x]}}] , {x,-20,80, 0.2}]//Transpose]`}</Wl>\\n\\n*try to zoom in with a mouse*\\n\\n## FABRIK Inverse\xa0Kinematics\\nLegs of a spider are not straight lines, and consists of small segments needed to be animated separately. For this case there is a nice heuristic algorithm [FABRIK](http://www.andreasaristidou.com/FABRIK.html).\\n\\nI do not claim that my implementation is most optimized, but it does solve a problem\\n\\n```mathematica\\nClearAll[cached];\\ncached[expr_] := cached[expr] = expr;\\nSetAttributes[cached, HoldAll]\\n\\nSetAttributes[fabrik, HoldFirst]\\n\\nfabrik[chain_, target_, origin_] := Module[{\\n\\tbuffer, prev, \\n\\tlengths = cached[Norm /@ (chain // Reverse // Differences) // Reverse]\\n},\\n  buffer = Table[With[{p = chain[[-i]]},\\n    If[i === 1,\\n      prev = target;\\n      target\\n    ,\\n    \\n      prev = prev - Normalize[(prev - p)] lengths[[1-i]];\\n      prev \\n    ]\\n  ], {i, chain // Length}] // Reverse;\\n\\n  chain = Table[With[{p = buffer[[i]]},\\n    If[i === 1,\\n      prev = origin;\\n      origin\\n    ,\\n    \\n      prev = prev - Normalize[(prev - p)] lengths[[i-1]];\\n      prev \\n    ]\\n  ], {i, chain // Length}];\\n]\\n```\\n\\nLet us see how it works in the following example\\n\\n```mathematica\\nchain = {{0,0}, {0.5,1}, {1,1}, {1,0.5}};\\n\\nGraphics[{\\n  Line[chain // Offload],\\n  EventHandler[Graphics`Canvas[], {\\"mousemove\\" -> Function[xy,\\n    fabrik[chain, xy, {0,0}]\\n  ]}]\\n}]\\n```\\n\\n![](./../tricks-ezgif.com-optimize.gif)\\n\\nThe next idea will be to assign the target position of each leg to a cycloid.\\n\\n## Modelling legs\\nWe can isolate our a leg into a independent component, hence it would be easier to combine them together\\n\\n```mathematica @\\nleg[event_String, target_, origin_] := Module[{\\n  (*BB[*)(* initial leg segments *)(*,*)(*\\"1:eJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn+BSWZ+XnFaYwgCS4g4Zyfm5uaV+KUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU=\\"*)(*]BB*)\\n  chain = Table[k(target - origin) + origin, {k, -0.6, 1.6, 0.4}]\\n},\\n  (*BB[*)(* subscribe to an update *)(*,*)(*\\"1:eJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn+BSWZ+XnFaYwgCS4g4Zyfm5uaV+KUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU=\\"*)(*]BB*)\\n  With[{cloned = EventClone[event]},    \\n    EventHandler[cloned, Function[Null,\\n      fabrik[chain, target, origin]\\n    ]];\\n  ];\\n\\n  Offload[chain]\\n]\\n\\nSetAttributes[leg, HoldRest];\\n```\\n\\nhere the first argument specifies an `EventObject` identifier, that will be called later on to update all legs segments in the animation loop.\\n\\nNow we can combine multiple legs, which target\'s variables will follows cycloids with small offsets as follows\\n\\n```mathematica @\\ngetTarget[xoffset_, x_] := With[{b = land[x + xoffset]}, \\n  {\\n    (*FB[*)(((4(x + xoffset) - Sin[4(x + xoffset)]))(*,*)/(*,*)(4))(*]FB*), \\n    b + 1 - Cos[4(x + xoffset)]\\n  }\\n]\\n```\\n\\n```mathematica @\\nModule[{t = 4.0 (*BB[*)(*x-position of a spider*)(*,*)(*\\"1:eJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn+BSWZ+XnFaYwgCS4g4Zyfm5uaV+KUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU=\\"*)(*]BB*), ev = CreateUUID[]},\\n {\\n  Graphics[{\\n    Line[leg[ev, {t,1 + land[t]}, getTarget[-0.5, t]]], \\n    Line[leg[ev, {t,1 + land[t]}, getTarget[+0.25, t]]],\\n    Line[leg[ev, {t,1 + land[t]}, getTarget[0, t]]],    \\n    Line[leg[ev, {t,1 + land[t]}, getTarget[-0.25, t]]], \\n    Line[leg[ev, {t,1 + land[t]}, getTarget[+0.5, t]]],    \\n    \\n    (*BB[*)(* ground curve *)(*,*)(*\\"1:eJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn+BSWZ+XnFaYwgCS4g4Zyfm5uaV+KUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU=\\"*)(*]BB*)\\n    Plot[land[x], {x,0,20}]//First \\n  }],\\n\\n  EventHandler[InputRange[0,10, 0.1], Function[value, t = value; EventFire[ev, Null]]]\\n } // Row \\n]\\n```\\n\\n![](./../Screenshot%202024-05-19%20at%2016.10.26.png)\\n\\n## Adding controls\\nSlides are boring. Using ``Graphics`Canvas[]`` with `EventHandler` we can capture arrow keys and animate accordingly. However, to animate continuously we can set a timer and remove it once the target position of a spider has been reached\\n\\n```mathematica @\\nModule[{\\n  t = 4.0, \\n  ev = CreateUUID[], \\n  target = 4.0, task = Null, \\n  wake, sleep, view = {0,0}, \\n  win = CurrentWindow[]\\n},\\n\\n  (*BB[*)(* using linear interpolation animate to the target*)(*,*)(*\\"1:eJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn+BSWZ+XnFaYwgCS4g4Zyfm5uaV+KUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU=\\"*)(*]BB*)\\n  wake := If[task === Null, task = SetInterval[\\n    t = t + 0.1 (target - t);\\n    EventFire[ev, Null];\\n    \\n    If[Abs[t - target] < 0.01, sleep];\\n  , 30]];\\n\\n  sleep := With[{},\\n    TaskRemove[task];\\n    task = Null;\\n  ];\\n\\n  (*BB[*)(* animate the camera by view of the canvas *)(*,*)(*\\"1:eJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn+BSWZ+XnFaYwgCS4g4Zyfm5uaV+KUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU=\\"*)(*]BB*)\\n  camera := With[{center = (*FB[*)(({30,20})(*,*)/(*,*)(2))(*]FB*) + view, spider = {t, land[t]}},\\n    If[Norm[center - spider] > 10, \\n      view = (center - spider)/2;\\n      FrontSubmit[ZoomAt[1, -view], MetaMarker[\\"marked\\"], \\"Window\\"->win];\\n    ];\\n  ];\\n\\n \\n  Graphics[{\\n    Line[leg[ev, {t,1.5 + land[t]}, getTarget[-2 0.5, t]]], \\n    Line[leg[ev, {t,1.5 + land[t]}, getTarget[+2 0.25, t]]],\\n    Line[leg[ev, {t,1.5 + land[t]}, getTarget[0, t]]],    \\n    Line[leg[ev, {t,1.5 + land[t]}, getTarget[-2 0.25, t]]], \\n    Line[leg[ev, {t,1.5 + land[t]}, getTarget[+2 0.5, t]]],    \\n\\n    Plot[land[x], {x,-20,80}]//First,\\n\\n    MetaMarker[\\"marked\\"],\\n\\n    EventHandler[Graphics`Canvas[], {\\n      \\"capturekeydown\\" -> Function[value, \\n        Switch[value,\\n          \\"ArrowRight\\",\\n            target = target + 1;\\n            camera;\\n            wake;\\n          ,  \\n          \\"ArrowLeft\\",\\n            target = target - 1;\\n            camera;\\n            wake;\\n          ,\\n          _,\\n            Null\\n        ];\\n        EventFire[ev, Null]\\n      ]\\n    }]\\n  }, PlotRange->{{0, 30}, {0, 20}}, ImagePadding->None]\\n]\\n```\\n\\nHere we also animate the view of the canvas and pan it to keep our spider in the center of the screen. To achieve that we mark the graphics with `MetaMarker` and then execute in its context `ZoomAt` function, which affects the state of an existing `Graphics` container.\\n\\n*The result*\\n\\n![](./../spider-ezgif.com-crop.gif)\\n\\n*focus on a canvas with your mouse and control the spider using arrow keys*\\n\\nNotebook is available by the link below\\n\\n [__Spider.wln__](./Spider.wln)"},{"id":"image-trace","metadata":{"permalink":"/wljs-docs/blog/image-trace","source":"@site/blog/2024-04-13-imagetrace/index.md","title":"Image tracing and animation","description":"The notebook focuses on tracing and animating the contours of GIF images using WLJS Notebook.","date":"2024-04-13T00:00:00.000Z","tags":[{"label":"animation","permalink":"/wljs-docs/blog/tags/animation"}],"readingTime":2.58,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","enableComments":true,"slug":"image-trace","tags":["animation"]},"unlisted":false,"prevItem":{"title":"Procedural spider animation","permalink":"/wljs-docs/blog/spider"},"nextItem":{"title":"Autocomplete Input","permalink":"/wljs-docs/blog/2024/01/01/autocomplete"}},"content":"The notebook focuses on tracing and animating the contours of GIF images using WLJS Notebook.\\n\\nFirstly, import as a usual file\\n\\n```mathematica @\\nimgs = (*BB[*)(* Drag and drop your gif here *)(*,*)(*\\"1:eJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn+BSWZ+XnFaYwgCS4g4Zyfm5uaV+KUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU=\\"*)(*]BB*);\\n```\\n\\nNow in `imgs` we have a sequence of images. In our case this is a dinosaur \\n\\n![giphy](./../giphy.gif)\\n\\n*the source is unknown, sorry*\\n\\n\x3c!--truncate--\x3e\\n\\nTo trace all contours we adapt a method from @anderstood on StackExchange\\n\\nA custom function `trace[ii_]` is defined to process each image frame. \\n\\n```mathematica\\ntrace[ii_] :=\\nModule[{img, pts, z, m, n, cn, f, g}, \\n  img = ii;\\n  img = Binarize[img~ColorConvert~\\"Grayscale\\"~ImageResize~500~Blur~3];\\n  pts = DeleteDuplicates@Cases[Normal@ListContourPlot[Reverse@ImageData[img], \\n       Contours -> {0.5}], _Line, -1][[1, 1]];\\n\\n  z = pts[[All, 1]] + I*pts[[All, 2]];\\n  m = 50;\\n  n = Length@z;\\n  cn = 1/n*Table[Sum[z[[k]]*Exp[-I*i*k*2 Pi/n], {k, 1, n}], {i, -m, m}];\\n{f[t_], g[t_]} = {Re@#, Im@#} &@\\n    Sum[cn[[i + m + 1]]*Exp[I*i*t], {i, -m, m}] // ComplexExpand;\\n  Function[t, {f[t], g[t]}]\\n]\\n```\\n\\nIn a nutshell it does:\\n\\n- Binarizes and processes the image.\\n- Extracts contour points using the data from `ListContourPlot` (kinda a hack \ud83d\ude03).\\n- Performs Fourier analysis to create a smooth curve representation.\\n- Returns a parameterized function of the contour.\\n\\n## Frame processing\\n\\nThen we need to process each frame like that\\n\\n```mathematica\\nframes = Map[With[{f = trace[#]}, \\n  Table[f[p], {p,0,2Pi,0.01}]\\n]&, imgs];\\n```\\n*it might take a while*\\n\\nThe processed frames are animated with a slider as follows\\n\\n```mathematica\\ncurrentFrame = frames // First;\\n\\nEventHandler[InputRange[1,Length[imgs], 1, 1], Function[v, \\n\\tcurrentFrame = frames[[v]]\\n]]\\n\\nGraphics[Line[currentFrame // Offload]]\\n```\\n\\n![](./../dino66-ezgif.com-optimize.gif)\\n\\nHowever we can go further and analyze each color plotting a separate curve for it.\\n\\n## Color separation\\nTo find dominant colors use can follows this approach\\n\\n```mathematica\\nimg = imgs // First;\\n\\n(* Convert Image Data to a List of Colors *)\\ncolors = ImageData[ImageResize[img, 200], \\"Byte\\"];\\ncolorsList = Flatten[colors, 1];\\n\\n(* Cluster Colors Using KMeans *)\\nclusters = FindClusters[colorsList, 4, Method -> \\"KMeans\\"];\\n\\n(* Extract and Visualize Dominant Colors *)\\ndominantColors = Map[Mean, clusters];\\ndominantColors = Select[dominantColors, Norm[#[[;;3]]]>10 &];\\ndominantColorsRGB = RGBColor /@ (dominantColors / 255)\\n```\\n\\nas a result we have\\n\\n```mathematica @\\n{(*VB[*)(RGBColor[{116204/126735, 124/1207, 72346/126735, 42004/42245}])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJhchzIMmnscD0+2QWlxTZKJU89Qx/a1/0ZMq5uOM+u+yLOvoO8ca4PLIv6jo5T9Hl4nt7AA1hJUk=\\"*)(*]VB*),(*VB[*)(RGBColor[{1339/159154, 277964/397885, 35905/477462, 2365267/2387310}])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJhchzIMmnscD0+2QWlxT5pez1+GrVaF9kfnJb/beoZ/ZFE7K2LfZ02GxftJy9VDVmy3t7AA3lJL8=\\"*)(*]VB*),(*VB[*)(RGBColor[{19736/26295, 128738/149005, 163801/447015, 443111/447015}])(*,*)(*\\"1:eJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs/JLwouTyxJzghJzS3ISSxJhchzIMmnscD0+2QWlxSFXeRLmsHywr6Is/vVmkNLX9sX/V+y9fOi4uv2RYeX1veU7HhvDwAkIidz\\"*)(*]VB*)}\\n```\\n\\nOn the next step we will convolve those colors with an image\\n\\n```mathematica\\nClamp[val_List, max_] := Clamp[val//First, max]\\nClamp[val_, max_] := If[val > 0.5, 1, 0] max \\n\\ncolorSeparate[img_, colors_] := Table[Map[\\n  Map[\\n    Function[pixel, \\n      Clamp[i[[;;3]] . pixel[[;;3]] / 255.0, 1]\\n    ]\\n  , #]&\\n, img // ImageData] // Image, {i, colors}]\\n```\\n\\n```mathematica\\nImageResize[#, 100] &/@ colorSeparate[img, dominantColors] \\n```\\n\\n![](./../Screenshot%202024-05-19%20at%2013.55.02.png)\\n\\n### Animating each color channel separately\\nFirstly we will apply curve extracting on each channel of the frame\\n\\n```mathematica\\nframesColored = Table[Map[With[{f = trace[#]}, \\n  Table[f[p], {p,0,2Pi,0.01}]\\n]&, colorSeparate[frame, dominantColors] ], {frame, imgs}];\\n```\\n\\n```mathematica\\ncurrentFrameColored = framesColored // First;\\n\\nEventHandler[InputRange[1,Length[imgs], 1, 1], Function[v, currentFrameColored = framesColored[[v]]]]\\n\\nGraphics[\\n  Table[\\n    With[{i=i},\\n      {dominantColorsRGB[[i]], Polygon[currentFrameColored[[i]] // Offload]}\\n    ]\\n  , {i, Length[dominantColorsRGB]}] // Reverse\\n]\\n```\\n\\nHere we use `Polygon` instead of `Line` to get filling for each closed curve. An algorithm did not work well for all colors and we effectively have only two instead of 3\\n\\n![](./../dinooo.svg)\\n\\nTry it on your images!\\n\\n[__Image tracing.wln__](./Image%20tracing.wln)"},{"id":"/2024/01/01/autocomplete","metadata":{"permalink":"/wljs-docs/blog/2024/01/01/autocomplete","source":"@site/blog/2024-01-01-autocomplete.md","title":"Autocomplete Input","description":"We added a new standard input element! InputAutocomplete. Here is a short demo on that together with a text-to-speech example","date":"2024-01-01T00:00:00.000Z","tags":[{"label":"short","permalink":"/wljs-docs/blog/tags/short"},{"label":"speech","permalink":"/wljs-docs/blog/tags/speech"}],"readingTime":0.18,"hasTruncateMarker":false,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["short","speech"]},"unlisted":false,"prevItem":{"title":"Image tracing and animation","permalink":"/wljs-docs/blog/image-trace"},"nextItem":{"title":"Simples example of the Planar Inverse Kinematics","permalink":"/wljs-docs/blog/2023/12/20/fabrik"}},"content":"We added a new standard input element! `InputAutocomplete`. Here is a short demo on that together with a text-to-speech example\\n\\n```mathematica\\nEventHandler[InputAutocomplete[Function[{data, cbk},\\n  cbk[DictionaryLookup[data<>\\"*\\", 6]];\\n], \\"ClearOnSubmit\\"->False], Function[text,\\n  SpeechSynthesize[text, GeneratedAssetLocation -> None] // EmitSound\\n]]\\n```"},{"id":"/2023/12/20/fabrik","metadata":{"permalink":"/wljs-docs/blog/2023/12/20/fabrik","source":"@site/blog/2023-12-20-fabrik/index.mdx","title":"Simples example of the Planar Inverse Kinematics","description":"{%3Csmall%3Esrc.%20%5BFOUNDRY%5D%28https%3A%2F%2Flearn.foundry.com%2Fmodo%2Fcontent%2Fhelp%2Fpages%2Fanimation%2Fmodifiers%2Fplanar_ik.html%29%3C%2Fsmall%3E}","date":"2023-12-20T00:00:00.000Z","tags":[{"label":"graphics","permalink":"/wljs-docs/blog/tags/graphics"}],"readingTime":0.47,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["graphics"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Autocomplete Input","permalink":"/wljs-docs/blog/2024/01/01/autocomplete"},"nextItem":{"title":"An overview of Wolfram Language and WLJS","permalink":"/wljs-docs/blog/2023/12/12/notebook"}},"content":"![](attachments/planar_ik.png)\\n\\n\x3c!--truncate--\x3e\\n\\n\\n\\nimport { WLJSHTML, WLJSEditor, WLJSStore } from \\"@site/src/components/wljs-reactcells\\";\\n\\n<WLJSHTML>{`%3Csmall%3Esrc.%20%5BFOUNDRY%5D%28https%3A%2F%2Flearn.foundry.com%2Fmodo%2Fcontent%2Fhelp%2Fpages%2Fanimation%2Fmodifiers%2Fplanar_ik.html%29%3C%2Fsmall%3E`}</WLJSHTML>\\n\\n\\n\\n<WLJSStore json={require(\'./attachments/0c14ab53-e20b-4724-a7bc-e401a1483a87.txt\').default} notebook={require(\'./attachments/notebook-0c1.wln\').default}/>\\n\\n\\n\\n\\n\\n*the actual implemntation is not well-optimized for Wolfram Language, but serves a good purpose for the demonstration*\\n\\n\\nDefine a bunch of points connect them into a segmented line with fixed length\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"0c14ab53-e20b-4724-a7bc-e401a1483a87\\"} id={\\"49eed1a8-06d8-466e-8f04-099a7c9b6ce8\\"} type={\\"Input\\"} opts={{\\"Hidden\\":false,\\"init\\":false}} >{`chain%20%3D%20Table%5BExp%5B-%CF%95%5D%7B-Cos%5B%CF%95%5D%2C%20Sin%5B%CF%95%5D%7D%2C%20%7B%CF%95%2C%200%2C%20%CF%80%20-%20%CF%80%2F7%2C%20%CF%80%2F7.0%7D%5D%3B%0AGraphics%5B%7B%0A%20%20%20%20Line%5Bchain%20%2F%2F%20Offload%5D%2C%20Black%2C%20%0A%20%20%20%20PointSize%5B0.04%5D%2C%20Point%5Bchain%20%2F%2F%20Offload%5D%2C%20Red%2C%0A%20%20%20%20EventHandler%5BGraphics%60Canvas%5B%5D%2C%20%7B%0A%20%20%20%20%20%20%22mousemove%22%20-%3E%20handler%0A%20%20%20%20%7D%5D%0A%20%20%7D%2C%0A%20%20Axes-%3ETrue%2C%20PlotRange-%3E%7B%7B-1%2C0.2%7D%2C%20%7B0%2C0.4%7D%7D%2C%20ImageSize-%3E400%0A%5D`}</WLJSEditor>\\n\\n![](./../fabrik-ezgif.com-video-to-gif-converter.gif)\\n\\n*Dynamics is not available on this page. Download this notebook and run it*\\n\\n## FABRIK Solver\\nOriginal paper published in 2011\\n\\n<WLJSHTML>{`%3Ciframe%20class%3D%22rounded-md%20border-0%20mt-4%22%20style%3D%22width%3A600px%3B%20height%3A400px%22%20src%3D%22http%3A%2F%2Fwww.andreasaristidou.com%2Fpublications%2Fpapers%2FFABRIK.pdf%22%3E%3C%2Fiframe%3E`}</WLJSHTML>\\n\\nFor the demonstration purposes, we implemented this in the simples possible way.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"0c14ab53-e20b-4724-a7bc-e401a1483a87\\"} id={\\"7cdbf8d7-ea3d-4c53-9d4e-1094283dd4e7\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`handler%20%3D%20Function%5Btarget%2C%0A%20%20Module%5B%7Bbuffer%20%3D%20chain%2C%20origin%20%3D%20%7B-1%2C0%7D%2C%20prev%20%3D%20chain%2C%20lengths%20%3D%20Norm%20%2F%40%20%28chain%20%2F%2F%20Reverse%20%2F%2F%20Differences%29%20%2F%2F%20Reverse%7D%2C%0A%20%20%20%20buffer%20%3D%20Table%5BWith%5B%7Bp%20%3D%20chain%5B%5B-i%5D%5D%7D%2C%0A%20%20%20%20%20%20If%5Bi%20%3D%3D%3D%201%2C%0A%20%20%20%20%20%20%20%20prev%20%3D%20target%3B%0A%20%20%20%20%20%20%20%20target%0A%20%20%20%20%20%20%2C%0A%20%20%20%20%0A%20%20%20%20%20%20%20%20prev%20%3D%20prev%20-%20Normalize%5B%28prev%20-%20p%29%5D%20lengths%5B%5B1-i%5D%5D%3B%0A%20%20%20%20%20%20%20%20prev%20%0A%20%20%20%20%20%20%5D%0A%20%20%20%20%5D%20%20%20%0A%20%20%20%20%2C%20%7Bi%2C%20chain%20%2F%2F%20Length%7D%5D%20%2F%2F%20Reverse%3B%0A%0A%20%20%20%20buffer%20%3D%20Table%5BWith%5B%7Bp%20%3D%20buffer%5B%5Bi%5D%5D%7D%2C%0A%20%20%20%20%20%20If%5Bi%20%3D%3D%3D%201%2C%0A%20%20%20%20%20%20%20%20prev%20%3D%20origin%3B%0A%20%20%20%20%20%20%20%20origin%0A%20%20%20%20%20%20%2C%0A%20%20%20%20%0A%20%20%20%20%20%20%20%20prev%20%3D%20prev%20-%20Normalize%5B%28prev%20-%20p%29%5D%20lengths%5B%5Bi-1%5D%5D%3B%0A%20%20%20%20%20%20%20%20prev%20%0A%20%20%20%20%20%20%5D%0A%20%20%20%20%5D%0A%20%20%20%20%2C%20%7Bi%2C%20chain%20%2F%2F%20Length%7D%5D%3B%0A%0A%20%20%20%20chain%20%3D%20buffer%3B%0A%20%20%20%5D%0A%5D%3B`}</WLJSEditor>"},{"id":"/2023/12/12/notebook","metadata":{"permalink":"/wljs-docs/blog/2023/12/12/notebook","source":"@site/blog/2023-12-12-notebook/index.mdx","title":"An overview of Wolfram Language and WLJS","description":"Here we will quickly go though the basics of those two.","date":"2023-12-12T00:00:00.000Z","tags":[{"label":"notebook","permalink":"/wljs-docs/blog/tags/notebook"}],"readingTime":2.485,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["notebook"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Simples example of the Planar Inverse Kinematics","permalink":"/wljs-docs/blog/2023/12/20/fabrik"},"nextItem":{"title":"Modelling quantum spin-system with orbital degeneracy","permalink":"/wljs-docs/blog/2023/10/10/spin-hamiltonian"}},"content":"Here we will quickly go though the basics of those two.\\n\\n\x3c!--truncate--\x3e\\n\\nimport { WLJSHTML, WLJSEditor, WLJSStore } from \\"@site/src/components/wljs-reactcells\\";\\n\\n\\n\\n<WLJSStore json={require(\'./attachments/07d1d4eb-9d47-4fc1-9211-da04c457e56c.txt\').default} notebook={require(\'./attachments/notebook-07d.wln\').default}/>\\n\\n\\n\\n\\n---\\n\\n\\n![](attachments/Interface-1.png)\\n\\nBy the default any text in a new cell is considered to be Wolfram Language\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"7c7a2422-7a62-43ea-b8ca-49253fc799ca\\"} type={\\"Input\\"} opts={{}} >{`1%2B1`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"4a304623-4076-49bb-a487-effcb054b947\\"} type={\\"Output\\"} opts={{}} >{`2`}</WLJSEditor>\\n\\n__To evaluate an expression__ press play icon or `Shift+Enter`\\n\\n*One can also hide any input cell by clicking on a ^ mark on the left side*\\n\\n### Text cells\\nFor typing regular text, embedding pictures, making description we use Markdown language.\\n\\nTo make markdown cell type __in the first line of a new cell__ `.md`, if it was an anonymous file\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"8e022d34-0096-4501-99c5-f22ca6c49b32\\"} type={\\"Input\\"} opts={{}} >{`.md%0A%0A%23%20Heading%201%0A%23%23%20Heading%202%0A%0AHere%20is%20a%20regular%20paragraph%2C%20which%20can%20__be%20styled__%20in%20a%20%2Adifferent%20way%2A.%20Then%20press%20%60Shift%2BEnter%60%20to%20make%20an%20output%20cell.%0A%0AYou%20can%20also%20hide%20an%20input%20cell%20automatically%20by%20a%20shortcut%20%60Win%2FCmd%20%2B%202%60%0A%0A%24%5C%5CLaTeX%24%20is%20also%20supported%0A%0AAs%20well%20as%20regular%20HTML%20%3Cspan%20style%3D%22color%3Ared%22%3Elanguage%3C%2Fspan%3E`}</WLJSEditor>\\n\\n\\n# Heading 1\\n## Heading 2\\n\\nHere is a regular paragraph, which can __be styled__ in a *different way*. Then press `Shift+Enter` to make an output cell.\\n\\nYou can also hide an input cell automatically by a shortcut `Win/Cmd + 2`\\n\\n$\\\\LaTeX$ is also supported\\n\\nAs well as regular HTML <WLJSHTML>{`%3Cspan%20style%3D%22color%3Ared%22%3Elanguage%3C%2Fspan%3E`}</WLJSHTML>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"2de6a50a-67a5-4860-a8dd-575e1d36bdb0\\"} type={\\"Input\\"} opts={{}} >{`.md%0ATo%20embed%20a%20picture%20type%0A%0A%21%5Balt%5D%28https%3A%2F%2Fupload.wikimedia.org%2Fwikipedia%2Fcommons%2Fa%2Fa0%2FKilroy_was_here_%2528re-drawn%2529.gif%29`}</WLJSEditor>\\n\\nTo embed a picture type\\n\\n![alt](https://upload.wikimedia.org/wikipedia/commons/a/a0/Kilroy_was_here_%28re-drawn%29.gif)\\n\\nOr __just drag and drop__ any image file to a cell\\n\\nThere are many more cell types are available. For example\\n\\n### Javascript\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"fe51f3dd-2182-4a39-ad18-f37f91c4a6fe\\"} type={\\"Input\\"} opts={{}} >{`.js%0A%0Areturn%201%2B1%3B`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"js\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"accc0c94-2f76-47f0-9a15-77af41427a2f\\"} type={\\"Output\\"} opts={{}} >{`%0Areturn%201%2B1%3B`}</WLJSEditor>\\n\\n### Mermaid\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"6e45244a-66b1-4b8a-bf4c-75d98ea27491\\"} type={\\"Input\\"} opts={{}} >{`.mermaid%0A%0Agraph%20LR%0A%20%20%20%20A%5BSquare%20Rect%5D%20--%20Link%20text%20--%3E%20B%28%28Circle%29%29%0A%20%20%20%20A%20--%3E%20C%28Round%20Rect%29%0A%20%20%20%20B%20--%3E%20D%7BRhombus%7D%0A%20%20%20%20C%20--%3E%20D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"mermaid\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"f231cccd-bde1-460c-b3e1-66dcba7f2798\\"} type={\\"Output\\"} opts={{}} >{`%0Agraph%20LR%0A%20%20%20%20A%5BSquare%20Rect%5D%20--%20Link%20text%20--%3E%20B%28%28Circle%29%29%0A%20%20%20%20A%20--%3E%20C%28Round%20Rect%29%0A%20%20%20%20B%20--%3E%20D%7BRhombus%7D%0A%20%20%20%20C%20--%3E%20D`}</WLJSEditor>\\n\\n***and many more!***\\n\\n---\\n\\n# Wolfram Language\\nA symbolic programming language\\n\\nThere are a few key-features compared to other languages\\n\\n- Data and code are indistinguishable.\\n- It employs a pattern matching approach.\\n- It features a versatile standard library, friendly for mathematicians and physicists.\\n- It boasts a comprehensive standard library for visualizing data.\\n- Provides powerful syntax sugar\\n\\n*Output cells are editable, you can evaluate it as well*\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"04b2abe9-905d-4fb8-bd45-69543e622289\\"} type={\\"Input\\"} opts={{\\"Hidden\\":false}} >{`%7B1%2C1%2C2%2C2%2C2%2C2%7D%20%2F.%20%7B2%20-%3E%201%2C%201%20-%3E%200%7D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"2da21ecc-5850-4c4b-8918-cf2f6d10c8b1\\"} type={\\"Output\\"} opts={{}} >{`%7B0%2C0%2C1%2C1%2C1%2C1%7D`}</WLJSEditor>\\n\\nrules are one of the most powerful features, i.e.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"f744586e-2aeb-4d61-8786-ca8a003cc5be\\"} type={\\"Input\\"} opts={{}} >{`%7B0%2C0%2C1%2C1%2C1%2C1%7D%20%2F.%20%7Bany_Integer%20%3A%3E%20any%20%2F%202%7D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"9fb0e38e-32b9-4e3e-a5d2-0898424b7a94\\"} type={\\"Output\\"} opts={{}} >{`%7B0%2C0%2C%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%2C%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%2C%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%2C%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%7D`}</WLJSEditor>\\n\\nAnd __everything is a Symbol (or expression)__\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"edf444c4-caa8-45e8-8d54-3225c08f98ef\\"} type={\\"Input\\"} opts={{}} >{`%7B0%2C0%2C%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%2C%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%2C%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%2C%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%7D%20%2F.%20%7Bany_%3FNumericQ%20%3A%3E%20%7BRGBColor%5Bany%2C%201-any%2C%201%5D%2C%20any%7D%20%7D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"8b046a86-2f20-44e0-8601-03fedac0294d\\"} type={\\"Output\\"} opts={{}} >{`%7B%7B%28%2AVB%5B%2A%29%28RGBColor%5B0%2C%201%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxQAGU8cEezgAAAxwUjA%3D%3D%22%2A%29%28%2A%5DVB%2A%29%2C0%7D%2C%7B%28%2AVB%5B%2A%29%28RGBColor%5B0%2C%201%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxQAGU8cEezgAAAxwUjA%3D%3D%22%2A%29%28%2A%5DVB%2A%29%2C0%7D%2C%7B%28%2AVB%5B%2A%29%28RGBColor%5B1%2F2%2C%201%2F2%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEDe3TGB3sAGJkVmw%3D%3D%22%2A%29%28%2A%5DVB%2A%29%2C%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%7D%2C%7B%28%2AVB%5B%2A%29%28RGBColor%5B1%2F2%2C%201%2F2%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEDe3TGB3sAGJkVmw%3D%3D%22%2A%29%28%2A%5DVB%2A%29%2C%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%7D%2C%7B%28%2AVB%5B%2A%29%28RGBColor%5B1%2F2%2C%201%2F2%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEDe3TGB3sAGJkVmw%3D%3D%22%2A%29%28%2A%5DVB%2A%29%2C%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%7D%2C%7B%28%2AVB%5B%2A%29%28RGBColor%5B1%2F2%2C%201%2F2%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEDe3TGB3sAGJkVmw%3D%3D%22%2A%29%28%2A%5DVB%2A%29%2C%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%7D%7D`}</WLJSEditor>\\n\\nor may be you prefer tables\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"1f798744-d529-4336-9117-641faecf082d\\"} type={\\"Input\\"} opts={{}} >{`%25%20%2F%2F%20Transpose%20%2F%2F%20TableForm%20`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"3c755910-8ffc-4709-96ee-5f5077a8c229\\"} type={\\"Output\\"} opts={{}} >{`%28%2AGB%5B%2A%29%7B%7B%28%2AVB%5B%2A%29%28RGBColor%5B0%2C%201%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxQAGU8cEezgAAAxwUjA%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0%2C%201%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxQAGU8cEezgAAAxwUjA%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B1%2F2%2C%201%2F2%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEDe3TGB3sAGJkVmw%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B1%2F2%2C%201%2F2%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEDe3TGB3sAGJkVmw%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B1%2F2%2C%201%2F2%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEDe3TGB3sAGJkVmw%3D%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B1%2F2%2C%201%2F2%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEDe3TGB3sAGJkVmw%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B0%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%7D%7D%28%2A%5DGB%2A%29`}</WLJSEditor>\\n\\nOr something more complicated\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"a532adcf-31fd-4c97-a09c-f041851b9f75\\"} type={\\"Input\\"} opts={{\\"Hidden\\":false}} >{`Table%5BIf%5BPrimeQ%5Bi%5D%2C%20Framed%5Bi%2C%20Background-%3EYellow%5D%2C%20i%5D%2C%20%7Bi%2C%201%2C%2020%7D%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"2eeb874a-b6b0-4a3d-860f-0dca7c15e32b\\"} type={\\"Output\\"} opts={{}} >{`%7B1%2C%28%2ABB%5B%2A%29%282%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KWlMIB4HkHArSsxNdcqvgIiA5INKc1KLuYAMp8Tk7PSi%2FNK8lDRmmPIgdyfn%2FJz8okyQcRACiBnQdPMAGcElRZkF%2FnmeeQWlJcWsIJsSc4pTAcQ1Hcg%3D%22%2A%29%28%2A%5DBB%2A%29%2C%28%2ABB%5B%2A%29%283%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KWlMIB4HkHArSsxNdcqvgIiA5INKc1KLuYAMp8Tk7PSi%2FNK8lDRmmPIgdyfn%2FJz8okyQcRACiBnQdPMAGcElRZkF%2FnmeeQWlJcWsIJsSc4pTAcQ1Hcg%3D%22%2A%29%28%2A%5DBB%2A%29%2C4%2C%28%2ABB%5B%2A%29%285%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KWlMIB4HkHArSsxNdcqvgIiA5INKc1KLuYAMp8Tk7PSi%2FNK8lDRmmPIgdyfn%2FJz8okyQcRACiBnQdPMAGcElRZkF%2FnmeeQWlJcWsIJsSc4pTAcQ1Hcg%3D%22%2A%29%28%2A%5DBB%2A%29%2C6%2C%28%2ABB%5B%2A%29%287%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KWlMIB4HkHArSsxNdcqvgIiA5INKc1KLuYAMp8Tk7PSi%2FNK8lDRmmPIgdyfn%2FJz8okyQcRACiBnQdPMAGcElRZkF%2FnmeeQWlJcWsIJsSc4pTAcQ1Hcg%3D%22%2A%29%28%2A%5DBB%2A%29%2C8%2C9%2C10%2C%28%2ABB%5B%2A%29%2811%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KWlMIB4HkHArSsxNdcqvgIiA5INKc1KLuYAMp8Tk7PSi%2FNK8lDRmmPIgdyfn%2FJz8okyQcRACiBnQdPMAGcElRZkF%2FnmeeQWlJcWsIJsSc4pTAcQ1Hcg%3D%22%2A%29%28%2A%5DBB%2A%29%2C12%2C%28%2ABB%5B%2A%29%2813%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KWlMIB4HkHArSsxNdcqvgIiA5INKc1KLuYAMp8Tk7PSi%2FNK8lDRmmPIgdyfn%2FJz8okyQcRACiBnQdPMAGcElRZkF%2FnmeeQWlJcWsIJsSc4pTAcQ1Hcg%3D%22%2A%29%28%2A%5DBB%2A%29%2C14%2C15%2C16%2C%28%2ABB%5B%2A%29%2817%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KWlMIB4HkHArSsxNdcqvgIiA5INKc1KLuYAMp8Tk7PSi%2FNK8lDRmmPIgdyfn%2FJz8okyQcRACiBnQdPMAGcElRZkF%2FnmeeQWlJcWsIJsSc4pTAcQ1Hcg%3D%22%2A%29%28%2A%5DBB%2A%29%2C18%2C%28%2ABB%5B%2A%29%2819%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KWlMIB4HkHArSsxNdcqvgIiA5INKc1KLuYAMp8Tk7PSi%2FNK8lDRmmPIgdyfn%2FJz8okyQcRACiBnQdPMAGcElRZkF%2FnmeeQWlJcWsIJsSc4pTAcQ1Hcg%3D%22%2A%29%28%2A%5DBB%2A%29%2C20%7D`}</WLJSEditor>\\n\\n---\\n\\nThe same counts for Graphics\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"45073fef-738f-4777-b3e1-ac7afd285adb\\"} type={\\"Input\\"} opts={{}} >{`Plot%5Bx%2C%20%7Bx%2C0%2C1%7D%2C%20PlotStyle%20-%3E%20%28%2AVB%5B%2A%29%28RGBColor%5B1%2F2%2C%201%2F2%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEDe3TGB3sAGJkVmw%3D%3D%22%2A%29%28%2A%5DVB%2A%29%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"8692261e-c3ac-4597-bfba-82b1e16b6188\\"} type={\\"Input\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%220abffd63-2484-4b4f-b2e2-f0e9e52c0377%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKGyQmpaWlmBnrGplYmOiaJJmk6SYZpRrpphmkWqaaGiUbGJubAwCNohXQ%22%2A%29%28%2A%5DVB%2A%29%20%2F.%20%7B%28%2AVB%5B%2A%29%28RGBColor%5B1%2F2%2C%201%2F2%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxgMEDe3TGB3sAGJkVmw%3D%3D%22%2A%29%28%2A%5DVB%2A%29%20-%3E%20Red%7D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"7d3407cc-0c74-46a8-a33d-77dc0f8b0bcb\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%22e630c1ab-22ee-4894-bd4e-df01145b168a%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKp5oZGyQbJibpGhmlpuqaWFia6CalmKTqpqQZGBqamCYZmlkkAgCJYBXF%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\n*This is not a picture, this is a set of Wolfram Expressions covered with a decoration. Underneath there is still a working code*\\n\\nOr may be\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"c0a2b367-979e-4ac9-812d-1c608049abd9\\"} type={\\"Input\\"} opts={{}} >{`Graphics3D%5BSphere%5B%5D%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"83d854ba-b34a-4c95-a012-1d95e30a9c29\\"} type={\\"Input\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%223a8e7b43-b8da-4fd7-8029-9fce36edb5d3%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKGydapJonmRjrJlmkJOqapKWY61oYGFnqWqYlpxqbpaYkmaYYAwCNjRZC%22%2A%29%28%2A%5DVB%2A%29%2F.%20%7BSphere%20-%3E%20Cuboid%7D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"fae27ace-da79-4600-82f8-81274ec940f4\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%22167ffe0f-6f06-4ba9-ae2c-98abf947a7cc%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG5qZp6WlGqTpmqUZmOmaJCVa6iamGiXrWlokJqVZmpgnmicnAwCPcxZx%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nOr play some sound\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"2a766044-8724-4913-8f22-30a57a3dac54\\"} type={\\"Input\\"} opts={{}} >{`ListPlay%5BTable%5BSin%5B2%20%CF%80%2050%20t%5D%2C%20%7Bt%2C%200%2C%201%2C%201.%2F2000%7D%5D%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"07d1d4eb-9d47-4fc1-9211-da04c457e56c\\"} id={\\"64136dd2-d4a8-49ba-ada6-61a77e5d8344\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%22f51f5383-6cd0-41da-a191-c1bc8c4a6f6b%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKp5kappkaWxjrmiWnGOiaGKYk6iYaWhrqJhsmJVskmySapZklAQCEkRX4%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>"},{"id":"/2023/10/10/spin-hamiltonian","metadata":{"permalink":"/wljs-docs/blog/2023/10/10/spin-hamiltonian","source":"@site/blog/2023-10-10-spin-hamiltonian/index.mdx","title":"Modelling quantum spin-system with orbital degeneracy","description":"This notebook delves into quantum mechanics with a focus on symbolic quantum operators and spin-Hamiltonians. It begins with setting up orthogonality rules and defining the linear properties of basis functions.","date":"2023-10-10T00:00:00.000Z","tags":[{"label":"quantum","permalink":"/wljs-docs/blog/tags/quantum"},{"label":"animation","permalink":"/wljs-docs/blog/tags/animation"}],"readingTime":5.755,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"authors":"jerryi","tags":["quantum","animation"],"enableComments":true},"unlisted":false,"prevItem":{"title":"An overview of Wolfram Language and WLJS","permalink":"/wljs-docs/blog/2023/12/12/notebook"},"nextItem":{"title":"Image and Raster were implemented!","permalink":"/wljs-docs/blog/imageraster"}},"content":"This notebook delves into quantum mechanics with a focus on symbolic quantum operators and spin-Hamiltonians. It begins with setting up orthogonality rules and defining the linear properties of basis functions.\\n\\nNext, we investigate the spin-Hamiltonian for a cubic system with doubly degenerated orbital states, particularly focusing on $Fe^{2+}$ ions in cubic spinels with $^5E_g$ states. The Hamiltonian for a paramagnetic state is presented and implemented in code, followed by defining basis vectors and functions to find eigenvalues and eigenvectors, and calculating thermal averages of quantum operators.\\n\\n\x3c!--truncate--\x3e\\n\\n---\\n\\nLet us start from the ground level - *how to represent a state*\\n\\nimport { WLJSHTML, WLJSEditor, WLJSStore } from \\"@site/src/components/wljs-reactcells\\";\\n\\n\\n\\n<WLJSStore json={require(\'./attachments/44b68f07-c3d6-4925-99c0-99f949c395f0.txt\').default} notebook={require(\'./attachments/notebook-44b.wln\').default}/>\\n\\n\\n\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"75d9f1a8-f8de-4944-9675-3d80ddf19a87\\"} type={\\"Output\\"} opts={{}} >{`%28%2ABB%5B%2A%29%28Ket%5B%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29`}</WLJSEditor>\\n\\nJust copy and paste the expression above to have prettier representation of your wavefunction.\\n\\nLet\'s work with wavefunction in the basis of $S=2$ and a doubly-degenerated orbital state $\\\\hat{L}=1/2$\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"fcef7bb0-031c-45cc-94d8-fec7f794bde5\\"} type={\\"Input\\"} opts={{}} >{`%28%2ABB%5B%2A%29%28Ket%5BMs%2C%20Ml%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29`}</WLJSEditor>\\n\\n\\n## Setting up rules\\nFirstly, define the ortogonality of our basis functions\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"0f0a1000-2228-4cf5-a6b4-abe66b0a0f22\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`Ket%20%2F%3A%20%28%2ABB%5B%2A%29%28Bra%5BMs1_%2C%20Ml1_%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMaeiRJfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABBAEzo%3D%22%2A%29%28%2A%5DBB%2A%29.%28%2ABB%5B%2A%29%28Ket%5BMs2_%2C%20Ml2_%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29%20%3A%3D%20KroneckerDelta%5BMs1%2C%20Ms2%5D%20KroneckerDelta%5BMl1%2C%20Ml2%5D%0A%0AKet%20%2F%3A%20Conjugate%5B%28%2ABB%5B%2A%29%28Ket%5BMs2_%2C%20Ml2_%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29%5D%20%3A%3D%20%28%2ABB%5B%2A%29%28Bra%5BMs2%2C%20Ml2%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMaeiRJfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABBAEzo%3D%22%2A%29%28%2A%5DBB%2A%29%20%20`}</WLJSEditor>\\n\\n__Linear properties__ must also be defined as well\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"9f55b8ec-17af-42a4-8aa4-2f63e34f1076\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`Unprotect%5BDot%5D%3B%0AUnprotect%5BConjugate%5D%3B%0A%0AConjugate%5Ba_%20b_%5D%20%3A%3D%20Conjugate%5Ba%5D%20Conjugate%5Bb%5D%0AConjugate%5Ba_%20%2B%20b_%5D%20%3A%3D%20Conjugate%5Ba%5D%20%2B%20Conjugate%5Bb%5D%0ADot%5Ba_%2C%20b_%3FNumericQ%5D%20%3A%3D%20b%20a%0ADot%5Bb_%3FNumericQ%2C%20a_%5D%20%3A%3D%20b%20a%0ADot%5Ba_%20%2B%20b_%2C%20c_%5D%20%3A%3D%20a.c%20%2B%20b.c%20%0ADot%5Bc_%2C%20a_%20%2B%20b_%5D%20%3A%3D%20c.a%20%2B%20c.b%20%20%0ADot%5Ba_%2C%20b_%3FNumericQ%20c_%5D%20%3A%3D%20b%20a.c%0ADot%5Bb_%3FNumericQ%20c_%2C%20a_%5D%20%3A%3D%20b%20c.a%0A%0AProtect%5BDot%5D%3B%0AProtect%5BConjugate%5D%3B`}</WLJSEditor>\\n\\n## Symbolic quantum operators\\nA well known ladder-like operators (see [more here](https://easyspin.org/easyspin/documentation/spinoperators.html)) as well as pauli-like operators $U_\\\\theta$, $U_\\\\varepsilon$ for an orbital doublet\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"34f1e933-2579-47ac-9d9d-5334f990c173\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`Ket%20%2F%3A%20Sp.%28%2ABB%5B%2A%29%28Ket%5BMs_%2C%20Ml_%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29%20%3A%3D%20%28%2ASqB%5B%2A%29Sqrt%5B2%282%2B1%29%20-%20%28Ms%2B1%29Ms%5D%28%2A%5DSqB%2A%29%20%28%2ABB%5B%2A%29%28Ket%5BMs%2B1%2C%20Ml%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29%0AKet%20%2F%3A%20Sm.%28%2ABB%5B%2A%29%28Ket%5BMs_%2C%20Ml_%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29%20%3A%3D%20%28%2ASqB%5B%2A%29Sqrt%5B2%282%2B1%29%20-%20%28Ms-1%29Ms%5D%28%2A%5DSqB%2A%29%20%28%2ABB%5B%2A%29%28Ket%5BMs-1%2C%20Ml%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29%0AKet%20%2F%3A%20Sz.%28%2ABB%5B%2A%29%28Ket%5BMs_%2C%20Ml_%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29%20%3A%3D%20Ms%20%28%2ABB%5B%2A%29%28Ket%5BMs%2C%20Ml%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29%0A%0AU%CE%B8%20%3D%20Sum%5B%28%2ABB%5B%2A%29%28Ket%5BMs%2C1%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29.%28%2ABB%5B%2A%29%28Bra%5BMs%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMaeiRJfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABBAEzo%3D%22%2A%29%28%2A%5DBB%2A%29%20-%20%28%2ABB%5B%2A%29%28Ket%5BMs%2C-1%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29.%28%2ABB%5B%2A%29%28Bra%5BMs%2C%20-1%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMaeiRJfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABBAEzo%3D%22%2A%29%28%2A%5DBB%2A%29%2C%20%7BMs%2C-2%2C2%7D%5D%3B%0AU%CF%B5%20%3D%20Sum%5B%28%2ABB%5B%2A%29%28Ket%5BMs%2C1%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29.%28%2ABB%5B%2A%29%28Bra%5BMs%2C%20-1%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMaeiRJfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABBAEzo%3D%22%2A%29%28%2A%5DBB%2A%29%20%2B%20%28%2ABB%5B%2A%29%28Ket%5BMs%2C-1%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29.%28%2ABB%5B%2A%29%28Bra%5BMs%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMaeiRJfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABBAEzo%3D%22%2A%29%28%2A%5DBB%2A%29%2C%20%7BMs%2C-2%2C2%7D%5D%3B%0A%0ASx%20%3D%20%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29%28Sp%20%2B%20Sm%29%3B%0ASy%20%3D%20%20%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282I%20%29%29%28%2A%5DFB%2A%29%28Sp%20-%20Sm%29%3B%20%0A`}</WLJSEditor>\\n\\n### Testing\\n\\ncheck a single operator\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"712f64a9-e8f7-4c89-ab9a-de5e91396c44\\"} type={\\"Input\\"} opts={{}} >{`Sm.%28%2ABB%5B%2A%29%28Ket%5B0%2C1%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"f039f870-17ce-4bdd-93a1-df4dad254e95\\"} type={\\"Output\\"} opts={{}} >{`%28%28%2ASqB%5B%2A%29Sqrt%5B6%5D%28%2A%5DSqB%2A%29%29%20%28%28%2ABB%5B%2A%29%28Ket%5B-1%2C1%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29%29`}</WLJSEditor>\\n\\nWe can also build the matrix of a operator in the basis of spin-only states\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"3cc87509-2d6d-40e6-bf22-704536ae3ffa\\"} type={\\"Input\\"} opts={{}} >{`Table%5B%0A%0A%20%20%28%2ABB%5B%2A%29%28Bra%5BMs1%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMaeiRJfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABBAEzo%3D%22%2A%29%28%2A%5DBB%2A%29.%28Sz%29.%28%2ABB%5B%2A%29%28Ket%5BMs2%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29%0A%0A%2C%20%7BMs1%2C%20-2%2C2%7D%2C%20%7BMs2%2C%20-2%2C2%7D%5D%20%2F%2F%20MatrixForm%20`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"94da53aa-2903-4980-b377-909f98e0b262\\"} type={\\"Output\\"} opts={{}} >{`%28%28%2AGB%5B%2A%29%7B%7B-2%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B0%28%2A%7C%2A%29%2C%28%2A%7C%2A%29-1%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B0%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B0%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%291%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B0%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%7D%7D%28%2A%5DGB%2A%29%29`}</WLJSEditor>\\n\\nNow check the modulus of an spin-momentum\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"8d137b94-3783-4faa-9d8f-96d1026f44be\\"} type={\\"Input\\"} opts={{}} >{`Table%5B%0A%0A%20%20%28%2ABB%5B%2A%29%28Bra%5BMs1%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMaeiRJfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABBAEzo%3D%22%2A%29%28%2A%5DBB%2A%29.%28Sz.Sz%20%2B%20Sx.Sx%20%2B%20Sy.Sy%29.%28%2ABB%5B%2A%29%28Ket%5BMs2%2C%201%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29%0A%0A%2C%20%7BMs1%2C%20-2%2C2%7D%2C%20%7BMs2%2C%20-2%2C2%7D%5D%20%2F%2F%20MatrixForm%20`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"2ed8138f-66a2-42e3-bc42-54d9b282e186\\"} type={\\"Output\\"} opts={{}} >{`%28%28%2AGB%5B%2A%29%7B%7B6%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B0%28%2A%7C%2A%29%2C%28%2A%7C%2A%296%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B0%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%296%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B0%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%296%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B0%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%290%28%2A%7C%2A%29%2C%28%2A%7C%2A%296%7D%7D%28%2A%5DGB%2A%29%29`}</WLJSEditor>\\n\\nThis is correct! As it should be $S(S + 1) = 6$\\n\\n## Spin-Hamiltonian\\nLet us have a look at the cubic system with a doubly degenerated orbital states. For example, it can be effectively $Fe^{2+}$ ions in a cubic spinels with $^5E_g$ states as a ground multiplet. Let us have a look at the Hamiltonian for a paramagnetic state\\n\\n$$\\nH = \\\\mu g~ \\\\mathbf{S H_0} - d \\\\Big[ U_{\\\\theta} (3 Sz^2 - S(S+1)) + \\\\sqrt{3} U_{\\\\epsilon}(Sx^2 - Sy^2)  \\\\Big] \\n$$\\n\\nwhere $d$ accounts for an effective spin-orbit coupling and then dictates cubic anistoropy for the spin\\n\\n### Implementation\\nNow we move to the actual code\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"4093b274-8e97-4f30-8ccb-2876acdb3ecf\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`%CE%BC%20%3D%200.466%3B%0Ag%20%3D%202.%3B`}</WLJSEditor>\\n\\nEffective hamiltonian in our notations\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"871e3517-a110-4a95-b065-8f9b5272e000\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`H%5BHx_%2C%20Hy_%2C%20Hz_%2C%20d_%5D%20%3A%3D%20%CE%BC%20g%20%28Hx%20Sx%20%2B%20Hy%20Sy%20%2B%20Hz%20Sz%20%29%20-%20d%20%283%20Sz.Sz.U%CE%B8%20-%20%202%282%2B1%29%20U%CE%B8%20%2B%20%28%2ASqB%5B%2A%29Sqrt%5B3%5D%28%2A%5DSqB%2A%29%20Sx.Sx.U%CF%B5%20-%20%28%2ASqB%5B%2A%29Sqrt%5B3%5D%28%2A%5DSqB%2A%29%20Sy.Sy.U%CF%B5%29`}</WLJSEditor>\\n\\nNow define an array of basis vectors and function to __find eigenvalues and eigenvectors__\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"51af0447-17fb-4d21-92e9-5ee1d160da06\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`basis%20%3D%20Table%5B%28%2ABB%5B%2A%29%28Ket%5BMs2%2C%20Ml%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFxTxAMe%2FUEpfU5PyixJL8IohKFiARVJqTGgxieKQmpgQzQ9QBABLAE1g%3D%22%2A%29%28%2A%5DBB%2A%29%2C%20%7BMs2%2C-2%2C2%7D%2C%20%7BMl%2C-1%2C1%2C2%7D%5D%20%2F%2F%20Flatten%3B%20%0A%0Asystem%5Bparams__%5D%20%3A%3D%20With%5B%7B%20h%20%3D%20Simplify%5BH%5Bparams%5D%5D%7D%2C%20With%5B%7B%0A%20%20r%20%3D%20Table%5B%0A%0A%20%20%20%20Conjugate%5Bi%5D.%28h.j%29%0A%0A%20%20%2C%20%7Bi%2C%20basis%7D%2C%20%7Bj%2C%20basis%7D%5D%20%20%2F%2F%20Eigensystem%20%2F%2F%20Transpose%20%0A%7D%2C%0A%0A%20%20%28%2A%20truncate%20accuracy%20%2A%29%0A%20%20r%20%2F%2F%20Chop%0A%5D%20%5D`}</WLJSEditor>\\n\\nNow we need a helper function to find a __thermal average of any quantum operator__\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"87b512a0-d724-466c-845c-551b28b56a51\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`%28%2A%20for%20caching%20already%20calculated%20values%20%2A%29%0A%0AClearAll%5Bcached%5D%3B%0Acached%5Bexpr_%5D%20%3A%3D%20cached%5Bexpr%5D%20%3D%20expr%3B%0ASetAttributes%5Bcached%2C%20HoldFirst%5D%0A%0A%0Aaverage%5Bsys_%2C%20T_%2C%20operator_%5D%20%3A%3D%20With%5B%7B%0A%20%20operatorMatrix%20%3D%20cached%5BTable%5BConjugate%5Bi%5D.operator.j%2C%20%7Bi%2C%20basis%7D%2C%20%7Bj%2C%20basis%7D%5D%5D%2C%0A%20%20%0A%20%20stat%20%3D%20Total%5BExp%5B-%28%2AFB%5B%2A%29%28%28%23%5B%5B1%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%280.7%20T%29%29%28%2A%5DFB%2A%29%5D%20%26%2F%40%20sys%5D%0A%7D%2C%0A%20%20Map%5B%0A%20%20%20%20%28%28Conjugate%5B%7B%23%5B%5B2%5D%5D%7D%5D.operatorMatrix.Transpose%5B%7B%23%5B%5B2%5D%5D%7D%5D%29%20%2F%2F%20First%20%2F%2F%20First%29%20%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%28stat%29%29%28%2A%5DFB%2A%29%20Exp%5B-%28%2AFB%5B%2A%29%28%28%23%5B%5B1%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%280.7%20T%29%29%28%2A%5DFB%2A%29%5D%20%26%0A%20%20%20%20%2C%20sys%5D%20%2F%2F%20Total%20%20%0A%5D`}</WLJSEditor>\\n\\nUsually for such systems a parameter $d\\\\simeq 3-4~cm^{-1}$. \\n\\nLet\'s try to see a magnetic anisotropy in an averaged magnetic moment of a single ion site at $T=10~K$ in the magnetic field around $10~T$\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"300638ac-7c5f-406b-883f-24f341f61a29\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true}} >{`Table%5B%0A%20%20With%5B%7B%0A%20%20%20%20%28%2ABB%5B%2A%29%28%2Aapply%20a%20magnetic%20field%20to%20the%20given%20direction%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20sys%20%3D%20system%5B10%20Sin%5Bx%5D%2C%2010%20Cos%5Bx%5D%2C%200%2C%203.%5D%0A%20%20%7D%2C%0A%20%20%20%20%28%2ABB%5B%2A%29%28%2Aproject%20magnetic%20moment%20to%20the%20direction%20of%20field%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%282.0%20average%5Bsys%2C%2010%2C%20%23%5D%20%26%2F%40%20%7BSx%2C%20Sy%7D%29.%28%7BSin%5Bx%5D%2C%20%20Cos%5Bx%5D%7D%29%0A%20%20%20%0A%20%20%5D%20%7BSin%5Bx%5D%2C%20%20Cos%5Bx%5D%7D%0A%2C%20%7Bx%2C%200%2C%202Pi%2C%200.1%7D%5D%20%2F%2F%20Re%3B%0A%0AListLinePlot%5B%25%2C%20%0A%20%20PlotRange-%3EFull%2C%20%0A%20%20Epilog-%3E%7B%0A%20%20%20%20Black%20%2F%2F%20Lighter%2C%20Arrow%5B%7B%7B0%2C%200%7D%2C%20%7B2.5501%2C%200.0%7D%7D%5D%2C%0A%20%20%20%20Arrow%5B%7B%7B0%2C0%7D%2C%20%7B0%2C%202.52099%7D%7D%5D%0A%7D%2C%20AxesLabel-%3E%7B%22%5C%5Cmu%20x%22%2C%20%22%5C%5Cmu%20y%22%7D%2C%20ImageSize-%3E500%2C%20AspectRatio-%3E1%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"36788727-23bc-4fff-881c-3b4b3655095b\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%22c7710bc3-f3fa-4da9-b610-78b5b046c42c%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKJ5ubGxokJRvrphmnJeqapCRa6iaZGRromlskmSYZmJglmxglAwCKFxXG%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nIt is clear, __that a cubic anistropy is quite visible here__ \ud83d\udcab\\n\\nActually, this is not a typical spin system with a fixed magnetic anisotropy. Here it comes from the orbital degeneracy, which is lifted in magnetic fields. However, it also means, that the field can change anisotropy. The less field we apply, the less spin prjection we have, the less splitting between the orbital states we have, and therefore the less anisotropy we observe. *Try to evaluate the cell above using different fields*\\n\\n## Ferromagnetic ordering\\nOne can go further and model an ordered state using *mean field approximation*, which is suitable for ferromagnets\\n\\n$$\\nH = \\\\mu g~ \\\\mathbf{S H_0} - d \\\\Big[ U_{\\\\theta} (3 Sz^2 - S(S+1)) + \\\\sqrt{3} U_{\\\\epsilon}(Sx^2 - Sy^2)  \\\\Big] + J \\\\mathbf{S M}\\n$$\\n\\nwhere $M$ is an average of $\\\\hat{S}$ (i.e. just a classical vector).\\n\\n### Implementation\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"7e23f79d-bb36-41c6-af0c-7f3e21815c49\\"} type={\\"Input\\"} opts={{}} >{`H%5BHx_%2C%20Hy_%2C%20Hz_%2C%20d_%2C%20J_%2C%20Mx_%2C%20My_%2C%20Mz_%5D%20%3A%3D%20%CE%BC%20g%20%28Hx%20Sx%20%2B%20Hy%20Sy%20%2B%20Hz%20Sz%20%29%20-%20d%20%283%20Sz.Sz.U%CE%B8%20-%20%202%282%2B1%29%20U%CE%B8%20%2B%20%28%2ASqB%5B%2A%29Sqrt%5B3%5D%28%2A%5DSqB%2A%29%20Sx.Sx.U%CF%B5%20-%20%28%2ASqB%5B%2A%29Sqrt%5B3%5D%28%2A%5DSqB%2A%29%20Sy.Sy.U%CF%B5%29%20%2B%20J%20%28Mx%20Sx%20%2B%20My%20Sy%20%2B%20Mz%20Sz%29`}</WLJSEditor>\\n\\nNow it becomes more computationally expensive to do. It is better monitor the progress, for this reason we need a helper function\\n\\n<WLJSHTML>{`%3Cbr%20%2F%3E`}</WLJSHTML>\\n\\n#### Progress bar\\n\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"49a3d89f-99d5-48f8-b879-e6ecef6cc279\\"} type={\\"Input\\"} opts={{\\"InitGroup\\":true,\\"Fade\\":true}} >{`progressBar.wl%0A%0AModule%5B%7BprogressBar%7D%2C%0A%20%20progressBar%5Bmax_%2C%20OptionsPattern%5B%5D%20%5D%20%3A%3D%20With%5B%7Bcell%20%3D%20OptionValue%5B%22Cell%22%5D%7D%2C%20LeakyModule%5B%7Bprogress%20%3D%200.%2C%20indicator%20%3D%200.%2C%20handler%2C%20timer%20%3D%20AbsoluteTime%5B%5D%7D%2C%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20%20%20cell%20%3D%20CellPrint%5BToString%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20Graphics%5B%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20LightBlue%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Rectangle%5B%7B-0.004%2C-0.12%7D%2C%20%7B1.004%2C1.12%7D%5D%2C%20Green%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20Rectangle%5B%7B0%2C0%7D%2C%20%7BOffload%5Bindicator%5D%2C1%7D%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%20PlotRange-%3E%7B%7B0%2C1%7D%2C%20%7B0%2C1%7D%7D%2C%20ImagePadding-%3E0%2C%20ImageSize-%3E%7B300%2C%2020%7D%2C%20Controls-%3EFalse%5D%0A%20%20%20%20%20%20%20%20%2C%20StandardForm%5D%2C%20%22After%22-%3Ecell%5D%0A%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20handler%5Bn_%5D%20%3A%3D%20With%5B%7Bdiff%20%3D%20AbsoluteTime%5B%5D%20-%20timer%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20progress%20%3D%20n%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20If%5Bdiff%20%3E%200.03%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20indicator%20%3D%20progress%20%2F%20max%20%2F%2F%20N%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20timer%20%3D%20AbsoluteTime%5B%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20If%5BAbs%5Bprogress%20-%20max%5D%20%3C%200.1%2C%20Delete%5Bcell%5D%20%5D%3B%0A%20%20%20%20%20%20%20%20%5D%3B%0A%0A%20%20%20%20%20%20%20%20handler%0A%20%20%20%20%5D%0A%20%20%5D%20%5D%3B%0A%0A%20%20%20%20Options%5BprogressBar%5D%20%3D%20%7B%22Cell%22%3A%3EEvaluationCell%5B%5D%7D%3B%0A%0A%20%20%20%20progressBar%0A%5D`}</WLJSEditor>\\n\\n*we store it to a file, so we can reuse it later*\\n\\nContinue with our plotting\\n\\nSince this is a mean approximation method, we need to substitute an averaged value of a spin back to the Hamiltonian and wait until it converges. The *memory* of our system is stored exactly in this mean field vector\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"089d74eb-21bd-40e4-8388-2602f11aebd8\\"} type={\\"Input\\"} opts={{}} >{`meanField%20%3D%20%7B0.1%2C%20-0.8%2C%20-0.1%7D%3B%0Asys%3B%0A%0AprogressBarGenerator%20%3D%20Get%5B%22progressBar.wl%22%5D%3B%0A%0AWith%5B%7B%0A%20%20progress%20%3D%20progressBarGenerator%5B2Pi%5D%0A%7D%2C%0A%0ATable%5B%0A%20%20With%5B%7B%0A%20%20%20%20%0A%20%20%7D%2C%0A%20%20%0A%20%20%20%20Do%5B%0A%20%20%20%20%0A%20%20%20%20%20%20sys%20%3D%20system%20%40%40%20Join%5B%7B10.%20Sin%5Bx%5D%2C%2010.%20Cos%5Bx%5D%2C%200%2C%203.%2C%20-100.%7D%2C%20meanField%5D%3B%0A%20%20%20%20%20%20meanField%20%3D%20average%5Bsys%2C%2010%2C%20%23%5D%20%26%2F%40%20%7BSx%2C%20Sy%2C%20Sz%7D%3B%20%0A%20%20%20%20%20%20%0A%20%20%20%20%2C%20%7Bi%2C%2015%7D%5D%3B%0A%0A%20%20%20%20progress%5Bx%5D%3B%0A%20%20%20%20%0A%20%20%20%20%0A%20%20%20%20%28%20meanField%5B%5B%7B1%2C2%7D%5D%5D%20%29%20.%20%7BSin%5Bx%5D%2C%20Cos%5Bx%5D%7D%0A%20%20%20%0A%20%20%5D%20%7BSin%5Bx%5D%2C%20Cos%5Bx%5D%7D%0A%20%20%0A%2C%20%7Bx%2C%200%2C%202Pi%2C%200.05%7D%5D%0A%0A%5D%3B%0A%0AListLinePlot%5B%25%2C%20%0A%20%20PlotRange-%3EFull%2C%20%0A%20%20Epilog-%3E%7B%0A%20%20%20%20Black%20%2F%2F%20Lighter%2C%20Arrow%5B%7B%7B0%2C%200%7D%2C%20%7B2.3501%2C%200.0%7D%7D%5D%2C%0A%20%20%20%20Arrow%5B%7B%7B0%2C0%7D%2C%20%7B0%2C%202.32099%7D%7D%5D%0A%7D%2C%20AxesLabel-%3E%7B%22%5C%5Cmu%20x%22%2C%20%22%5C%5Cmu%20y%22%7D%2C%20ImageSize-%3E500%2C%20AspectRatio-%3E1%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"223743a2-287c-47cc-a4cf-6e74b45fce7b\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%228d6b2390-be0d-45a5-b9d7-099c0e12ef55%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKW6SYJRkZWxroJqUapOiamCaa6iZZppjrGlhaJhukGhqlppmaAgCErRWn%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nFrom this plot one can see, that our magnetic moment sticks to $C_4$ directions and when the rotating magnetic field overcomes the anisotropy magnetic moment switches to another easy-axis or direction.\\n\\nA calculation itself is quite slow, due to algebra we used for quantum computations. In general, we do not need all operators, once we constructed the Hamiltonian in the basis we have. We can deal only with matrixes and simple numerics.\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"7c752533-16f1-40a5-9bb8-5ab73c0451c4\\"} type={\\"Input\\"} opts={{\\"Hidden\\":false}} >{`.md%0A%23%23%23%20Converting%20operators%20to%20matrixes%0AWe%20build%20a%20function%2C%20that%20approximate%20any%20arbitary%20function%20up%20to%202nd%20order%20for%20all%20variables%20in%20arguments`}</WLJSEditor>\\n\\n### Converting operators to matrixes\\nWe build a function, that approximate any arbitary function up to 2nd order for all variables in arguments\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"5e8e7f8c-88c8-4bd3-b72c-8b0e2cd29340\\"} type={\\"Input\\"} opts={{\\"Fade\\":true,\\"InitGroup\\":true}} >{`quadInterpolator.wl%0A%0ABeginPackage%5B%22Misc%60QuadarticInterpolation%60%22%5D%0ABegin%5B%22%60Private%60%22%5D%0A%0AquadraticInterpolation%5Bf_%2C%20vars__%2C%20OptionsPattern%5B%5D%5D%20%3A%3D%20Module%5B%7B%0A%20%20variables%20%3D%20%20List%5Bvars%5D%2C%0A%20%20rules%2C%0A%20%20constant%2C%0A%20%20quadratic%2C%0A%20%20final%2C%0A%20%20cached%2C%0A%20%20mdcache%2C%0A%20%20calculated%20%3D%20%3C%7C%7C%3E%2C%0A%20%20linear%2C%0A%20%20handler%2C%20count%20%3D%200%0A%7D%2C%0A%0A%20%20If%5BOptionValue%5B%22Monitor%22%5D%20%3D%21%3D%20Null%2C%0A%20%20%20%20handler%20%3D%20OptionValue%5B%22Monitor%22%5D%5B%20%28Length%5Bvariables%5D%20Length%5Bvariables%5D%20-%20Length%5Bvariables%5D%29%20%2F%202%20%20%2B%202%20Length%5Bvariables%5D%5D%3B%0A%20%20%5D%3B%0A%0A%20%20cached%5Bexpr_%2C%20%7Bi_%2Cj_%7D%5D%20%3A%3D%20mdcache%5Bexpr%2C%20Sort%5B%7Bi%2Cj%7D%5D%5D%3B%0A%20%20SetAttributes%5Bcached%2C%20HoldFirst%5D%3B%0A%0A%20%20mdcache%5Bexpr_%2C%20%7Bi_%2Cj_%7D%5D%20%3A%3D%20If%5BKeyExistsQ%5Bcalculated%2C%20%7Bi%2Cj%7D%5D%2C%0A%20%20%20%20calculated%5B%7Bi%2Cj%7D%5D%0A%20%20%2C%0A%20%20%20%20calculated%5B%7Bi%2Cj%7D%5D%20%3D%20expr%0A%20%20%5D%3B%0A%0A%20%20SetAttributes%5Bmdcache%2C%20HoldFirst%5D%3B%0A%0A%20%20rules%20%3D%20%28%23%5B%5B1%5D%5D%20-%3E%20%23%5B%5B2%5D%5D%29%20%26%2F%40%20variables%3B%0A%20%20%0A%20%20constant%20%3D%20Hold%5Bf%5D%20%2F.%20rules%20%2F%2F%20ReleaseHold%3B%0A%0A%20%20linear%20%3D%20Table%5B%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20r%20%3D%20%7Bi%5B%5B1%5D%5D%20-%3E%201.%7D%0A%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20count%2B%2B%3B%0A%20%20%20%20%20%20handler%5Bcount%5D%3B%0A%0A%20%20%20%20%20%20%28Hold%5Bf%5D%20%2F.%20r%20%2F.%20rules%20%2F%2F%20ReleaseHold%29%20-%20constant%0A%20%20%20%20%5D%0A%20%20%20%20%0A%20%20%2C%20%7Bi%2C%20variables%7D%5D%3B%0A%0A%20%20quadratic%20%3D%20Table%5B%0A%20%20%20%20cached%5BWith%5B%7B%0A%20%20%20%20%20%20f11%20%3D%20With%5B%7B%0A%20%20%20%20%20%20%20%20r%20%3D%20%7Bi%5B%5B1%5D%5D%20-%3E%201.%2C%20j%5B%5B1%5D%5D%20-%3E%201.%7D%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%28Hold%5Bf%5D%20%2F.%20r%20%2F.%20rules%20%2F%2F%20ReleaseHold%29%0A%20%20%20%20%20%20%5D%2C%0A%0A%20%20%20%20%20%20fm1m1%20%3D%20With%5B%7B%0A%20%20%20%20%20%20%20%20r%20%3D%20%7Bi%5B%5B1%5D%5D%20-%3E%20-1.%2C%20j%5B%5B1%5D%5D%20-%3E%20-1.%7D%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%28Hold%5Bf%5D%20%2F.%20r%20%2F.%20rules%20%2F%2F%20ReleaseHold%29%0A%20%20%20%20%20%20%5D%2C%0A%0A%20%20%20%20%20%20f1m1%20%3D%20With%5B%7B%0A%20%20%20%20%20%20%20%20r%20%3D%20%7Bi%5B%5B1%5D%5D%20-%3E%201.%2C%20j%5B%5B1%5D%5D%20-%3E%20-1.%7D%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%28Hold%5Bf%5D%20%2F.%20r%20%2F.%20rules%20%2F%2F%20ReleaseHold%29%0A%20%20%20%20%20%20%5D%2C%0A%0A%20%20%20%20%20%20fm11%20%3D%20With%5B%7B%0A%20%20%20%20%20%20%20%20r%20%3D%20%7Bi%5B%5B1%5D%5D%20-%3E%20-1.%2C%20j%5B%5B1%5D%5D%20-%3E%201.%7D%0A%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%28Hold%5Bf%5D%20%2F.%20r%20%2F.%20rules%20%2F%2F%20ReleaseHold%29%0A%20%20%20%20%20%20%5D%20%20%20%20%20%20%0A%20%20%20%20%20%20%0A%20%20%20%20%7D%2C%0A%20%20%20%20%20%20count%2B%2B%3B%0A%20%20%20%20%20%20handler%5Bcount%5D%3B%0A%0A%20%20%20%20%20%20Print%5B%22Checking...%20%22%2C%20i%2C%20j%5D%3B%0A%0A%20%20%20%20%20%20%28%2AFB%5B%2A%29%28%28f11%20-%20f1m1%20-%20fm11%20%2B%20fm1m1%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%284.%29%29%28%2A%5DFB%2A%29%0A%20%20%20%20%5D%2C%20%7Bi%2Cj%7D%5D%0A%20%20%20%20%0A%20%20%2C%20%7Bi%2C%20variables%7D%2C%20%7Bj%2C%20variables%7D%5D%3B%0A%0A%20%20final%20%3D%20Sum%5B%0A%20%20%20%20With%5B%7Bl%20%3D%20linear%5B%5Bi%5D%5D%7D%2C%0A%20%20%20%20%20%20Slot%5Bi%5D%20Hold%5Bl%5D%0A%20%20%20%20%5D%0A%20%20%2C%20%7Bi%2C%20Length%5Blinear%5D%7D%5D%20%2B%20Sum%5B%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20q%20%3D%20%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282%29%29%28%2A%5DFB%2A%29quadratic%5B%5Bi%2C%20j%5D%5D%0A%20%20%20%20%7D%2C%0A%20%20%20%20%20%20Slot%5Bi%5DSlot%5Bj%5D%20Hold%5Bq%5D%0A%20%20%20%20%5D%0A%20%20%2C%20%7Bi%2C%20Length%5Blinear%5D%7D%2C%20%7Bj%2C%20Length%5Blinear%5D%7D%5D%20%2B%20With%5B%7Bc%20%3D%20constant%7D%2C%20Hold%5Bc%5D%20%5D%3B%0A%0A%20%20With%5B%7B%0A%20%20%20%20r%20%3D%20final%0A%20%20%7D%2C%0A%20%20%20%20%28r%20%26%29%20%2F.%20%7BHold%20-%3E%20Identity%7D%0A%20%20%5D%0A%5D%0A%0ASetAttributes%5BquadraticInterpolation%2C%20HoldFirst%5D%0A%0AOptions%5BquadraticInterpolation%5D%20%3D%20%7B%22Monitor%22-%3ENull%7D%0A%0AEnd%5B%5D%0AEndPackage%5B%5D%0A%0AMisc%60QuadarticInterpolation%60Private%60quadraticInterpolation`}</WLJSEditor>\\n\\nNow lets import it\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"bfb63009-e4f7-4865-932a-7801c2cd1253\\"} type={\\"Input\\"} opts={{}} >{`quadInterpolation%20%3D%20Get%5B%22quadInterpolator.wl%22%5D%3B%0AprogressBarGenerator%20%3D%20Get%5B%22progressBar.wl%22%5D%3B`}</WLJSEditor>\\n\\nNow we apply it to our hamiltonian calculated in the basis with a given parameters\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"5008ce32-4eff-41b3-b3a2-5076ca36a05c\\"} type={\\"Input\\"} opts={{}} >{`int%20%3D%20quadInterpolation%5B%0A%0A%20%20Table%5BConjugate%5Bfin%5D.H%5Ba1%2Ca2%2Ca3%2C%20a4%2C%20a5%2C%20a6%2Ca7%2Ca8%5D.ini%2C%20%7Bfin%2C%20basis%7D%2C%20%7Bini%2C%20basis%7D%5D%0A%20%20%0A%2C%20%7Ba1%2C0%7D%2C%20%7Ba2%2C0%7D%2C%20%7Ba3%2C0%7D%2C%20%7Ba4%2C0%7D%2C%20%7Ba5%2C0%7D%2C%20%7Ba6%2C0%7D%2C%20%7Ba7%2C0%7D%2C%20%7Ba8%2C0%7D%2C%20%22Monitor%22-%3EprogressBarGenerator%5D%3B`}</WLJSEditor>\\n\\nNow one can check that __it speeds up things__ drastically\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"3e7fa315-759b-47d8-bca2-7dffedb4620a\\"} type={\\"Input\\"} opts={{}} >{`%28%2A%20old%20%2A%29%0ATable%5BConjugate%5Bfin%5D.H%5B0%2C1.%2C1.%2C%201.%2C%201.%2C%20%201.%2C1.%2C1.%5D.ini%2C%20%7Bfin%2C%20basis%7D%2C%20%7Bini%2C%20basis%7D%5D%20%2F%2F%20RepeatedTiming%20%2F%2F%20First%20%0A%28%2A%20converted%20%2A%29%0Aint%5B0%2C1.%2C1.%2C%201.%2C%201.%2C%20%201.%2C1.%2C1.%5D%20%2F%2F%20RepeatedTiming%20%2F%2F%20First%20`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"69c43abe-82ce-4f99-8518-2ce98785ae8e\\"} type={\\"Output\\"} opts={{}} >{`1.051729%60`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"6c95d102-46a5-4442-a8df-0217e9cb391f\\"} type={\\"Output\\"} opts={{}} >{`0.0007063037109375%60`}</WLJSEditor>\\n\\nWe can also save this function for later, so that we do not need to derive it again\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"d79b5e89-466f-4b16-b210-0377aac50666\\"} type={\\"Input\\"} opts={{}} >{`int%20%2F%2F%20Iconize%20`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"6e47f3e7-56e3-4f42-9c6d-22380f9197bc\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28Get%5BFileNameJoin%5B%7B%22.iconized%22%2C%20%22iconized-6f9a.wl%22%7D%5D%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeH5DwTM7Py6xKdcvMSXXKr8i0EGdmAADrVArH%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nOr better to internal Notebook storage, so that we do not need to worry about folders structure\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"8965c3c8-90b1-447b-9e0e-88f192dacdc4\\"} type={\\"Input\\"} opts={{}} >{`NotebookStore%5B%22Int%22%5D%20%3D%20int`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"21f4e6c9-ec62-47c1-b274-50ebc3b52fa4\\"} type={\\"Output\\"} opts={{}} >{`%22Int%22`}</WLJSEditor>\\n\\n## Modelling\\nusing faster approach\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"7ff151e9-5232-424c-a818-28f4d840475a\\"} type={\\"Input\\"} opts={{}} >{`progressBarGenerator%20%3D%20Get%5B%22progressBar.wl%22%5D%3B%0Aint%20%3D%20NotebookStore%5B%22Int%22%5D%3B%0A%0AmeanField%20%3D%20%7B0.1%2C%20-0.8%2C%20-0.1%7D%3B%0Asys%3B%0A%0AWith%5B%7B%0A%20%20progress%20%3D%20progressBarGenerator%5B15%5D%0A%7D%2C%0ATable%5B%0A%20%20With%5B%7B%0A%20%20%20%20%0A%20%20%7D%2C%0A%20%20%0A%20%20%20%20Do%5B%0A%20%20%20%20%20%20sys%20%3D%20int%20%40%40%20Join%5B%7Bh%20Sin%5Bx%5D%2C%20h%20Cos%5Bx%5D%2C%200%2C%203.%2C%20-100.%7D%2C%20meanField%5D%20%2F%2F%20Eigensystem%20%2F%2F%20Transpose%3B%0A%20%20%20%20%20%20meanField%20%3D%20average%5Bsys%2C%2010%2C%20%23%5D%20%26%2F%40%20%7BSx%2C%20Sy%2C%20Sz%7D%3B%20%0A%20%20%20%20%2C%20%7Bi%2C%2025%7D%5D%3B%0A%0A%20%20%20%20progress%5Bh%5D%3B%0A%0A%20%20%20%20%0A%20%20%20%20%0A%20%20%20%20%28%20meanField%5B%5B%7B1%2C2%7D%5D%5D%29.%28%7BSin%5Bx%5D%2C%20Cos%5Bx%5D%7D%29%0A%20%20%20%0A%20%20%5D%20%7BSin%5Bx%5D%2C%20Cos%5Bx%5D%7D%0A%2C%20%7Bh%2C%20%7B1%2C5%2C10%2C15%7D%7D%2C%20%7Bx%2C%200%2C%202Pi%2C%200.05%7D%5D%0A%5D%3B%0A%0AListLinePlot%5B%25%2C%20%0A%20%20PlotRange-%3EFull%2C%20%0A%20%20Epilog-%3E%7B%0A%20%20%20%20Black%20%2F%2F%20Lighter%2C%20Arrow%5B%7B%7B0%2C%200%7D%2C%20%7B2.5501%2C%200.0%7D%7D%5D%2C%0A%20%20%20%20Arrow%5B%7B%7B0%2C0%7D%2C%20%7B0%2C%202.52099%7D%7D%5D%0A%7D%2C%20AxesLabel-%3E%7B%22%5C%5Cmu%20x%22%2C%20%22%5C%5Cmu%20y%22%7D%2C%20ImageSize-%3E500%2C%20AspectRatio-%3E1%2C%20PlotLegends-%3E%7B%221T%22%2C%20%225T%22%2C%20%2210T%22%2C%20%2215T%22%7D%5D`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"9d4d305b-4b73-41ae-961d-8a8dfa8eea87\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%2217a8d4a4-9c68-4b79-a0ce-37fa69f6fee7%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG5onWqSYJJroWiabWeiaJJlb6iYaJKfqGpunJZpZppmlpaaaAwCGQBYd%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\nHere we have magnetic moment curves plotted for different magnitudes of applied field\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"649d88f3-aa88-4a3a-bb24-c34be9ad9094\\"} type={\\"Output\\"} opts={{}} >{`%28%2AGB%5B%2A%29%7B%7B%28%2AVB%5B%2A%29%28RGBColor%5B0.368417%2C%200.506779%2C%200.709798%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcVTJv0VGXKdfsiw2kvp3eYP7AvOt4yw3vVtmf2AKMBH1E%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.880722%2C%200.611041%2C%200.142051%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRf5HIl%2Bfl%2FvjX3Rv%2BoPt5b2PrYv2jxrnfouvUP2ALwBIFo%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.560181%2C%200.691569%2C%200.194885%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRcxPIvawvD2oX1R6dq9%2FqGKz%2ByLJCfsvff34wl7AJc8HzE%3D%22%2A%29%28%2A%5DVB%2A%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%29%28%2AVB%5B%2A%29%28RGBColor%5B0.922526%2C%200.385626%2C%200.209179%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeGJAIcndyzs%2FJLwouTyxJzghJzS3ISSxJTWMGyXMgyRdd2frNLrT1rX3RHf35ayTW3bAv0nBnXJRw7JQ9AKbfHmU%3D%22%2A%29%28%2A%5DVB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B1%28%2A%7C%2A%29%2C%28%2A%7C%2A%295%28%2A%7C%2A%29%2C%28%2A%7C%2A%2910%28%2A%7C%2A%29%2C%28%2A%7C%2A%2915%7D%7D%28%2A%5DGB%2A%29`}</WLJSEditor>\\n\\n*Why do we have circles at the bottom?*\\n\\nWell, it looks that the magnetic field cannot overcome the anisotropy and the position of magentic moment remains constant, while projection goes from 0 up to the maximum. We can prove its shape by plotting this function\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"a62be35f-d619-46b1-8752-7ca773ab19ee\\"} type={\\"Input\\"} opts={{}} >{`PolarPlot%5B%28%2ABB%5B%2A%29%28%2Aour%20constant%20magnetic%20moment%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%20%7B0%2C-1%7D.%7B%20%28%2ABB%5B%2A%29%28%2Aprojection%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%20Cos%5Bx%5D%2C%20Sin%5Bx%5D%7D%2C%20%7Bx%2C0%2C2Pi%7D%2C%20PlotRange-%3E%7B%7B-1%2C1%7D%2C%7B-1%2C1%7D%7D%2C%20Epilog-%3E%7BSVGAttribute%5BCircle%5B%7B0%2C0%7D%2C%201%5D%2C%20%22stroke-dasharray%22-%3E%223%22%5D%7D%5D%20`}</WLJSEditor>\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"767697f0-dbcb-4cd2-a93e-86277e042697\\"} type={\\"Output\\"} opts={{}} >{`%28%2AVB%5B%2A%29%28FrontEndRef%5B%2280ee3f9f-f7c6-4c81-9107-63b95fea7fa0%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKWxikphqnWabpppknm%2BmaJFsY6loaGpjrmhknWZqmpSaapyUaAACJHBXn%22%2A%29%28%2A%5DVB%2A%29`}</WLJSEditor>\\n\\n<WLJSHTML>{`%3Cstyle%3E%0A%20%20%23realtimeStuff%20%7B%0A%20%20%20%20scroll-behavior%3A%20smooth%3B%0A%20%20%7D%0A%3C%2Fstyle%3E%0A%3Cdiv%20id%3D%22realtimeStuff%22%3E%3C%2Fdiv%3E`}</WLJSHTML>\\n\\n## Real-time modelling\\nWe can go further and recalculate spins based on user\'s input. For this case `Offload` keyword is used together with some GUI building blocks\\n\\n*Download this notebook to try it*\\n\\n<WLJSEditor display={\\"codemirror\\"} nid={\\"44b68f07-c3d6-4925-99c0-99f949c395f0\\"} id={\\"59b7d207-02e9-439a-98a2-67d82bd5d5d5\\"} type={\\"Input\\"} opts={{}} >{`int%20%3D%20NotebookStore%5B%22Int%22%5D%3B%0A%0ALeakyModule%5B%7B%0A%20%20spin%20%3D%20%7B0.1%2C%20-0.8%2C%20-0.11%7D%2C%0A%20%20defaults%20%3D%20%7B0.%2C0.%2C0.%2C%203.%2C%20-100.%7D%2C%0A%20%20temperature%20%3D%2010.%2C%0A%20%20field%20%3D%20%7B0.%2C0.%7D%2C%0A%20%20controlPanel%2C%0A%20%20frame%20%3D%20CreateUUID%5B%5D%0A%7D%2C%0A%0A%20%20controlPanel%20%3D%20InputGroup%5B%7B%0A%20%20%20%20InputRange%5B0%2C%205.%2C%201%2C%203%2C%20%22Label%22-%3E%22Spin-orbit%22%5D%2C%0A%20%20%20%20InputRange%5B-100%2C%200.%2C%2010%2C%20-100%2C%20%22Label%22-%3E%22J%22%5D%2C%0A%20%20%20%20InputRange%5B1%2C%20150.%2C%2010%2C%2010%2C%20%22Label%22-%3E%22Temperature%22%5D%0A%20%20%7D%5D%3B%0A%0A%20%20EventHandler%5Bframe%2C%20Function%5B%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20sys%20%3D%20int%20%40%40%20Join%5Bdefaults%2C%20spin%5D%20%2F%2F%20Eigensystem%20%2F%2F%20Transpose%0A%20%20%20%20%7D%2C%0A%20%20%20%20%20%20spin%20%3D%20average%5Bsys%2C%20temperature%2C%20%23%5D%20%26%2F%40%20%7BSx%2C%20Sy%2C%20Sz%7D%20%2F%2F%20Chop%20%2F%2F%20Re%3B%0A%20%20%20%20%5D%20%20%0A%20%20%5D%5D%3B%0A%0A%20%20EventHandler%5BcontrolPanel%2C%20Function%5Bdata%2C%0A%20%20%20%20defaults%5B%5B4%3B%3B5%5D%5D%20%3D%20data%5B%5B1%3B%3B2%5D%5D%3B%0A%20%20%20%20temperature%20%3D%20data%5B%5B3%5D%5D%3B%0A%20%20%5D%5D%3B%0A%0A%20%20%7B%0A%20%20%20%20Graphics%5B%7B%0A%20%20%20%20%20%20White%2C%20EventHandler%5BRectangle%5B%7B-4%2C-4%7D%2C%20%7B4%2C4%7D%5D%2C%20%7B%22mousemove%22%20-%3E%20Function%5Bxy%2C%0A%20%20%20%20%20%20%20%20defaults%5B%5B1%3B%3B2%5D%5D%20%3D%20-%2010%20xy%3B%0A%20%20%20%20%20%20%20%20field%20%3D%20xy%200.8%3B%0A%20%20%20%20%20%20%5D%7D%5D%2C%0A%20%20%20%20%20%20Red%2C%20Arrow%5B%7B%7B0%2C0%7D%2C%20With%5B%7Bs%20%3D%20spin%7D%2C%20%7Bs%5B%5B1%5D%5D%2C%20s%5B%5B2%5D%5D%7D%5D%20%2F%2F%20Offload%7D%5D%2C%0A%20%20%20%20%20%20Blue%2C%20Arrow%5B%7B%7B0%2C0%7D%2C%20field%20%2F%2F%20Offload%7D%5D%2C%0A%20%20%20%20%20%20AnimationFrameListener%5Bspin%20%2F%2F%20Offload%2C%20%22Event%22%20-%3E%20frame%5D%0A%20%20%20%20%7D%2C%20PlotRange-%3E1.5%7B%7B-2%2C2%7D%2C%20%7B-2%2C2%7D%7D%2C%20Controls-%3EFalse%2C%20TransitionType-%3E%22Linear%22%2C%20TransitionDuration-%3E30%2C%20ImagePadding-%3E0%5D%2C%0A%20%20%20%20%0A%20%20%20%20controlPanel%0A%20%20%7D%20%2F%2F%20Row%20%20%0A%5D`}</WLJSEditor>\\n\\nExpected result is shown in this video \\n\\nimport testVideo from \'./attachments/Spin_system.mov\';\\n\\n<video width={\\"100%\\"} controls>\\n  <source src={testVideo}/>\\n</video>"},{"id":"imageraster","metadata":{"permalink":"/wljs-docs/blog/imageraster","source":"@site/blog/2023-09-14-image-raster/2023-08-20-image-raster.md","title":"Image and Raster were implemented!","description":"It means, MatrixPlot as well as Rasterize can work properly finally","date":"2023-08-20T00:00:00.000Z","tags":[{"label":"graphics","permalink":"/wljs-docs/blog/tags/graphics"}],"readingTime":0.73,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"slug":"imageraster","title":"Image and Raster were implemented!","authors":"jerryi","tags":["graphics"],"enableComments":true,"draft":false},"unlisted":false,"prevItem":{"title":"Modelling quantum spin-system with orbital degeneracy","permalink":"/wljs-docs/blog/2023/10/10/spin-hamiltonian"},"nextItem":{"title":"Realtime path-tracing","permalink":"/wljs-docs/blog/rtx-intro"}},"content":"![](plot.svg)\\n\\n```mathematica\\nMatrixPlot[\\n Fourier[Table[\\n   UnitStep[i, 4 - i] UnitStep[j, 7 - j], {i, -25, 25}, {j, -25, \\n    25}]]]\\n```\\nIt means, `MatrixPlot` as well as `Rasterize` can work properly finally\\n\\n\x3c!--truncate--\x3e\\n\\n\\n\\n## Raster\\n\\n`MatrixPlot` produces `Graphics` with `Raster` inside. However, similar function `ArrayPlot` __won\'t work properly__ since it doesn\'t provide the `PlotRange` option.\\n\\nIn my implementation of `Graphics` it cannot guess what the plot range would be. Therefore you have to manually provide it. For example\\n\\n```mathematica\\nGraphics[{\\n\\tRaster[Table[{x, y, x, y}, {x, .1, 1, .1}, {y, .1, 1, .1}]]}\\n\\t, PlotRange->{{0.1,10}, {0.1,10}\\n}]\\n```\\n\\n\\n\\nHere `PlotRange` is necessary, otherwise it will be set to `{-1,1}`.\\n\\n## Image\\nThis is actually a separate entity, that uses HTML5 canvas\\n> despite this fact, you can still easily embed it into `Graphics` using `Inset` wrapper\\n\\n\\n\\nPlease see __Reference__ section in the frontend docs for more information. See Ya!"},{"id":"rtx-intro","metadata":{"permalink":"/wljs-docs/blog/rtx-intro","source":"@site/blog/2023-07-20-rtx/index.md","title":"Realtime path-tracing","description":"There is nothing more exciting in programming than designing a graphics application. Thankfully, there is one person on Github Garrett Johnson, who implemented a path-tracing algorithm on top of the well-known THREE.js graphics engine. Moreover, it fully supports features from the original library and can be anytime flipped as a main renderer.","date":"2023-07-20T00:00:00.000Z","tags":[{"label":"frontend","permalink":"/wljs-docs/blog/tags/frontend"},{"label":"graphics","permalink":"/wljs-docs/blog/tags/graphics"}],"readingTime":2.05,"hasTruncateMarker":true,"authors":[{"name":"Kirill Vasin","title":"Maintainer","url":"https://github.com/JerryI","imageURL":"https://avatars.githubusercontent.com/u/4111822?s=48&v=4","key":"jerryi"}],"frontMatter":{"slug":"rtx-intro","title":"Realtime path-tracing","authors":"jerryi","tags":["frontend","graphics"],"enableComments":true},"unlisted":false,"prevItem":{"title":"Image and Raster were implemented!","permalink":"/wljs-docs/blog/imageraster"}},"content":"![](Screenshot%20from%202023-07-20%2020-04-08.png)\\n\\nThere is nothing more exciting in programming than designing a graphics application. Thankfully, there is one person on Github [Garrett Johnson](https://github.com/gkjohnson), who implemented a path-tracing algorithm on top of the well-known [THREE.js](https://threejs.org) graphics engine. Moreover, it fully supports features from the original library and can be anytime flipped as a main renderer.\\n\\n\x3c!--truncate--\x3e\\n\\nI hooked up his [library](https://github.com/gkjohnson/three-gpu-pathtracer) to works as a secondary engine for `Graphics3D` function presented in [wljs-graphics3d-threejs](https://github.com/JerryI/Mathematica-ThreeJS-graphics-engine) library. Just pass an option\\n\\n```mathematica\\nGraphics3D[%, \\"RTX\\"->True]\\n```\\n\\nAnd it will bake a realtime photorealistic image. It also supports all properties used in traditional rendering, i.e. `Emissive[]`, `Metallness[]`, HDRI map and many more!\\n\\nSome classical examples from Wolfram Mathematica\\n\\n![](IMG_0556.png)\\n\\n\\n![](screenshot(8)%201.png)\\n\\nYou might recognize those examples from `Graphics3D` official documentation page. Here is some other neat pictures produced using the following code\\n\\n### Metallic maze\\nThis was taken from the discussion [here](https://mathematica.stackexchange.com/questions/191047/making-holes-from-maze-generated-graphics3d). The maze is made from many polygons, where for the surface `Metallness[1], Roughness[0]` were applied. Since it provides perfect reflection, the overall time for rendering (when the noise has gone) is relatively low.\\n\\n```mathematica\\nshowmaze = Uncompress[FromCharacterCode @@ ImageData[Import[\\"https://i.stack.imgur.com/XVJcP.png\\"], \\"Byte\\"]];\\nprims = CapsuleShape @@@ Cases[showmaze, _Cylinder, Infinity];\\nprims = prims /. {{5., 5., 5.} -> {5.5, 5., 5.}, {1., 1., 1.} -> {1., 0.5, 1.}};\\nims = RegionImage[#, {{0.3`, 5.7`}, {0.3`, 5.7`}, {0.3`, 5.7`}}, RasterSize -> 100] & /@ prims;\\nim = ImageApply[Max, ims];\\n```\\n\\nThen, the generated mesh is lit by `lighting` arrays, which contain randomly distributed glowing spheres\\n\\n```mathematica\\nlighting = Table[{Emissive[RGBColor@@(RandomReal[{0,1}, 3]), 2], Sphere[RandomReal[{1,92}, 3], RandomReal[{1,7}]]}, {i, 1, 30}];\\nShow[bmr = ImageMesh[im, Method -> \\"DualMarchingCubes\\"], PlotRange -> {{0, 91}, {1, 92}, {0, 91}}][[1]];\\nGraphics3D[{lighting, Metalness[0], Roughness[0], %},  \\"Lighting\\"->None, ViewProjection->\\"Perspective\\", \\"RTX\\"->True]\\n```\\n\\n\\n![](screenshot(12).png)\\n\\nDespite the complicity of the scene, __it renders in real time__ with an acceptable amount of noise.\\n\\n### Torus Knot\\nThis is rather classical example, but uses a glossy surface using `Roughness[0]` lit by two glowing spheres\\n\\n```mathematica\\nKnotData[{\\"TorusKnot\\", {3, 5}}][[1]];\\nGraphics3D[{{Emissive[Red, 5], Sphere[{0,0,-0.1}, 0.14]}, {Roughness[0],Cyan, %}, {Emissive[RGBColor[{1,1,1}], 5], Sphere[{0,0,0.4}, 0.1]}}, Lighting->None, \\"RTX\\"->True]\\n```\\n\\nHere is the result\\n\\n![](screenshot(13).png)\\n\\nLooks like a dream...\\n\\n## Limitations\\n- The dynamic scenes now are not supported, but can be added in theory according to the documentation of the path-rendering library. \\n- Requires a dedicated GPU (actually with my Intel UHD integrated graphics it works, but demands an extremely long time to compile shaders to start rendering). However, iPhones, Androids can still handle not very complicated scenes.\\n- Safari crashes (Firefox, Chrome, Vivaldi work well)"}]}}')}}]);