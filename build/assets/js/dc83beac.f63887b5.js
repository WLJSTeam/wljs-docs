(self.webpackChunkwlx_docs=self.webpackChunkwlx_docs||[]).push([[89132],{3375:(e,n,a)=>{"use strict";a.d(n,{A:()=>t});const t=a.p+"assets/images/draggizmo-ezgif.com-optimize-d42-a60da74175c76a2d3bb305f2711a9bfc.gif"},18535:()=>{},26314:(e,n,a)=>{"use strict";a.d(n,{A:()=>t});const t=a.p+"assets/images/DistanceHoles-ezgif.com-optimize-162-371ef18873fb44dd707ffb216614c46d.gif"},28453:(e,n,a)=>{"use strict";a.d(n,{R:()=>r,x:()=>o});var t=a(96540);const i={},s=t.createContext(i);function r(e){const n=t.useContext(s);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(s.Provider,{value:n},e.children)}},48653:(e,n,a)=>{"use strict";a.r(n),a.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>D,frontMatter:()=>r,metadata:()=>l,toc:()=>d});var t=a(74848),i=a(28453),s=a(52621);const r={},o="Estimate the Area of an Image Segment",l={permalink:"/blog/2025/06/18/holes",source:"@site/blog/2025-06-18-holes/index.mdx",title:"Estimate the Area of an Image Segment",description:"Using Basic ML with Wolfram Engine",date:"2025-06-18T00:00:00.000Z",tags:[],readingTime:4.115,hasTruncateMarker:!0,authors:[],frontMatter:{},unlisted:!1,prevItem:{title:"Dragging object inside a custom region",permalink:"/blog/2025/06/26/contrained-drag"},nextItem:{title:"Mathematica's render in animations and dynamics",permalink:"/blog/2025/05/07/mma"}},c={authorsImageUrls:[]},d=[{value:"Image segmentation",id:"image-segmentation",level:2},{value:"Morphological components",id:"morphological-components",level:3},{value:"Back to CNN",id:"back-to-cnn",level:2},{value:"Calibration",id:"calibration",level:2},{value:"Automate it!",id:"automate-it",level:2},{value:"Overlay",id:"overlay",level:3},{value:"Virtual Ruler",id:"virtual-ruler",level:3},{value:"Final version",id:"final-version",level:3},{value:"Final final version",id:"final-final-version",level:3},{value:"Convert to a Mini App",id:"convert-to-a-mini-app",level:2},{value:"Main Window",id:"main-window",level:3}];function B(e){const n={admonition:"admonition",annotation:"annotation",code:"code",em:"em",h2:"h2",h3:"h3",img:"img",li:"li",math:"math",mn:"mn",mo:"mo",mrow:"mrow",msup:"msup",mtext:"mtext",ol:"ol",p:"p",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:(0,t.jsx)(n.em,{children:"Using Basic ML with Wolfram Engine"})}),"\n",(0,t.jsx)(n.p,{children:"Hi there! I am working as a spectroscopist. We shine light through the samples and estimate how much is absorbed and at which frequency. In this case, it is quite crucial to know the light spot, which is collimated by a special copper aperture:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:a(26314).A+"",width:"800",height:"387"})}),"\n","\n",(0,t.jsx)(s.k8,{json:a(48775).A,notebook:a(55573).A}),"\n",(0,t.jsx)(n.p,{children:"Let's drag and drop our image and adjust the brightness:"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"adf8e995-70f9-4354-abc1-508d0b66cbe4",type:"Input",opts:{},children:"Import%5B%22yourPathToDroppedImage.jpeg%22%5D%3B%0AImageAdjust%5BImageResize%5B%25%2C%20400%5D%2C%20%7B0.01%2C%202%7D%5D"}),"\n",(0,t.jsx)(n.p,{children:"Here is my sample image:"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"d8658b4f-815c-439d-8060-2a54d217229f",type:"Input",opts:{InitGroup:!0},children:"img%20%3D%20%28%2AVB%5B%2A%29%28FrontEndRef%5B%2229e2ab9f-8a3d-492a-a77a-13df130878b9%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG1mmGiUmWabpWiQap%2BiaWBol6iaamyfqGhqnpBkaG1iYWyRZAgCJ%2BxWr%22%2A%29%28%2A%5DVB%2A%29%3B"}),"\n",(0,t.jsx)(n.h2,{id:"image-segmentation",children:"Image segmentation"}),"\n",(0,t.jsx)(n.p,{children:"There is a local neural network, which is ready to be used for a general image segmentation:"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"bd1d0f61-60c4-4d7e-bca3-f8e96573ef00",type:"Input",opts:{InitGroup:!1},children:"%28segments%20%3D%20ImageSegmentationComponents%5Bimg%5D%29%20%2F%2F%20AbsoluteTiming%3B%0AQuantity%5B%25%20%2F%2F%20First%2C%20%22Seconds%22%5D%0Asegments%20%2F%2F%20Colorize%20"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"7eb8a2db-f84a-47c7-96c6-69404d149901",type:"Output",opts:{},children:"%28%2AVB%5B%2A%29%28Quantity%5B63.408851%2C%20%22Seconds%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KWnMIB4vkAjLTC13SU3OL0osyS8K5gCKBJYm5pVkllQWvfl%2BxCp0i79DMDtQNBioJi%2BlGADByRWf%22%2A%29%28%2A%5DVB%2A%29"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"538ca437-8cb2-4808-bc5e-3bfece9c497a",type:"Output",opts:{},children:"%28%2AVB%5B%2A%29%28FrontEndRef%5B%2233a9e052-8529-40e9-bb21-d580107ea254%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKGxsnWqYamBrpWpgaWeqaGKRa6iYlGRnqpphaGBgamKcmGpmaAAB1TxTa%22%2A%29%28%2A%5DVB%2A%29"}),"\n",(0,t.jsxs)(n.p,{children:["It takes ",(0,t.jsx)(n.strong,{children:"a lot of time"}),"! Can we do better for our case?"]}),"\n",(0,t.jsx)(n.h3,{id:"morphological-components",children:"Morphological components"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"1bac8809-60ca-48c7-a353-5cdf58f1f498",type:"Input",opts:{},children:"MorphologicalComponents%5Bimg%5D%20%2F%2F%20Colorize%20"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"ee0bbaf9-ddae-4c97-aeb0-6fc8cebb1166",type:"Output",opts:{},children:"%28%2AVB%5B%2A%29%28FrontEndRef%5B%228f24228f-919c-4006-9f65-a8eca3335f86%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKW6QZmRgZWaTpWhpaJuuaGBiY6VqmmZnqJlqkJicaGxubplmYAQB4JhUn%22%2A%29%28%2A%5DVB%2A%29"}),"\n",(0,t.jsx)(n.p,{children:"Wow cool. It is faster than CNN (I guess), but requires some tweaking:"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"f977b283-959c-4c54-bbd0-b194b99e7b17",type:"Input",opts:{},children:"MorphologicalComponents%5Bimg%2C%200.5%5D%20%2F%2F%20Colorize%20"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"e7a36fa8-1544-47c5-9f25-c37f34e85a53",type:"Output",opts:{},children:"%28%2AVB%5B%2A%29%28FrontEndRef%5B%22e584841b-1ba8-4ff7-ba7f-0a8f79268bab%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKp5pamFiYGCbpGiYlWuiapKWZ6yYlmqfpGiRapJlbGplZJCUmAQCHXRYP%22%2A%29%28%2A%5DVB%2A%29"}),"\n",(0,t.jsx)(n.p,{children:"Nope \ud83e\udd7a\nI did not manage to make it work with a simpler approach. I guess, we have to stick to CNN."}),"\n",(0,t.jsx)(n.h2,{id:"back-to-cnn",children:"Back to CNN"}),"\n",(0,t.jsx)(n.p,{children:"Let's pick a point on our image:"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"12c5f7ce-cd6b-46e1-9592-796a17b3605a",type:"Input",opts:{},children:"HighlightImage%5Bimg%2C%20%7BRed%2C%20Point%5B%28%2ABB%5B%2A%29%28%7B268%2C177.65625%60%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeB5AILqnMSXXKr0hjgskHleakFnMBGU6JydnpRfmleSlpzDDlQe5Ozvk5%2BUVFDGDwwR6dwcAAAAHdFiw%3D%22%2A%29%28%2A%5DBB%2A%29%5D%7D%5D"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"c0381727-69dd-41e4-9e53-431b20e3f12a",type:"Output",opts:{},children:"%28%2AVB%5B%2A%29%28FrontEndRef%5B%222d6fd627-6c9f-469a-8add-1613a1062c9a%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG6WYpaWYGZnrmiVbpumamFkm6lokpqToGpoZGicaGpgZJVsmAgCHARWn%22%2A%29%28%2A%5DVB%2A%29"}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsxs)(n.p,{children:["Do not do by repeated revaluation of the same cell. Use ",(0,t.jsx)(n.strong,{children:"Command Palette"})," tool ==Inline navigation drag gizmo== while selecting the coordinates of a point highlighted in yellow"]}),(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{src:a(3375).A+"",width:"686",height:"441"})})]}),"\n",(0,t.jsx)(n.p,{children:"Now let us try again:"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"8b971bd2-388d-401b-9d55-5443d41cda4a",type:"Input",opts:{InitGroup:!1},children:"segments%20%3D%20ImageSegmentationComponents%5Bimg%5D%3B"}),"\n",(0,t.jsx)(n.p,{children:"Select one with a minimal area and one that includes our point:"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"43207f0d-0047-4e61-a633-54796649e079",type:"Input",opts:{},children:"hole%20%3D%20With%5B%7Bi%20%3D%20SortBy%5BSelect%5BComponentMeasurements%5B%7Bimg%2C%20segments%7D%2C%20%22BoundingBox%22%5D%2C%20RegionMember%5BRectangle%20%40%40%20%23%5B%5B2%5D%5D%2C%20%28%2ABB%5B%2A%29%28%7B268%2C177.65625%60%7D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeB5AILqnMSXXKr0hjgskHleakFnMBGU6JydnpRfmleSlpzDDlQe5Ozvk5%2BUVFDGDwwR6dwcAAAAHdFiw%3D%22%2A%29%28%2A%5DBB%2A%29%5D%26%5D%2C%20Area%5BRectangle%20%40%40%20%23%5D%26%5D%2F%2FLast%2F%2FFirst%7D%2C%0A%20%20SelectComponents%5B%7Bimg%2C%20segments%7D%2C%20%28%23Label%20%3D%3D%20i%29%20%26%5D%20%2F%2F%20Last%20%0A%5D%3B%0A%0Ahole%20%2F%2F%20Colorize%20"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"fde54d11-8895-4d25-bfb8-8ccf320b71a8",type:"Output",opts:{},children:"%28%2AVB%5B%2A%29%28FrontEndRef%5B%22c5cbc3ab-ac8a-485d-993d-54d53cccc5e5%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKJ5smJyUbJybpJiZbJOqaWJim6FpaGqfompqkmBonA4FpqikAmiAWlA%3D%3D%22%2A%29%28%2A%5DVB%2A%29"}),"\n",(0,t.jsx)(n.p,{children:"Measure the area"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"8eb78215-fa8a-40ca-99c2-c175bc6aced9",type:"Input",opts:{},children:"ComponentMeasurements%5Bhole%2C%20%22Area%22%5D%20%2F%2F%20First%20%2F%2F%20Last%20"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"f5b53e63-6754-49b6-9b2c-daf392ec205b",type:"Output",opts:{},children:"1358.875%60"}),"\n",(0,t.jsx)(n.h2,{id:"calibration",children:"Calibration"}),"\n",(0,t.jsx)(n.p,{children:"To get the correct value in real units, we need to adjust the integrated value by the corresponding Jacobian. Assuming that perspective distortions are negligible and the aspect ratio of the image was not changed, the area can be corrected by a constant multiplier corresponding to:"}),"\n",(0,t.jsx)(n.span,{className:"katex-display",children:(0,t.jsxs)(n.span,{className:"katex",children:[(0,t.jsx)(n.span,{className:"katex-mathml",children:(0,t.jsx)(n.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,t.jsxs)(n.semantics,{children:[(0,t.jsxs)(n.mrow,{children:[(0,t.jsx)(n.mtext,{children:"Area"}),(0,t.jsx)(n.mo,{children:"="}),(0,t.jsxs)(n.msup,{children:[(0,t.jsx)(n.mtext,{children:"UnitsPerPixel"}),(0,t.jsx)(n.mn,{children:"2"})]}),(0,t.jsx)(n.mo,{children:"\u22c5"}),(0,t.jsx)(n.mtext,{children:"PixelArea"})]}),(0,t.jsx)(n.annotation,{encoding:"application/x-tex",children:"\\text{Area} = \\text{UnitsPerPixel}^2 \\cdot \\text{PixelArea}"})]})})}),(0,t.jsxs)(n.span,{className:"katex-html","aria-hidden":"true",children:[(0,t.jsxs)(n.span,{className:"base",children:[(0,t.jsx)(n.span,{className:"strut",style:{height:"0.6833em"}}),(0,t.jsx)(n.span,{className:"mord text",children:(0,t.jsx)(n.span,{className:"mord",children:"Area"})}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(n.span,{className:"mrel",children:"="}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,t.jsxs)(n.span,{className:"base",children:[(0,t.jsx)(n.span,{className:"strut",style:{height:"0.8984em"}}),(0,t.jsxs)(n.span,{className:"mord",children:[(0,t.jsx)(n.span,{className:"mord text",children:(0,t.jsx)(n.span,{className:"mord",children:"UnitsPerPixel"})}),(0,t.jsx)(n.span,{className:"msupsub",children:(0,t.jsx)(n.span,{className:"vlist-t",children:(0,t.jsx)(n.span,{className:"vlist-r",children:(0,t.jsx)(n.span,{className:"vlist",style:{height:"0.8984em"},children:(0,t.jsxs)(n.span,{style:{top:"-3.1473em",marginRight:"0.05em"},children:[(0,t.jsx)(n.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(n.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(n.span,{className:"mord mtight",children:"2"})})]})})})})})]}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,t.jsx)(n.span,{className:"mbin",children:"\u22c5"}),(0,t.jsx)(n.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,t.jsxs)(n.span,{className:"base",children:[(0,t.jsx)(n.span,{className:"strut",style:{height:"0.6944em"}}),(0,t.jsx)(n.span,{className:"mord text",children:(0,t.jsx)(n.span,{className:"mord",children:"PixelArea"})})]})]})]})}),"\n",(0,t.jsx)(n.p,{children:"We simply place two points using gizmo helpers:"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"fd769a3e-2082-4dd3-baac-f7e82c275dec",type:"Input",opts:{},children:"HighlightImage%5Bimg%2C%20%7BRed%2C%20Line%5B%7B%7B129%2C24.828125000000018%60%7D%2C%20%7B129%2C262.828125%60%7D%7D%5D%7D%5D"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"d64bc141-60e1-4198-8d1b-ebffcc2ec5d5",type:"Output",opts:{},children:"%28%2AVB%5B%2A%29%28FrontEndRef%5B%22539e7a14-15ed-475e-8766-e19f8116320b%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKmxpbpponGproGpqmpuiamJum6lqYm5npphpaplkYGpoZGxkkAQB5tRTx%22%2A%29%28%2A%5DVB%2A%29"}),"\n",(0,t.jsx)(n.p,{children:"Esimate units per pixel"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"5767ac64-f6f0-4689-8f20-ab1efb60e0e7",type:"Input",opts:{},children:"Line%5B%7B%7B129%2C24.828125000000018%60%7D%2C%20%7B129%2C262.828125%60%7D%7D%5D%20%2F%2F%20ArcLength%3B%0A20.0%20%2F%20%25"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"2a2ce490-0ca1-48bd-bd90-5f4563633132",type:"Output",opts:{},children:"0.08403361344537816%60"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Final result: area of the hole"})}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"35e31b74-b64f-43f1-9d8d-5ceeaaf76baa",type:"Input",opts:{},children:"HighlightImage%5BBlend%5B%7Bimg%2C%20Colorize%5Bhole%5D%7D%2C%200.5%5D%2C%20%0A%20%20%7BDirective%5BRed%2C%20FontSize-%3E18%5D%2C%20Text%5BStringTemplate%5B%22Area%3A%20%60%60%20mm%5E%7B2%7D%22%5D%5B%28%2ASpB%5B%2A%29Power%5B0.08403%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%201358.87%5D%2C%20%7B268%2C177.65625%20%2B%2035%7D%2C%20%7B0%2C0%7D%5D%7D%0A%5D"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"ce014d20-79d6-457d-87f7-b31cab004d10",type:"Output",opts:{},children:"%28%2AVB%5B%2A%29%28FrontEndRef%5B%2283b999da-39b4-4e04-9c78-32b37c57299a%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKWxgnWVpapiTqGlsmmeiapBqY6Fomm1voGhslGZsnm5obWVomAgB%2BBxUv%22%2A%29%28%2A%5DVB%2A%29"}),"\n",(0,t.jsx)(n.h2,{id:"automate-it",children:"Automate it!"}),"\n",(0,t.jsx)(n.p,{children:"Let's create a widget that can accomplish this task in a few steps:"}),"\n",(0,t.jsx)(n.h3,{id:"overlay",children:"Overlay"}),"\n",(0,t.jsxs)(n.p,{children:["Here, we overlay our image with an inset that includes a dynamic ",(0,t.jsx)(n.code,{children:"Image"}),". We reload the image data with masked regions depending on where the user's cursor is pointing:"]}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"7a3ed534-2660-4d1d-b543-a2b91e02403d",type:"Input",opts:{},children:"Module%5B%7B%0A%20%20overlay%2C%20%0A%20%20segment%20%3D%201%0A%7D%2C%20With%5B%7B%0A%20%20masks%20%3D%20Values%5BComponentMeasurements%5B%7Bimg%2C%20segments%7D%2C%20%7B%22Mask%22%2C%20%22BoundingBox%22%2C%20%22Label%22%2C%20%22Area%22%2C%20%22BoundingBoxArea%22%7D%5D%5D%0A%7D%2C%0A%20%20%0A%20%20overlay%20%3D%20ImageData%5BColorize%5Bmasks%5B%5Bsegment%2C%201%5D%5D%5D%2C%20%22Byte%22%5D%3B%0A%0A%20%20EventHandler%5BHighlightImage%5BBlend%5B%7Bimg%2C%20Colorize%5Bsegments%5D%7D%2C%200.4%5D%2C%20%7B%0A%20%20%20%20%7BOpacity%5B0.2%5D%2C%20Inset%5BImage%5Boverlay%20%2F%2F%20Offload%2C%20%22Byte%22%5D%2C%20Center%2C%20Center%5D%7D%0A%20%20%7D%5D%2C%20%7B%22mousemove%22%20-%3E%20Function%5Bxy%2C%20%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20r%20%3D%20SortBy%5BSelect%5Bmasks%2C%20RegionMember%5BRectangle%20%40%40%20%23%5B%5B2%5D%5D%2C%20xy%5D%26%5D%2C%20Last%5D%20%2F%2F%20First%20%2F%2F%20Quiet%0A%20%20%20%20%7D%2C%0A%20%20%20%20%20%20If%5B%21ListQ%5Br%5D%2C%20Return%5B%5D%5D%3B%0A%20%20%20%20%20%20If%5Br%5B%5B3%5D%5D%20%3D%3D%20segment%2C%20Return%5B%5D%5D%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20segment%20%3D%20r%5B%5B3%5D%5D%3B%0A%20%20%20%20%20%20overlay%20%3D%20ImageData%5BColorize%5Bmasks%5B%5Bsegment%2C%201%5D%5D%5D%2C%20%22Byte%22%5D%3B%0A%20%20%20%20%5D%0A%20%20%5D%7D%5D%0A%0A%5D%5D"}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsx)(n.p,{children:"Here we pick a segment with a minimal bounding box area to discard tiny distributed non-connected features."})}),"\n",(0,t.jsx)(n.h3,{id:"virtual-ruler",children:"Virtual Ruler"}),"\n",(0,t.jsx)(n.p,{children:"We need to match the scale of the image with real units. For that resound we construct two handles to place two points on the image. The easiest one would be this:"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"afec6a82-42a1-4899-ad26-bc3a5a10d635",type:"Input",opts:{},children:"Graphics%5B%7B%0A%20%20Line%5B%7B%7B0%2C1%7D%2C%20%7B0%2C-1%7D%7D%5D%2C%20Line%5B%7B%7B-0.3%2C1%7D%2C%20%7B0.3%2C1%7D%7D%5D%2C%20Line%5B%7B%7B-0.3%2C-1%7D%2C%20%7B0.3%2C-1%7D%7D%5D%2C%0A%20%20Opacity%5B0.5%5D%2C%20Red%2C%20Rectangle%5B%7B0%2C1%7D-%7B0.2%2C0.2%7D%2C%20%7B0%2C1%7D%2B%7B0.2%2C0.2%7D%5D%2C%20Rectangle%5B%7B0%2C-1%7D-%7B0.2%2C0.2%7D%2C%20%7B0%2C-1%7D%2B%7B0.2%2C0.2%7D%5D%0A%7D%2C%20PlotRange-%3E1.2%7B%7B-1%2C1%7D%2C%20%7B-1%2C1%7D%7D%2C%20ImageSize-%3ESmall%5D"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"a2ab3b55-1a53-45ac-9de9-664f90047746",type:"Output",opts:{},children:"%28%2AVB%5B%2A%29%28Graphics%5B%7BLine%5B%7B%7B0%2C%201%7D%2C%20%7B0%2C%20-1%7D%7D%5D%2C%20Line%5B%7B%7B-0.3%2C%201%7D%2C%20%7B0.3%2C%201%7D%7D%5D%2C%20Line%5B%7B%7B-0.3%2C%20-1%7D%2C%20%7B0.3%2C%20-1%7D%7D%5D%2C%20Opacity%5B0.5%5D%2C%20RGBColor%5B1%2C%200%2C%200%5D%2C%20Rectangle%5B%7B-0.2%2C%200.8%7D%2C%20%7B0.2%2C%201.2%7D%5D%2C%20Rectangle%5B%7B-0.2%2C%20-1.2%7D%2C%20%7B0.2%2C%20-0.8%7D%5D%7D%2C%20PlotRange%20-%3E%20%7B%7B-1.2%2C%201.2%7D%2C%20%7B-1.2%2C%201.2%7D%7D%2C%20ImageSize%20-%3E%20Small%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KWnMIB4HkHAvSizIyEwuTmOHyftkFpcgVPtk5qWmMaHIofAygTRDJkg5NvH%2FQEC8WUXGYHB5PxbzYHL2EDkyzAS7BYeZCHeCgsG%2FIDE5s6SyiAEMHtgjQivI3ck5Pye%2FCOwIiBcZ4E7lBClITS5JzEvPQXNT0ayZIHByP5Tx0h67vD3USZ%2FtSTASqmU%2FLiOhViLJB5XmpILNDsjJLwkCGk5MEH7ej%2BY4YuThNnnmJqanBmdWpRazAnnBuYk5OQCX9Kl6%22%2A%29%28%2A%5DVB%2A%29"}),"\n",(0,t.jsx)(n.p,{children:"Where two red rectangles can be used as dragging area for a user mouse. Of course we have to recalculate the posiitons of upper and bottom segments considering the angle, i.e. not only for horisontal or vertical directions."}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"672009ac-3fae-4058-b5a2-e397afd490ad",type:"Input",opts:{},children:"Module%5B%7B%0A%20%20overlay%2C%20%0A%20%20segment%20%3D%201%2C%20%0A%20%20nav%20%3D%20%7B%7B0.5%2C0.6%7D%20ImageDimensions%5Bimg%5D%2C%20%7B0.5%2C0.4%7D%20ImageDimensions%5Bimg%5D%7D%2C%0A%20%20minScale%20%3D%20%7B0.1%2C0.1%7D%20ImageDimensions%5Bimg%5D%20%2F%204.0%0A%7D%2C%20With%5B%7B%0A%20%20masks%20%3D%20Values%5BComponentMeasurements%5B%7Bimg%2C%20segments%7D%2C%20%7B%22Mask%22%2C%20%22BoundingBox%22%2C%20%22Label%22%2C%20%22Area%22%2C%20%22BoundingBoxArea%22%7D%5D%5D%2C%0A%20%20helperLines%20%3D%20Function%5Bp%2C%20With%5B%7Bdir%20%3D%20Normalize%5Bp%5B%5B2%5D%5D-p%5B%5B1%5D%5D%5D%7D%2C%0A%20%20%20%20%7Bp%2C%20%0A%20%20%20%20%20%20%7Bp%5B%5B1%5D%5D%20-%20minScale%5B%5B1%5D%5D%20%20%7Bdir%5B%5B2%5D%5D%2C%20-dir%5B%5B1%5D%5D%7D%2C%20p%5B%5B1%5D%5D%20%2B%20minScale%5B%5B1%5D%5D%20%20%7Bdir%5B%5B2%5D%5D%2C%20-dir%5B%5B1%5D%5D%7D%7D%2C%20%0A%20%20%20%20%20%20%7Bp%5B%5B2%5D%5D%20-%20minScale%5B%5B1%5D%5D%20%20%7Bdir%5B%5B2%5D%5D%2C%20-dir%5B%5B1%5D%5D%7D%2C%20p%5B%5B2%5D%5D%20%2B%20minScale%5B%5B1%5D%5D%20%20%7Bdir%5B%5B2%5D%5D%2C%20-dir%5B%5B1%5D%5D%7D%7D%0A%20%20%20%20%7D%0A%20%20%5D%5D%0A%7D%2C%0A%0A%20%20nav%20%3D%20helperLines%5Bnav%5D%3B%0A%20%20%0A%20%20overlay%20%3D%20ImageData%5BColorize%5Bmasks%5B%5Bsegment%2C%201%5D%5D%5D%2C%20%22Byte%22%5D%3B%0A%0A%20%20EventHandler%5BHighlightImage%5BBlend%5B%7Bimg%2C%20Colorize%5Bsegments%5D%7D%2C%200.4%5D%2C%20%7B%0A%0A%20%20%20%20%7BOpacity%5B0.2%5D%2C%20Inset%5BImage%5Boverlay%20%2F%2F%20Offload%2C%20%22Byte%22%5D%2C%20Center%2C%20Center%5D%7D%2C%0A%20%20%0A%20%20%20%20Cyan%2C%20Line%5Bnav%5B%5B1%5D%5D%20%2F%2F%20Offload%5D%2C%20%0A%20%20%20%20Line%5Bnav%5B%5B2%5D%5D%20%2F%2F%20Offload%5D%2C%20Line%5Bnav%5B%5B3%5D%5D%20%2F%2F%20Offload%5D%2C%0A%0A%20%20%20%20%7B%20Opacity%5B0%5D%2C%0A%20%20%20%20%20%20EventHandler%5BRectangle%5Bnav%5B%5B1%2C1%5D%5D%20-%20minScale%2C%20nav%5B%5B1%2C1%5D%5D%20%2B%20minScale%5D%2C%20%7B%22drag%22-%3EFunction%5Bxy%2C%0A%20%20%20%20%20%20%20%20nav%5B%5B1%2C%201%5D%5D%20%3D%20xy%3B%0A%20%20%20%20%20%20%20%20nav%20%3D%20helperLines%5Bnav%5B%5B1%5D%5D%5D%3B%0A%20%20%20%20%20%20%5D%7D%5D%2C%0A%20%20%20%20%20%20EventHandler%5BRectangle%5Bnav%5B%5B1%2C2%5D%5D%20-%20minScale%2C%20nav%5B%5B1%2C2%5D%5D%20%2B%20minScale%5D%2C%20%7B%22drag%22-%3EFunction%5Bxy%2C%0A%20%20%20%20%20%20%20%20nav%5B%5B1%2C%202%5D%5D%20%3D%20xy%3B%0A%20%20%20%20%20%20%20%20nav%20%3D%20helperLines%5Bnav%5B%5B1%5D%5D%5D%3B%0A%20%20%20%20%20%20%5D%7D%5D%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%7D%5D%2C%20%7B%22mousemove%22%20-%3E%20Function%5Bxy%2C%20%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20r%20%3D%20SortBy%5BSelect%5Bmasks%2C%20RegionMember%5BRectangle%20%40%40%20%23%5B%5B2%5D%5D%2C%20xy%5D%26%5D%2C%20Last%5D%20%2F%2F%20First%20%2F%2F%20Quiet%0A%20%20%20%20%7D%2C%0A%20%20%20%20%20%20If%5B%21ListQ%5Br%5D%2C%20Return%5B%5D%5D%3B%0A%20%20%20%20%20%20If%5Br%5B%5B3%5D%5D%20%3D%3D%20segment%2C%20Return%5B%5D%5D%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20segment%20%3D%20r%5B%5B3%5D%5D%3B%0A%20%20%20%20%20%20overlay%20%3D%20ImageData%5BColorize%5Bmasks%5B%5Bsegment%2C%201%5D%5D%5D%2C%20%22Byte%22%5D%3B%0A%20%20%20%20%5D%0A%20%20%5D%7D%5D%0A%0A%5D%5D"}),"\n",(0,t.jsx)(n.h3,{id:"final-version",children:"Final version"}),"\n",(0,t.jsx)(n.p,{children:"Let's add a panel with a slider to enter the length of the measured distance in real-world units and a text window with calculated area:"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"24f53e98-cf14-49e7-a627-1a16d12b49a3",type:"Input",opts:{},children:"Module%5B%7B%0A%20%20overlay%2C%20%0A%20%20segment%20%3D%201%2C%20%0A%20%20distance%20%3D%201.0%2C%0A%20%20area%20%3D%200.0%2C%0A%20%20nav%20%3D%20%7B%7B0.5%2C0.6%7D%20ImageDimensions%5Bimg%5D%2C%20%7B0.5%2C0.4%7D%20ImageDimensions%5Bimg%5D%7D%2C%0A%20%20minScale%20%3D%20%7B0.1%2C0.1%7D%20ImageDimensions%5Bimg%5D%20%2F%204.0%0A%7D%2C%20With%5B%7B%0A%20%20masks%20%3D%20Values%5BComponentMeasurements%5B%7Bimg%2C%20segments%7D%2C%20%7B%22Mask%22%2C%20%22BoundingBox%22%2C%20%22Label%22%2C%20%22Area%22%2C%20%22BoundingBoxArea%22%7D%5D%5D%2C%0A%20%20helperLines%20%3D%20Function%5Bp%2C%20With%5B%7Bdir%20%3D%20Normalize%5Bp%5B%5B2%5D%5D-p%5B%5B1%5D%5D%5D%7D%2C%0A%20%20%20%20%7Bp%2C%20%0A%20%20%20%20%20%20%7Bp%5B%5B1%5D%5D%20-%20minScale%5B%5B1%5D%5D%20%20%7Bdir%5B%5B2%5D%5D%2C%20-dir%5B%5B1%5D%5D%7D%2C%20p%5B%5B1%5D%5D%20%2B%20minScale%5B%5B1%5D%5D%20%20%7Bdir%5B%5B2%5D%5D%2C%20-dir%5B%5B1%5D%5D%7D%7D%2C%20%0A%20%20%20%20%20%20%7Bp%5B%5B2%5D%5D%20-%20minScale%5B%5B1%5D%5D%20%20%7Bdir%5B%5B2%5D%5D%2C%20-dir%5B%5B1%5D%5D%7D%2C%20p%5B%5B2%5D%5D%20%2B%20minScale%5B%5B1%5D%5D%20%20%7Bdir%5B%5B2%5D%5D%2C%20-dir%5B%5B1%5D%5D%7D%7D%0A%20%20%20%20%7D%0A%20%20%5D%5D%2C%0A%0A%20%20computeArea%20%3D%20Function%5B%7Bd%2Cp%2Cm%2Cs%7D%2C%20%28%2ASpB%5B%2A%29Power%5B%28%28%2AFB%5B%2A%29%28%28d%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%28Norm%5Bp%5B%5B1%2C1%5D%5D-p%5B%5B1%2C2%5D%5D%5D%29%29%28%2A%5DFB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20m%5B%5Bs%2C%204%5D%5D%5D%0A%7D%2C%0A%0A%20%20nav%20%3D%20helperLines%5Bnav%5D%3B%0A%20%20area%20%3D%20computeArea%5Bdistance%2C%20nav%2C%20masks%2C%20segment%5D%3B%0A%20%20%0A%20%20overlay%20%3D%20ImageData%5BColorize%5Bmasks%5B%5Bsegment%2C%201%5D%5D%5D%2C%20%22Byte%22%5D%3B%0A%0A%20%7B%0A%20%20%20EventHandler%5BHighlightImage%5BBlend%5B%7Bimg%2C%20Colorize%5Bsegments%5D%7D%2C%200.4%5D%2C%20%7B%0A%0A%20%20%20%20%7BOpacity%5B0.2%5D%2C%20Inset%5BImage%5Boverlay%20%2F%2F%20Offload%2C%20%22Byte%22%5D%2C%20Center%2C%20Center%5D%7D%2C%0A%20%20%0A%20%20%20%20Cyan%2C%20Line%5Bnav%5B%5B1%5D%5D%20%2F%2F%20Offload%5D%2C%20%0A%20%20%20%20Line%5Bnav%5B%5B2%5D%5D%20%2F%2F%20Offload%5D%2C%20Line%5Bnav%5B%5B3%5D%5D%20%2F%2F%20Offload%5D%2C%0A%0A%20%20%20%20%7B%20Opacity%5B0%5D%2C%0A%20%20%20%20%20%20EventHandler%5BRectangle%5Bnav%5B%5B1%2C1%5D%5D%20-%20minScale%2C%20nav%5B%5B1%2C1%5D%5D%20%2B%20minScale%5D%2C%20%7B%22drag%22-%3EFunction%5Bxy%2C%0A%20%20%20%20%20%20%20%20nav%5B%5B1%2C%201%5D%5D%20%3D%20xy%3B%0A%20%20%20%20%20%20%20%20nav%20%3D%20helperLines%5Bnav%5B%5B1%5D%5D%5D%3B%0A%20%20%20%20%20%20%5D%7D%5D%2C%0A%20%20%20%20%20%20EventHandler%5BRectangle%5Bnav%5B%5B1%2C2%5D%5D%20-%20minScale%2C%20nav%5B%5B1%2C2%5D%5D%20%2B%20minScale%5D%2C%20%7B%22drag%22-%3EFunction%5Bxy%2C%0A%20%20%20%20%20%20%20%20nav%5B%5B1%2C%202%5D%5D%20%3D%20xy%3B%0A%20%20%20%20%20%20%20%20nav%20%3D%20helperLines%5Bnav%5B%5B1%5D%5D%5D%3B%0A%20%20%20%20%20%20%5D%7D%5D%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%7D%5D%2C%20%7B%22mousemove%22%20-%3E%20Function%5Bxy%2C%20%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20r%20%3D%20SortBy%5BSelect%5Bmasks%2C%20RegionMember%5BRectangle%20%40%40%20%23%5B%5B2%5D%5D%2C%20xy%5D%26%5D%2C%20Last%5D%20%2F%2F%20First%20%2F%2F%20Quiet%0A%20%20%20%20%7D%2C%0A%20%20%20%20%20%20If%5B%21ListQ%5Br%5D%2C%20Return%5B%5D%5D%3B%0A%20%20%20%20%20%20If%5Br%5B%5B3%5D%5D%20%3D%3D%20segment%2C%20Return%5B%5D%5D%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20segment%20%3D%20r%5B%5B3%5D%5D%3B%0A%20%20%20%20%20%20overlay%20%3D%20ImageData%5BColorize%5Bmasks%5B%5Bsegment%2C%201%5D%5D%5D%2C%20%22Byte%22%5D%3B%0A%20%20%20%20%20%20area%20%3D%20computeArea%5Bdistance%2C%20nav%2C%20masks%2C%20segment%5D%3B%0A%20%20%20%20%5D%0A%20%20%5D%7D%5D%2C%0A%20%20%0A%20%20Panel%5B%7B%0A%20%20%20%20EventHandler%5BInputRange%5B0%2C%2050%2C%200.01%2C%201.0%2C%20%22Label%22-%3E%22Distance%22%5D%2C%20Function%5Bd%2C%20%0A%20%20%20%20%20%20distance%20%3D%20d%3B%0A%20%20%20%20%20%20area%20%3D%20computeArea%5Bdistance%2C%20nav%2C%20masks%2C%20segment%5D%3B%0A%20%20%20%20%5D%5D%2C%0A%0A%20%20%20%20TextView%5Barea%20%2F%2F%20Offload%2C%20%22Label%22-%3E%22Area%22%5D%0A%20%20%7D%20%2F%2F%20Column%5D%0A%20%7D%20%2F%2F%20Row%20%0A%0A%5D%5D"}),"\n",(0,t.jsx)(n.h3,{id:"final-final-version",children:"Final final version"}),"\n",(0,t.jsx)(n.p,{children:"As a last commit we can add a file browser and contrast/brightness correction widget:"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"d285159a-558c-4571-9bf9-094f146effbe",type:"Input",opts:{InitGroup:!0,Fade:!0},children:"widget1%5Bimg_Image%5D%20%3A%3D%20Module%5B%7B%0A%20%20overlay%2C%20%0A%20%20segment%20%3D%201%2C%20%0A%20%20distance%20%3D%201.0%2C%0A%20%20area%20%3D%200.0%2C%0A%20%20nav%20%3D%20%7B%7B0.5%2C0.6%7D%20ImageDimensions%5Bimg%5D%2C%20%7B0.5%2C0.4%7D%20ImageDimensions%5Bimg%5D%7D%2C%0A%20%20minScale%20%3D%20%7B0.1%2C0.1%7D%20ImageDimensions%5Bimg%5D%20%2F%204.0%2C%0A%20%20segments%20%3D%20ImageSegmentationComponents%5Bimg%5D%0A%7D%2C%20With%5B%7B%0A%20%20masks%20%3D%20Values%5BComponentMeasurements%5B%7Bimg%2C%20segments%7D%2C%20%7B%22Mask%22%2C%20%22BoundingBox%22%2C%20%22Label%22%2C%20%22Area%22%2C%20%22BoundingBoxArea%22%7D%5D%5D%2C%0A%20%20helperLines%20%3D%20Function%5Bp%2C%20With%5B%7Bdir%20%3D%20Normalize%5Bp%5B%5B2%5D%5D-p%5B%5B1%5D%5D%5D%7D%2C%0A%20%20%20%20%7Bp%2C%20%0A%20%20%20%20%20%20%7Bp%5B%5B1%5D%5D%20-%20minScale%5B%5B1%5D%5D%20%20%7Bdir%5B%5B2%5D%5D%2C%20-dir%5B%5B1%5D%5D%7D%2C%20p%5B%5B1%5D%5D%20%2B%20minScale%5B%5B1%5D%5D%20%20%7Bdir%5B%5B2%5D%5D%2C%20-dir%5B%5B1%5D%5D%7D%7D%2C%20%0A%20%20%20%20%20%20%7Bp%5B%5B2%5D%5D%20-%20minScale%5B%5B1%5D%5D%20%20%7Bdir%5B%5B2%5D%5D%2C%20-dir%5B%5B1%5D%5D%7D%2C%20p%5B%5B2%5D%5D%20%2B%20minScale%5B%5B1%5D%5D%20%20%7Bdir%5B%5B2%5D%5D%2C%20-dir%5B%5B1%5D%5D%7D%7D%0A%20%20%20%20%7D%0A%20%20%5D%5D%2C%0A%0A%20%20computeArea%20%3D%20Function%5B%7Bd%2Cp%2Cm%7D%2C%20%28%2ASpB%5B%2A%29Power%5B%28%28%2AFB%5B%2A%29%28%28d%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%28Norm%5Bp%5B%5B1%2C1%5D%5D-p%5B%5B1%2C2%5D%5D%5D%29%29%28%2A%5DFB%2A%29%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20m%5B%5B4%5D%5D%5D%0A%7D%2C%0A%0A%20%20nav%20%3D%20helperLines%5Bnav%5D%3B%0A%20%20area%20%3D%20computeArea%5Bdistance%2C%20nav%2C%20masks%5B%5Bsegment%5D%5D%5D%3B%0A%20%20%0A%20%20overlay%20%3D%20ImageData%5BColorize%5Bmasks%5B%5Bsegment%2C%201%5D%5D%5D%2C%20%22Byte%22%5D%3B%0A%0A%20%7B%0A%20%20%20EventHandler%5BHighlightImage%5BBlend%5B%7Bimg%2C%20Colorize%5Bsegments%5D%7D%2C%200.4%5D%2C%20%7B%0A%0A%20%20%20%20%7BOpacity%5B0.2%5D%2C%20Inset%5BImage%5Boverlay%20%2F%2F%20Offload%2C%20%22Byte%22%5D%2C%20Center%2C%20Center%5D%7D%2C%0A%20%20%0A%20%20%20%20Cyan%2C%20Line%5Bnav%5B%5B1%5D%5D%20%2F%2F%20Offload%5D%2C%20%0A%20%20%20%20Line%5Bnav%5B%5B2%5D%5D%20%2F%2F%20Offload%5D%2C%20Line%5Bnav%5B%5B3%5D%5D%20%2F%2F%20Offload%5D%2C%0A%0A%20%20%20%20%7B%20Opacity%5B0%5D%2C%0A%20%20%20%20%20%20EventHandler%5BRectangle%5Bnav%5B%5B1%2C1%5D%5D%20-%20minScale%2C%20nav%5B%5B1%2C1%5D%5D%20%2B%20minScale%5D%2C%20%7B%22drag%22-%3EFunction%5Bxy%2C%0A%20%20%20%20%20%20%20%20nav%5B%5B1%2C%201%5D%5D%20%3D%20xy%3B%0A%20%20%20%20%20%20%20%20nav%20%3D%20helperLines%5Bnav%5B%5B1%5D%5D%5D%3B%0A%20%20%20%20%20%20%5D%7D%5D%2C%0A%20%20%20%20%20%20EventHandler%5BRectangle%5Bnav%5B%5B1%2C2%5D%5D%20-%20minScale%2C%20nav%5B%5B1%2C2%5D%5D%20%2B%20minScale%5D%2C%20%7B%22drag%22-%3EFunction%5Bxy%2C%0A%20%20%20%20%20%20%20%20nav%5B%5B1%2C%202%5D%5D%20%3D%20xy%3B%0A%20%20%20%20%20%20%20%20nav%20%3D%20helperLines%5Bnav%5B%5B1%5D%5D%5D%3B%0A%20%20%20%20%20%20%5D%7D%5D%0A%20%20%20%20%7D%0A%20%20%20%20%0A%20%20%7D%5D%2C%20%7B%22mousemove%22%20-%3E%20Function%5Bxy%2C%20%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20r%20%3D%20SortBy%5BSelect%5Bmasks%2C%20RegionMember%5BRectangle%20%40%40%20%23%5B%5B2%5D%5D%2C%20xy%5D%26%5D%2C%20Last%5D%20%2F%2F%20First%20%2F%2F%20Quiet%0A%20%20%20%20%7D%2C%0A%20%20%20%20%20%20If%5B%21ListQ%5Br%5D%2C%20Return%5B%5D%5D%3B%0A%20%20%20%20%20%20If%5Br%5B%5B3%5D%5D%20%3D%3D%20segment%2C%20Return%5B%5D%5D%3B%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20segment%20%3D%20r%5B%5B3%5D%5D%3B%0A%20%20%20%20%20%20overlay%20%3D%20ImageData%5BColorize%5Bmasks%5B%5Bsegment%5D%5D%5B%5B1%5D%5D%5D%2C%20%22Byte%22%5D%3B%0A%20%20%20%20%20%20area%20%3D%20computeArea%5Bdistance%2C%20nav%2C%20masks%5B%5Bsegment%5D%5D%5D%3B%0A%20%20%20%20%5D%0A%20%20%5D%7D%5D%2C%0A%20%20%0A%20%20Panel%5B%7B%0A%20%20%20%20EventHandler%5BInputRange%5B0%2C%2050%2C%200.01%2C%201.0%2C%20%22Label%22-%3E%22Distance%22%5D%2C%20Function%5Bd%2C%20%0A%20%20%20%20%20%20distance%20%3D%20d%3B%0A%20%20%20%20%20%20area%20%3D%20computeArea%5Bdistance%2C%20nav%2C%20masks%5B%5Bsegment%5D%5D%5D%3B%0A%20%20%20%20%5D%5D%2C%0A%0A%20%20%20%20TextView%5Barea%20%2F%2F%20Offload%2C%20%22Label%22-%3E%22Area%22%5D%0A%20%20%7D%20%2F%2F%20Column%5D%0A%20%7D%20%2F%2F%20Row%20%0A%0A%5D%5D%3B%0A%0Awidget2%5Bimg_%5D%20%3A%3D%20Module%5B%7B%0A%20%20imageData%20%3D%20ImageData%5Bimg%2C%20%22Byte%22%5D%0A%7D%2C%20With%5B%7Bo%20%3D%20img%7D%2C%0A%0A%20%20%7B%0A%20%20%20%20Image%5BimageData%20%2F%2F%20Offload%2C%20%22Byte%22%5D%2C%0A%20%20%20%20EventHandler%5BInputGroup%5B%7B%0A%20%20%20%20%20%20InputRange%5B-1%2C2%2C0.1%2C%20%22Label%22-%3E%22Contrast%22%5D%2C%0A%20%20%20%20%20%20InputRange%5B0%2C2%2C0.1%2C%20%22Label%22-%3E%22Brightness%22%5D%0A%20%20%20%20%7D%5D%2C%20Function%5Bc%2C%0A%20%20%20%20%20%20img%20%3D%20ImageAdjust%5Bo%2C%20c%5D%3B%0A%20%20%20%20%20%20imageData%20%3D%20ImageData%5Bimg%2C%20%22Byte%22%5D%3B%0A%20%20%20%20%5D%5D%0A%20%20%7D%20%2F%2F%20Row%0A%0A%5D%5D%3B%0A%0ASetAttributes%5Bwidget2%2C%20HoldFirst%5D"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Evaluate this cell"}),"\n"]}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"5df3c9b9-2f6e-44b3-b6f6-447bf6b49e2b",type:"Input",opts:{},children:"path%20%3D%20SystemDialogInput%5B%22FileOpen%22%5D%3B%0Aimg%20%3D%20Null%3B%0A%0AIf%5BImageQ%5Bimg%20%3D%20Import%5Bpath%5D%5D%2C%0A%20%20img%20%3D%20ImageResize%5Bimg%2C%20350%5D%3B%0A%20%20widget2%5Bimg%5D%0A%2C%20%24Failed%5D"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"After adjusting evaluate this one"}),"\n"]}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"2b50b031-9f1e-49ea-a372-88f45820164b",type:"Input",opts:{},children:"widget1%5Bimg%5D"}),"\n",(0,t.jsx)(n.h2,{id:"convert-to-a-mini-app",children:"Convert to a Mini App"}),"\n",(0,t.jsx)(n.p,{children:"You can export this entire notebook into a mini-app. There are a few rules to follow:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"All initialization cells will be executed on start."}),"\n",(0,t.jsx)(n.li,{children:"The last input cell will represent the main window of the app."}),"\n",(0,t.jsx)(n.li,{children:"Any defined variables in the notebook will be isolated."}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Since we have two widgets, it might be handy to work with multiple windows."}),"\n",(0,t.jsx)(n.h3,{id:"main-window",children:"Main Window"}),"\n",(0,t.jsx)(n.p,{children:"This will just be a file browser button. But first, define some helper components:"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"dbe2f848-1bf5-4b98-a32c-4625b62cd0a3",type:"Input",opts:{InitGroup:!0,Fade:!0},children:".wlx%0A%0AprogressBarIcon%20%3D%20%3Csvg%20aria-hidden%3D%22true%22%20class%3D%22w-5%20h-4%20text-gray-200%20animate-spin%20dark%3Atext-gray-600%20fill-teal-600%22%20viewBox%3D%220%200%20100%20101%22%20fill%3D%22none%22%3E%3Cpath%20d%3D%22M100%2050.5908C100%2078.2051%2077.6142%20100.591%2050%20100.591C22.3858%20100.591%200%2078.2051%200%2050.5908C0%2022.9766%2022.3858%200.59082%2050%200.59082C77.6142%200.59082%20100%2022.9766%20100%2050.5908ZM9.08144%2050.5908C9.08144%2073.1895%2027.4013%2091.5094%2050%2091.5094C72.5987%2091.5094%2090.9186%2073.1895%2090.9186%2050.5908C90.9186%2027.9921%2072.5987%209.67226%2050%209.67226C27.4013%209.67226%209.08144%2027.9921%209.08144%2050.5908Z%22%20fill%3D%22currentColor%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M93.9676%2039.0409C96.393%2038.4038%2097.8624%2035.9116%2097.0079%2033.5539C95.2932%2028.8227%2092.871%2024.3692%2089.8167%2020.348C85.8452%2015.1192%2080.8826%2010.7238%2075.2124%207.41289C69.5422%204.10194%2063.2754%201.94025%2056.7698%201.05124C51.7666%200.367541%2046.6976%200.446843%2041.7345%201.27873C39.2613%201.69328%2037.813%204.19778%2038.4501%206.62326C39.0873%209.04874%2041.5694%2010.4717%2044.0505%2010.1071C47.8511%209.54855%2051.7191%209.52689%2055.5402%2010.0491C60.8642%2010.7766%2065.9928%2012.5457%2070.6331%2015.2552C75.2735%2017.9648%2079.3347%2021.5619%2082.5849%2025.841C84.9175%2028.9121%2086.7997%2032.2913%2088.1811%2035.8758C89.083%2038.2158%2091.5421%2039.6781%2093.9676%2039.0409Z%22%20fill%3D%22currentFill%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E"}),"\n",(0,t.jsx)(s.aO,{display:"wlx",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"da6a57e3-d15c-4a77-ab4b-37b01b01dc4f",type:"Output",opts:{},children:"%3Csvg%20aria-hidden%3D%22true%22%20class%3D%22w-5%20h-4%20text-gray-200%20animate-spin%20dark%3Atext-gray-600%20fill-teal-600%22%20viewBox%3D%220%200%20100%20101%22%20fill%3D%22none%22%3E%3Cpath%20d%3D%22M100%2050.5908C100%2078.2051%2077.6142%20100.591%2050%20100.591C22.3858%20100.591%200%2078.2051%200%2050.5908C0%2022.9766%2022.3858%200.59082%2050%200.59082C77.6142%200.59082%20100%2022.9766%20100%2050.5908ZM9.08144%2050.5908C9.08144%2073.1895%2027.4013%2091.5094%2050%2091.5094C72.5987%2091.5094%2090.9186%2073.1895%2090.9186%2050.5908C90.9186%2027.9921%2072.5987%209.67226%2050%209.67226C27.4013%209.67226%209.08144%2027.9921%209.08144%2050.5908Z%22%20fill%3D%22currentColor%22%3E%3C%2Fpath%3E%3Cpath%20d%3D%22M93.9676%2039.0409C96.393%2038.4038%2097.8624%2035.9116%2097.0079%2033.5539C95.2932%2028.8227%2092.871%2024.3692%2089.8167%2020.348C85.8452%2015.1192%2080.8826%2010.7238%2075.2124%207.41289C69.5422%204.10194%2063.2754%201.94025%2056.7698%201.05124C51.7666%200.367541%2046.6976%200.446843%2041.7345%201.27873C39.2613%201.69328%2037.813%204.19778%2038.4501%206.62326C39.0873%209.04874%2041.5694%2010.4717%2044.0505%2010.1071C47.8511%209.54855%2051.7191%209.52689%2055.5402%2010.0491C60.8642%2010.7766%2065.9928%2012.5457%2070.6331%2015.2552C75.2735%2017.9648%2079.3347%2021.5619%2082.5849%2025.841C84.9175%2028.9121%2086.7997%2032.2913%2088.1811%2035.8758C89.083%2038.2158%2091.5421%2039.6781%2093.9676%2039.0409Z%22%20fill%3D%22currentFill%22%3E%3C%2Fpath%3E%3C%2Fsvg%3E"}),"\n",(0,t.jsx)(n.p,{children:"Now our window and it's logic:"}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"4ff1958e-f017-45ac-9f17-8422c4d64b25",type:"Input",opts:{InitGroup:!0},children:"notebook%20%3D%20EvaluationNotebook%5B%5D%3B%0Aimg%20%3D%20Null%3B%0A%0AClearAll%5BMainWindow%5D%3B%0A%0AMainWindow%20%3A%3D%20Panel%5B%7B%0A%20%20Style%5B%22Open%20an%20image%22%2C%2010%2C%20Lighter%5BBlack%5D%2CFontFamily-%3E%22system-ui%22%5D%2C%0A%20%20EventHandler%5B%0A%20%20%20%20InputButton%5B%22Browse%22%5D%2C%20%0A%20%20%20%20AsyncFunction%5BNull%2C%20Module%5B%7Bpath%2C%20cell%2C%20progressBar%20%3D%20%22%22%7D%2C%20%0A%20%20%20%20%20%20path%20%3D%20SystemDialogInputAsync%5B%22FileOpen%22%5D%20%2F%2F%20Await%3B%0A%20%20%20%20%20%20If%5BStringQ%5Bpath%5D%2C%0A%20%20%20%20%20%20%20%20With%5B%7Bi%20%3D%20Import%5Bpath%5D%7D%2C%0A%20%20%20%20%20%20%20%20%20%20If%5BImageQ%5Bi%5D%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20img%20%3D%20ImageResize%5Bi%2C%20350%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20cell%20%3D%20CellPrint%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20Panel%5B%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20widget2%5Bimg%5D%2C%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20EventHandler%5BInputButton%5B%22Continue%22%5D%2C%20Function%5BNull%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20If%5BprogressBar%20%3D%21%3D%20%22%22%2C%20Return%5B%5D%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20progressBar%20%3D%20progressBarIcon%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20CellPrint%5B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Panel%5Bwidget1%5Bimg%5D%5D%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22Target%22-%3E_%2C%20%22Notebook%22-%3Enotebook%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ImageSize-%3E%7B800%2C500%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20Delete%5Bcell%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ClearAll%5BprogressBar%5D%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5D%2C%20%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20HTMLView%5BprogressBar%20%2F%2F%20Offload%5D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%20%2F%2FRow%20%0A%20%20%20%20%20%20%20%20%20%20%20%7D%20%2F%2FColumn%20%5D%0A%20%20%20%20%20%20%20%20%2C%20%22Target%22-%3E_%2C%20%22Notebook%22-%3Enotebook%2C%20ImageSize-%3E%7B800%2C500%7D%5D%0A%20%20%20%20%20%20%5D%0A%20%20%20%20%5D%0A%20%20%5D%3B%0A%20%20%0A%20%20ClearAll%5Bpath%5D%3B%0A%5D%5D%5D%7D%20%2F%2F%20Column%5D"}),"\n",(0,t.jsxs)(n.p,{children:["As a final step - export this notebook to a mini app using ",(0,t.jsx)(n.code,{children:"Share"})," menu"]}),"\n",(0,t.jsx)(s.aO,{display:"codemirror",nid:"32417caf-1fd1-413f-8ed5-7014f0ca6366",id:"75d32a60-ac8b-4100-b8d8-d678c83dfbeb",type:"Input",opts:{},children:"MainWindow"})]})}function D(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(B,{...e})}):B(e)}},48775:(e,n,a)=>{"use strict";a.d(n,{A:()=>t});const t=a.p+"67dfa91b49508d82d7a3691f98d7cbdf.txt"},52621:(e,n,a)=>{"use strict";a.d(n,{aO:()=>g,oN:()=>h,k8:()=>u});var t,i=a(96540);a(83386),a(44586);function s(){return s=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var a=arguments[n];for(var t in a)({}).hasOwnProperty.call(a,t)&&(e[t]=a[t])}return e},s.apply(null,arguments)}const r=e=>{let{title:n,titleId:a,...r}=e;return i.createElement("svg",s({xmlns:"http://www.w3.org/2000/svg",fill:"none",className:"w-5 h-5 ml-auto",viewBox:"0 0 24 24","aria-labelledby":a},r),n?i.createElement("title",{id:a},n):null,t||(t=i.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",d:"M17 17h.01m.39-3h.6c.932 0 1.398 0 1.765.152a2 2 0 0 1 1.083 1.083C21 15.602 21 16.068 21 17s0 1.398-.152 1.765a2 2 0 0 1-1.083 1.083C19.398 20 18.932 20 18 20H6c-.932 0-1.398 0-1.765-.152a2 2 0 0 1-1.083-1.083C3 18.398 3 17.932 3 17s0-1.398.152-1.765a2 2 0 0 1 1.083-1.083C4.602 14 5.068 14 6 14h.6m5.4 1V4m0 11-3-3m3 3 3-3"})))};var o=a(95293),l=(a(38193),a(14195),a(92303),a(74848));function c(e){return e.reduce(((e,n)=>Array.isArray(n)?e.concat(c(n)):e.concat(n)),[])}function d(e,n){return n.reduce(((n,a)=>e[a.index]===a.value?n+1:n),0)}function B(e){return Array.isArray(e)}function D(e){return B(e)?e.map(D):0}function m(e,n){return B(e)?e.map(((e,a)=>m(e,n[a]))):e+n}function p(e,n){return B(e)?e.map((e=>p(e,n))):e*n}function C(e,n){const a=n.reduce(((e,n)=>e+n),0);let t=D(e[0]);for(let i=0;i<e.length;i++)t=m(t,p(e[i],n[i]));return p(t,1/a)}async function A(e,n,a){const{numerical:t,categorical:i}=e.reduce(((e,n,a)=>("string"==typeof n?e.categorical.push({index:a,value:n}):e.numerical.push({index:a,value:n}),e)),{numerical:[],categorical:[]});const s=t.map((e=>e.value)),r=t.map((e=>e.index)),o=function(e,n){const a=new Map;for(let t=0;t<e.length;t++){const i=d(e[t],n);a.has(i)||a.set(i,[]),a.get(i).push(t)}return Array.from(a.entries()).sort(((e,n)=>n[0]-e[0]))}(n,i);let l=null;for(const[d,C]of o)if(C.length>=2){l=C;break}if(!l)throw new Error("No matching basis found.");const c=l.map((e=>function(e,n){return n.map((n=>e[n]))}(n[e],r))),B=await Promise.all(l.map((e=>a(e)))),D=s.length;let m=Math.pow(2,D);m=Math.min(m,l.length);const p=c.map(((e,n)=>{return{index:n,dist:(a=s,t=e,Math.sqrt(a.reduce(((e,n,a)=>e+(n-t[a])**2),0)))};var a,t}));p.sort(((e,n)=>e.dist-n.dist));const A=p.slice(0,m),u=A.map((e=>{let{dist:n}=e;return 0===n?1e6:1/n})),h=A.map((e=>{let{index:n}=e;return B[n]})),g=h[0];if("string"==typeof(f=g)||f instanceof String){const e=h.map((e=>function(e){const n=e.match(/(\d*\.?\d+|\D+)/g),a=[],t=[];for(const i of n)/^\d*\.?\d+$/.test(i)?(t.push(parseFloat(i)),a.push(null)):a.push(i);return{template:a,numbers:t}}(e))),n=JSON.stringify(e[0].template),a=e.every((e=>JSON.stringify(e.template)===n));if(!a)return console.error("Output string differs. Cannot interpolate!"),h[0];const t=e.map((e=>e.numbers)),i=C(t,u).map((e=>Number(e.toFixed(2))));return function(e,n){let a=0;return e.map((e=>null===e?n[a++]:e)).join("")}(e[0].template,i)}return Array.isArray(g),C(h,u);var f}function u(e){let{json:n,notebook:a,kernel:t}=e;const{colorMode:s,setColorMode:d}=(0,o.G)();return(0,i.useEffect)((()=>{console.warn("Create store"),console.warn(n);const e={},a={};let i=[];const s=new Deferred;window.server={kernel:{io:{fire(e,n,a){void 0===a&&(a="Default"),i.push(["fire",e,n,a])},poke(e){i.push(["poke",e])}}}},window.server.kernel.emitt=()=>{console.warn("Emitt is not supported anymore")};let r=async()=>{r=async()=>{},fetch(n).then((n=>{console.warn("Store loaded!"),n.json().then((n=>{interpretate(n.objects,{hold:!0}).then((n=>{console.warn("Objects loaded!"),Object.keys(n).forEach((e=>{const a=new ObjectStorage(e);a.cache=n[e],a.cached=!0})),Object.keys(e).forEach((a=>{Array.isArray(e[a])?e[a].forEach((e=>e.resolve(n[a]))):e[a].resolve(n[a])}))})),interpretate(n.symbols,{hold:!0}).then((e=>{console.warn("Symbols loaded!"),Object.keys(e).forEach((n=>{core[n]=async(e,a)=>await interpretate(core[n].data,a),core[n].data=e[n],core[n]=async(e,a)=>{console.log("IE: calling our symbol...");const t=await interpretate(core[n].data,a);return a.root&&!a.novirtual&&(core[n].instances[a.root.uid]=a.root),t},core[n].update=async(e,a)=>{if(a.useCache)return core[n].cached&&core[n].currentData==core[n].data||(core[n].cached=await interpretate(core[n].data,a),core[n].currentData=core[n].data),core[n].cached;return await interpretate(core[n].data,a)},core[n].destroy=async(e,a)=>{delete core[n].instances[a.root.uid],console.warn(a.root.uid+" was destroyed"),console.warn("external symbol was destoryed")},core[n].data=structuredClone(e[n]),core[n].virtual=!0,core[n].instances={}})),Object.keys(a).forEach((n=>{console.warn(n),a[n].resolve(e[n])})),s.resolve()}))}))}))};core.Offload=(e,n)=>{if(e.length>1)if("'Static'"===e[1][1]){if(e[1][2])return interpretate(e[0],{...n,static:!0})}else if(e.length>2&&"'Static'"===e[2][1]&&e[2][2])return interpretate(e[0],{...n,static:!0});return interpretate(e[0],n)},core.Medium=()=>.7,core.Offload.update=(e,n)=>{if(e.length>1)if("'Volatile'"===e[1][1]){if(!e[1][2])return void console.log("Update was rejected (Nonvolatile)")}else if(e.length>2&&"'Volatile'"===e[2][1]&&!e[2][2])return void console.log("Update was rejected (Nonvolatile)");return interpretate(e[0],n)},window.server.ask=n=>{const a=new Deferred;if(n.length<42)return console.error("Unknown command"),console.error(n),!1;return Array.isArray(e[n.slice(60,-2)])?e[n.slice(60,-2)].push(a):e[n.slice(60,-2)]=[a],r(),a.promise},window.server.getSymbol=e=>{const n=new Deferred;return console.warn("Asking for symbol"+e),a[e]=n,n.promise},interpretate.anonymous=async(e,n)=>{let t,i;if(console.log("Anonimous symbol: "+JSON.stringify(e)),e instanceof Array)throw console.error(e),"unknown WL expression. Error at "+e[0];t=e;const s=new Deferred;return console.warn("Asking for symbol"+t),a[t]=s,i=await s.promise,core[t]=async(e,n)=>{console.log("IE: calling our symbol...");const a=await interpretate(core[t].data,n);return n.root&&!n.novirtual&&(core[t].instances[n.root.uid]=n.root),a},core[t].update=async(e,n)=>{if(n.useCache)return core[t].cached&&core[t].currentData==core[t].data||(core[t].cached=await interpretate(core[t].data,n),core[t].currentData=core[t].data),core[t].cached;return await interpretate(core[t].data,n)},core[t].destroy=async(e,n)=>{delete core[t].instances[n.root.uid],console.warn(n.root.uid+" was destroyed"),console.warn("external symbol was destoryed")},core[t].data=i,core[t].virtual=!0,core[t].instances={},interpretate(e,n)},(async()=>{console.warn("Kernel"),t&&(console.warn("KERNEL"),fetch(t).then((e=>{console.log(e),e.json().then((async e=>{const n={},a=async e=>{const n=(new TextEncoder).encode(e),a=await window.crypto.subtle.digest("SHA-1",n);return Array.from(new Uint8Array(a)).map((e=>e.toString(16).padStart(2,"0"))).join("")};n.StateMachine=class{constructor(){this.map=new Map,this.state=[],this.symbol=null,this.eventsMap=new Map}async init(e){const n=await interpretate.unzlib64String(e.CompressedMap),a=JSON.parse(n);this.map=new Map(a),this.symbol=e.Symbol,e.Basis&&(this.basis=e.Basis,this.flattenbasis=e.Basis.map((e=>c(e)))),this.state=[...e.InitialValues],this.eventsMap=new Map;const t=this;return e.Events.forEach(((e,n)=>{t.eventsMap.set(e[0]+"::"+e[1],n)})),delete e.CompressedMap,this}async run(e,n,t){const i=e+"::"+t;if(!this.eventsMap.has(i))return;const s=this.eventsMap.get(i);this.state[s]=n;const r=await a(JSON.stringify(this.state)),o=core[this.symbol];this.map.has(r)?o.data=["JSObject",structuredClone(this.map.get(r))]:(console.log("Hash miss. Attempting to interpolate"),o.data=await this.interpolate());for(const a of Object.values(o.instances))a.dead||await a.update()}async interpolate(){if(!this.basis)throw"no basis";const e=this,n=c(this.state);console.log(n);return["JSObject",await A(n,this.flattenbasis,(async n=>{const t=await a(JSON.stringify(e.basis[n]));return structuredClone(e.map.get(t))}))]}},n.PavlovMachine=class{constructor(){this.map=new Map,this.eventsMap=new Map}async init(e){const n=await interpretate.unzlib64String(e.CompressedMap),a=JSON.parse(n);this.map=new Map(a),this.eventsMap=new Map;const t=this;return e.Events.forEach((e=>{t.eventsMap.set(e[0]+"::"+e[1])})),delete e.CompressedMap,this}async run(e,n,t){const i=e+"::"+t;if(!this.eventsMap.has(i))return;const s=await a(JSON.stringify([e,t,n]));if(!this.map.has(s))return;interpretate(JSON.parse(this.map.get(s)),{global:{},local:{}})}},n.AnimationMachine=class{constructor(){}async init(e){const n=await interpretate.unzlib64String(e.Compressed),a=JSON.parse(n);return this.values=a,this.count=0,this.parity=!0,this.symbol=e.Symbol,this.hash=e.HashState,this.eventId=e.Event[0],this}async run(e,n,a){if(this.eventId!=e)return;const t=core[this.symbol];t.data=["JSObject",structuredClone(this.values[this.count])];for(const i of Object.values(t.instances))i.dead||await i.update();this.parity||this.count++,this.parity=!this.parity,this.values.length==this.count&&(this.count=0)}};const t=await interpretate(e,{}),s=[];for(const i of t){const e=new n[i.Class];await e.init(i),s.push(e)}const r=s.length;window.server.kernel={io:{fire:function(e,n,a){void 0===a&&(a="Default");for(let t=0;t<r;++t)s[t].run(e,n,a)},poke:e=>{for(let n=0;n<r;++n)s[n].run(e,!0,"Default")}}},i.forEach((e=>{"fire"==e[0]?window.server.kernel.io.fire(e[1],e[2],e[3]):"poke"==e[0]&&window.server.kernel.io.poke(e[1])})),i=[]}))})))})()})),console.log("DONE loading mesh"),a?(0,l.jsx)(l.Fragment,{children:(0,l.jsxs)("a",{href:a,className:"dark"==s?"p-2 text-xs w-full flex ring-1 ring-inset shadow ring-gray-300 text-gray-300 my-2":"p-2 text-xs w-full flex ring-1 ring-inset text-gray-600 shadow ring-gray-300 bg-gray-300 my-2",children:["Download original notebook ",(0,l.jsx)(r,{})]})}):(0,l.jsx)(l.Fragment,{})}function h(e){let{children:n,data:a}=e;const t={__html:decodeURIComponent(n)};return(0,l.jsx)("div",{dangerouslySetInnerHTML:t})}function g(e){let{children:n,nid:a,id:t,type:s,display:r,opts:c}=e;const d=(0,i.useRef)(null),{colorMode:B,setColorMode:D}=(0,o.G)(),m=decodeURIComponent(n),[p,C]=(0,i.useState)(c.Fade),[A,u]=(0,i.useState)(!1);return(0,i.useEffect)((()=>{const e=d.current;let n;if(console.warn("Create Codemirror"),console.warn(r),console.log(m),u(!0),console.warn("Created: "+r),"print"!=r){if(window.SupportedCells[r])return window.SupportedCells[r].view&&(n=new window.SupportedCells[r].view({element:e},m)),n.editor&&c.Fade&&(d.current.addEventListener("focusin",(()=>{C(!1)})),d.current.addEventListener("focusout",(()=>{C(!0)}))),()=>{n&&n.dispose()};console.warn("Not found: "+r)}}),[]),(0,l.jsx)("div",{style:{filter:"dark"==B?"invert(1) contrast(0.8) hue-rotate(-185deg)":"none"},className:"language-mathematica codeBlockContainer_node_modules-@docusaurus-theme-classic-lib-theme-CodeBlock-Container-styles-module theme-code-block",children:(0,l.jsx)("div",{className:p?"h-fade-20 codeBlockContent_node_modules-@docusaurus-theme-classic-lib-theme-CodeBlock-Content-styles-module":"codeBlockContent_node_modules-@docusaurus-theme-classic-lib-theme-CodeBlock-Content-styles-module",children:(0,l.jsxs)("pre",{tabIndex:"0",className:"prism-code language-mathematica codeBlock_node_modules-@docusaurus-theme-classic-lib-theme-CodeBlock-Content-styles-module thin-scrollbar",style:{color:"rgb(57, 58, 52)",backgroundColor:"rgb(246, 248, 250)"},children:[!A&&(0,l.jsx)("code",{style:{whiteSpace:"pre-wrap"},className:"codeBlockLines_node_modules-@docusaurus-theme-classic-lib-theme-CodeBlock-Content-styles-module",children:m}),(0,l.jsx)("code",{ref:d,className:"codeBlockLines_node_modules-@docusaurus-theme-classic-lib-theme-CodeBlock-Content-styles-module"})]})})})}},55573:(e,n,a)=>{"use strict";a.d(n,{A:()=>t});const t=a.p+"44a2a3ba69b0daf7cac838c7d8b39c84.wln"},76274:()=>{}}]);