(self.webpackChunkwlx_docs=self.webpackChunkwlx_docs||[]).push([[94256],{77824:(e,B,A)=>{"use strict";A.r(B),A.d(B,{assets:()=>o,contentTitle:()=>t,default:()=>c,frontMatter:()=>r,metadata:()=>D,toc:()=>C});var i=A(17624),a=A(4552),n=A(46880);const s=A.p+"assets/medias/fluid_raster-e1fa9e5abb674313def47863e086ac1f.mov",r={authors:"jerryi",tags:["graphics","animation"],enableComments:!0},t="Real-time Fluid Simulation Part 3",D={permalink:"/wljs-docs/blog/2024/08/21/fluid-3",source:"@site/blog/2024-08-21-fluid-3/index.mdx",title:"Real-time Fluid Simulation Part 3",description:"Using Wolfram Language and WLJS",date:"2024-08-21T00:00:00.000Z",tags:[{label:"graphics",permalink:"/wljs-docs/blog/tags/graphics"},{label:"animation",permalink:"/wljs-docs/blog/tags/animation"}],readingTime:4.16,hasTruncateMarker:!0,authors:[{name:"Kirill Vasin",title:"Maintainer",url:"https://github.com/JerryI",imageURL:"https://avatars.githubusercontent.com/u/4111822?s=48&v=4",key:"jerryi"}],frontMatter:{authors:"jerryi",tags:["graphics","animation"],enableComments:!0},unlisted:!1,prevItem:{title:"Covariant Matrices and Ellipses",permalink:"/wljs-docs/blog/2024/08/22/ellipce"},nextItem:{title:"Real-time Fluid Simulation Part 2",permalink:"/wljs-docs/blog/2024/08/19/fluid-2"}},o={authorsImageUrls:[void 0]},C=[{value:"Measure and optimize \u23f1\ufe0f",id:"measure-and-optimize-\ufe0f",level:2},{value:"Compile",id:"compile",level:3},{value:"Immediate Graphics Mode",id:"immediate-graphics-mode",level:2},{value:"Dynamic image",id:"dynamic-image",level:3},{value:"Virtual Ink",id:"virtual-ink",level:2}];function l(e){const B={annotation:"annotation",blockquote:"blockquote",code:"code",del:"del",em:"em",h2:"h2",h3:"h3",hr:"hr",img:"img",math:"math",mfrac:"mfrac",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",msub:"msub",p:"p",semantics:"semantics",span:"span",strong:"strong",...(0,a.M)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(B.p,{children:(0,i.jsx)(B.em,{children:"Using Wolfram Language and WLJS"})}),"\n",(0,i.jsx)(B.p,{children:"In this notebook we will apply some optimizations to the code, expand the resolution and switch to immediate mode of graphics rendering."}),"\n","\n",(0,i.jsx)(n.Af,{json:A(81320).c,notebook:A(19744).c}),"\n",(0,i.jsx)(B.h2,{id:"measure-and-optimize-\ufe0f",children:"Measure and optimize \u23f1\ufe0f"}),"\n",(0,i.jsxs)(B.p,{children:["Let us try to estimate the time we need to do our normal calculations on ",(0,i.jsx)(B.em,{children:"divergence"}),", ",(0,i.jsx)(B.em,{children:"advection"})," and ",(0,i.jsx)(B.em,{children:"bilinear interpolation"})]}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"3778f713-f0ac-4279-af40-99061d14cf32",type:"Input",opts:{Fade:!0},children:"ClearAll%5Badvect%5D%3B%20ClearAll%5BremoveDivergence%5D%3B%20ClearAll%5BbilinearInterpolation%5D%3B%0A%0Aadvect%5Bv_%2C%20u_%2C%20%CE%B4t_%3A0.1%5D%20%3A%3D%20With%5B%7Bmax%20%3D%20Length%5Bv%5D%7D%2C%20With%5B%7B%0A%20%20take%20%3D%20Function%5B%7Barray%2C%20x%2Cy%7D%2C%20If%5Bx%20%3E%3D%201%20%26%26%20x%20%3C%3D%20max%20%26%26%20y%20%3E%3D%201%20%26%26%20y%20%3C%3D%20max%2C%20array%5B%5Bx%2Cy%5D%5D%2C%20array%5B%5B1%2C1%5D%5D%200.%5D%5D%0A%7D%2C%0A%20%20Table%5B%20%0A%20%20%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20v1%20%3D%20%20%28%2AFB%5B%2A%29%28%28take%5Bv%2C%20i-1%2C%20j%5D%20%2B%20take%5Bv%2C%20i%2C%20j%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B1%2C0%7D%2C%0A%20%20%20%20%20%20v2%20%3D%20%20%28%2AFB%5B%2A%29%28%28take%5Bv%2C%20i%2C%20j%2B1%5D%20%2B%20take%5Bv%2C%20i%2C%20j%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C-1%7D%2C%0A%20%20%20%20%20%20v3%20%3D%20%20%28%2AFB%5B%2A%29%28%28take%5Bv%2C%20i%2B1%2C%20j%5D%20%2B%20take%5Bv%2C%20i%2C%20j%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B-1%2C0%7D%2C%0A%20%20%20%20%20%20v4%20%3D%20%20%28%2AFB%5B%2A%29%28%28take%5Bv%2C%20i%2C%20j-1%5D%20%2B%20take%5Bv%2C%20i%2C%20j%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C1%7D%2C%0A%20%20%20%20%20%20org%20%3D%20u%5B%5Bi%2Cj%5D%5D%0A%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20org%20%2B%20%28%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20v1%20%28%2ATB%5B%2A%29Piecewise%5B%7B%7B%28%2A%7C%2A%29take%5Bu%2C%20i-1%2C%20j%5D%28%2A%7C%2A%29%2C%28%2A%7C%2A%29v1%20%3E%200%28%2A%7C%2A%29%7D%2C%7B%28%2A%7C%2A%29org%28%2A%7C%2A%29%2C%28%2A%7C%2A%29True%28%2A%7C%2A%29%7D%7D%5D%28%2A%7C%2A%29%28%2A1%3AeJxTTMoPSmNkYGAo5gESAZmpyanlmcWpTvkVmUxAAQBzVQdd%2A%29%28%2A%5DTB%2A%29%20%2B%20v3%20%28%2ATB%5B%2A%29Piecewise%5B%7B%7B%28%2A%7C%2A%29take%5Bu%2C%20i%2B1%2C%20j%5D%28%2A%7C%2A%29%2C%28%2A%7C%2A%29v3%20%3E%200%28%2A%7C%2A%29%7D%2C%7B%28%2A%7C%2A%29org%28%2A%7C%2A%29%2C%28%2A%7C%2A%29True%28%2A%7C%2A%29%7D%7D%5D%28%2A%7C%2A%29%28%2A1%3AeJxTTMoPSmNkYGAo5gESAZmpyanlmcWpTvkVmUxAAQBzVQdd%2A%29%28%2A%5DTB%2A%29%20%20%2B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20v4%20%28%2ATB%5B%2A%29Piecewise%5B%7B%7B%28%2A%7C%2A%29take%5Bu%2C%20i%2C%20j-1%5D%28%2A%7C%2A%29%2C%28%2A%7C%2A%29v4%20%3E%200%28%2A%7C%2A%29%7D%2C%7B%28%2A%7C%2A%29org%28%2A%7C%2A%29%2C%28%2A%7C%2A%29True%28%2A%7C%2A%29%7D%7D%5D%28%2A%7C%2A%29%28%2A1%3AeJxTTMoPSmNkYGAo5gESAZmpyanlmcWpTvkVmUxAAQBzVQdd%2A%29%28%2A%5DTB%2A%29%20%2B%20v2%20%28%2ATB%5B%2A%29Piecewise%5B%7B%7B%28%2A%7C%2A%29take%5Bu%2C%20i%2C%20j%2B1%5D%28%2A%7C%2A%29%2C%28%2A%7C%2A%29v2%20%3E%200%28%2A%7C%2A%29%7D%2C%7B%28%2A%7C%2A%29org%28%2A%7C%2A%29%2C%28%2A%7C%2A%29True%28%2A%7C%2A%29%7D%7D%5D%28%2A%7C%2A%29%28%2A1%3AeJxTTMoPSmNkYGAo5gESAZmpyanlmcWpTvkVmUxAAQBzVQdd%2A%29%28%2A%5DTB%2A%29%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%20%CE%B4t%0A%20%20%20%20%5D%0A%20%20%20%20%0A%20%20%2C%20%7Bi%2C%20max%7D%2C%20%7Bj%2C%20max%7D%5D%20%2F%2F%20Chop%0A%20%5D%5D%0A%0A%20removeDivergence%5Bgrid_%5D%20%3A%3D%20With%5B%7B%0A%20%20%28%2ABB%5B%2A%29%28%2Asafety%20checks%2C%20which%20enforce%20closed%20boundaries%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20take%20%3D%20Function%5B%7Barray%2C%20x%2Cy%7D%2C%20If%5Bx%20%3E%3D%201%20%26%26%20x%20%3C%3D%20Length%5Bgrid%5D%20%26%26%20y%20%3E%3D%201%20%26%26%20y%20%3C%3D%20Length%5Bgrid%5D%2C%20array%5B%5Bx%2Cy%5D%5D%2C%20%7B0%2C0%7D%5D%5D%0A%7D%2C%0A%20%20MapIndexed%5BFunction%5B%7Bval%2C%20i%7D%2C%20%0A%20%20%20%20val%20%2B%20%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%288.0%29%29%28%2A%5DFB%2A%29%20%28%0A%20%20%20%20%20%20%28%28take%5Bgrid%2C%20i%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%29.%7B1%2C1%7D%29%7B1%2C1%7D%20%2B%0A%0A%20%20%20%20%20%20%28%28take%5Bgrid%2C%20i%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%29.%7B1%2C-1%7D%29%7B1%2C-1%7D%20%2B%0A%0A%20%20%20%20%20%20%28take%5Bgrid%2C%20i%5B%5B1%5D%5D-1%2C%20i%5B%5B2%5D%5D%5D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2B1%2C%20i%5B%5B2%5D%5D%5D%20-%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D-1%5D%20-%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%2B1%5D%29%7B2%2C-2%7D%20%2B%20take%5Bgrid%2C%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%5D%20%28-4%29%0A%0A%20%20%20%20%29%0A%20%20%5D%2C%20grid%2C%20%7B2%7D%5D%0A%5D%0A%0AbilinearInterpolation%5Barray_%2C%20%7Bx0_%2C%20y0_%7D%5D%20%3A%3D%20Module%5B%0A%20%20%7Brows%2C%20cols%2C%20x%20%3D%20y0%2C%20y%20%3D%20x0%2C%20x1%2C%20x2%2C%20y1%2C%20y2%2C%20fQ11%2C%20fQ12%2C%20fQ21%2C%20fQ22%7D%2C%0A%20%20%0A%20%20%28%2A%20Get%20the%20dimensions%20of%20the%20array%20%2A%29%0A%20%20%7Brows%2C%20cols%7D%20%3D%20Take%5BDimensions%5Barray%5D%2C%202%5D%3B%0A%20%20%0A%20%20%28%2A%20Clip%20points%20to%20the%20boundaries%20%2A%29%0A%20%20x%20%3D%20Clip%5Bx%2C%20%7B1%2C%20cols%7D%5D%3B%0A%20%20y%20%3D%20Clip%5By%2C%20%7B1%2C%20rows%7D%5D%3B%0A%20%20%0A%20%20%28%2A%20Find%20the%20bounding%20indices%20%2A%29%0A%20%20x1%20%3D%20Floor%5Bx%5D%3B%20%0A%20%20x2%20%3D%20Ceiling%5Bx%5D%3B%0A%20%20y1%20%3D%20Floor%5By%5D%3B%20%0A%20%20y2%20%3D%20Ceiling%5By%5D%3B%0A%20%20%0A%20%20%28%2A%20Get%20the%20values%20at%20the%20four%20corners%20%2A%29%0A%20%20fQ11%20%3D%20array%5B%5By1%2C%20x1%5D%5D%3B%0A%20%20fQ12%20%3D%20array%5B%5By2%2C%20x1%5D%5D%3B%0A%20%20fQ21%20%3D%20array%5B%5By1%2C%20x2%5D%5D%3B%0A%20%20fQ22%20%3D%20array%5B%5By2%2C%20x2%5D%5D%3B%0A%20%20%0A%20%20%28%2A%20Perform%20bilinear%20interpolation%20%2A%29%0A%20%20If%5Bx2%20%3D%3D%20x1%2C%0A%20%20%20%20If%5By2%20%3D%3D%20y1%2C%0A%20%20%20%20%20%20fQ11%2C%0A%20%20%20%20%20%201%2F%282%20%28y2%20-%20y1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28y%20-%20y1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28y%20-%20y1%29%0A%20%20%20%20%20%20%29%0A%20%20%20%20%5D%2C%0A%20%20%20%20If%5By2%20%3D%3D%20y1%2C%0A%20%20%20%20%20%201%2F%282%20%28x2%20-%20x1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28x2%20-%20x%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28x%20-%20x1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28x2%20-%20x%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28x%20-%20x1%29%0A%20%20%20%20%20%20%29%2C%0A%20%20%20%20%20%201%2F%28%28x2%20-%20x1%29%20%28y2%20-%20y1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28x2%20-%20x%29%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28x%20-%20x1%29%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28x2%20-%20x%29%20%28y%20-%20y1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28x%20-%20x1%29%20%28y%20-%20y1%29%0A%20%20%20%20%20%20%29%0A%20%20%20%20%5D%0A%20%20%5D%0A%5D%0A%0AadvectParticles%5Bv_%2C%20pts_%2C%20%CE%B4t_%3A0.02%5D%20%3A%3D%20Map%5BFunction%5Bp%2C%20p%20%2B%20%CE%B4t%20%28bilinearInterpolation%5Bv%2C%20p%5D%29%5D%2C%20pts%5D"}),"\n",(0,i.jsx)(B.p,{children:"For a single run we have"}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"4aac5186-935d-4ad1-a8f6-18284ad46ac1",type:"Input",opts:{Fade:!0},children:"runTest%5Btitle_%5D%20%3A%3D%20With%5B%7B%7D%2C%0A%20%20testGrid%20%3D%20Table%5B%7B0.%2C0.%7D%2C%20%7Bi%2C15%7D%2C%20%7Bj%2C15%7D%5D%3B%0A%20%20testParticles%20%3D%20Table%5BRandomReal%5B%7B1%2C15%7D%2C%202%5D%2C%20%7Bi%2C1000%7D%5D%3B%0A%0A%20%20timing%20%3D%20%7B0.%2C%200.%2C%200.%7D%3B%0A%0A%20%20timing%5B%5B1%5D%5D%20%3D%20-AbsoluteTime%5B%5D%3B%0A%20%20testGrid%20%3D%20advect%5BtestGrid%2C%20testGrid%2C%200.2%5D%3B%0A%20%20timing%5B%5B1%5D%5D%20%2B%3D%20AbsoluteTime%5B%5D%3B%0A%0A%20%20timing%5B%5B2%5D%5D%20%3D%20-AbsoluteTime%5B%5D%3B%0A%20%20testGrid%20%3D%20removeDivergence%5BtestGrid%5D%3B%0A%20%20timing%5B%5B2%5D%5D%20%2B%3D%20AbsoluteTime%5B%5D%3B%0A%0A%20%20timing%5B%5B3%5D%5D%20%3D%20-AbsoluteTime%5B%5D%3B%0A%20%20testParticles%20%3D%20advectParticles%5BtestGrid%2C%20testParticles%2C%200.2%5D%3B%0A%20%20timing%5B%5B3%5D%5D%20%2B%3D%20AbsoluteTime%5B%5D%3B%0A%0A%20%20%7B%0A%20%20%20%20Style%5Btitle%2C%20Italic%2C%2012%5D%2C%0A%0A%20%20%20%20Flatten%20%2F%40%20%7B%0A%20%20%20%20%20%20%7BStyle%5B%22time%2C%20s%22%2C%20Italic%5D%2C%20Round%5Btiming%2C%200.001%5D%7D%2C%0A%20%20%20%20%20%20%7BStyle%5B%22Max%20FPS%22%2C%20Italic%5D%2C%20Round%5B1%20%2F%20%28timing%20%2F%2F%20Total%29%2C%201%5D%7D%0A%20%20%20%20%7D%20%2F%2F%20TableView%20%0A%20%20%7D%20%2F%2F%20Column%0A%5D%3B%0A%0ArunTest%5B%22Uncompiled%22%5D"}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"fb3892d8-c313-401d-88d4-9156b13de3bf",type:"Output",opts:{},children:"%28%2AGB%5B%2A%29%7B%7B%28%2ABB%5B%2A%29%28%22Uncompiled%22%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCRYg4ZGfkwJRxgkkgkuKMvPSnfIritmAPM%2BSxJzM5EweIBOiBKQhqDQnNZgNrhYsFlJUmgoAykcZ4w%3D%3D%22%2A%29%28%2A%5DBB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28FrontEndRef%5B%22bc61c228-82bc-43b5-a78b-b2829082984b%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKJyWbGSYbGVnoWhglJeuaGCeZ6iaaWyTpJhlZGFkaALGFSRIAgx0VRQ%3D%3D%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29"}),"\n",(0,i.jsx)(B.h3,{id:"compile",children:"Compile"}),"\n",(0,i.jsxs)(B.p,{children:["Most probably for pure function JIT compiler should kick in, however, not all expressions are compilable in our case. We can make them by removing function declaration within the ",(0,i.jsx)(B.code,{children:"Module"})," and replacing ",(0,i.jsx)(B.code,{children:"Piecewise"})," with just a normal ",(0,i.jsx)(B.code,{children:"If"})," statement."]}),"\n",(0,i.jsxs)(B.p,{children:["It makes our code looks less readable ",(0,i.jsx)(B.del,{children:"and removes all magic of WL"}),", but the result worth it"]}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"5d76df8d-c1e8-4454-86a2-a735271062f8",type:"Input",opts:{Fade:!0},children:"advect%20%3D%20Compile%5B%7B%7Bv%2C%20_Real%2C%203%7D%2C%20%7Bu%2C%20_Real%2C%203%7D%2C%20%7B%CE%B4t%2C%20_Real%2C%200%7D%7D%20%2C%20With%5B%7Bmax%20%3D%20Length%5Bv%5D%7D%2C%20With%5B%7B%0A%20%0A%7D%2C%0A%20%20Table%5B%20%0A%20%20%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20here%20we%20add%20a%20lot%20of%20manual%20check%20for%20boundary%20condition%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20v1%20%3D%20%28%2ABB%5B%2A%29%28%20%28%2AFB%5B%2A%29%28%28If%5Bi-1%20%3E%3D%201%2C%20v%5B%5Bi-1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeB5AILqnMSXXKr0hjgskHleakFnMBGU6JydnpRfmleSlpzDDlQe5Ozvk5%2BUVFDGDwwR6dwcAAAAHdFiw%3D%22%2A%29%28%2A%5DBB%2A%29.%7B1%2C0%7D%2C%0A%20%20%20%20%20%20v2%20%3D%20%20%28%2AFB%5B%2A%29%28%28If%5Bj%2B1%20%3C%3D%20max%2C%20v%5B%5Bi%2C%20j%2B1%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C-1%7D%2C%0A%20%20%20%20%20%20v3%20%3D%20%20%28%2AFB%5B%2A%29%28%28If%5Bi%2B1%20%3C%3D%20max%2C%20v%5B%5Bi%2B1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B-1%2C0%7D%2C%0A%20%20%20%20%20%20v4%20%3D%20%20%28%2AFB%5B%2A%29%28%28If%5Bj-1%20%3E%3D%201%2C%20v%5B%5Bi%2C%20j-1%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C1%7D%2C%0A%20%20%20%20%20%20org%20%3D%20u%5B%5Bi%2Cj%5D%5D%0A%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20org%20%2B%20%20%28%0A%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20here%20we%20add%20a%20lot%20of%20manual%20check%20for%20boundary%20condition%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20v1%20%28%2ABB%5B%2A%29%28If%5Bv1%20%3E0%2C%20If%5Bi-1%20%3E%3D%201%2C%20u%5B%5Bi-1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeB5AILqnMSXXKr0hjgskHleakFnMBGU6JydnpRfmleSlpzDDlQe5Ozvk5%2BUVFDGDwwR6dwcAAAAHdFiw%3D%22%2A%29%28%2A%5DBB%2A%29%20%20%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2B%20v3%20%28%2ABB%5B%2A%29%28If%5Bv3%3E0%2CIf%5Bi%2B1%20%3C%3D%20max%2C%20u%5B%5Bi%2B1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeB5AILqnMSXXKr0hjgskHleakFnMBGU6JydnpRfmleSlpzDDlQe5Ozvk5%2BUVFDGDwwR6dwcAAAAHdFiw%3D%22%2A%29%28%2A%5DBB%2A%29%2B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20v4%20If%5Bv4%20%3E0%2C%20If%5Bj-1%20%3E%3D%201%2C%20u%5B%5Bi%2C%20j-1%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%20%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2B%20v2%20If%5Bv2%3E0%2C%20If%5Bj%2B1%20%3C%3D%20max%2C%20u%5B%5Bi%2C%20j%2B1%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%20%CE%B4t%20%0A%20%20%20%20%5D%0A%20%20%20%20%0A%20%20%2C%20%7Bi%2C%20max%7D%2C%20%7Bj%2C%20max%7D%5D%20%2F%2F%20Chop%0A%20%5D%5D%5D%3B%0A%0AremoveDivergence%20%3D%20Compile%5B%7B%7Bgrid%2C%20_Real%2C%203%7D%7D%2C%20With%5B%7B%0A%20%20max%20%3D%20grid%20%2F%2F%20Length%0A%7D%2C%0A%20%20MapIndexed%5BFunction%5B%7Bval%2C%20i%7D%2C%20%0A%20%20%20%20val%20%2B%20%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%288.0%29%29%28%2A%5DFB%2A%29%20%28%0A%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20here%20we%20add%20a%20lot%20of%20manual%20check%20for%20boundary%20condition%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%20%20%20%20If%5Bi%5B%5B1%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%20-%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%2B%20If%5Bi%5B%5B1%5D%5D%20%2B%201%20%3E%3D1%20%26%26%20i%5B%5B1%5D%5D%20%2B%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%29.%7B1%2C1%7D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%7B1%2C1%7D%20%2B%0A%0A%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20here%20we%20add%20a%20lot%20of%20manual%20check%20for%20boundary%20condition%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%20%20%20%20If%5Bi%5B%5B1%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%20-%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%2B%20If%5Bi%5B%5B1%5D%5D%20%2B%201%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%20%2B%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%29.%7B1%2C-1%7D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%7B1%2C-1%7D%20%2B%0A%0A%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28If%5Bi%5B%5B1%5D%5D-1%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D-1%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D-1%2C%20i%5B%5B2%5D%5D%20%5D%5D%2C%20%7B0.%2C0.%7D%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRAeB5AILqnMSXXKr0hjgskHleakFnMBGU6JydnpRfmleSlpzDDlQe5Ozvk5%2BUVFDGDwwR6dwcAAAAHdFiw%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2B%20If%5Bi%5B%5B1%5D%5D%2B1%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%2B1%20%3C%3D%20max%2C%20grid%5B%5B%20i%5B%5B1%5D%5D%2B1%2C%20i%5B%5B2%5D%5D%20%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20-%20If%5Bi%5B%5B2%5D%5D-1%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D-1%20%3C%3D%20max%2C%20grid%5B%5B%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D-1%20%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20-%20If%5Bi%5B%5B2%5D%5D%2B1%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%2B1%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%2B1%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%7B2%2C-2%7D%20%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2B%20grid%5B%5B%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%20%5D%5D%20%28-4%29%0A%0A%20%20%20%20%29%0A%20%20%5D%2C%20grid%2C%20%7B2%7D%5D%0A%5D%5D%3B%0A%0AbilinearInterpolation%20%3D%20Compile%5B%7B%7Barray%2C%20_Real%2C%203%7D%2C%20%7Bv%2C%20_Real%2C%201%7D%7D%2C%20%0A%28%2ABB%5B%2A%29%28%2A%20no%20big%20changes%20here%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0AModule%5B%0A%20%20%7Brows%2C%20cols%2C%20x%20%3D%20v%5B%5B2%5D%5D%2C%20y%20%3D%20v%5B%5B1%5D%5D%2C%20x1%2C%20x2%2C%20y1%2C%20y2%2C%20fQ11%2C%20fQ12%2C%20fQ21%2C%20fQ22%7D%2C%0A%20%20%0A%20%20%28%2A%20Get%20the%20dimensions%20of%20the%20array%20%2A%29%0A%20%20%7Brows%2C%20cols%7D%20%3D%20%7BLength%5Barray%5D%2C%20Length%5Barray%5D%7D%3B%0A%20%20%0A%20%20%28%2A%20Clip%20points%20to%20the%20boundaries%20%2A%29%0A%20%20x%20%3D%20Clip%5Bx%2C%20%7B1%2C%20cols%7D%5D%3B%0A%20%20y%20%3D%20Clip%5By%2C%20%7B1%2C%20rows%7D%5D%3B%0A%20%20%0A%20%20%28%2A%20Find%20the%20bounding%20indices%20%2A%29%0A%20%20x1%20%3D%20Floor%5Bx%5D%3B%20%0A%20%20x2%20%3D%20Ceiling%5Bx%5D%3B%0A%20%20y1%20%3D%20Floor%5By%5D%3B%20%0A%20%20y2%20%3D%20Ceiling%5By%5D%3B%0A%20%20%0A%20%20%28%2A%20Get%20the%20values%20at%20the%20four%20corners%20%2A%29%0A%20%20fQ11%20%3D%20array%5B%5By1%2C%20x1%5D%5D%3B%0A%20%20fQ12%20%3D%20array%5B%5By2%2C%20x1%5D%5D%3B%0A%20%20fQ21%20%3D%20array%5B%5By1%2C%20x2%5D%5D%3B%0A%20%20fQ22%20%3D%20array%5B%5By2%2C%20x2%5D%5D%3B%0A%20%20%0A%20%20%28%2A%20Perform%20bilinear%20interpolation%20%2A%29%0A%20%20If%5Bx2%20%3D%3D%20x1%2C%0A%20%20%20%20If%5By2%20%3D%3D%20y1%2C%0A%20%20%20%20%20%20fQ11%2C%0A%20%20%20%20%20%201%2F%282%20%28y2%20-%20y1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28y%20-%20y1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28y%20-%20y1%29%0A%20%20%20%20%20%20%29%0A%20%20%20%20%5D%2C%0A%20%20%20%20If%5By2%20%3D%3D%20y1%2C%0A%20%20%20%20%20%201%2F%282%20%28x2%20-%20x1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28x2%20-%20x%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28x%20-%20x1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28x2%20-%20x%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28x%20-%20x1%29%0A%20%20%20%20%20%20%29%2C%0A%20%20%20%20%20%201%2F%28%28x2%20-%20x1%29%20%28y2%20-%20y1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28x2%20-%20x%29%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28x%20-%20x1%29%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28x2%20-%20x%29%20%28y%20-%20y1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28x%20-%20x1%29%20%28y%20-%20y1%29%0A%20%20%20%20%20%20%29%0A%20%20%20%20%5D%0A%20%20%5D%0A%5D%5D%3B%20%20%20%20"}),"\n",(0,i.jsx)(B.p,{children:"Let us test it again!"}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"16b21fa2-abb0-4b08-915e-d00f25347ec6",type:"Input",opts:{},children:"runTest%5B%22Compiled%22%5D"}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"ecbfb280-ec3c-4653-8c47-9f1b4fb63496",type:"Output",opts:{},children:"%28%2AGB%5B%2A%29%7B%7B%28%2ABB%5B%2A%29%28%22Compiled%22%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCRYg4ZGfkwJRxgkkgkuKMvPSnfIritmAPM%2BSxJzM5EweIBOiBKQhqDQnNZgNrhYsFlJUmgoAykcZ4w%3D%3D%22%2A%29%28%2A%5DBB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28FrontEndRef%5B%22695430be-0583-497f-8116-2c88bdb6b06d%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKm1mamhgbJKXqGphaGOuaWJqn6VoYGprpGiVbWCSlJJklGZilAAByCRUe%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29"}),"\n",(0,i.jsx)(n.gL,{children:"%3Cspan%20style%3D%22color%3Ared%22%3E%3Cb%20%3Ex5%3C%2Fb%3E%20time%20faster%3C%2Fspan%3E"}),"\n",(0,i.jsx)(B.p,{children:"However, one should note, that this is still not a machine code, but rather byte-code of Wolfram Kernel internal command representation or something similar to that."}),"\n",(0,i.jsxs)(B.p,{children:["One can go futher and force WL to compile it to C and then link automatically. ",(0,i.jsxs)(B.strong,{children:["This will probably require to have ",(0,i.jsx)(B.code,{children:"gcc"})," or ",(0,i.jsx)(B.code,{children:"clang"})," installed on your system"]})]}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"9da84e82-862e-4190-9ad7-6d18bf5fc82b",type:"Input",opts:{InitGroup:!0,Fade:!0},children:"advect%20%3D%20Compile%5B%7B%7Bv%2C%20_Real%2C%203%7D%2C%20%7Bu%2C%20_Real%2C%203%7D%2C%20%7B%CE%B4t%2C%20_Real%2C%200%7D%7D%20%2C%20With%5B%7Bmax%20%3D%20Length%5Bv%5D%7D%2C%20With%5B%7B%0A%20%0A%7D%2C%0A%20%20Table%5B%20%0A%20%20%0A%20%20%20%20With%5B%7B%0A%20%20%20%20%20%20v1%20%3D%20%20%28%2AFB%5B%2A%29%28%28If%5Bi-1%20%3E%3D%201%2C%20v%5B%5Bi-1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B1%2C0%7D%2C%0A%20%20%20%20%20%20v2%20%3D%20%20%28%2AFB%5B%2A%29%28%28If%5Bj%2B1%20%3C%3D%20max%2C%20v%5B%5Bi%2C%20j%2B1%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C-1%7D%2C%0A%20%20%20%20%20%20v3%20%3D%20%20%28%2AFB%5B%2A%29%28%28If%5Bi%2B1%20%3C%3D%20max%2C%20v%5B%5Bi%2B1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B-1%2C0%7D%2C%0A%20%20%20%20%20%20v4%20%3D%20%20%28%2AFB%5B%2A%29%28%28If%5Bj-1%20%3E%3D%201%2C%20v%5B%5Bi%2C%20j-1%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%2B%20v%5B%5Bi%2C%20j%5D%5D%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29.%7B0%2C1%7D%2C%0A%20%20%20%20%20%20org%20%3D%20u%5B%5Bi%2Cj%5D%5D%0A%20%20%20%20%7D%2C%0A%0A%20%20%20%20%20%20org%20%2B%20%20%28%0A%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20v1%20If%5Bv1%20%3E0%2C%20If%5Bi-1%20%3E%3D%201%2C%20u%5B%5Bi-1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%20%20%2B%20v3%20If%5Bv3%3E0%2CIf%5Bi%2B1%20%3C%3D%20max%2C%20u%5B%5Bi%2B1%2C%20j%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%2B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20v4%20If%5Bv4%20%3E0%2C%20If%5Bj-1%20%3E%3D%201%2C%20u%5B%5Bi%2C%20j-1%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%20%2B%20v2%20If%5Bv2%3E0%2C%20If%5Bj%2B1%20%3C%3D%20max%2C%20u%5B%5Bi%2C%20j%2B1%5D%5D%2C%20%7B0.%2C0.%7D%20%5D%2C%20org%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%20%CE%B4t%20%0A%20%20%20%20%5D%0A%20%20%20%20%0A%20%20%2C%20%7Bi%2C%20max%7D%2C%20%7Bj%2C%20max%7D%5D%20%2F%2F%20Chop%0A%20%5D%5D%20%2C%20CompilationOptions%20-%3E%20%7B%22InlineExternalDefinitions%22%20-%3E%20True%7D%2C%20%0A%20%20%20%20%22CompilationTarget%22%20-%3E%20%22C%22%2C%20%22RuntimeOptions%22%20-%3E%20%22Speed%22%5D%3B%0A%0AremoveDivergence%20%3D%20Compile%5B%7B%7Bgrid%2C%20_Real%2C%203%7D%7D%2C%20With%5B%7B%0A%20%20max%20%3D%20grid%20%2F%2F%20Length%0A%7D%2C%0A%20%20MapIndexed%5BFunction%5B%7Bval%2C%20i%7D%2C%20%0A%20%20%20%20val%20%2B%20%28%2AFB%5B%2A%29%28%281%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%288.0%29%29%28%2A%5DFB%2A%29%20%28%0A%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%20%20If%5Bi%5B%5B1%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%20-%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%20%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%2B%20If%5Bi%5B%5B1%5D%5D%20%2B%201%20%3E%3D1%20%26%26%20i%5B%5B1%5D%5D%20%2B%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%29.%7B1%2C1%7D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%7B1%2C1%7D%20%2B%0A%0A%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20%20%20If%5Bi%5B%5B1%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%20-%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20%2B%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20-%201%2C%20i%5B%5B2%5D%5D%20%2B%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20%2B%20If%5Bi%5B%5B1%5D%5D%20%2B%201%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%20%2B%201%20%3C%3D%20max%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%20-%201%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%20%2B%201%2C%20i%5B%5B2%5D%5D%20-%201%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%29.%7B1%2C-1%7D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%7B1%2C-1%7D%20%2B%0A%0A%20%20%20%20%20%20%28%0A%20%20%20%20%20%20%20%20If%5Bi%5B%5B1%5D%5D-1%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D-1%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D-1%2C%20i%5B%5B2%5D%5D%20%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2B%20If%5Bi%5B%5B1%5D%5D%2B1%20%3E%3D%201%20%26%26%20i%5B%5B1%5D%5D%2B1%20%3C%3D%20max%2C%20grid%5B%5B%20i%5B%5B1%5D%5D%2B1%2C%20i%5B%5B2%5D%5D%20%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20-%20If%5Bi%5B%5B2%5D%5D-1%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D-1%20%3C%3D%20max%2C%20grid%5B%5B%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D-1%20%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20-%20If%5Bi%5B%5B2%5D%5D%2B1%20%3E%3D%201%20%26%26%20i%5B%5B2%5D%5D%2B1%20%3C%3D%20max%2C%20grid%5B%5Bi%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%2B1%5D%5D%2C%20%7B0.%2C0.%7D%5D%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%29%7B2%2C-2%7D%20%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%2B%20grid%5B%5B%20i%5B%5B1%5D%5D%2C%20i%5B%5B2%5D%5D%20%5D%5D%20%28-4%29%0A%0A%20%20%20%20%29%0A%20%20%5D%2C%20grid%2C%20%7B2%7D%5D%0A%5D%2C%20CompilationOptions%20-%3E%20%7B%22InlineExternalDefinitions%22%20-%3E%20True%7D%2C%20%0A%20%20%20%20%22CompilationTarget%22%20-%3E%20%22C%22%2C%20%20%20%22RuntimeOptions%22%20-%3E%20%22Speed%22%5D%3B%0A%0A%0AbilinearInterpolation%20%3D%20Compile%5B%7B%7Barray%2C%20_Real%2C%203%7D%2C%20%7Bv%2C%20_Real%2C%201%7D%7D%2C%20Module%5B%0A%20%20%7Brows%2C%20cols%2C%20x%20%3D%20v%5B%5B2%5D%5D%2C%20y%20%3D%20v%5B%5B1%5D%5D%2C%20x1%2C%20x2%2C%20y1%2C%20y2%2C%20fQ11%2C%20fQ12%2C%20fQ21%2C%20fQ22%7D%2C%0A%20%20%0A%20%20%28%2A%20Get%20the%20dimensions%20of%20the%20array%20%2A%29%0A%20%20%7Brows%2C%20cols%7D%20%3D%20%7BLength%5Barray%5D%2C%20Length%5Barray%5D%7D%3B%0A%20%20%0A%20%20%28%2A%20Clip%20points%20to%20the%20boundaries%20%2A%29%0A%20%20x%20%3D%20Clip%5Bx%2C%20%7B1%2C%20cols%7D%5D%3B%0A%20%20y%20%3D%20Clip%5By%2C%20%7B1%2C%20rows%7D%5D%3B%0A%20%20%0A%20%20%28%2A%20Find%20the%20bounding%20indices%20%2A%29%0A%20%20x1%20%3D%20Floor%5Bx%5D%3B%20%0A%20%20x2%20%3D%20Ceiling%5Bx%5D%3B%0A%20%20y1%20%3D%20Floor%5By%5D%3B%20%0A%20%20y2%20%3D%20Ceiling%5By%5D%3B%0A%20%20%0A%20%20%28%2A%20Get%20the%20values%20at%20the%20four%20corners%20%2A%29%0A%20%20fQ11%20%3D%20array%5B%5By1%2C%20x1%5D%5D%3B%0A%20%20fQ12%20%3D%20array%5B%5By2%2C%20x1%5D%5D%3B%0A%20%20fQ21%20%3D%20array%5B%5By1%2C%20x2%5D%5D%3B%0A%20%20fQ22%20%3D%20array%5B%5By2%2C%20x2%5D%5D%3B%0A%20%20%0A%20%20%28%2A%20Perform%20bilinear%20interpolation%20%2A%29%0A%20%20If%5Bx2%20%3D%3D%20x1%2C%0A%20%20%20%20If%5By2%20%3D%3D%20y1%2C%0A%20%20%20%20%20%20fQ11%2C%0A%20%20%20%20%20%201%2F%282%20%28y2%20-%20y1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28y%20-%20y1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28y%20-%20y1%29%0A%20%20%20%20%20%20%29%0A%20%20%20%20%5D%2C%0A%20%20%20%20If%5By2%20%3D%3D%20y1%2C%0A%20%20%20%20%20%201%2F%282%20%28x2%20-%20x1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28x2%20-%20x%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28x%20-%20x1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28x2%20-%20x%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28x%20-%20x1%29%0A%20%20%20%20%20%20%29%2C%0A%20%20%20%20%20%201%2F%28%28x2%20-%20x1%29%20%28y2%20-%20y1%29%29%20%2A%20%28%0A%20%20%20%20%20%20%20%20fQ11%20%28x2%20-%20x%29%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ21%20%28x%20-%20x1%29%20%28y2%20-%20y%29%20%2B%0A%20%20%20%20%20%20%20%20fQ12%20%28x2%20-%20x%29%20%28y%20-%20y1%29%20%2B%0A%20%20%20%20%20%20%20%20fQ22%20%28x%20-%20x1%29%20%28y%20-%20y1%29%0A%20%20%20%20%20%20%29%0A%20%20%20%20%5D%0A%20%20%5D%0A%5D%20%2C%20CompilationOptions%20-%3E%20%7B%22InlineExternalDefinitions%22%20-%3E%20True%7D%2C%20%0A%20%20%20%20%22CompilationTarget%22%20-%3E%20%22C%22%2C%22RuntimeOptions%22%20-%3E%20%22Speed%22%5D%3B%20%20"}),"\n",(0,i.jsx)(B.p,{children:"Now we have new results"}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"4ae7a2ba-842d-4526-86a8-2961864ed5f1",type:"Input",opts:{},children:"runTest%5B%22Compiled%20%2B%20C%22%5D"}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"7a260453-994b-4ba2-a652-a0b41ff83253",type:"Output",opts:{},children:"%28%2AGB%5B%2A%29%7B%7B%28%2ABB%5B%2A%29%28%22Compiled%20%2B%20C%22%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNiYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCRYg4ZGfkwJRxgkkgkuKMvPSnfIritmAPM%2BSxJzM5EweIBOiBKQhqDQnNZgNrhYsFlJUmgoAykcZ4w%3D%3D%22%2A%29%28%2A%5DBB%2A%29%7D%28%2A%7C%7C%2A%29%2C%28%2A%7C%7C%2A%29%7B%28%2AVB%5B%2A%29%28FrontEndRef%5B%2209dd1aaf-1abc-48e4-8407-2d04783abf9c%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG1impBgmJqbpGiYmJeuaWKSa6FqYGJjrGqUYmJhbGCcmpVkmAwCN5RX9%22%2A%29%28%2A%5DVB%2A%29%7D%7D%28%2A%5DGB%2A%29"}),"\n",(0,i.jsx)(n.gL,{children:"%3Cspan%20style%3D%22color%3Ared%22%3E%3Cb%20%3Ex6%3C%2Fb%3E%20time%20faster%3C%2Fspan%3E"}),"\n",(0,i.jsx)(B.p,{children:"We gained a bit of speed; we will see more difference once the grid is expanded and more iterations are needed."}),"\n",(0,i.jsx)(B.h2,{id:"immediate-graphics-mode",children:"Immediate Graphics Mode"}),"\n",(0,i.jsx)(B.p,{children:"This only means, that we will do all rendering of our primitives by ourself. The graphics API will only display the rendered frame we crafted on Wolfram Kernel. The last also meant we migh have to transfer much more data over WebSockets to frontend."}),"\n",(0,i.jsx)(B.p,{children:"Let me show you a simple example"}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"6cf0317c-09c9-4e99-9515-ef4741b27d27",type:"Input",opts:{},children:"Table%5BClip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B10%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%20%7Bx%2C-10%2C10%2C%200.5%7D%2C%20%7By%2C-10%2C10%2C%200.5%7D%5D%3B%0AImage%5B%25%2C%20Magnification%20-%3E%205%2C%20Antialiasing-%3EFalse%5D"}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"9e248deb-85e1-4a1a-8d61-65efe29b1d70",type:"Output",opts:{},children:"%28%2AVB%5B%2A%29%28FrontEndRef%5B%22a38a8802-948f-46d8-9f9a-33a0bf6828dd%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKJxpbJFpYGBjpWppYpOmamKVY6FqmWSbqGhsnGiSlmVkYWaSkAAB9LBWL%22%2A%29%28%2A%5DVB%2A%29"}),"\n",(0,i.jsxs)(B.p,{children:["Here we used so-called SDF method for drawing graphics. We iterate over all posiitons of pixels in reactangle, produce brightness values and then send them to ",(0,i.jsx)(B.code,{children:"Image"}),", which copies them into a texture on GPU."]}),"\n",(0,i.jsx)(B.p,{children:"We can use all 4 (RGBA) color channels to draw our picture"}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"68edadf2-03e7-47c6-9ddb-fd75ee0ff1f7",type:"Input",opts:{},children:"Table%5B%7B%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B10%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B5%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B3%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B1%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%0A%7D%2C%20%7Bx%2C-10%2C10%2C%200.5%7D%2C%20%7By%2C-10%2C10%2C%200.5%7D%5D%3B%0AImage%5B%25%2C%20Magnification%20-%3E%205%2C%20Antialiasing-%3EFalse%5D"}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"2a261f4b-bff3-4147-8281-d86eb9067f03",type:"Input",opts:{},children:"%28%2AVB%5B%2A%29%28FrontEndRef%5B%2237dbfc31-9a78-43de-bb3d-a7828a5639f6%22%5D%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNkYGAoZgESHvk5KRCeEJBwK8rPK3HNS3GtSE0uLUlMykkNVgEKG5unJKUlGxvqWiaaW%2BiaGKek6iYlGafoAnlGFommZsaWaWYAjRsV4g%3D%3D%22%2A%29%28%2A%5DVB%2A%29"}),"\n",(0,i.jsxs)(B.p,{children:[(0,i.jsx)(B.strong,{children:"For the best performance"})," use ",(0,i.jsx)(B.code,{children:"NumericArray"}),", since it packs all numberic data to a more compact form"]}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"a6040353-179c-4fa6-aca7-9374b3a26514",type:"Input",opts:{},children:"Table%5B%7B%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B10%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B5%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B3%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B1%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%0A%7D%2C%20%7Bx%2C-10%2C10%2C%200.5%7D%2C%20%7By%2C-10%2C10%2C%200.5%7D%5D%3B%0AImage%5BNumericArray%5B%25%2C%20%22Real32%22%5D%2C%20Magnification%20-%3E%205%2C%20Antialiasing-%3EFalse%5D"}),"\n",(0,i.jsx)(B.hr,{}),"\n",(0,i.jsx)(B.h3,{id:"dynamic-image",children:"Dynamic image"}),"\n",(0,i.jsxs)(B.p,{children:["There is a usual way on how to update our ",(0,i.jsx)(B.code,{children:"Image"})," - using ",(0,i.jsx)(B.code,{children:"Offload"})," technique as we did before"]}),"\n",(0,i.jsxs)(B.blockquote,{children:["\n",(0,i.jsx)(n.gL,{children:"%3Cb%20%3ETIP%3C%2Fb%3E"}),"\n"]}),"\n",(0,i.jsxs)(B.p,{children:["Real values takes more time to deserialize on frontend, we will use ",(0,i.jsx)(B.code,{children:"UnsignedInteger8"})]}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"6f7e3a9c-fdea-4f80-b7af-9152dc302506",type:"Input",opts:{},children:"serialize%5Barr_List%5D%20%3A%3D%20NumericArray%5Barr%2C%20%22UnsignedInteger8%22%2C%20%22ClipAndRound%22%5D%3B%0A%0Abuffer%20%3D%20Table%5B255.0%20%7B%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B10%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B5%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B3%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5Bx%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5By%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B1%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%0A%7D%2C%20%7Bx%2C-10%2C10%2C%200.5%7D%2C%20%7By%2C-10%2C10%2C%200.5%7D%5D%20%2F%2F%20serialize%3B%0A%0AImage%5Bbuffer%20%2F%2F%20Offload%2C%20%22Byte%22%2C%20Magnification%20-%3E%205%2C%20Antialiasing-%3EFalse%5D"}),"\n",(0,i.jsx)(B.p,{children:(0,i.jsx)(B.img,{src:A(4556).c+"",width:"214",height:"218"})}),"\n",(0,i.jsxs)(B.p,{children:["Now we can easily update our image by setting new values to ",(0,i.jsx)(B.code,{children:"buffer"})]}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"f8c2fc4f-f0a6-43e5-a137-c474d6a6a98d",type:"Input",opts:{},children:"t%20%3A%3D%20AbsoluteTime%5B%5D%3B%0A%0Atask%20%3D%20SetInterval%5B%0A%20%20buffer%20%3D%20Table%5B255.0%20%7B%0A%20%20%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5B%28x%20%2B%20Cos%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5B%28y%20-%20Sin%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B3%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5B%28x%20-%20Cos%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5B%28y%20-%20Sin%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B5%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5B%28x%20%2B%20Cos%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5B%28y%20%2B%20Sin%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B10%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%2C%0A%20%20%20%20Clip%5B%28%28%2ASpB%5B%2A%29Power%5B%28x%20-%20Cos%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%20%2B%20%28%2ASpB%5B%2A%29Power%5B%28y%20%2B%20Sin%5Bt%5D%29%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%29%20-%20%28%2ASpB%5B%2A%29Power%5B1%28%2A%7C%2A%29%2C%28%2A%7C%2A%292%5D%28%2A%5DSpB%2A%29%2C%20%7B0%2C%201%7D%5D%0A%20%20%7D%2C%20%7Bx%2C-10%2C10%2C%200.5%7D%2C%20%7By%2C-10%2C10%2C%200.5%7D%5D%20%2F%2F%20serialize%3B%0A%2C%20100%5D%3B%0A%0ASetTimeout%5BTaskRemove%5Btask%5D%2C%2010000%5D%3B"}),"\n",(0,i.jsxs)(B.p,{children:["If you made that far, ",(0,i.jsx)(B.strong,{children:"congratulations"})," \u2b50\ufe0f Now you have learned how to do the software rendering."]}),"\n",(0,i.jsxs)(B.blockquote,{children:["\n",(0,i.jsxs)(B.p,{children:["Please, never do ",(0,i.jsx)(B.em,{children:"software rendering"}),". It is slow and basically is a waste of resources of your CPU, which was not designed for rendering graphics. Use it only for educational purposes, small images or complex calulations, which are not possible to do using GPU."]}),"\n"]}),"\n",(0,i.jsx)(B.h2,{id:"virtual-ink",children:"Virtual Ink"}),"\n",(0,i.jsx)(B.p,{children:"To visualize velocity field, one can actually use another scalar field instead of 1000 probing balls. This scalar field is easy to imagine: ink \u270d\ud83c\udffc or dye or goo, which fell into a water and now is carried by the steams of fluid"}),"\n",(0,i.jsx)(B.span,{className:"katex-display",children:(0,i.jsxs)(B.span,{className:"katex",children:[(0,i.jsx)(B.span,{className:"katex-mathml",children:(0,i.jsx)(B.math,{xmlns:"http://www.w3.org/1998/Math/MathML",display:"block",children:(0,i.jsxs)(B.semantics,{children:[(0,i.jsxs)(B.mrow,{children:[(0,i.jsxs)(B.mfrac,{children:[(0,i.jsxs)(B.mrow,{children:[(0,i.jsx)(B.mi,{mathvariant:"normal",children:"\u2202"}),(0,i.jsxs)(B.msub,{children:[(0,i.jsx)(B.mi,{children:"u"}),(0,i.jsxs)(B.mrow,{children:[(0,i.jsx)(B.mi,{children:"i"}),(0,i.jsx)(B.mi,{children:"n"}),(0,i.jsx)(B.mi,{children:"k"})]})]})]}),(0,i.jsxs)(B.mrow,{children:[(0,i.jsx)(B.mi,{mathvariant:"normal",children:"\u2202"}),(0,i.jsx)(B.mi,{children:"t"})]})]}),(0,i.jsx)(B.mo,{children:"+"}),(0,i.jsx)(B.mo,{stretchy:"false",children:"("}),(0,i.jsx)(B.mi,{mathvariant:"bold",children:"v"}),(0,i.jsx)(B.mo,{children:"\u22c5"}),(0,i.jsx)(B.mi,{mathvariant:"normal",children:"\u2207"}),(0,i.jsx)(B.mo,{stretchy:"false",children:")"}),(0,i.jsxs)(B.msub,{children:[(0,i.jsx)(B.mi,{children:"u"}),(0,i.jsxs)(B.mrow,{children:[(0,i.jsx)(B.mi,{children:"i"}),(0,i.jsx)(B.mi,{children:"n"}),(0,i.jsx)(B.mi,{children:"k"})]})]}),(0,i.jsx)(B.mo,{children:"="}),(0,i.jsx)(B.mn,{children:"0"})]}),(0,i.jsx)(B.annotation,{encoding:"application/x-tex",children:"\\frac{\\partial{u_{ink}}}{\\partial{t}} + (\\mathbf{v}\\cdot \\nabla) u_{ink} = 0"})]})})}),(0,i.jsxs)(B.span,{className:"katex-html","aria-hidden":"true",children:[(0,i.jsxs)(B.span,{className:"base",children:[(0,i.jsx)(B.span,{className:"strut",style:{height:"2.0574em",verticalAlign:"-0.686em"}}),(0,i.jsxs)(B.span,{className:"mord",children:[(0,i.jsx)(B.span,{className:"mopen nulldelimiter"}),(0,i.jsx)(B.span,{className:"mfrac",children:(0,i.jsxs)(B.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(B.span,{className:"vlist-r",children:[(0,i.jsxs)(B.span,{className:"vlist",style:{height:"1.3714em"},children:[(0,i.jsxs)(B.span,{style:{top:"-2.314em"},children:[(0,i.jsx)(B.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsxs)(B.span,{className:"mord",children:[(0,i.jsx)(B.span,{className:"mord",style:{marginRight:"0.05556em"},children:"\u2202"}),(0,i.jsx)(B.span,{className:"mord",children:(0,i.jsx)(B.span,{className:"mord mathnormal",children:"t"})})]})]}),(0,i.jsxs)(B.span,{style:{top:"-3.23em"},children:[(0,i.jsx)(B.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsx)(B.span,{className:"frac-line",style:{borderBottomWidth:"0.04em"}})]}),(0,i.jsxs)(B.span,{style:{top:"-3.677em"},children:[(0,i.jsx)(B.span,{className:"pstrut",style:{height:"3em"}}),(0,i.jsxs)(B.span,{className:"mord",children:[(0,i.jsx)(B.span,{className:"mord",style:{marginRight:"0.05556em"},children:"\u2202"}),(0,i.jsx)(B.span,{className:"mord",children:(0,i.jsxs)(B.span,{className:"mord",children:[(0,i.jsx)(B.span,{className:"mord mathnormal",children:"u"}),(0,i.jsx)(B.span,{className:"msupsub",children:(0,i.jsxs)(B.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(B.span,{className:"vlist-r",children:[(0,i.jsx)(B.span,{className:"vlist",style:{height:"0.3361em"},children:(0,i.jsxs)(B.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(B.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(B.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(B.span,{className:"mord mtight",children:(0,i.jsx)(B.span,{className:"mord mathnormal mtight",style:{marginRight:"0.03148em"},children:"ink"})})})]})}),(0,i.jsx)(B.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(B.span,{className:"vlist-r",children:(0,i.jsx)(B.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(B.span,{})})})]})})]})})]})]})]}),(0,i.jsx)(B.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(B.span,{className:"vlist-r",children:(0,i.jsx)(B.span,{className:"vlist",style:{height:"0.686em"},children:(0,i.jsx)(B.span,{})})})]})}),(0,i.jsx)(B.span,{className:"mclose nulldelimiter"})]}),(0,i.jsx)(B.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(B.span,{className:"mbin",children:"+"}),(0,i.jsx)(B.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,i.jsxs)(B.span,{className:"base",children:[(0,i.jsx)(B.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(B.span,{className:"mopen",children:"("}),(0,i.jsx)(B.span,{className:"mord mathbf",style:{marginRight:"0.01597em"},children:"v"}),(0,i.jsx)(B.span,{className:"mspace",style:{marginRight:"0.2222em"}}),(0,i.jsx)(B.span,{className:"mbin",children:"\u22c5"}),(0,i.jsx)(B.span,{className:"mspace",style:{marginRight:"0.2222em"}})]}),(0,i.jsxs)(B.span,{className:"base",children:[(0,i.jsx)(B.span,{className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,i.jsx)(B.span,{className:"mord",children:"\u2207"}),(0,i.jsx)(B.span,{className:"mclose",children:")"}),(0,i.jsxs)(B.span,{className:"mord",children:[(0,i.jsx)(B.span,{className:"mord mathnormal",children:"u"}),(0,i.jsx)(B.span,{className:"msupsub",children:(0,i.jsxs)(B.span,{className:"vlist-t vlist-t2",children:[(0,i.jsxs)(B.span,{className:"vlist-r",children:[(0,i.jsx)(B.span,{className:"vlist",style:{height:"0.3361em"},children:(0,i.jsxs)(B.span,{style:{top:"-2.55em",marginLeft:"0em",marginRight:"0.05em"},children:[(0,i.jsx)(B.span,{className:"pstrut",style:{height:"2.7em"}}),(0,i.jsx)(B.span,{className:"sizing reset-size6 size3 mtight",children:(0,i.jsx)(B.span,{className:"mord mtight",children:(0,i.jsx)(B.span,{className:"mord mathnormal mtight",style:{marginRight:"0.03148em"},children:"ink"})})})]})}),(0,i.jsx)(B.span,{className:"vlist-s",children:"\u200b"})]}),(0,i.jsx)(B.span,{className:"vlist-r",children:(0,i.jsx)(B.span,{className:"vlist",style:{height:"0.15em"},children:(0,i.jsx)(B.span,{})})})]})})]}),(0,i.jsx)(B.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,i.jsx)(B.span,{className:"mrel",children:"="}),(0,i.jsx)(B.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,i.jsxs)(B.span,{className:"base",children:[(0,i.jsx)(B.span,{className:"strut",style:{height:"0.6444em"}}),(0,i.jsx)(B.span,{className:"mord",children:"0"})]})]})]})}),"\n",(0,i.jsxs)(B.p,{children:["We already know how to solve advection equation. Our function ",(0,i.jsx)(B.code,{children:"advect"})," is used for modelling the momentum of fluid, which is a 2D vector field... Why not then to use ",(0,i.jsx)(B.strong,{children:"two kinds of ink"}),"?"]}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"87b65963-4580-4c9f-a471-b67a3ac3ab47",type:"Input",opts:{InitGroup:!0},children:"ink%20%3D%20Table%5B%7B0.%2C0.%7D%2C%20%7Bi%2C50%7D%2C%20%7Bj%2C50%7D%5D%3B%0A%0A%28%2ABB%5B%2A%29%28%2A%20transform%20to%20%22byte%22%20format%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0Anink%20%3D%20NumericArray%5BMap%5B255.0%20%7B%23%5B%5B1%5D%5D%2C%200.%2C%20%23%5B%5B2%5D%5D%7D%20%26%2C%20ink%2C%20%7B2%7D%5D%2C%20%22UnsignedInteger8%22%2C%20%22ClipAndRound%22%5D%3B"}),"\n",(0,i.jsxs)(B.p,{children:["Then we can directly visualize ",(0,i.jsx)(B.code,{children:"nink"})," scalar field instead of drawing many many arrows and dots. In this way we will utilize fully our expensive software rendering."]}),"\n",(0,i.jsxs)(B.p,{children:[(0,i.jsx)(B.strong,{children:"TL;DR"})," Final program"]}),"\n",(0,i.jsx)(n.EB,{display:"codemirror",nid:"73fe49db-9a23-480c-b68c-e4e3334021f7",id:"63d3faa1-b130-427a-b958-7f416cf688f1",type:"Input",opts:{},children:"vgrid%20%3D%20Table%5B%7B0.%2C0.%7D%2C%20%7Bi%2C50%7D%2C%20%7Bj%2C50%7D%5D%3B%0A%0Aink%20%3D%200.%20ink%3B%0Anink%20%3D%20NumericArray%5BMap%5B255.0%20%7B%23%5B%5B1%5D%5D%2C%200.%2C%20%23%5B%5B2%5D%5D%7D%20%26%2C%20ink%2C%20%7B2%7D%5D%2C%20%22UnsignedInteger8%22%2C%20%22ClipAndRound%22%5D%3B%0A%0Adest%20%3D%20%7B0%2C0%7D%3B%0Acink%20%3D%20%7B1.0%2C0.2%7D%3B%0Avfps%20%3D%200%3B%0A%0AWith%5B%7B%0A%20%20win%20%3D%20CurrentWindow%5B%5D%2C%20%0A%20%20currentCell%20%3D%20ResultCell%5B%5D%0A%7D%2C%0A%0A%20%20EventHandler%5Bwin%2C%20%7B%22Closed%22%20-%3E%20Function%5BNull%2C%0A%20%20%20%20Delete%5BcurrentCell%5D%20%28%2ABB%5B%2A%29%28%2A%20remove%20output%20cell%20if%20a%20notebook%20has%20been%20closed%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20this%20will%20prevent%20the%20animation%20running%20uncontrollably%20on%20the%20next%20start%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%5D%7D%5D%3B%0A%0A%20%20Graphics%5B%7B%0A%0A%20%20%20%20%28%2ABB%5B%2A%29%28%2Aattach%20listeners%20to%20a%20user%27s%20mouse%20to%20manipulate%20the%20grid%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20EventHandler%5BGraphics%60Canvas%5B%5D%2C%20%7B%0A%20%20%20%20%20%20%22click%22%20-%3E%20Function%5BNull%2C%0A%20%20%20%20%20%20%20%20cink%20%3D%20cink%20%2F%2F%20Reverse%3B%0A%20%20%20%20%20%20%5D%2C%0A%0A%20%20%20%20%20%20%22mousemove%22%20-%3E%20Function%5Bpos%2C%20With%5B%7B%0A%20%20%20%20%20%20%20%20%20%20xy%20%3D%20%7B50.0%20-%20pos%5B%5B2%5D%5D%2C%20pos%5B%5B1%5D%5D%7D%0A%20%20%20%20%20%20%20%20%7D%2C%20%0A%20%20%20%20%20%20%20%20%20%20With%5B%7Bp%20%3D%20Round%5Bxy%5D%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20If%5Bp%5B%5B1%5D%5D%20%3C%3D%2050-1%20%26%26%20p%5B%5B1%5D%5D%20%3E%3D2%20%26%26%20p%5B%5B2%5D%5D%20%3C%3D50-1%20%26%26%20p%5B%5B2%5D%5D%20%3E%3D2%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20accelerate%20the%20fluid%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20vgrid%5B%5Bp%5B%5B1%5D%5D%2Cp%5B%5B2%5D%5D%5D%5D%20%3D%20Normalize%5B%28xy%20-%20dest%29%5D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20add%20some%20ink%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ink%5B%5Bp%5B%5B1%5D%5D%2Cp%5B%5B2%5D%5D%5D%5D%20%3D%20cink%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ink%5B%5Bp%5B%5B1%5D%5D%2B1%2Cp%5B%5B2%5D%5D%5D%5D%20%3D%20cink%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ink%5B%5Bp%5B%5B1%5D%5D-1%2Cp%5B%5B2%5D%5D%5D%5D%20%3D%20cink%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ink%5B%5Bp%5B%5B1%5D%5D%2Cp%5B%5B2%5D%5D%2B1%5D%5D%20%3D%20cink%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20ink%5B%5Bp%5B%5B1%5D%5D%2Cp%5B%5B2%5D%5D%2B1%5D%5D%20%3D%20cink%3B%0A%20%20%20%20%20%20%20%20%20%20%20%20%5D%3B%0A%0A%20%20%20%20%20%20%20%20%20%20%5D%3B%0A%20%20%20%20%20%20%20%20%0A%20%20%20%20%20%20%20%20%20%20dest%20%3D%20xy%3B%0A%20%20%20%20%20%20%20%20%5D%20%5D%0A%20%20%20%20%7D%5D%2C%20%0A%0A%20%20%20%20%28%2ABB%5B%2A%29%28%2Async%20with%20browser%27s%20repaint%20cycle%20and%20update%20of%20fps%20label%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20AnimationFrameListener%5Bvfps%20%2F%2F%20Offload%2C%20%22Event%22-%3E%22vframe%22%5D%2C%20%0A%0A%20%20%20%20%28%2ABB%5B%2A%29%28%2Ainsert%20our%20Image%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20Inset%5B%0A%20%20%20%20%0A%20%20%20%20%20%20Image%5Bnink%20%2F%2F%20Offload%2C%20%22Byte%22%2C%20Magnification-%3E10%5D%0A%20%20%20%20%0A%20%20%20%20%2C%20%7B0%2C0%7D%2C%20%7B0%2C0%7D%2C%20%7B500%2C500%7D%2C%20%0A%20%20%20%20%0A%20%20%20%20%20%20%28%2ABB%5B%2A%29%28%2A%20do%20not%20apply%20any%20transformation.%20keep%20the%20original%20size%20%2A%29%28%2A%2C%2A%29%28%2A%221%3AeJxTTMoPSmNhYGAo5gcSAUX5ZZkpqSn%2BBSWZ%2BXnFaYwgCS4g4Zyfm5uaV%2BKUXxEMUqxsbm6exgSSBPGCSnNSg9mAjOCSosy8dLBYSFFpKpoKkDkeqYkpEFXBILO1sCgJSczMQVYCAOFrJEU%3D%22%2A%29%28%2A%5DBB%2A%29%0A%20%20%20%20%20%20ViewMatrix-%3ENone%0A%20%20%20%20%5D%2C%0A%20%20%20%20%0A%20%20%20%20Text%5Bvfps%20%2F%2F%20Offload%2C%20%7B0%2C0%7D%5D%0A%0A%20%20%20%20%0A%20%20%7D%2C%20%0A%20%20%20%20Controls-%3EFalse%2C%20%0A%20%20%20%20ImageSize-%3E500%2C%20%0A%20%20%20%20PlotRange-%3E%7B%7B0%2C50%7D%2C%20%7B0%2C50%7D%7D%2C%20%0A%20%20%20%20ImagePadding-%3ENone%0A%20%20%5D%0A%5D%0A%0A%28%2A%20subscribe%20to%20animation%20event%20%2A%29%0A%0Avtime%20%3D%20AbsoluteTime%5B%5D%3B%0A%0AEventHandler%5B%22vframe%22%2C%20Function%5BNull%2C%0A%20%20%0A%20%20vgrid%20%3D%20advect%5Bvgrid%2Cvgrid%2C%201.0%5D%3B%0A%20%20vgrid%20%3D%20removeDivergence%5Bvgrid%5D%3B%0A%20%20vgrid%20%3D%20removeDivergence%5Bvgrid%5D%3B%0A%0A%20%20ink%20%3D%20With%5B%7Ba%20%3D%20advect%5Bvgrid%2C%20ink%2C%201.0%5D%7D%2C%20advect%5Bvgrid%2C%20a%2C%201.0%5D%5D%3B%0A%20%20nink%20%3D%20NumericArray%5BMap%5B255.0%20%7B1.0%20-%20%23%5B%5B2%5D%5D%2C%201.0-%20%23%5B%5B1%5D%5D%2C%201.0%20-%20%23%5B%5B1%5D%5D%2C%201.0%7D%20%26%2C%20ink%2C%20%7B2%7D%5D%2C%20%22UnsignedInteger8%22%2C%20%22ClipAndRound%22%5D%3B%0A%20%20%0A%20%20vfps%20%3D%20%28%2AFB%5B%2A%29%28%28%28vfps%20%2B%201%20%2F%20%28AbsoluteTime%5B%5D%20-%20vtime%29%29%29%28%2A%2C%2A%29%2F%28%2A%2C%2A%29%282.0%29%29%28%2A%5DFB%2A%29%20%2F%2F%20Round%3B%0A%20%20vtime%20%3D%20AbsoluteTime%5B%5D%3B%20%0A%5D%5D%3B"}),"\n",(0,i.jsxs)(B.p,{children:["We do here pretty much the same as before; however, there are no longer arrows but a single ",(0,i.jsx)(B.code,{children:"Inset"})," with a raster dynamic image inside. This places the ",(0,i.jsx)(B.code,{children:"Image"})," on top of our ",(0,i.jsx)(B.code,{children:"Graphics"})," canvas. This overlay is helpful since we can still listen to mouse positions and display FPS at a low cost. The fluid goes in the same direction as the mouse"]}),"\n","\n",(0,i.jsx)("video",{width:"100%",controls:!0,children:(0,i.jsx)("source",{src:s})}),"\n",(0,i.jsx)(B.p,{children:"I (Me - @JerryI) personally believe that we pushed the implementation to the limits of this toy model running on a CPU with an interpretive programming language. The next step definitely should be to utilize GPU compute shaders such as WebGPU, OpenCL, CUDA to calculate bigger fields and pipe the data directly to the canvas. However, this will be another story."}),"\n",(0,i.jsx)(B.p,{children:"Thank you \u2764\ufe0f"})]})}function c(e={}){const{wrapper:B}={...(0,a.M)(),...e.components};return B?(0,i.jsx)(B,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},46880:(e,B,A)=>{"use strict";A.d(B,{EB:()=>C,gL:()=>o,Af:()=>D});var i,a=A(11504);A(93391),A(28264);function n(){return n=Object.assign?Object.assign.bind():function(e){for(var B=1;B<arguments.length;B++){var A=arguments[B];for(var i in A)Object.prototype.hasOwnProperty.call(A,i)&&(e[i]=A[i])}return e},n.apply(this,arguments)}const s=e=>{let{title:B,titleId:A,...s}=e;return a.createElement("svg",n({xmlns:"http://www.w3.org/2000/svg",fill:"none",className:"w-5 h-5 ml-auto",viewBox:"0 0 24 24","aria-labelledby":A},s),B?a.createElement("title",{id:A},B):null,i||(i=a.createElement("path",{stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",d:"M17 17h.01m.39-3h.6c.932 0 1.398 0 1.765.152a2 2 0 0 1 1.083 1.083C21 15.602 21 16.068 21 17s0 1.398-.152 1.765a2 2 0 0 1-1.083 1.083C19.398 20 18.932 20 18 20H6c-.932 0-1.398 0-1.765-.152a2 2 0 0 1-1.083-1.083C3 18.398 3 17.932 3 17s0-1.398.152-1.765a2 2 0 0 1 1.083-1.083C4.602 14 5.068 14 6 14h.6m5.4 1V4m0 11-3-3m3 3 3-3"})))};var r=A(66528),t=(A(98684),A(52964),A(93664),A(17624));function D(e){let{json:B,notebook:A,kernel:i}=e;const{colorMode:n,setColorMode:D}=(0,r.U)();return(0,a.useEffect)((()=>{console.warn("Create store"),console.warn(B);const e={},A={},a=[],n=new Deferred;let s=async()=>{s=async()=>{},fetch(B).then((B=>{console.warn("Store loaded!"),B.json().then((B=>{interpretate(B.objects,{hold:!0}).then((B=>{console.warn("Objects loaded!"),Object.keys(B).forEach((e=>{const A=new ObjectStorage(e);A.cache=B[e],A.cached=!0})),Object.keys(e).forEach((A=>{Array.isArray(e[A])?e[A].forEach((e=>e.resolve(B[A]))):e[A].resolve(B[A])}))})),interpretate(B.symbols,{hold:!0}).then((e=>{console.warn("Symbols loaded!"),Object.keys(e).forEach((B=>{core[B]=async(e,A)=>await interpretate(core[B].data,A),core[B].data=e[B],core[B]=async(e,A)=>{console.log("IE: calling our symbol...");const i=await interpretate(core[B].data,A);return A.root&&!A.novirtual&&(core[B].instances[A.root.uid]=A.root),i},core[B].update=async(e,A)=>{if(A.useCache)return core[B].cached&&core[B].currentData==core[B].data||(core[B].cached=await interpretate(core[B].data,A),core[B].currentData=core[B].data),core[B].cached;return await interpretate(core[B].data,A)},core[B].destroy=async(e,A)=>{delete core[B].instances[A.root.uid],console.warn(A.root.uid+" was destroyed"),console.warn("external symbol was destoryed")},core[B].data=e[B],core[B].virtual=!0,core[B].instances={}})),Object.keys(A).forEach((B=>{console.warn(B),A[B].resolve(e[B])})),n.resolve()}))}))}))};core.Offload=(e,B)=>{if(e.length>1)if("'Static'"===e[1][1]){if(e[1][2])return interpretate(e[0],{...B,static:!0})}else if(e.length>2&&"'Static'"===e[2][1]&&e[2][2])return interpretate(e[0],{...B,static:!0});return interpretate(e[0],B)},core.Offload.update=(e,B)=>{if(e.length>1)if("'Volatile'"===e[1][1]){if(!e[1][2])return void console.log("Update was rejected (Nonvolatile)")}else if(e.length>2&&"'Volatile'"===e[2][1]&&!e[2][2])return void console.log("Update was rejected (Nonvolatile)");return interpretate(e[0],B)},window.server={kernel:{}},window.server.ask=B=>{const A=new Deferred;return B.length<42?(console.error("Unknown command"),console.error(B),!1):(Array.isArray(e[B.slice(42,-2)])?e[B.slice(42,-2)].push(A):e[B.slice(42,-2)]=[A],s(),A.promise)},window.server.getSymbol=e=>{const B=new Deferred;return console.warn("Asking for symbol"+e),A[e]=B,B.promise},window.server.kernel.emitt=function(e,B,A){void 0===A&&(A="Default"),a.push({uid:e,data:B,type:A})},interpretate.anonymous=async(e,B)=>{let i,a;if(console.log("Anonimous symbol: "+JSON.stringify(e)),e instanceof Array)throw console.error(e),"unknown WL expression. Error at "+e[0];i=e;const n=new Deferred;return console.warn("Asking for symbol"+i),A[i]=n,a=await n.promise,core[i]=async(e,B)=>{console.log("IE: calling our symbol...");const A=await interpretate(core[i].data,B);return B.root&&!B.novirtual&&(core[i].instances[B.root.uid]=B.root),A},core[i].update=async(e,B)=>{if(B.useCache)return core[i].cached&&core[i].currentData==core[i].data||(core[i].cached=await interpretate(core[i].data,B),core[i].currentData=core[i].data),core[i].cached;return await interpretate(core[i].data,B)},core[i].destroy=async(e,B)=>{delete core[i].instances[B.root.uid],console.warn(B.root.uid+" was destroyed"),console.warn("external symbol was destoryed")},core[i].data=a,core[i].virtual=!0,core[i].instances={},interpretate(e,B)},(async()=>{if(console.warn("Kernel"),i){if(console.warn("KERNEL"),!interpretate.unzlib64String){const e=new Deferred,B=document.createElement("script");B.src="https://cdn.jsdelivr.net/gh/JerryI/wljs-export-html@main/dist/zip.min.js",B.addEventListener("load",(()=>e.resolve())),document.head.appendChild(B),await e.promise,console.warn("ZIP loaded!")}if(!window.KernelState){const e=new Deferred,B=document.createElement("script");B.src="https://cdn.jsdelivr.net/gh/JerryI/wljs-export-html@main/dist/decoder.min.js",B.addEventListener("load",(()=>e.resolve())),document.head.appendChild(B),await e.promise,console.warn("KernelState lib loaded!")}fetch(i).then((e=>{console.log(e),e.json().then((async e=>{let B=e;B=B.map((e=>interpretate.unzlib64String(e))),B=B.map(KernelMesh.unpack),console.warn("Mesh loaded!"),window.server.kernel.emitt=function(e,A,i){void 0===i&&(i="Default"),setTimeout((()=>{const a={type:"event",uid:e,pattern:i,data:A},n=B;for(let e=0;e<n.length;++e)if(n[e].test(a)){if(n[e].state)n[e].state=new KernelState(n[e].state,a,!0);else{if(n[e].database.has("$initialization")){n[e].database.get("$initialization").forEach((B=>n[e].state=new KernelState(n[e].state,B,!0)))}n[e].state=new KernelState(n[e].state,a,!0)}n[e].state.exec(n[e].database,(e=>{for(const B of Object.keys(e))if("$state"!==B)if(1===e[B].set.length){core[B].data=e[B].set[0];for(const e of Object.values(core[B].instances))e.update()}else{e[B].i+=1,e[B].i>=e[B].set.length&&(e[B].i=0),core[B].data=e[B].set[e[B].i];for(const e of Object.values(core[B].instances))e.update()}}))}}),2)},a.forEach((e=>window.server.kernel.emitt(e.uid,e.data,e.type)))}))}))}})()})),(0,t.jsx)(t.Fragment,{children:(0,t.jsxs)("a",{href:A,className:"dark"==n?"p-2 text-xs w-full flex ring-1 ring-inset shadow ring-gray-300 text-gray-300 my-2":"p-2 text-xs w-full flex ring-1 ring-inset text-gray-600 shadow ring-gray-300 bg-gray-300 my-2",children:["Download original notebook ",(0,t.jsx)(s,{})]})})}function o(e){let{children:B,data:A}=e;const i={__html:decodeURIComponent(B)};return(0,t.jsx)("div",{dangerouslySetInnerHTML:i})}function C(e){let{children:B,nid:A,id:i,type:n,display:s,opts:D}=e;const o=(0,a.useRef)(null),{colorMode:C,setColorMode:l}=(0,r.U)(),c=decodeURIComponent(B),[d,m]=(0,a.useState)(D.Fade),[p,h]=(0,a.useState)(!1);return(0,a.useEffect)((()=>{const e=o.current;let B;if(console.warn("Create Codemirror"),console.warn(s),console.log(c),h(!0),console.warn("Created: "+s),"print"!=s){if(window.SupportedCells[s])return window.SupportedCells[s].view&&(B=new window.SupportedCells[s].view({element:e},c)),B.editor&&D.Fade&&(o.current.addEventListener("focusin",(()=>{m(!1)})),o.current.addEventListener("focusout",(()=>{m(!0)}))),()=>{B&&B.dispose()};console.warn("Not found: "+s)}}),[]),(0,t.jsx)("div",{style:{filter:"dark"==C?"invert(1) contrast(0.8) hue-rotate(-185deg)":"none"},className:"language-mathematica codeBlockContainer_node_modules-@docusaurus-theme-classic-lib-theme-CodeBlock-Container-styles-module theme-code-block",children:(0,t.jsx)("div",{className:d?"h-fade-20 codeBlockContent_node_modules-@docusaurus-theme-classic-lib-theme-CodeBlock-Content-styles-module":"codeBlockContent_node_modules-@docusaurus-theme-classic-lib-theme-CodeBlock-Content-styles-module",children:(0,t.jsxs)("pre",{tabIndex:"0",className:"prism-code language-mathematica codeBlock_node_modules-@docusaurus-theme-classic-lib-theme-CodeBlock-Content-styles-module thin-scrollbar",style:{color:"rgb(57, 58, 52)",backgroundColor:"rgb(246, 248, 250)"},children:[!p&&(0,t.jsx)("code",{style:{whiteSpace:"pre-wrap"},className:"codeBlockLines_node_modules-@docusaurus-theme-classic-lib-theme-CodeBlock-Content-styles-module",children:c}),(0,t.jsx)("code",{ref:o,className:"codeBlockLines_node_modules-@docusaurus-theme-classic-lib-theme-CodeBlock-Content-styles-module"})]})})})}},81320:(e,B,A)=>{"use strict";A.d(B,{c:()=>i});const i=A.p+"dee23992c5ab28c3de0c5f36a3dbefc0.txt"},19744:(e,B,A)=>{"use strict";A.d(B,{c:()=>i});const i=A.p+"852d254f3f8da0b1965634eeb37213ed.wln"},4556:(e,B,A)=>{"use strict";A.d(B,{c:()=>i});const i=A.p+"assets/images/eye-ezgif.com-optimize-300beb3801a83995a50b58fbb4f92dea.gif"},47944:()=>{},73223:()=>{}}]);