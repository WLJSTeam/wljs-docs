"use strict";(self.webpackChunkwlx_docs=self.webpackChunkwlx_docs||[]).push([[3783],{5430:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/Screenshot 2025-05-18 at 12.41.01-dbb2b03d6accdb61f614c2f1e6568bd7.png"},6576:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/Screenshot 2025-05-18 at 12.35.53-b7e9fe8f4122c982ef645f7322558185.png"},21022:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/bubbleseasy-ezgif.com-video-to-gif-converter-b6c42e83757282b02a497b04e6bea11d.gif"},25728:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/buterfly-ezgif.com-optimize-8fe9fb7adab89fd84177efb62287d560.gif"},26348:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/AnimateExample-ezgif.com-video-to-gif-converter-48a92a56d77843c42397b8b3c73c84ab.gif"},28453:(e,n,a)=>{a.d(n,{R:()=>o,x:()=>s});var i=a(96540);const t={},r=i.createContext(t);function o(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),i.createElement(r.Provider,{value:n},e.children)}},36519:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/animatedsn-ezgif.com-video-to-gif-converter-1b1a82f44ba5274fb6f679bf3d49628f.gif"},68087:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/ani-ezgif.com-optimize-2ab04d128f188c3e75c500c675b8301a.gif"},72926:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/color-ezgif.com-optimize-8b160d963cc68f2d3daef553a6ac84b9.gif"},88521:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/ScreenRecording2025-04-11at19.13.52-ezgif.com-optimize-25d6d792538a198067b5894a6aedcc03.gif"},92283:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/basicRing-ezgif.com-video-to-gif-converter-47c23badc6a2dbff942e7c8daa248591.gif"},94795:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>l,contentTitle:()=>o,default:()=>h,frontMatter:()=>r,metadata:()=>s,toc:()=>c});var i=a(74848),t=a(28453);const r={draft:!1},o=void 0,s={id:"frontend/Advanced/Dynamics/Animation",title:"Animation",description:"Basic",source:"@site/docs/frontend/Advanced/Dynamics/Animation.md",sourceDirName:"frontend/Advanced/Dynamics",slug:"/frontend/Advanced/Dynamics/Animation",permalink:"/frontend/Advanced/Dynamics/Animation",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1748709296e3,frontMatter:{draft:!1},sidebar:"tutorialSidebar",previous:{title:"Dynamics and Interactivity",permalink:"/category/dynamics-and-interactivity"},next:{title:"Arrays",permalink:"/frontend/Advanced/Dynamics/Arrays"}},l={},c=[{value:"Basic",id:"basic",level:2},{value:"Way 1",id:"way-1",level:3},{value:"Way 2",id:"way-2",level:3},{value:"Smoother version",id:"smoother-version",level:4},{value:"Advanced",id:"advanced",level:2},{value:"Way 1",id:"way-1-1",level:3},{value:"Way 2",id:"way-2-1",level:3},{value:"Way 3",id:"way-3",level:3},{value:"A remark on color and opacity",id:"a-remark-on-color-and-opacity",level:2},{value:"Append or remove object",id:"append-or-remove-object",level:2},{value:"How to remove",id:"how-to-remove",level:3},{value:"How to append",id:"how-to-append",level:3},{value:"Bubbles",id:"bubbles",level:4},{value:"How to append and remove",id:"how-to-append-and-remove",level:3},{value:"Animating Bubbles",id:"animating-bubbles",level:4},{value:"Pool of Objects",id:"pool-of-objects",level:4}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h2,{id:"basic",children:"Basic"}),"\n",(0,i.jsx)(n.h3,{id:"way-1",children:"Way 1"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Plotting%20Functions/AnimatePlot",children:"AnimatePlot"})," for plot-like animations"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"AnimatePlot[Sum[Sin[x w]/w, {w, 1,n}] // Re, {x, -2Pi,2Pi}, {n, 1,20, 1}]\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:a(88521).A+"",width:"800",height:"581"})}),"\n",(0,i.jsx)(n.h3,{id:"way-2",children:"Way 2"}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.a,{href:"/frontend/Reference/GUI/Animate",children:"Animate"})," for animating arbitrary expressions"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'Animate[Row[{Sin[x], "==", Series[Sin[x], {x,0,n}], Invisible[1/2]}], {n, 1, 10, 1}, AnimationRate->3]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["here we used ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Formatting/Invisible",children:"Invisible"})," with a dummy expression to keep the height of the editor the same. The result will look like"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:a(36519).A+"",width:"800",height:"121"})}),"\n",(0,i.jsxs)(n.p,{children:["Using ",(0,i.jsx)(n.code,{children:"UpdateFunction"})," option, one can bypass the default update method and write your own using [[Offload]]"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'Module[{pts},\n  Animate[Graphics[{\n    Circle[{0,0},1],\n    Red, Point[pts // Offload]\n  }, ImageSize->Small], {t, 0, 2Pi, 0.1}, \n  "UpdateFunction" -> Function[t,\n    pts = {Sin[t], Cos[t]};\n    False\n  ]]\n]\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:a(92283).A+"",width:"800",height:"447"})}),"\n",(0,i.jsx)(n.h4,{id:"smoother-version",children:"Smoother version"}),"\n",(0,i.jsx)(n.p,{children:"There are two way how to make the previous example look smoother."}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["Native ",(0,i.jsx)(n.code,{children:"Graphics"}),"'s data interpolation"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'Module[{pts},\n  Animate[Graphics[{\n    Circle[{0,0},1],\n    Red, Point[pts // Offload]\n  }, ImageSize->Small,\n    TransitionDuration->220\n  ], {t, 0, 2Pi, 0.1}, \n  "UpdateFunction" -> Function[t,\n    pts = {Sin[t], Cos[t]};\n    False\n  ]]\n]\n'})}),"\n",(0,i.jsxs)(n.ol,{start:"2",children:["\n",(0,i.jsx)(n.li,{children:"Increate the update frame rate"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'Module[{pts},\n  Animate[Graphics[{\n    Circle[{0,0},1],\n    Red, Point[pts // Offload]\n  }, ImageSize->Small,\n    TransitionType->None\n  ], {t, 0, 2Pi, 0.02}, \n  "UpdateFunction" -> Function[t,\n    pts = {Sin[t], Cos[t]};\n    False\n  ], AnimationRate->60]\n]\n'})}),"\n",(0,i.jsx)(n.p,{children:"It is important to disable interpolation, since it will only hurt the performance at higher rates."}),"\n",(0,i.jsx)(n.h2,{id:"advanced",children:"Advanced"}),"\n",(0,i.jsx)(n.h3,{id:"way-1-1",children:"Way 1"}),"\n",(0,i.jsxs)(n.p,{children:["Consider using ",(0,i.jsx)(n.strong,{children:"to achieve the highest frame rate"})," and ",(0,i.jsx)(n.strong,{children:"smooth animations"}),"."]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/AnimationFrameListener",children:"AnimationFrameListener"})," for ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/",children:"Graphics"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics3D/AnimationFrameListener",children:"AnimationFrameListener"})," for ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics3D/",children:"Graphics3D"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Use ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/TransitionType",children:"TransitionType"})," set to ",(0,i.jsx)(n.code,{children:"None"})," if the calculation time does not exceed ",(0,i.jsx)(n.code,{children:"1/60"})," seconds. Otherwise, consider using the ",(0,i.jsx)(n.code,{children:'"Linear"'})," interpolation option and a small value for ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/TransitionDuration",children:"TransitionDuration"}),", around 10-100, depending on how long it takes to update the data."]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["If your animation looks choppy, you can use JavaScript to interpolate between data changes over time. Use ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/TransitionType",children:"TransitionType"})," and ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/TransitionDuration",children:"TransitionDuration"}),"."]})}),"\n",(0,i.jsx)(n.p,{children:"For example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",metastring:'title="cell 1"',children:'balls = RandomReal[{-1,1}, {100,3}];\nvels  = RandomReal[{-1,1}, {100,3}];\n\nGraphics3D[{\n  Table[With[{i = i},\n    {\n      RGBColor[RandomReal[{0,1}, 3]],\n      Sphere[balls[[i]] // Offload, 0.03]\n    }\n  ], {i, Length[balls]}], \n  AnimationFrameListener[balls // Offload, "Event"->"frame"]\n}]\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"Evaluate the cell above. It will create a canvas with randomly scattered balls."})}),"\n",(0,i.jsxs)(n.p,{children:["At the start of the browser's frame, an event ",(0,i.jsx)(n.code,{children:'"frame"'}),' is triggered to request an update of data from the Kernel. However, after this, you\'ll need to "recharge" ',(0,i.jsx)(n.code,{children:"AnimationFrameListener"}),", or else it will not trigger the event again. This can be automated to occur whenever a change in the ",(0,i.jsx)(n.code,{children:"balls"})," symbol is detected."]}),"\n",(0,i.jsx)(n.p,{children:"This process ensures the following benefits:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Synchronization of animation with the browser's engine (eliminating flickering)."}),"\n",(0,i.jsx)(n.li,{children:"The ability to skip frames if recalculations take longer than one frame of your browser, adapting to your computing power."}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"Here is our update function:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'EventHandler["frame", Function[Null,\n\n  vels = Table[\n    If[Norm[balls[[i]]] < 0.01, -1, 1] vels[[i]] - 0.08 balls[[i]]\n  , {i, Length[balls]}];\n  \n  balls = Table[balls[[i]] + 0.08 vels[[i]], {i, Length[balls]}];\n]];\n'})}),"\n",(0,i.jsxs)(n.p,{children:["To start the animation, reevaluate ",(0,i.jsx)(n.em,{children:"cell 1"}),' or use this "kickstarter":']}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'EventFire["frame", Null]\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:a(68087).A+"",width:"578",height:"300"})}),"\n",(0,i.jsx)(n.p,{children:"Here is another easy example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'Module[{\n  ltrace = {{0.,0.}},\n  ev = CreateUUID[]\n},\n  EventHandler[ev, Function[Null, With[{t= 10.0 AbsoluteTime[]},\n    ltrace = Append[ltrace, {Sin[t], Cos[1.1 t]}];\n  ]]];\n\n  Graphics[{\n    Red, Line[ltrace // Offload],\n    AnimationFrameListener[ltrace // Offload, "Event"->ev]\n  }, PlotRange->{{-1,1}, {-1,1}}, "TransitionType"->None, ImageSize->Small]\n]\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:a(26348).A+"",width:"800",height:"368"})}),"\n",(0,i.jsx)(n.h3,{id:"way-2-1",children:"Way 2"}),"\n",(0,i.jsxs)(n.p,{children:["Consider using ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Misc/Async#%60SetInterval%60",children:(0,i.jsx)(n.code,{children:"SetInterval"})})," for resource-intensive animations. Set ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/TransitionDuration",children:"TransitionDuration"})," and ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/TransitionType",children:"TransitionType"})," to appropriate values for interpolation."]}),"\n",(0,i.jsxs)(n.p,{children:["Usually, if your ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Misc/Async#%60SetInterval%60",children:(0,i.jsx)(n.code,{children:"SetInterval"})})," is, let's say, ",(0,i.jsx)(n.code,{children:"100 ms"}),", then ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/TransitionDuration",children:"TransitionDuration"})," should also be around ",(0,i.jsx)(n.code,{children:"100 ms"})," to achieve ",(0,i.jsx)(n.em,{children:"the smoothest animation"}),"."]}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["If your animation looks choppy, you can use JavaScript to interpolate between data portions over time. Use ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/TransitionType",children:"TransitionType"})," and ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/TransitionDuration",children:"TransitionDuration"}),"."]})}),"\n",(0,i.jsx)(n.p,{children:"For example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'ParametricAnimator[equation_, variable_:t, range_:{0, Infinity, 0.1}] := LeakyModule[{time = range[[1]], task, scale = 1, array = {}, scaledArray={}, cell = ResultCell[]},\n\n    (* Sample the equation each frame and rescale if needed *)\n    animate := Block[{variable = time},\n        With[{e = {Sin[t], Cos[t]} equation},\n            scale = If[Norm[e scale] > 1.4, scale 0.95, scale 1];\n            array = Append[array, e];\n            scaledArray = scale array; \n            pointer = e scale;\n        ];\n\n        time += range[[3]];\n        If[time >= range[[2]], TaskRemove[task]];\n    ];\n\n    animate;\n\n    (* Async task to animate every 50 ms *)\n    task = SetInterval[animate, 50];\n\n    (* Stop the task if the cell is destroyed or reevaluated *)\n    EventHandler[cell, {"Destroy"->Function[Null, TaskRemove[task]; Print["removed"]]}];\n\n    Graphics[{Red, PointSize[0.05], Point[pointer // Offload],\n Opacity[0.5], Line[scaledArray // Offload]\n  }, TransitionDuration->50, TransitionType->"Linear", "Controls"->False, PlotRange->{{-1,1}, {-1,1}}]\n]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["This will sample a given parametric equation and animate it with a ",(0,i.jsx)(n.code,{children:"50 ms"})," time step, while on JavaScript's side, it will interpolate between frames so that the overall animation appears smooth and is rendered at 60FPS."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"ParametricAnimator[Exp[Sin[t]] - 2 Cos[4t] + Sin[(2t - Pi)/24], t, {0,16, 0.05}]\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:a(25728).A+"",width:"361",height:"240"})}),"\n",(0,i.jsx)(n.h3,{id:"way-3",children:"Way 3"}),"\n",(0,i.jsx)(n.p,{children:"If your animation depends on user interaction, it might be best to update object attributes only when an event occurs."}),"\n",(0,i.jsx)(n.p,{children:"For example:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'pt = {0,0};\nGraphics[{\n    White,\n    EventHandler[\n        Rectangle[{-2,-2}, {2,2}],\n        {"mousemove"->Function[xy, pt = xy]}\n    ],\n    PointSize[0.05], Cyan,\n    Point[pt // Offload]\n}]\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"A mouse follower."})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:a(98886).A+"",width:"578",height:"454"})}),"\n",(0,i.jsx)(n.h2,{id:"a-remark-on-color-and-opacity",children:"A remark on color and opacity"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/RGBColor",children:"RGBColor"})," and ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/Opacity",children:"Opacity"})," support updates in the context of ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/",children:"Graphics"}),". However, all graphics symbols sharing the same scope should bind to them indirectly. The good news is that you do not have to worry about this\u2014just use them normally."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"color = {1,0,0};\nGraphics[{RGBColor[color // Offload], Disk[{0,0}, 1]}]\n\nEventHandler[InputJoystick[], Function[xy,\n    color = Normalize[{xy[[1]], xy[[2]], 0.5}] // Abs;\n]]\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:a(72926).A+"",width:"724",height:"531"})}),"\n",(0,i.jsx)(n.h2,{id:"append-or-remove-object",children:"Append or remove object"}),"\n",(0,i.jsx)(n.h3,{id:"how-to-remove",children:"How to remove"}),"\n",(0,i.jsxs)(n.p,{children:["To make a primitive removable, one need to wrap it into ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Frontend%20IO/FrontInstanceGroup",children:"FrontInstanceGroup"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"group = FrontInstanceGroup[];\nPlot[x, {x,0,1}, Prolog->{\n  group[Disk[{0,0}, 1]]\n}]\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:a(6576).A+"",width:"1170",height:"468"})}),"\n",(0,i.jsx)(n.p,{children:"and then to remove it"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"Delete[group]\n"})}),"\n",(0,i.jsx)(n.h3,{id:"how-to-append",children:"How to append"}),"\n",(0,i.jsxs)(n.p,{children:["To append you need to track the instance of your graphics canvas using ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Frontend%20IO/FrontInstanceReference",children:"FrontInstanceReference"})," expression"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"ref = FrontInstanceReference[];\nPlot[x, {x,0,1}, Prolog->{\n  ref\n}]\n"})}),"\n",(0,i.jsxs)(n.p,{children:["and then you can append anything using ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Frontend%20IO/FrontSubmit",children:"FrontSubmit"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"FrontSubmit[Disk[{0,0}, 1], ref]\n"})}),"\n",(0,i.jsx)(n.h4,{id:"bubbles",children:"Bubbles"}),"\n",(0,i.jsx)(n.p,{children:"Let's make something more interesting"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'ref = FrontInstanceReference[];\nEventHandler[Plot[x, {x,0,1}, Epilog->{\n  ref\n}], {"mousemove" -> Function[xy,\n  FrontSubmit[{\n    RandomColor[],\n    Disk[xy, {0.7, 1} RandomReal[{0.01, 0.1}]]\n  }, ref]\n]}]\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:a(5430).A+"",width:"1364",height:"482"})}),"\n",(0,i.jsx)(n.h3,{id:"how-to-append-and-remove",children:"How to append and remove"}),"\n",(0,i.jsx)(n.p,{children:"Here combines both methods"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'ref = FrontInstanceReference[];\ngroups = {};\nEventHandler[Plot[x, {x,0,1}, Epilog->{\n  ref\n}], {"mousemove" -> Function[xy, With[{g = FrontInstanceGroup[]},\n  AppendTo[groups, g];\n  \n  FrontSubmit[{\n    RandomColor[],\n    Disk[xy, {0.7, 1} RandomReal[{0.01, 0.1}]]\n  } // g, ref];\n\n  If[Length[groups] > 10, \n    Delete[groups // First]; \n    groups = Drop[groups, 1];\n  ];\n]]}]\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:a(21022).A+"",width:"800",height:"311"})}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.a,{href:"/frontend/Reference/Frontend%20IO/FrontInstanceGroup",children:"FrontInstanceGroup"})," does support batch processing as well, which may help to eliminate multiple calls to ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Frontend%20IO/FrontSubmit",children:"FrontSubmit"})," or ",(0,i.jsx)(n.code,{children:"Delete"})]})}),"\n",(0,i.jsx)(n.h4,{id:"animating-bubbles",children:"Animating Bubbles"}),"\n",(0,i.jsxs)(n.p,{children:["We can go further and animate bubbles. The problem arises when we create a bubble. In fact, we need to provide a graphical primitive (let\u2019s say ",(0,i.jsx)(n.code,{children:"Disk"}),") and a dynamic symbol to control its properties (see ",(0,i.jsx)(n.a,{href:"/frontend/Dynamics",children:"Dynamics"}),"). Creating 1000 dynamic symbols is a significant overhead for the system, especially if we want to update all of them."]}),"\n",(0,i.jsx)(n.h4,{id:"pool-of-objects",children:"Pool of Objects"}),"\n",(0,i.jsxs)(n.p,{children:["Let us use a limited number of dynamic symbols\u2014buffers\u2014and bind each animated ",(0,i.jsx)(n.code,{children:"Disk"})," or bubble to one of its parts."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"cPool = Table[{0., 0.}, {i, 100}]; (* Positions *)\nvPool = cPool; (* Velocities *)\nrPool = Table[0., {i, 100}]; (* Radius or lifetime *)\n\noPool = Table[Null, {i, 100}]; (* References to objects *)\n"})}),"\n",(0,i.jsx)(n.p,{children:"The general idea is not to allocate new variables for each new object but rather to reuse objects from the pool."}),"\n",(0,i.jsx)(n.p,{children:"The graphical output remains the same:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'scene = FrontInstanceReference[];\nGraphics[{White, EventHandler[Rectangle[{-1, -1}, {1, 1}], {"mousemove" -> handler[scene]}], scene}, ImagePadding -> None]\n'})}),"\n",(0,i.jsx)(n.p,{children:"Our future animation loop will look like this:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"handler[scene_] := Function[xy, \n  If[!created[xy, scene], update[]];\n];\n"})}),"\n",(0,i.jsx)(n.p,{children:"We don't need to evaluate it now."}),"\n",(0,i.jsx)(n.p,{children:"The update function iterates over our arrays and produces new values:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"update[] := With[{},\n  {cPool, rPool} = Transpose[MapIndexed[Function[{a, index},\n    (* If the slot is not empty, recalculate *)\n    If[oPool[[index // First]] =!= Null,\n      \n      If[a[[2]] <= 0.002, \n        (* If the radius is too small, remove the object *)\n        remove[index // First];\n        a\n      ,\n        (* Otherwise, animate *)\n        {a[[1]] + 0.05 vPool[[index // First]], 0.9 a[[2]]}\n      ]\n    ,\n      a\n    ]\n  ], {cPool, rPool} // Transpose]];\n];\n"})}),"\n",(0,i.jsx)(n.p,{children:"If the lifetime is close to zero, we need to remove the created instance and free up slots in our buffers for new objects:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"remove[index_] := (\n  (* Destroy the instance on the frontend *)\n  Delete[oPool[[index]]]; \n  oPool[[index]] = Null\n);\n"})}),"\n",(0,i.jsx)(n.p,{children:"And finally, a function to create new objects:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'created[xy_, scene_] := With[{\n  (* Find an empty slot *)\n  slot = FirstPosition[oPool, Null]\n},\n  If[!MissingQ[slot],\n    With[{s = slot // First},\n\n      (* Initialize positions, radius, etc. *)\n      cPool[[s]] = xy;\n      rPool[[s]] = 0.05;\n      vPool[[s]] = RandomReal[{-1, 1}, 2];\n      oPool[[s]] = True;\n\n      (* Update so the object doesn\'t appear abruptly *)\n      update[];\n\n      (* Create an instance of Disk in the graphics *)\n      With[{\n        group = FrontInstanceGroup[],\n        o = {\n          Hue[RandomReal[{0, 1}], 1, 1],\n          (* Prevent double updates *)\n          Disk[Offload[cPool[[s]]], Offload[rPool[[s]], "Static" -> True]]\n        }\n      },\n        oPool[[s]] = group;\n        FrontSubmit[o // group, scene];\n      ];\n    ];\n\n    True\n  ,\n    False\n  ]\n]\n'})}),"\n",(0,i.jsxs)(n.p,{children:["The key difference from the previous example ",(0,i.jsx)(n.a,{href:"#Simple%20example",children:"Simple Example"})," is that we track our created instances using ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Frontend%20IO/FrontInstanceGroup",children:"FrontInstanceGroup"}),", allowing us to remove them later from our SVG canvas (also known as ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/",children:"Graphics"}),")."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:a(97789).A+"",width:"404",height:"278"})}),"\n",(0,i.jsxs)(n.p,{children:["All positions and radii are stored in two solid symbols, ",(0,i.jsx)(n.code,{children:"cPool"})," and ",(0,i.jsx)(n.code,{children:"rPool"}),". This means we only need to perform two data transactions with our frontend, significantly saving resources when animating objects on the screen. The payload size matters less than the number of transactions in terms of transport load."]})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},97789:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/Bubbles video to gif-e6769380f627f9aeca39fa8709b4461c.gif"},98886:(e,n,a)=>{a.d(n,{A:()=>i});const i=a.p+"assets/images/mours-ezgif.com-crop-1ab1f5b0ac7e45c094ec6d5651321b92.gif"}}]);