"use strict";(self.webpackChunkwlx_docs=self.webpackChunkwlx_docs||[]).push([[61278],{22163:(e,n,r)=>{r.d(n,{A:()=>i});const i=r.p+"assets/images/lenard-ezgif.com-video-to-gif-converter-4ef3fc217a88f298e880dfef39f7dd05.gif"},28453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>s});var i=r(96540);const t={},o=i.createContext(t);function a(e){const n=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(o.Provider,{value:n},e.children)}},31787:(e,n,r)=>{r.d(n,{A:()=>i});const i=r.p+"assets/images/fire-ezgif.com-video-to-gif-converter-a8da107d1d515c144dab68b80d544d98.gif"},49449:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>l});var i=r(74848),t=r(28453);const o={env:["Wolfram Kernel"],package:"wljs-editor"},a=void 0,s={id:"frontend/Reference/Frontend IO/FrontProxy",title:"FrontProxy",description:"Definitions are not loaded to the main context",source:"@site/docs/frontend/Reference/Frontend IO/FrontProxy.md",sourceDirName:"frontend/Reference/Frontend IO",slug:"/frontend/Reference/Frontend IO/FrontProxy",permalink:"/frontend/Reference/Frontend IO/FrontProxy",draft:!1,unlisted:!1,tags:[],version:"current",lastUpdatedAt:1749492433e3,frontMatter:{env:["Wolfram Kernel"],package:"wljs-editor"},sidebar:"tutorialSidebar",previous:{title:"FrontInstanceReference",permalink:"/frontend/Reference/Frontend IO/FrontInstanceReference"},next:{title:"FrontSubmit",permalink:"/frontend/Reference/Frontend IO/FrontSubmit"}},c={},l=[{value:"Needs",id:"needs",level:2},{value:"Factory",id:"factory",level:2},{value:"Constructor",id:"constructor",level:2},{value:"Methods",id:"methods",level:2},{value:"<code>FullForm</code>",id:"fullform",level:3},{value:"<code>Remove</code>",id:"remove",level:3},{value:"<code>Dispatch</code>",id:"dispatch",level:3},{value:"<code>FrontProxyBuffer</code>",id:"frontproxybuffer",level:3},{value:"<code>FrontProxyBufferSet</code>",id:"frontproxybufferset",level:3},{value:"Tips",id:"tips",level:2},{value:"Examples",id:"examples",level:2},{value:"Spherical attracting molecules",id:"spherical-attracting-molecules",level:3},{value:"Fireworks",id:"fireworks",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",img:"img",p:"p",pre:"pre",strong:"strong",...(0,t.R)(),...e.components},{CodeMirror:o}=n;return o||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("CodeMirror",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsx)(n.p,{children:"Definitions are not loaded to the main context"})}),"\n",(0,i.jsxs)(n.p,{children:["An low-level optional abstraction for managing and manipulating graphical or any dynamic ",(0,i.jsx)(n.a,{href:"/frontend/Advanced/Frontend%20interpretation/WLJS%20Functions",children:"frontend instances"})," efficiently and process them in batch. The idea is to use proxy objects as lightweight references to groups of instances (like rectangles, circles combined with other primitives) in a larger scene and ",(0,i.jsx)(n.strong,{children:"minimize the data transfer"})," and symbols usage."]}),"\n",(0,i.jsx)(n.p,{children:"All properties of proxies are stored in linear auto-sizable buffers, which allows JIT-enabled processing and easy sync with a frontend (single transaction)."}),"\n",(0,i.jsx)(n.h2,{id:"needs",children:"Needs"}),"\n",(0,i.jsxs)(n.p,{children:["To load this library use any context that differs from ",(0,i.jsx)(n.code,{children:"Global"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'Needs["FrontProxy`" -> "f`"] // Quiet\n'})}),"\n",(0,i.jsx)(n.h2,{id:"factory",children:"Factory"}),"\n",(0,i.jsx)(n.p,{children:"Creates a new proxy type"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"f`Proxy[{properties__}, body_] _FrontProxy`Reference\n"})}),"\n",(0,i.jsx)(n.p,{children:"or if you want to specify mutable properties explicitly"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"f`Proxy[{properties__}, body_, {mutable__}] _FrontProxy`Reference\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For example to make proxy for many ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/Disk",children:"Disk"}),"s with controllable opacity, color and position"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"disk = f`Proxy[{pos, c}, {\n\tOpacity[c], RGBColor[With[{h=c}, {h, 1-h, 0.}]],\n    Disk[pos, 0.1]\n}];\n"})}),"\n",(0,i.jsx)(n.admonition,{type:"info",children:(0,i.jsxs)(n.p,{children:["Proxy factory will automatically wrap all mentioned variables ",(0,i.jsx)(n.code,{children:"pos"})," and ",(0,i.jsx)(n.code,{children:"c"})," linear buffer parts wrapped with ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Interpreter/Offload",children:"Offload"})]})}),"\n",(0,i.jsx)(n.h2,{id:"constructor",children:"Constructor"}),"\n",(0,i.jsx)(n.p,{children:"To construct an single instance"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"f`AddTo[_FrontProxy`Reference, {args__}] _Integer\n"})}),"\n",(0,i.jsx)(n.p,{children:"To construct multiple instances use"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"f`AddTo[_FrontProxy`Reference, {args__}..] _List\n"})}),"\n",(0,i.jsxs)(n.p,{children:["as a result it returns ",(0,i.jsxs)(n.strong,{children:["a plain ",(0,i.jsx)(n.code,{children:"List"})," of integers corresponding to the internal ",(0,i.jsx)(n.code,{children:"Ids"})]}),". For example"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"ids = f`AddTo[disk, Sequence @@ Table[{RandomReal[{-1,1}, 2], RandomReal[{0,1}]}, {10}]];\n"})}),"\n",(0,i.jsx)(n.h2,{id:"methods",children:"Methods"}),"\n",(0,i.jsx)(n.p,{children:"The following methods can be applied"}),"\n",(0,i.jsx)(n.h3,{id:"fullform",children:(0,i.jsx)(n.code,{children:"FullForm"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"f`FullForm[_FrontProxy`Reference, id_Integer]\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"f`FullForm[_FrontProxy`Reference, {id__Integer}]\n"})}),"\n",(0,i.jsx)(n.p,{children:"Reveals the actual expressions. This method can be used to display an object. For example"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"Graphics[{f`FullForm[disk, ids]}, PlotRange->{{-1,1}, {-1,1}}]\n"})}),"\n",(0,i.jsx)(n.h3,{id:"remove",children:(0,i.jsx)(n.code,{children:"Remove"})}),"\n",(0,i.jsx)(n.p,{children:"Removes the given proxy or list of proxies by provided Ids (live)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"f`Remove[_FrontProxyFunction, Id_Integer]\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"f`Remove[_FrontProxyFunction, {Id__Integer}]\n"})}),"\n",(0,i.jsx)(n.h3,{id:"dispatch",children:(0,i.jsx)(n.code,{children:"Dispatch"})}),"\n",(0,i.jsx)(n.p,{children:"Dispatches the changes made to the properties of proxies and effectively syncing all buffers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"f`Dispatch[_FrontProxyFunction]\n"})}),"\n",(0,i.jsx)(n.p,{children:"It is called usually when all calculations have been finished and an update is needed to see the changes. Behind the scenes it submits all buffers storing the properties of object to the frontend."}),"\n",(0,i.jsx)(n.h3,{id:"frontproxybuffer",children:(0,i.jsx)(n.code,{children:"FrontProxyBuffer"})}),"\n",(0,i.jsx)(n.p,{children:"Provides a read access to the slice of a given property of all proxies in a form if linear packed array"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"FrontProxyBuffer[_FrontProxyFunction, index_Integer] _List\n"})}),"\n",(0,i.jsxs)(n.p,{children:["where ",(0,i.jsx)(n.code,{children:"index"})," goes from the first property provided in ",(0,i.jsx)(n.a,{href:"#Constructor",children:"Constructor"})," to the last. There is a special case"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"FrontProxyBuffer[_FrontProxyFunction, -1] _List\n"})}),"\n",(0,i.jsxs)(n.p,{children:["which ",(0,i.jsx)(n.strong,{children:"returns a boolean array standing for the validity of the property at the given position"}),'. Since proxies are dynamic and can be created or removed any time it might temporary lead to "holes" in buffers marked as ',(0,i.jsx)(n.code,{children:"False"})," in the list."]}),"\n",(0,i.jsxs)(n.p,{children:["Each position in buffers does correspond to ",(0,i.jsx)(n.code,{children:"Id"})," returned by ",(0,i.jsx)(n.a,{href:"#Constructor",children:"Constructor"})]}),"\n",(0,i.jsx)(n.h3,{id:"frontproxybufferset",children:(0,i.jsx)(n.code,{children:"FrontProxyBufferSet"})}),"\n",(0,i.jsx)(n.p,{children:"Updates a given property buffer with a new array"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"FrontProxyBuffer[_FrontProxyFunction, index_Integer, new_List]\n"})}),"\n",(0,i.jsxs)(n.p,{children:["For example one can update ",(0,i.jsx)(n.code,{children:"disks"})," primitives in the following way"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:"  With[{\n    position = f`Buffer[disk, 1]\n  },\n    With[{velocity = Table[{a[[2]], -a[[1]]}, {a, position}]},\n    \n    f`BufferSet[disk, 1, position - 0.1 velocity];\n    f`Dispatch[disk];\n    ];\n  ];\n"})}),"\n",(0,i.jsx)(n.p,{children:"It will cause the rotation of all disks"}),"\n",(0,i.jsx)(n.h2,{id:"tips",children:"Tips"}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["If you dynamically add proxies to the scene. Call ",(0,i.jsx)(n.a,{href:"#%60Dispatch%60",children:(0,i.jsx)(n.code,{children:"Dispatch"})})," before submitting it to a scene. This will make sure, that the buffer size is up-to date on the frontend as well."]})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["For fast animations with many proxies involved turn off transition interpolation globally on ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/",children:"Graphics"})," using an option ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/#%60TransitionType%60",children:(0,i.jsx)(n.code,{children:"TransitionType"})})," set to ",(0,i.jsx)(n.code,{children:"None"}),"."]})}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["For processing many proxies use pure functions with ",(0,i.jsx)(n.code,{children:"Map"}),", ",(0,i.jsx)(n.code,{children:"Table"})," or ",(0,i.jsx)(n.code,{children:"MapThread"})," and etc. ",(0,i.jsx)(n.strong,{children:"Multiple passes using less complicated function cost less"}),", than a single pass with one complex due to JIT."]})}),"\n",(0,i.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,i.jsx)(n.h3,{id:"spherical-attracting-molecules",children:"Spherical attracting molecules"}),"\n",(0,i.jsxs)(n.p,{children:["Here we will use Lennard-Jones potential to model a bunch of sphere-like molecules on 2D canvas aka ",(0,i.jsx)(n.a,{href:"/frontend/Reference/Graphics/",children:"Graphics"})]}),"\n",(0,i.jsx)(o,{children:'disk = f`Proxy[{pos, c}, {\n\tOpacity[0.2], RGBColor[With[{h=c}, {h, 1-h, 0.}]],\n    Disk[pos, 0.1]\n}];\n\ndisks = f`AddTo[disk, Sequence @@ Table[{RandomReal[{-1,1}, 2], 0.2}, {10}]];\n\nanimation = CreateUUID[];\nscene = FrontInstanceReference[];\n\ntrigger = 1;\n\npotential = Function[{a,b}, With[{r = Norm[a-b]+0.001, r0 = 0.22},\n  With[{c = (*FB[*)((3.0 ((*SpB[*)Power[r0(*|*),(*|*)6](*]SpB*)))(*,*)/(*,*)((*SpB[*)Power[r(*|*),(*|*)8](*]SpB*)))(*]FB*)-(*FB[*)((3.0 ((*SpB[*)Power[r0(*|*),(*|*)12](*]SpB*)))(*,*)/(*,*)((*SpB[*)Power[r(*|*),(*|*)14](*]SpB*)))(*]FB*)},\n    If[Abs[c] > 100.0, {0.,0.}, (a-b) c]\n  ]\n]];\n\nEventHandler[animation, Function[Null,\n  With[{\n    position = f`Buffer[disk, 1],\n    state    = f`Buffer[disk, 2]\n  },\n    With[{velocity = Map[Total] @ Table[potential[a,b], {a, position}, {b, position}]},\n      With[{\n        character = Map[Clip[5.0 Norm[#], {0.2, 0.8}]&, velocity]\n      },\n        f`BufferSet[disk, 1, position - 0.001 velocity];\n        f`BufferSet[disk, 2, character];\n\n        f`Dispatch[disk];\n      ];\n    ];\n  ];\n\n  trigger = 1;\n]];\n\nadd = With[{new = f`AddTo[disk, {#, 0.2}]},\n  f`Dispatch[disk];\n  FrontSubmit[f`FullForm[disk, new], scene];\n]&;\n\nGraphics[{\n  f`FullForm[disk, disks], scene,\n  AnimationFrameListener[trigger // Offload, "Event"->animation],\n  EventHandler[Null, {"click" -> add}]\n}, PlotRange->{{-1,1}, {-1,1}}, TransitionType->None]'}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:r(22163).A+"",width:"600",height:"403"})}),"\n",(0,i.jsx)(n.h3,{id:"fireworks",children:"Fireworks"}),"\n",(0,i.jsx)(n.p,{children:"A crash test for the frontend system"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-mathematica",children:'(* Define the rectangle proxy with initial properties *)\nrectangleProxy = f`Proxy[\n  {position, velocity, rotationAngle, lifeSpan}, \n  Translate[\n    {Opacity[lifeSpan], RGBColor[With[{l = lifeSpan}, {l, 0, 1 - l}]], Rectangle[{-1, -1}, {1, 1}]}, \n    position\n  ]\n];\n\n(* Initialize variables *)\nnewProxies = {};\nexpiredProxies = {};\nframeCounter = 1;\nframeRate = 1;\nlastUpdateTime = AbsoluteTime[];\n\nsceneReference = FrontInstanceReference[];\n\n(* Function to add new proxies at a given position *)\naddProxyAtPosition[position_] := newProxies = {\n  newProxies, \n  f`AddTo[\n    rectangleProxy, \n    Sequence @@ Table[\n      {position, RandomReal[{0.99, 1.01}] {Cos[angle], Sin[angle]} // N, RandomReal[{0, 3.14}], 1.0},\n      {angle, 0., 2 Pi, 2 Pi / 12.0}\n    ]\n  ]\n};\n\n(* Frame update logic *)\nModule[{},\n  EventHandler["frame", Function[Null,\n    With[{\n      positions = f`Buffer[rectangleProxy, 1],\n      velocities = f`Buffer[rectangleProxy, 2],\n      lifeSpans = f`Buffer[rectangleProxy, 4],\n      isValid = f`Buffer[rectangleProxy, -1]\n    },\n      (* Identify expired proxies for disposal *)\n      expiredProxies = MapThread[\n        If[#1 && #2 < 0.2, #3, Nothing] &, \n        {isValid, lifeSpans, Range[Length[lifeSpans]]}\n      ];\n      \n      (* Update positions and life spans *)\n      f`BufferSet[rectangleProxy, 1, positions + velocities];\n      f`BufferSet[rectangleProxy, 4, lifeSpans * 0.95];\n    ];\n\n    (* Dispatch updates to proxies *)\n    f`Dispatch[rectangleProxy];\n\n    (* Remove expired proxies *)\n    If[Length[expiredProxies] > 0,\n      f`Remove[rectangleProxy, expiredProxies];\n      expiredProxies = {};\n    ];\n\n    (* Submit new proxies *)\n    If[Length[newProxies] > 0, \n      FrontSubmit[f`FullForm[rectangleProxy, newProxies // Flatten], sceneReference];\n      newProxies = {};\n    ];\n\n    (* Update FPS counter *)\n    With[{currentTime = AbsoluteTime[]},\n      If[currentTime - lastUpdateTime > 1.0,\n        frameRate = Round[(frameCounter + frameRate) / 2.0];\n        frameCounter = 1;\n        lastUpdateTime = currentTime;\n      ,\n        frameCounter++;\n      ];\n    ];\n  ]]\n];\n\n(* Create the graphics and event handlers *)\nGraphics[\n  {\n    sceneReference, \n    {Directive[FontSize -> 20], Text[frameRate // Offload, {-80, -80}]}, \n    AnimationFrameListener[frameCounter // Offload, "Event" -> "frame"], \n    EventHandler[\n      Null, \n      {"mousemove" -> addProxyAtPosition}\n    ]\n  }, \n  PlotRange -> {{-100, 100}, {-100, 100}}, \n  TransitionType -> None\n]\n'})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.img,{src:r(31787).A+"",width:"600",height:"503"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}}}]);